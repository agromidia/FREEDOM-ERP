/* Server version: WI-V6.3.6.27020 Firebird 2.5 
   SQLDialect: 3. ODS: 11.2. Forced writes: On. Sweep inteval: 20000.
   Page size: 16384. Cache pages: 2048 (32768 Kb). Read-only: False. */
SET NAMES ISO8859_1;

SET SQL DIALECT 3;

CONNECT 'C:\opt\firebird\dados\freedom2.fdb' USER 'SYSDBA' PASSWORD 'masterkey';

SET AUTODDL ON;

ALTER TABLE VDVENDEDOR DROP CONSTRAINT VDVENDEDORFKFNPLAN;

ALTER TABLE VDITVENDAITVENDA DROP CONSTRAINT VDITVENDAFKITVEND1;

ALTER TABLE SGPREFERE1 DROP CONSTRAINT SGPREFERE1FKPLANJR;

ALTER TABLE SGPREFERE1 DROP CONSTRAINT SGPREFERE1FKPLANJP;

ALTER TABLE SGPREFERE1 DROP CONSTRAINT SGPREFERE1FKPLANDR;

ALTER TABLE SGPREFERE1 DROP CONSTRAINT SGPREFERE1FKPLANDC;

ALTER TABLE SGPREFERE1 DROP CONSTRAINT SGPREFERE1FKPLANCHEQUE;

ALTER TABLE SGPREFERE7 DROP CONSTRAINT SGPREF7FNPLANVDCONSIG;

ALTER TABLE SGPREFERE7 DROP CONSTRAINT SGPREF7FKFNPLANCONSIG;

ALTER TABLE FNSUBLANCA DROP CONSTRAINT FNSUBLANCAFKFNPLAN;

RECONNECT;

ALTER TABLE FNSALDOLANCA DROP CONSTRAINT FNSALDOLANCAPK;

ALTER TABLE FNSALDOLANCA DROP CONSTRAINT FNSALDOLANCAFKFNPL;

ALTER TABLE FNRECEBER DROP CONSTRAINT FNRECEBERFKFNPLANEJ;

ALTER TABLE FNPLANOPAG DROP CONSTRAINT FNPLANOPAGFKFNPLAN;

ALTER TABLE FNPLANEJAMENTO DROP CONSTRAINT FNPLANEJAMFKFNPLAN;

RECONNECT;

ALTER TABLE CPCOMPRA DROP CONSTRAINT CPCOMPRAFKFNPLANEJAMENTO;

ALTER TABLE CPRATEIO DROP CONSTRAINT CPRATEIOFKFNPLANEJ;

ALTER TABLE EQPRODPLAN DROP CONSTRAINT EQPRODPLANFKFNPLAN;

ALTER TABLE FNCONTA DROP CONSTRAINT FNCONTAFKFNPLANEJA;

ALTER TABLE FNFBNCLI DROP CONSTRAINT FNFBNCLIFKFNPLANEJ;

ALTER TABLE FNITPAGAR DROP CONSTRAINT FNITPAGARFKFNPLANE;

ALTER TABLE FNITRECEBER DROP CONSTRAINT FNITRECEBERFKFNPLA;

ALTER TABLE FNLANCA DROP CONSTRAINT FNLANCAFKFNPLANEJA;

ALTER TABLE FNPAGAR DROP CONSTRAINT FNPAGARFKFNPLANEJ;

ALTER TABLE FNPAGTOCOMI DROP CONSTRAINT FNPAGTOCOMIFKFNPLA;

ALTER TABLE FNPLANEJAMENTO DROP CONSTRAINT FNPLANEJAMENTOPK;

RECONNECT;

ALTER TABLE FNCONTA DROP CONSTRAINT FNCONTAUNIQFNPLANEJA;

ALTER TABLE EQSALDOPROD DROP CONSTRAINT EQSOLDOPRODFKEQPRO;

ALTER TABLE EQSALDOPROD DROP CONSTRAINT EQSOLDOPRODFKEQALM;

ALTER TABLE CPCOMPRAVENDA DROP CONSTRAINT CPCOMPRAVENDAFKCPI;

/* Alter Procedure (Before Drop)... */
SET TERM ^ ;

ALTER PROCEDURE EQADICPRODUTOSP(CODEMPPD INTEGER,
CODFILIALPD INTEGER,
CODPROD INTEGER,
DESCPROD VARCHAR(100),
DESCAUXPROD VARCHAR(40),
REFPROD VARCHAR(20),
CODFABPROD CHAR(15),
CODBARPROD CHAR(13),
CODEMPMG INTEGER,
CODFILIALMG SMALLINT,
CODMODG INTEGER,
DESCCOMPPROD VARCHAR(500),
PRECOBASE DECIMAL(15,5),
ATUALIZAPROD CHAR)
 AS
 BEGIN EXIT; END
^


/* Drop Procedure... */
SET TERM ; ^

DROP PROCEDURE EQADICPRODUTOSP;


/* Drop Trigger... */
DROP TRIGGER ATAGENDATGBU;

DROP TRIGGER ATATENDENTETGBU;

DROP TRIGGER ATATENDIMENTOITRECTGBU;

DROP TRIGGER ATATENDIMENTOORCTGBU;

DROP TRIGGER ATATRIBUICAOTGBU;

DROP TRIGGER ATCLASATENDOTGBU;

DROP TRIGGER ATCONVATRIBTBTGBU;

DROP TRIGGER ATCONVATRIBTGBU;

DROP TRIGGER ATCONVENIADOTGBI;

DROP TRIGGER ATCONVENIADOTGBU;

DROP TRIGGER ATENCAMINHADORTGBU;

DROP TRIGGER ATESPECATENDTGBU;

DROP TRIGGER ATMODATENDOTGBU;

DROP TRIGGER ATSETORATENDENTETGBU;

DROP TRIGGER ATSETORTGBU;

DROP TRIGGER ATTIPOATENDOSETORTGBU;

DROP TRIGGER ATTIPOATENDOTGBU;

DROP TRIGGER ATTIPOATENDTGBU;

DROP TRIGGER ATTIPOCONVTGBU;

DROP TRIGGER CBCONTAEXTTGBU;

DROP TRIGGER CPCOMPRAPEDTGBU;

DROP TRIGGER CPCOMPRASOLTGBU;

DROP TRIGGER CPCOMPRAVENDATGBU;

DROP TRIGGER CPCOTACAOTGBU;

DROP TRIGGER CPDEVOLUCAOTGBI;

DROP TRIGGER CPDEVOLUCAOTGBU;

DROP TRIGGER CPEQUIVCFOPTGBU;

DROP TRIGGER CPIMPORTACAOADICTGBU;

DROP TRIGGER CPITORDCOMPRAPETGBU;

DROP TRIGGER CPITORDCOMPRATGBU;

DROP TRIGGER CPITSOLITSOL;

DROP TRIGGER CPITSUMSOLTGBI;

DROP TRIGGER CPITSUMSOLTGBU;

DROP TRIGGER CPPRODFORTGBU;

DROP TRIGGER CPRATEIOTGBU;

DROP TRIGGER CPSOLICITACAOTGBI;

DROP TRIGGER CPTABFORTGBU;

DROP TRIGGER CPTIPOFORTGBU;

DROP TRIGGER CRCHAMADOANEXOTGBU;

DROP TRIGGER CRCHAMADOTGBU;

DROP TRIGGER CRFEEDBACKTGBU;

DROP TRIGGER CRFICHAAVALTGBU;

DROP TRIGGER CRMARCADORTGBU;

DROP TRIGGER CRMOTIVOAVALTGBU;

DROP TRIGGER CRMOTIVOFBTGBU;

DROP TRIGGER CRPESSOATGBU;

DROP TRIGGER CRQUALIFICACAOTGBU;

DROP TRIGGER CRTAREFATGBU;

DROP TRIGGER CRTIPOCHAMADOTGBU;

DROP TRIGGER EQALMOXFILIALTGBU;

DROP TRIGGER EQALMOXTGBU;

DROP TRIGGER EQCLIFORTGBU;

DROP TRIGGER EQETIQPRODTGBU;

DROP TRIGGER EQEXPEDAMOSTRAGEMTGBU;

DROP TRIGGER EQFATCONVTGBU;

DROP TRIGGER EQGUIATRAFTGBU;

DROP TRIGGER EQITEXPEDICAOTGBU;

DROP TRIGGER EQITMODGRADETGBU;

DROP TRIGGER EQITRECMERCITCPTGBU;

DROP TRIGGER EQITRECMERCITOSITORCTGBU;

DROP TRIGGER EQITRECMERCITOSTGBU;

DROP TRIGGER EQITRECMERCTGBU;

DROP TRIGGER EQITVARGRADETGBU;

DROP TRIGGER EQLANCTOEXPTGBU;

DROP TRIGGER EQLOCDESCARGA;

DROP TRIGGER EQMARCATGBU;

DROP TRIGGER EQMODGRADETGBU;

DROP TRIGGER EQMODLOTETGBU;

DROP TRIGGER EQMOVEXPTGBU;

DROP TRIGGER EQMOVSERIETGBU;

DROP TRIGGER EQPREVESTOQLOGTGBU;

DROP TRIGGER EQPROCEXPEDTGBU;

DROP TRIGGER EQPROCRECTGBU;

DROP TRIGGER EQPRODACESSOTGBU;

DROP TRIGGER EQPRODPLANBU;

DROP TRIGGER EQPRODUTOLOGTGBU;

DROP TRIGGER EQRECAMOSTRAGEMTGBU;

DROP TRIGGER EQRECMERCTGBU;

DROP TRIGGER EQRMAALTGBU;

DROP TRIGGER EQSECAOTGBU;

DROP TRIGGER EQSERIETGBU;

DROP TRIGGER EQTIPOEXPEDTGBU;

DROP TRIGGER EQTIPOEXPTGBU;

DROP TRIGGER EQTIPOMOVUSUTGBU;

DROP TRIGGER EQTIPORECTGBU;

DROP TRIGGER EQUNIDADETGBU;

DROP TRIGGER EQVARGRADETGBU;

DROP TRIGGER FNBANCOTGBU;

DROP TRIGGER FNBORDEROTGBU;

DROP TRIGGER FNCARTCOBTGBU;

DROP TRIGGER FNCCTGBU;

DROP TRIGGER FNCHEQUETGBU;

DROP TRIGGER FNCONTATGBU;

DROP TRIGGER FNCONTAUSUTGBU;

DROP TRIGGER FNCONTAVINCULADATGBU;

DROP TRIGGER FNCOTMOEDATGBU;

DROP TRIGGER FNFBNCLITGBU;

DROP TRIGGER FNFBNCODRETTGBU;

DROP TRIGGER FNFBNRECTGBU;

DROP TRIGGER FNFINALIDADETGBU;

DROP TRIGGER FNHISTPADTGBU;

DROP TRIGGER FNITFBNCODRETTGBU;

DROP TRIGGER FNITMODBOLETOTGBU;

DROP TRIGGER FNITRENEGRECTGBU;

DROP TRIGGER FNITTBJUROSTGBU;

DROP TRIGGER FNLANCATGBU;

DROP TRIGGER FNLIBCREDTGBU;

DROP TRIGGER FNMODBOLETOTGBU;

DROP TRIGGER FNMOEDATGBU;

DROP TRIGGER FNPAGARTGBU;

DROP TRIGGER FNPAGTOCOMITGBU;

DROP TRIGGER FNPARCPAGTGBU;

DROP TRIGGER FNPLANOPAGTGBU;

DROP TRIGGER FNRENEGRECTGBU;

DROP TRIGGER FNTALAOCHEQTGBU;

DROP TRIGGER FNTBJUROSTGBU;

DROP TRIGGER FNTIPOCOBTGBU;

DROP TRIGGER FNTIPOCREDTGBU;

DROP TRIGGER FNTIPORESTRTGBU;

DROP TRIGGER LFCLFISCALTGBU;

DROP TRIGGER LFCSOSNTGBU;

DROP TRIGGER LFITCLFISCALTGBU;

DROP TRIGGER LFITCOMPRATGBU;

DROP TRIGGER LFITNATOPERTGBU;

DROP TRIGGER LFITREGRAFISCALTGBU;

DROP TRIGGER LFITVENDATGBU;

DROP TRIGGER LFLIVROFISCALTGBU;

DROP TRIGGER LFMENSAGEMTGBU;

DROP TRIGGER LFMODDOCFISCTGBU;

DROP TRIGGER LFMODNOTATGBU;

DROP TRIGGER LFNATOPERTGBU;

DROP TRIGGER LFNBMTGBU001;

DROP TRIGGER LFNCMNBMTGBU001;

DROP TRIGGER LFNCMTGBU001;

DROP TRIGGER LFREGRAFISCALTGBU;

DROP TRIGGER LFSEQSERIETGBU;

DROP TRIGGER LFSERIETGBU;

DROP TRIGGER LFSERVICOTGBU;

DROP TRIGGER LFSITTRIBTGBU;

DROP TRIGGER LFTABICMSTGBU;

DROP TRIGGER LFTIPOFISCCLITGBU;

DROP TRIGGER LFTRATTRIBTGBU;

DROP TRIGGER PEBATIDATGBU;

DROP TRIGGER PEFALTATGBU;

DROP TRIGGER PPDISTRIBTGBU;

DROP TRIGGER PPESTRUANALISETGBU;

DROP TRIGGER PPESTRUFASETGBU;

DROP TRIGGER PPFASETGBU;

DROP TRIGGER PPFOTOMTANTGBU;

DROP TRIGGER PPITRETCPTGBU;

DROP TRIGGER PPMETODOANALISETGBU;

DROP TRIGGER PPOPACAOCORRETTGBU;

DROP TRIGGER PPOPENTRADATGBU;

DROP TRIGGER PPOPITORCTGBU;

DROP TRIGGER PPPROCESSAOPTMPTGBU;

DROP TRIGGER PPRECURSOTGBU;

DROP TRIGGER PPRETCPTGBU;

DROP TRIGGER PPTIPOANALISETGBU;

DROP TRIGGER PPTIPORECTGBU;

DROP TRIGGER PVCAIXAIMPTGBU;

DROP TRIGGER PVLEITURAXTGBU;

DROP TRIGGER PVMOVCAIXATGBU;

DROP TRIGGER PVSEQMOVCAIXATGBU;

DROP TRIGGER PVSEQUENCIATGBU;

DROP TRIGGER RHAREATGBU;

DROP TRIGGER RHBENEFICIOTGBU;

DROP TRIGGER RHCANDIDATOCARACTGBU;

DROP TRIGGER RHCANDIDATOCURSOTGBU;

DROP TRIGGER RHCANDIDATOFUNCTGBU;

DROP TRIGGER RHCANDIDATOSTATUSTGBU;

DROP TRIGGER RHCANDIDATOTGBU;

DROP TRIGGER RHCARACTERISTICATGBI;

DROP TRIGGER RHCODGPSTGBU;

DROP TRIGGER RHCURSOTGBU;

DROP TRIGGER RHDEPTOTGBU;

DROP TRIGGER RHEMPREGADOBENEFTGBU;

DROP TRIGGER RHEMPREGADOSALTGBU;

DROP TRIGGER RHEMPREGADOTGBU;

DROP TRIGGER RHEXPEDIENTETGBU;

DROP TRIGGER RHEXPEDMESGBU;

DROP TRIGGER RHFUNCAOTGBU;

DROP TRIGGER RHNIVELCURSOTGBU;

DROP TRIGGER RHPONTOTGBU;

DROP TRIGGER RHTABELAINSSTGBU;

DROP TRIGGER RHTABELAIRRFTGBU;

DROP TRIGGER RHTURNOTGBU;

DROP TRIGGER RHVAGACANDIDATOTGBU;

DROP TRIGGER RHVAGACARACQUALITGBU;

DROP TRIGGER RHVAGACARACRESTTGBU;

DROP TRIGGER RHVAGACURSOTGBU;

DROP TRIGGER RHVAGASTATUSTGBU;

DROP TRIGGER SGACESSOEUTGBU;

DROP TRIGGER SGACESSOMGTGBU;

DROP TRIGGER SGACESSOMUTGBU;

DROP TRIGGER SGAGENTETGBU;

DROP TRIGGER SGATRIBUICAOTGBU;

DROP TRIGGER SGATRIBUSUTGBU;

DROP TRIGGER SGBAIRROTGBU;

DROP TRIGGER SGCATIMGTGBU;

DROP TRIGGER SGCONEXAOTGBU;

DROP TRIGGER SGEMPRESATGBU;

DROP TRIGGER SGEQVCLIFORTGBU0;

DROP TRIGGER SGESTACAOBALTGBU;

DROP TRIGGER SGESTACAOIMPTGBU;

DROP TRIGGER SGESTACAOTGBU;

DROP TRIGGER SGESTCIVILTGBU;

DROP TRIGGER SGFERIADOBTGU;

DROP TRIGGER SGFILIALTGBU;

DROP TRIGGER SGFLUXOTGBU;

DROP TRIGGER SGGATILHOTGBU;

DROP TRIGGER SGGRAUINSTTGBU;

DROP TRIGGER SGGRPUSUTGBU;

DROP TRIGGER SGIMAGEMTGBU;

DROP TRIGGER SGIMPRESSORATGBU;

DROP TRIGGER SGITFLUXOTGBU;

DROP TRIGGER SGITPREFERE6TGBU;

DROP TRIGGER SGITPROCESSOTGBU;

DROP TRIGGER SGITTABELATGBU;

DROP TRIGGER SGLOGTGBU;

DROP TRIGGER SGMENUOBJTGBU;

DROP TRIGGER SGMENUTGBU;

DROP TRIGGER SGMODETIQUETATGBU;

DROP TRIGGER SGMODULOTGBU;

DROP TRIGGER SGMUNICIPIOTGBU;

DROP TRIGGER SGOBJETOTBTGBU;

DROP TRIGGER SGOBJETOTGBU;

DROP TRIGGER SGPAISTGBU;

DROP TRIGGER SGPAPELTGBU;

DROP TRIGGER SGPREFERE1TGBU;

DROP TRIGGER SGPREFERE2TGBU;

DROP TRIGGER SGPREFERE3TGBU;

DROP TRIGGER SGPREFERE4TGBU;

DROP TRIGGER SGPREFERE5_BU0;

DROP TRIGGER SGPREFERE6TGBU;

DROP TRIGGER SGPREFERE7_BU0;

DROP TRIGGER SGPREFERE8TGBU;

DROP TRIGGER SGPROCESSOTGBU;

DROP TRIGGER SGPROXYWEBTGBU;

DROP TRIGGER SGSEQUENCIATGBU;

DROP TRIGGER SGSISTEMATGBU;

DROP TRIGGER SGTABELATGBU;

DROP TRIGGER SGTAREFATGBU;

DROP TRIGGER SGTIPOAGENDATGBU;

DROP TRIGGER SGTRATARETTGBU;

DROP TRIGGER SGUFTGBU;

DROP TRIGGER SGUNIFCODTGBU;

DROP TRIGGER SGVARIAVELTGBU;

DROP TRIGGER SVAVALIACAOTGBU;

DROP TRIGGER SVEXECUCAOTGBU;

DROP TRIGGER SVITOSTGBU;

DROP TRIGGER SVOSTGBU;

DROP TRIGGER TKATIVIDADETGBU;

DROP TRIGGER TKCAMPANHACLITGBU;

DROP TRIGGER TKCAMPANHACTOTGBU;

DROP TRIGGER TKCAMPANHAEMAILTGBU;

DROP TRIGGER TKCAMPANHATGBU;

DROP TRIGGER TKCONFEMAILTGBU;

DROP TRIGGER TKCONTCLIBU;

DROP TRIGGER TKCTOATIVTGBU;

DROP TRIGGER TKCTOGRPINTTGBU;

DROP TRIGGER TKEMAILTGBU;

DROP TRIGGER TKHISTORICOTGBU;

DROP TRIGGER TKORIGCONTTGBU;

DROP TRIGGER TKSETORCTOTGBU;

DROP TRIGGER TKSITCAMPTGBU;

DROP TRIGGER TKTIPOCONTTGBU;

DROP TRIGGER TKTIPOIMPTGBU;

DROP TRIGGER VDAUXVENDATGBU;

DROP TRIGGER VDCLASCLITGBU;

DROP TRIGGER VDCLIAUTPTGBU;

DROP TRIGGER VDCLICOMPLTGBU;

DROP TRIGGER VDCLICONTASTGBU;

DROP TRIGGER VDCLIENTEFORTGBU;

DROP TRIGGER VDCLIIMOVTGBU;

DROP TRIGGER VDCLIMETAVENDTGBU;

DROP TRIGGER VDCLIREFCTGBU;

DROP TRIGGER VDCLIREFPTGBU;

DROP TRIGGER VDCLISOCIOSTGBU;

DROP TRIGGER VDCLITERRATGBU;

DROP TRIGGER VDCLIVEICTGBU;

DROP TRIGGER VDCONSIGNACAOTGBU;

DROP TRIGGER VDCONTRATOTGBU;

DROP TRIGGER VDDETORCTGBU;

DROP TRIGGER VDETIQCLITGBU;

DROP TRIGGER VDFINCONTRTGBU;

DROP TRIGGER VDFOTOPRODTGBU;

DROP TRIGGER VDGRUPORCTGBU;

DROP TRIGGER VDITCONTRATOTGBU;

DROP TRIGGER VDITCUSTOORCTGBU;

DROP TRIGGER VDITCUSTOVENDATGBU;

DROP TRIGGER VDITDETORCTGBU;

DROP TRIGGER VDITGRUPORCTGBU;

DROP TRIGGER VDITKITTGBI;

DROP TRIGGER VDITROMANEIOTGBU;

DROP TRIGGER VDMOTORISTATGBU;

DROP TRIGGER VDOBSCLITGBU;

DROP TRIGGER VDPRAZOENTTGBU;

DROP TRIGGER VDPREVTRIBITORCTGBU;

DROP TRIGGER VDREGCOMISDESC_BU0;

DROP TRIGGER VDREGRACOMISTGBU;

DROP TRIGGER VDREMCONSIGTGBU;

DROP TRIGGER VDROMANEIOTGBU;

DROP TRIGGER VDSETORROTATGBU;

DROP TRIGGER VDSETORTGBU;

DROP TRIGGER VDSTATUSORCTGBU;

DROP TRIGGER VDTABPRECOTGBU;

DROP TRIGGER VDTEFTGBU;

DROP TRIGGER VDTIPOCLITGBU;

DROP TRIGGER VDTIPOVENDTGBU;

DROP TRIGGER VDVEICULOTGBU;

DROP TRIGGER VDVENDACOMISTGBU;

DROP TRIGGER VDVENDACONSIGTGBU;

DROP TRIGGER VDVENDAENTREGATGBU;

DROP TRIGGER VDVENDAORCTGBU;

DROP TRIGGER VDVENDEDORTGBU;


/* Create Table... */
CREATE TABLE EQGRUPOIMG(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODGRUP VARCHAR(14) NOT NULL COLLATE PT_BR,
SEQIMG INTEGER NOT NULL,
CODEMPIM INTEGER NOT NULL,
CODFILIALIM SMALLINT NOT NULL,
CODIMG INTEGER NOT NULL,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR);


CREATE TABLE EQITRMLOGALERTA(ID BIGINT NOT NULL,
CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
TICKET INTEGER NOT NULL,
CODITRECMERC INTEGER NOT NULL,
CODEMPPD INTEGER NOT NULL,
CODFILIALPD SMALLINT NOT NULL,
CODPROD INTEGER NOT NULL,
NUMSERIE VARCHAR(30) NOT NULL COLLATE PT_BR,
DTLOG DATE DEFAULT 'today' NOT NULL,
HLOG TIME DEFAULT 'now' NOT NULL,
DTMOV DATE DEFAULT 'today' NOT NULL,
DIASMOV INTEGER DEFAULT 0 NOT NULL,
DTTICKET DATE DEFAULT 'today' NOT NULL,
MENSAGEM VARCHAR(1000) DEFAULT '' NOT NULL COLLATE PT_BR,
TICKET_ANT INTEGER DEFAULT 0 NOT NULL,
DTINS DATE DEFAULT 'today' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'today',
HALT TIME DEFAULT 'now',
IDUSUALT VARCHAR(128) DEFAULT USER COLLATE PT_BR);


CREATE TABLE EQSEQLOTE(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODEMPPD INTEGER NOT NULL,
CODFILIALPD SMALLINT NOT NULL,
CODPROD INTEGER NOT NULL,
SEQLOTE BIGINT NOT NULL,
DTINS DATE DEFAULT 'today' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'today',
HALT TIME DEFAULT 'now',
IDUSUALT VARCHAR(128) DEFAULT USER COLLATE PT_BR);


CREATE TABLE EQTIPOCTRLPROD(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODTPCTRL INTEGER NOT NULL,
DESCTPCTRL VARCHAR(100) COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR);


CREATE TABLE FNTIPOCOBVD(ID BIGINT NOT NULL,
CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODEMPTC INTEGER NOT NULL,
CODFILIALTC SMALLINT NOT NULL,
CODTIPOCOB INTEGER NOT NULL,
TPAG CHAR(2) NOT NULL COLLATE PT_BR,
CODEMPCT INTEGER NOT NULL,
CODFILIALCT SMALLINT NOT NULL,
NUMCONTA VARCHAR(10) NOT NULL COLLATE PT_BR,
CODEMPPN INTEGER NOT NULL,
CODFILIALPN SMALLINT NOT NULL,
ANOPLAN SMALLINT NOT NULL,
CODPLAN CHAR(13) NOT NULL COLLATE PT_BR,
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC SMALLINT,
CODCC CHAR(19) COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT VARCHAR(128) DEFAULT USER COLLATE PT_BR);


CREATE TABLE LFCEST(CODCEST VARCHAR(10) NOT NULL COLLATE PT_BR,
DESCCEST VARCHAR(300) NOT NULL COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT VARCHAR(128) DEFAULT USER COLLATE PT_BR);


CREATE TABLE LFCESTNCM(CODCEST VARCHAR(10) NOT NULL COLLATE PT_BR,
CODNCM VARCHAR(10) NOT NULL COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT VARCHAR(128) DEFAULT USER COLLATE PT_BR);


CREATE TABLE LFENQIPI(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODENQ VARCHAR(3) NOT NULL COLLATE PT_BR,
DESCENQ VARCHAR(500) NOT NULL COLLATE PT_BR,
CSTENTRADA CHAR(2) NOT NULL COLLATE PT_BR,
CSTSAIDA CHAR(2) NOT NULL COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR);


CREATE TABLE RPCLIENTE(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODCLI INTEGER NOT NULL,
RAZCLI CHAR(80) NOT NULL COLLATE PT_BR,
NOMECLI CHAR(80) NOT NULL COLLATE PT_BR,
CODEMPVO INTEGER NOT NULL,
CODFILIALVO SMALLINT NOT NULL,
CODVEND INTEGER NOT NULL,
CODEMPTC INTEGER NOT NULL,
CODFILIALTC SMALLINT NOT NULL,
CODTIPOCLI INTEGER NOT NULL,
CODEMPPG INTEGER,
CODFILIALPG SMALLINT,
CODPLANOPAG INTEGER,
CNPJCLI CHAR(14) COLLATE PT_BR,
INSCCLI CHAR(15) COLLATE PT_BR,
ENDCLI CHAR(45) COLLATE PT_BR,
CIDCLI CHAR(30) COLLATE PT_BR,
ESTCLI CHAR(2) COLLATE PT_BR,
CEPCLI CHAR(8) COLLATE PT_BR,
BAIRCLI CHAR(30) COLLATE PT_BR,
DDDCLI CHAR(4) COLLATE PT_BR,
FONECLI CHAR(12) COLLATE PT_BR,
FAXCLI CHAR(12) COLLATE PT_BR,
EMAILCLI CHAR(50) COLLATE PT_BR,
ENDCOBCLI CHAR(45) COLLATE PT_BR,
BAIRCOBCLI CHAR(30) COLLATE PT_BR,
CIDCOBCLI CHAR(30) COLLATE PT_BR,
ESTCOBCLI CHAR(2) COLLATE PT_BR,
CEPCOBCLI CHAR(8) COLLATE PT_BR,
ENDENTCLI CHAR(45) COLLATE PT_BR,
BAIRENTCLI CHAR(30) COLLATE PT_BR,
CIDENTCLI CHAR(30) COLLATE PT_BR,
CEPENTCLI CHAR(8) COLLATE PT_BR,
ESTENTCLI CHAR(2) COLLATE PT_BR,
INSCENTCLI CHAR(15) COLLATE PT_BR,
CNPJENTCLI CHAR(14) COLLATE PT_BR,
ATIVCLI CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT user NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT CHAR(8) DEFAULT user NOT NULL COLLATE PT_BR,
FATLUCR NUMERIC(9,2),
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCLICP INTEGER,
CONTATOCLI VARCHAR(100) COLLATE PT_BR,
CELCONTATOCLI CHAR(12) COLLATE PT_BR);


CREATE TABLE RPCOMISSAO(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODPED INTEGER NOT NULL,
CODITPED SMALLINT NOT NULL,
CODEMPVD INTEGER NOT NULL,
CODFILIALVD SMALLINT NOT NULL,
CODVEND INTEGER NOT NULL,
VLRCOMISS NUMERIC(15,5),
VLRPAGO NUMERIC(15,5),
DTPAGO DATE,
STATUSCOMISS CHAR(2) DEFAULT 'PE' NOT NULL COLLATE PT_BR);


CREATE TABLE RPCONTATO(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODCONT INTEGER NOT NULL,
NOMECONT CHAR(45) NOT NULL COLLATE PT_BR,
ENDCONT CHAR(45) COLLATE PT_BR,
CIDCONT CHAR(30) COLLATE PT_BR,
BAIRCONT CHAR(30) COLLATE PT_BR,
CEPCONT CHAR(8) COLLATE PT_BR,
ESTCONT CHAR(2) COLLATE PT_BR,
DDDCONT CHAR(4) COLLATE PT_BR,
FONECONT CHAR(12) COLLATE PT_BR,
FAXCONT CHAR(8) COLLATE PT_BR,
EMAILCONT CHAR(50) COLLATE PT_BR,
NASCCONT DATE,
DTINS DATE DEFAULT 'now',
IDUSUINS CHAR(8) DEFAULT USER COLLATE PT_BR,
DTALT DATE DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER COLLATE PT_BR,
HINS TIME DEFAULT 'now',
HALT TIME DEFAULT 'now');


CREATE TABLE RPCOTMOEDA(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODMOEDA CHAR(4) NOT NULL COLLATE PT_BR,
DATACOT DATE NOT NULL,
VALORCOT NUMERIC(15,5) NOT NULL,
DTINS DATE DEFAULT 'now',
IDUSUINS CHAR(8) DEFAULT USER COLLATE PT_BR,
DTALT DATE DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER COLLATE PT_BR,
HINS TIME DEFAULT 'now',
HALT TIME DEFAULT 'now');


CREATE TABLE RPETIQPROD(NRCONEXAO INTEGER NOT NULL,
CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODPROD INTEGER NOT NULL,
DTINS DATE DEFAULT 'today' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT USER NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'today',
HALT TIME DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER COLLATE PT_BR);


CREATE TABLE RPFATURAMENTO(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODPED INTEGER NOT NULL,
CODITPED SMALLINT NOT NULL,
QTDFATURADO NUMERIC(15,5),
VLRFATURADO NUMERIC(15,5),
QTDPENDENTE NUMERIC(15,5),
PERCCOMISFAT NUMERIC(15,5),
VLRCOMISFAT NUMERIC(15,5),
DTFATURADO DATE,
STATUSFAT CHAR(2) DEFAULT 'PE' NOT NULL COLLATE PT_BR);


CREATE TABLE RPFORNECEDOR(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODFOR INTEGER NOT NULL,
RAZFOR CHAR(80) NOT NULL COLLATE PT_BR,
NOMEFOR CHAR(80) NOT NULL COLLATE PT_BR,
CNPJFOR CHAR(14) COLLATE PT_BR,
INSCFOR CHAR(15) COLLATE PT_BR,
ENDFOR CHAR(45) COLLATE PT_BR,
CIDFOR CHAR(30) COLLATE PT_BR,
ESTFOR CHAR(2) COLLATE PT_BR,
CEPFOR CHAR(8) COLLATE PT_BR,
BAIRFOR CHAR(30) COLLATE PT_BR,
DDDFOR CHAR(4) COLLATE PT_BR,
FONEFOR CHAR(12) COLLATE PT_BR,
FAXFOR CHAR(12) COLLATE PT_BR,
EMAILFOR CHAR(50) COLLATE PT_BR,
CODREPFOR INTEGER,
ATIVFOR CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT user NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT CHAR(8) DEFAULT user NOT NULL COLLATE PT_BR,
TIPOFOR CHAR COLLATE PT_BR);


CREATE TABLE RPGRUPO(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODGRUP CHAR(14) NOT NULL COLLATE PT_BR,
DESCGRUP CHAR(50) NOT NULL COLLATE PT_BR,
NIVELGRUP INTEGER,
CODEMPSG INTEGER,
CODFILIALSG SMALLINT,
CODSUBGRUP CHAR(14) COLLATE PT_BR,
SIGLAGRUP CHAR(10) COLLATE PT_BR,
DTINS DATE DEFAULT 'now',
IDUSUINS CHAR(8) DEFAULT USER COLLATE PT_BR,
DTALT DATE DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER COLLATE PT_BR,
HINS TIME DEFAULT 'now',
HALT TIME DEFAULT 'now');


CREATE TABLE RPITNOTA(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODPED INTEGER NOT NULL,
CODITPED SMALLINT NOT NULL,
DOCNOTA INTEGER NOT NULL,
DTEMITNOTA DATE NOT NULL,
QTDITNOTA NUMERIC(15,5) NOT NULL,
PRECOITNOTA NUMERIC(15,5) NOT NULL,
VLRITNOTA NUMERIC(15,5) NOT NULL,
VLRIPIITNOTA NUMERIC(15,5),
VLRDESCITNOTA NUMERIC(15,5),
VLRADICITNOTA NUMERIC(15,5),
VLRRECITNOTA NUMERIC(15,5),
VLRPAGITNOTA NUMERIC(15,5),
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT USER NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT CHAR(8) DEFAULT 'now' NOT NULL COLLATE PT_BR);


CREATE TABLE RPITPEDIDO(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODPED INTEGER NOT NULL,
CODITPED SMALLINT NOT NULL,
CODPROD INTEGER NOT NULL,
CODFILIALPD SMALLINT NOT NULL,
CODEMPPD INTEGER NOT NULL,
QTDITPED NUMERIC(15,5) NOT NULL,
PRECOITPED NUMERIC(15,5) NOT NULL,
VLRITPED NUMERIC(15,5) NOT NULL,
VLRLIQITPED NUMERIC(15,5) NOT NULL,
PERCIPIITPED NUMERIC(15,5),
VLRIPIITPED NUMERIC(15,5),
PERCDESCITPED NUMERIC(15,5),
VLRDESCITPED NUMERIC(15,5),
PERCADICITPED NUMERIC(15,5),
VLRADICITPED NUMERIC(15,5),
PERCRECITPED NUMERIC(15,5),
VLRRECITPED NUMERIC(15,5),
PERCPAGITPED NUMERIC(15,5),
VLRPAGITPED NUMERIC(15,5),
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT user NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT CHAR(8) DEFAULT 'now' NOT NULL COLLATE PT_BR,
REFPROD CHAR(13) COLLATE PT_BR,
PERCITLUCRO NUMERIC(15,5),
FATLUCR NUMERIC(9,2));


CREATE TABLE RPMOEDA(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODMOEDA CHAR(4) NOT NULL COLLATE PT_BR,
TIPOMOEDA CHAR NOT NULL COLLATE PT_BR,
SINGMOEDA CHAR(20) NOT NULL COLLATE PT_BR,
PLURMOEDA CHAR(20) NOT NULL COLLATE PT_BR,
DECSMOEDA CHAR(20) COLLATE PT_BR,
DECPMOEDA CHAR(20) COLLATE PT_BR,
DTINS DATE DEFAULT 'now',
IDUSUINS CHAR(8) DEFAULT USER COLLATE PT_BR,
DTALT DATE DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER COLLATE PT_BR,
HINS TIME DEFAULT 'now',
HALT TIME DEFAULT 'now');


CREATE TABLE RPPARCPLANOPAG(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODPLANOPAG INTEGER NOT NULL,
NROPARCPAG INTEGER NOT NULL,
DIASPAG INTEGER,
PERCPAG NUMERIC(7,6),
JUROSPARCPAG NUMERIC(7,6),
DESCPARCPAG CHAR(30) COLLATE PT_BR,
DTINS DATE DEFAULT 'now',
IDUSUINS CHAR(8) DEFAULT USER COLLATE PT_BR,
DTALT DATE DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER COLLATE PT_BR,
HINS TIME DEFAULT 'now',
HALT TIME DEFAULT 'now');


CREATE TABLE RPPEDIDO(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODPED INTEGER NOT NULL,
DATAPED DATE NOT NULL,
CODCLI INTEGER NOT NULL,
CODFILIALCL SMALLINT NOT NULL,
CODEMPCL INTEGER NOT NULL,
CODVEND INTEGER NOT NULL,
CODFILIALVD SMALLINT NOT NULL,
CODEMPVD INTEGER NOT NULL,
CODPLANOPAG INTEGER NOT NULL,
CODFILIALPG SMALLINT NOT NULL,
CODEMPPG INTEGER NOT NULL,
CODMOEDA CHAR(4) NOT NULL COLLATE PT_BR,
CODFILIALMO SMALLINT NOT NULL,
CODEMPMO INTEGER NOT NULL,
CODFOR INTEGER NOT NULL,
CODFILIALFO SMALLINT NOT NULL,
CODEMPFO INTEGER NOT NULL,
CODTRAN INTEGER,
CODFILIALTP SMALLINT,
CODEMPTP INTEGER,
TIPOFRETEPED CHAR DEFAULT 'C' COLLATE PT_BR,
TIPOREMPED CHAR DEFAULT 'M' COLLATE PT_BR,
NUMPEDCLI VARCHAR(20) COLLATE PT_BR,
NUMPEDFOR VARCHAR(20) COLLATE PT_BR,
VLRTOTPED NUMERIC(15,5),
QTDTOTPED NUMERIC(15,5),
VLRLIQPED NUMERIC(15,5) DEFAULT 0.0,
VLRIPIPED NUMERIC(15,5),
VLRDESCPED NUMERIC(15,5),
VLRADICPED NUMERIC(15,5),
VLRRECPED NUMERIC(15,5),
VLRPAGPED NUMERIC(15,5),
OBSPED VARCHAR(300) COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT user NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT CHAR(8) DEFAULT 'now' NOT NULL COLLATE PT_BR);


CREATE TABLE RPPLANOPAG(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODPLANOPAG INTEGER NOT NULL,
DESCPLANOPAG VARCHAR(100) NOT NULL COLLATE PT_BR,
PARCPLANOPAG INTEGER NOT NULL,
DTINS DATE DEFAULT 'now',
IDUSUINS CHAR(8) DEFAULT USER COLLATE PT_BR,
DTALT DATE DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER COLLATE PT_BR,
HINS TIME DEFAULT 'now',
HALT TIME DEFAULT 'now');


CREATE TABLE RPPRODUTO(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODPROD INTEGER NOT NULL,
DESCPROD CHAR(60) COLLATE PT_BR,
REFPROD CHAR(13) NOT NULL COLLATE PT_BR,
CODBARPROD CHAR(13) COLLATE PT_BR,
CODEMPGP INTEGER NOT NULL,
CODFILIALGP SMALLINT NOT NULL,
CODGRUP CHAR(14) NOT NULL COLLATE PT_BR,
CODEMPUD INTEGER NOT NULL,
CODFILIALUD SMALLINT NOT NULL,
CODUNID CHAR(8) NOT NULL COLLATE PT_BR,
CODEMPFO INTEGER,
CODFILIALFO SMALLINT,
CODFOR INTEGER,
REFPRODFOR CHAR(20) COLLATE PT_BR,
PESOLIQPROD NUMERIC(10,3),
PESOBRUTPROD NUMERIC(10,3),
EMBALAPROD CHAR(20) COLLATE PT_BR,
COMISPROD NUMERIC(6,2),
PERCIPIPROD NUMERIC(6,2),
PRECOPROD1 NUMERIC(15,5),
PRECOPROD2 NUMERIC(15,5),
PRECOPROD3 NUMERIC(15,5),
CUBAGEMPROD NUMERIC(15,5),
DTINS DATE DEFAULT 'now',
IDUSUINS CHAR(8) DEFAULT USER COLLATE PT_BR,
DTALT DATE DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER COLLATE PT_BR,
HINS TIME DEFAULT 'now',
HALT TIME DEFAULT 'now',
PRECOCUSTO NUMERIC(15,5),
SALDOPROD BIGINT DEFAULT 0);


CREATE TABLE RPTIPOCLI(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODTIPOCLI INTEGER NOT NULL,
DESCTIPOCLI CHAR(40) NOT NULL COLLATE PT_BR,
TIPOCLI CHAR(4) COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS DATE DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT user NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT DATE DEFAULT 'now' NOT NULL,
IDUSUALT CHAR(8) DEFAULT user NOT NULL COLLATE PT_BR);


CREATE TABLE RPTRANSP(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODTRAN INTEGER NOT NULL,
RAZTRAN CHAR(80) NOT NULL COLLATE PT_BR,
NOMETRAN CHAR(80) NOT NULL COLLATE PT_BR,
CNPJTRAN CHAR(15) COLLATE PT_BR,
INSCTRAN CHAR(15) COLLATE PT_BR,
ENDTRAN CHAR(45) COLLATE PT_BR,
CIDTRAN CHAR(30) COLLATE PT_BR,
ESTTRAN CHAR(2) COLLATE PT_BR,
CEPTRAN CHAR(8) COLLATE PT_BR,
BAIRTRAN CHAR(30) COLLATE PT_BR,
DDDTRAN CHAR(4) COLLATE PT_BR,
FONETRAN VARCHAR(12) COLLATE PT_BR,
FAXTRAN VARCHAR(12) COLLATE PT_BR,
EMAILTRAN CHAR(50) COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT user NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT CHAR(8) DEFAULT user NOT NULL COLLATE PT_BR);


CREATE TABLE RPUNIDADE(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODUNID CHAR(8) NOT NULL COLLATE PT_BR,
DESCUNID CHAR(40) NOT NULL COLLATE PT_BR,
DTINS DATE DEFAULT 'now',
IDUSUINS CHAR(8) DEFAULT USER COLLATE PT_BR,
DTALT DATE DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER COLLATE PT_BR,
HINS TIME DEFAULT 'now',
HALT TIME DEFAULT 'now');


CREATE TABLE RPVENDEDOR(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODVEND INTEGER NOT NULL,
NOMEVEND CHAR(45) NOT NULL COLLATE PT_BR,
ENDVEND CHAR(45) COLLATE PT_BR,
CIDVEND CHAR(30) COLLATE PT_BR,
BAIRVEND CHAR(30) COLLATE PT_BR,
CEPVEND CHAR(8) COLLATE PT_BR,
ESTVEND CHAR(2) COLLATE PT_BR,
DDDVEND CHAR(4) COLLATE PT_BR,
FONEVEND CHAR(12) COLLATE PT_BR,
FAXVEND CHAR(8) COLLATE PT_BR,
EMAILVEND CHAR(50) COLLATE PT_BR,
PERCCOMIS NUMERIC(15,5),
DTINS DATE DEFAULT 'now',
IDUSUINS CHAR(8) DEFAULT USER COLLATE PT_BR,
DTALT DATE DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER COLLATE PT_BR,
HINS TIME DEFAULT 'now',
HALT TIME DEFAULT 'now');


CREATE TABLE SGIEST(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODPAIS SMALLINT NOT NULL,
SIGLAUF CHAR(2) NOT NULL COLLATE PT_BR,
IEST VARCHAR(20) NOT NULL COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT VARCHAR(128) DEFAULT USER COLLATE PT_BR);


CREATE TABLE SGPREFERE9(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
IPICOMIS CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR,
IPIPED CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR,
CODBARPROD CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR,
ENDCLIPED CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR,
ORDEMPED CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR,
SERVIDORSMTP VARCHAR(50) COLLATE PT_BR,
PORTASMTP INTEGER,
USUARIOSMTP VARCHAR(30) COLLATE PT_BR,
AUTENTICASMTP CHAR DEFAULT 'N' COLLATE PT_BR,
SSLSMTP CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR,
CASASDEC SMALLINT,
CASASDECFIN SMALLINT,
CODEMPMO INTEGER,
CODFILIALMO SMALLINT,
CODMOEDA CHAR(4) COLLATE PT_BR,
LAYOUTPED VARCHAR(15) COLLATE PT_BR,
ANOCENTROCUSTO SMALLINT,
BUSCAPRODSIMILAR CHAR DEFAULT 'N' COLLATE PT_BR,
BUSCACODPRODGEN CHAR DEFAULT 'N' COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT user NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT CHAR(8) DEFAULT 'now' NOT NULL COLLATE PT_BR,
SENHASMTP VARCHAR(30) COLLATE PT_BR,
USAREFPROD CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR,
ENVIACOPIA CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR,
TPCALCLUCRO CHAR DEFAULT 'V' NOT NULL COLLATE PT_BR,
CODEMPUD INTEGER,
CODFILIALUD SMALLINT,
CODUNID CHAR(8) COLLATE PT_BR,
CODEMPGP INTEGER,
CODFILIALGP SMALLINT,
CODGRUP CHAR(14) COLLATE PT_BR,
MOSTRAFATLUCR CHAR DEFAULT 'N' COLLATE PT_BR);


CREATE TABLE TMP_ENQUADRAMENTO(CODENQ VARCHAR(3) COLLATE PT_BR,
DESCENQ VARCHAR(411) COLLATE PT_BR,
CSTENTRADA CHAR(2) COLLATE PT_BR,
CSTSAIDA CHAR(2) COLLATE PT_BR);


CREATE TABLE VDCONTREMPREGADO(CODEMP INTEGER NOT NULL,
CODFILIAL INTEGER NOT NULL,
CODCONTR INTEGER NOT NULL,
SEQ SMALLINT NOT NULL,
CODEMPEP INTEGER NOT NULL,
CODFILIALEP SMALLINT NOT NULL,
MATEMPR INTEGER NOT NULL,
CODEMPFP INTEGER NOT NULL,
CODFILIALFP SMALLINT NOT NULL,
CODFUNCAOPROJ INTEGER NOT NULL,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT VARCHAR(128) DEFAULT USER COLLATE PT_BR);


CREATE TABLE VDFUNCAOPROJ(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODFUNCAOPROJ INTEGER NOT NULL,
DESCFUNCAOPROJ VARCHAR(100) NOT NULL COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT USER NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT VARCHAR(128) DEFAULT USER COLLATE PT_BR);


CREATE TABLE VDTIPOCONTR(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODTIPOCONTR INTEGER NOT NULL,
DESCTIPOCONTR VARCHAR(100) NOT NULL COLLATE PT_BR,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT user NOT NULL COLLATE PT_BR,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT VARCHAR(128) DEFAULT user NOT NULL COLLATE PT_BR);



ALTER TABLE ATCONVENIADO ADD CODPAIS SMALLINT;

ALTER TABLE ATCONVENIADO ADD SIGLAUF CHAR(2) COLLATE PT_BR;

ALTER TABLE ATCONVENIADO ADD CODMUNIC CHAR(7) COLLATE PT_BR;

ALTER TABLE CPCOMPRA ADD HEMITCOMPRA TIME;

ALTER TABLE CPCOMPRA ADD HENTCOMPRA TIME DEFAULT 'now';

ALTER TABLE CPCOMPRA ADD ANOPLAN SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Ano do planejamento financeiro.'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'ANOPLAN';

ALTER TABLE CPCOMPRA ADD VLRICMSCREDOR NUMERIC(15,5);

ALTER TABLE CPCOMPRA ADD MOTIVOCANCCOMPRA VARCHAR(255) COLLATE PT_BR;

ALTER TABLE CPCOMPRA ADD RECEBTOCONFIRMADO CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE CPCOMPRA ADD DOWNLOADXML CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE CPCOMPRA ADD CRT CHAR COLLATE PT_BR;

ALTER TABLE CPCOMPRA ADD TPVIATRANSP SMALLINT DEFAULT 0;

ALTER TABLE CPCOMPRA ADD TPINTERMEDIO SMALLINT DEFAULT 0;

ALTER TABLE CPITCOMPRA ADD VLRICMSDIFERIDO NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ADD VLRICMSCREDOR NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ADD PBCOP NUMERIC(6,2) DEFAULT 0 NOT NULL;

ALTER TABLE CPITCOMPRA ADD ICMSPART CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE CPITCOMPRA ADD PFCP NUMERIC(6,2) DEFAULT 0 NOT NULL;

ALTER TABLE CPITCOMPRA ADD VBCUFDEST NUMERIC(15,5) DEFAULT 0 NOT NULL;

ALTER TABLE CPITCOMPRA ADD VFCPUFDEST NUMERIC(15,5) DEFAULT 0 NOT NULL;

ALTER TABLE CPITCOMPRA ADD VICMSUFDEST NUMERIC(15,5) DEFAULT 0 NOT NULL;

ALTER TABLE CPITCOMPRA ADD VICMSUFREMET NUMERIC(15,5) DEFAULT 0 NOT NULL;

ALTER TABLE CPITCOMPRA ADD PICMSINTER NUMERIC(6,2) DEFAULT 0 NOT NULL;

ALTER TABLE CPITCOMPRA ADD PICMSUFDEST NUMERIC(6,2) DEFAULT 0 NOT NULL;

ALTER TABLE CPITCOMPRA ADD MARGEMVLAGRITCOMPRA DECIMAL(15,5) DEFAULT 0 NOT NULL;

ALTER TABLE CPITCOMPRA ADD VLRDIFICMSINTER NUMERIC(15,5);

ALTER TABLE CPITSOLICITACAO ADD CODEMPCT INTEGER;

ALTER TABLE CPITSOLICITACAO ADD CODFILIALCT SMALLINT;

ALTER TABLE CPITSOLICITACAO ADD CODCONTR INTEGER;

ALTER TABLE CPITSOLICITACAO ADD CODITCONTR SMALLINT;

ALTER TABLE CPRATEIO ADD ANOPLAN SMALLINT DEFAULT 0 NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Ano do planejamento.'
WHERE RDB$RELATION_NAME = 'CPRATEIO' AND RDB$FIELD_NAME = 'ANOPLAN';

ALTER TABLE CPSOLICITACAO ADD CODEMPCT INTEGER;

ALTER TABLE CPSOLICITACAO ADD CODFILIALCT SMALLINT;

ALTER TABLE CPSOLICITACAO ADD CODCONTR INTEGER;

ALTER TABLE CPSOLICITACAO ADD CODITCONTR SMALLINT;

ALTER TABLE EQETIQPROD ADD TIPO CHAR(2) DEFAULT 'PD' NOT NULL COLLATE PT_BR;

ALTER TABLE EQETIQPROD ADD CODPED INTEGER DEFAULT 0 NOT NULL;

ALTER TABLE EQETIQPROD ADD SEQITEM INTEGER DEFAULT 0 NOT NULL;

ALTER TABLE EQETIQPROD ADD QTDADE INTEGER DEFAULT 1 NOT NULL;

ALTER TABLE EQETIQPROD ADD IMPOK CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE EQETIQPROD ADD CODEMPLE INTEGER;

ALTER TABLE EQETIQPROD ADD CODFILIALLE SMALLINT;

ALTER TABLE EQETIQPROD ADD CODLOTE VARCHAR(20) COLLATE PT_BR;

ALTER TABLE EQETIQPROD ADD CODEMPME INTEGER;

ALTER TABLE EQETIQPROD ADD CODFILIALME SMALLINT;

ALTER TABLE EQETIQPROD ADD CODMODETIQ INTEGER;

ALTER TABLE EQITRECMERC ADD OBRIGALAUDO CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE EQITRECMERC ADD ALERTAEMITIDO CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE EQITRECMERC ADD LAUDOIMPRESSO CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE EQLOTE ADD HVENCTOLOTE TIME DEFAULT '23:59:59.999';

ALTER TABLE EQLOTE ADD HINILOTE TIME DEFAULT 'now';

ALTER TABLE EQLOTE ADD EMMANUT CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE EQPRODPLAN ADD ANOPLAN SMALLINT DEFAULT 0 NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Ano do planejamento.'
WHERE RDB$RELATION_NAME = 'EQPRODPLAN' AND RDB$FIELD_NAME = 'ANOPLAN';

ALTER TABLE EQPRODUTO ADD CODEMPTL INTEGER;

ALTER TABLE EQPRODUTO ADD CODFILIALTL SMALLINT;

ALTER TABLE EQPRODUTO ADD CODTPCTRL INTEGER;

ALTER TABLE EQPRODUTO ADD REGISTROANVISA VARCHAR(30) COLLATE PT_BR;

ALTER TABLE EQPRODUTO ADD MATERIAPRIMAPROD VARCHAR(50) COLLATE PT_BR;

ALTER TABLE EQPRODUTO ADD PMCPROD NUMERIC(15,5) DEFAULT 0 NOT NULL;

ALTER TABLE EQPRODUTO ADD FATSEMPRODUCAO CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE EQRMA ADD CODEMPCL INTEGER;

ALTER TABLE EQRMA ADD CODFILIALCL SMALLINT;

ALTER TABLE EQRMA ADD CODCLI INTEGER;

ALTER TABLE EQTIPOMOV ADD CODEMPSC INTEGER;

ALTER TABLE EQTIPOMOV ADD CODFILIALSC SMALLINT;

ALTER TABLE EQTIPOMOV ADD SERIEC VARCHAR(5) COLLATE PT_BR;

ALTER TABLE EQTIPOMOV ADD CALCIMPCP CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE EQTIPOMOV ADD PERMITDIGIPI CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE EQTIPOMOV ADD INDPRES CHAR DEFAULT '3' NOT NULL COLLATE PT_BR;

ALTER TABLE EQTIPOMOV ADD IMPDANFE CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE FNBANCO ADD CODEMPBP INTEGER;

ALTER TABLE FNBANCO ADD CODFILIALBP SMALLINT;

ALTER TABLE FNBANCO ADD CODBANCOBP CHAR(3) COLLATE PT_BR;

ALTER TABLE FNCC ADD ATIVOCC CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR;

ALTER TABLE FNCONTA ADD ANOPLAN SMALLINT DEFAULT 0 NOT NULL;

ALTER TABLE FNCONTA ADD CODEMPPO INTEGER;

ALTER TABLE FNCONTA ADD CODFILIALPO SMALLINT;

ALTER TABLE FNCONTA ADD ANOPLANPO SMALLINT;

ALTER TABLE FNCONTA ADD CODPLANPO CHAR(13) COLLATE PT_BR;

ALTER TABLE FNCONTA ADD AGENCIACONTABOL VARCHAR(6) COLLATE PT_BR;

ALTER TABLE FNCONTA ADD NUMCONTABOL CHAR(10) COLLATE PT_BR;

ALTER TABLE FNFBNCLI ADD ANOPLAN SMALLINT;

ALTER TABLE FNITPAGAR ADD DTCANCITPAG DATE;

ALTER TABLE FNITPAGAR ADD ANOPLAN SMALLINT;

ALTER TABLE FNITPAGAR ADD CODEMPEM INTEGER;

ALTER TABLE FNITPAGAR ADD CODFILIALEM SMALLINT;

ALTER TABLE FNITPAGAR ADD MATEMPR INTEGER;

ALTER TABLE FNITRECEBER ADD DTCANCITREC DATE;

ALTER TABLE FNITRECEBER ADD ANOPLAN SMALLINT;

ALTER TABLE FNITRECEBER ADD CODEMPEM INTEGER;

ALTER TABLE FNITRECEBER ADD CODFILIALEM SMALLINT;

ALTER TABLE FNITRECEBER ADD MATEMPR INTEGER;

ALTER TABLE FNITRECEBER ADD TPAG CHAR(2) COLLATE PT_BR;

ALTER TABLE FNITRENEGREC ADD VLRRENEGITREC DECIMAL(15,5) DEFAULT 0 NOT NULL;

ALTER TABLE FNLANCA ADD ANOPLAN SMALLINT DEFAULT 0 NOT NULL;

ALTER TABLE FNMODBOLETO ADD PERCJUROSDIAMODBOL DECIMAL(9,5) DEFAULT 0 NOT NULL;

ALTER TABLE FNPAGAR ADD ANOPLAN SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Ano do planejamento financeiro.'
WHERE RDB$RELATION_NAME = 'FNPAGAR' AND RDB$FIELD_NAME = 'ANOPLAN';

ALTER TABLE FNPAGTOCOMI ADD ANOPLAN SMALLINT DEFAULT 0 NOT NULL;

ALTER TABLE FNPLANEJAMENTO ADD ANOPLAN SMALLINT DEFAULT 0 NOT NULL;

ALTER TABLE FNPLANEJAMENTO ADD ANOPLANSP SMALLINT;

ALTER TABLE FNPLANEJAMENTO ADD LANCTOXPLAN CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE FNPLANEJAMENTO ADD ATIVOPLAN CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR;

ALTER TABLE FNPLANEJAMENTO ADD CODEMPANT INTEGER;

ALTER TABLE FNPLANEJAMENTO ADD CODFILIALANT SMALLINT;

ALTER TABLE FNPLANEJAMENTO ADD ANOPLANANT SMALLINT;

ALTER TABLE FNPLANEJAMENTO ADD CODPLANANT CHAR(13) COLLATE PT_BR;

ALTER TABLE FNPLANOPAG ADD ANOPLAN SMALLINT;

ALTER TABLE FNRECEBER ADD ANOPLAN SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Ano do planejamento financeiro.'
WHERE RDB$RELATION_NAME = 'FNRECEBER' AND RDB$FIELD_NAME = 'ANOPLAN';

ALTER TABLE FNSALDOLANCA ADD ANOPLAN SMALLINT DEFAULT 0 NOT NULL;

ALTER TABLE FNSUBLANCA ADD ANOPLAN SMALLINT DEFAULT 0 NOT NULL;

ALTER TABLE FNSUBLANCA ADD CODEMPEM INTEGER;

ALTER TABLE FNSUBLANCA ADD CODFILIALEM SMALLINT;

ALTER TABLE FNSUBLANCA ADD MATEMPR INTEGER;

ALTER TABLE FNSUBLANCA ADD TPAG CHAR(2) COLLATE PT_BR;

ALTER TABLE FNSUBLANCA ADD CODEMPTC INTEGER;

ALTER TABLE FNSUBLANCA ADD CODFILIALTC SMALLINT;

ALTER TABLE FNSUBLANCA ADD CODTIPOCOB INTEGER;

ALTER TABLE LFFRETE ADD DTMOVFRETE DATE;

ALTER TABLE LFFRETE ADD EMMANUT CHAR DEFAULT 'N' COLLATE PT_BR;

ALTER TABLE LFITCLFISCAL ADD ATIVOITFISC CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR;

ALTER TABLE LFITCLFISCAL ADD CREDDEBPIS CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE LFITCLFISCAL ADD CREDDEBCOF CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE LFITCLFISCAL ADD CREDDEBIPI CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR;

ALTER TABLE LFITCLFISCAL ADD CODEMPEQ INTEGER;

ALTER TABLE LFITCLFISCAL ADD CODFILIALEQ SMALLINT;

ALTER TABLE LFITCLFISCAL ADD CODENQ VARCHAR(3) COLLATE PT_BR;

ALTER TABLE LFITCLFISCAL ADD CREDDEBICMS CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR;

ALTER TABLE LFITCLFISCAL ADD TRIBREGNORMAL CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE LFITCLFISCAL ADD SIMPLESFILIAL CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR;

ALTER TABLE LFITCLFISCAL ADD ICMSPART CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE LFITCLFISCAL ADD PBCOP NUMERIC(6,2) DEFAULT 0 NOT NULL;

ALTER TABLE LFITCLFISCAL ADD CODCEST VARCHAR(10) COLLATE PT_BR;

ALTER TABLE LFTABICMS ADD ALIQFCPTI NUMERIC(6,2) DEFAULT 0 NOT NULL;

ALTER TABLE LFTIPOFISCCLI ADD ATIVO CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD NUMEROFT INTEGER;

ALTER TABLE PPESTRUTURA ADD DTREVISAOFT DATE;

ALTER TABLE PPESTRUTURA ADD MANIPULACAO VARCHAR(100) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD SEGUIMENTO VARCHAR(100) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD CATEGORIA VARCHAR(100) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD ANVISA VARCHAR(300) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD MINISTERIOAGRI VARCHAR(300) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD PRINCIPIOATIVO VARCHAR(300) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD DESCCOMPL VARCHAR(1000) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD FINALIDADEUSO VARCHAR(1000) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD MODOUSAR VARCHAR(1000) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD RESTRICAOUSO VARCHAR(1000) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD COMPOSICAO VARCHAR(1000) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD MECANISMOACAO VARCHAR(1000) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD CARACTERISTICA01 VARCHAR(100) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD CARACTERISTICA02 VARCHAR(100) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD CARACTERISTICA03 VARCHAR(100) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD EMBALAGEM VARCHAR(300) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD PRECAUCOES VARCHAR(1000) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TITPARAM01 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TITPARAM02 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TITPARAM03 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TITPARAM04 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TITPARAM05 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TITPARAM06 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD VLRPARAM01 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD VLRPARAM02 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD VLRPARAM03 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD VLRPARAM04 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD VLRPARAM05 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD VLRPARAM06 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TABTIT VARCHAR(50) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TABTITCOL01 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TABTITCOL02 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TABTITLIN01 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TABTITLIN02 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TABTITLIN03 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TABCELL01C01 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TABCELL01C02 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TABCELL02C01 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TABCELL02C02 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TABCELL03C01 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD TABCELL03C02 VARCHAR(30) COLLATE PT_BR;

ALTER TABLE PPESTRUTURA ADD NOTADILUICAO VARCHAR(100) COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD ATIVAEST CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD HOSTEST VARCHAR(100) COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD IPEST VARCHAR(20) COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD MACADDRESSEST VARCHAR(20) COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD DESCLOCALEST VARCHAR(1000) COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD NOMECONTEST VARCHAR(50) COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD RAMALEST VARCHAR(10) COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD EMAILEST VARCHAR(80) COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD PATHPDFREADER VARCHAR(256) COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD PRINTPDF CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD CMDGBAK VARCHAR(256) COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD DIRGBAK VARCHAR(256) COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD CONTINGENCIAPESAGEM CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD CMDIMPPADRAOWIN VARCHAR(250) COLLATE PT_BR;

ALTER TABLE SGESTACAO ADD CMDIMPPADRAOLIN VARCHAR(250) COLLATE PT_BR;

ALTER TABLE SGFILIAL ADD PERFILEPC CHAR COLLATE PT_BR;

ALTER TABLE SGFILIAL ADD INDATIVEPC CHAR COLLATE PT_BR;

ALTER TABLE SGFILIAL ADD LOGOPREFEITURA BLOB;

ALTER TABLE SGFILIAL ADD LOGOFILIAL BLOB;

ALTER TABLE SGFILIAL ADD REGISTRO CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGFILIAL ADD DTREGISTRO DATE;

ALTER TABLE SGFILIAL ADD HREGISTRO TIME;

ALTER TABLE SGIMAGEM ADD FORMATOIMG VARCHAR(30) DEFAULT '' NOT NULL COLLATE PT_BR;

ALTER TABLE SGIMPRESSORA ADD CODEMPMD INTEGER;

ALTER TABLE SGIMPRESSORA ADD CODFILIALMD SMALLINT;

ALTER TABLE SGIMPRESSORA ADD CODMODDOCFISC CHAR(2) COLLATE PT_BR;

ALTER TABLE SGIMPRESSORA ADD MODELOIMP VARCHAR(20) COLLATE PT_BR;

ALTER TABLE SGITPREFERE6 ADD CONSISTERETORNO CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGMODETIQUETA ADD TIPOETIQ CHAR DEFAULT 'C' NOT NULL COLLATE PT_BR;

ALTER TABLE SGMODETIQUETA ADD CODEMPCI INTEGER;

ALTER TABLE SGMODETIQUETA ADD CODFILIALCI SMALLINT;

ALTER TABLE SGMODETIQUETA ADD CODCATIMG INTEGER;

ALTER TABLE SGMODETIQUETA ADD BLOQIMPVISUAL CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGMODETIQUETA ADD IMPSUMARIZADA CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGMODETIQUETA ADD BLOQREIMP CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGMODETIQUETA ADD NOMEIMPRESSORA VARCHAR(60) COLLATE PT_BR;

ALTER TABLE SGMODETIQUETA ADD EXECCMDIMPPADRAO CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD ANOPLAN SMALLINT DEFAULT 0 NOT NULL;

ALTER TABLE SGPREFERE1 ADD CLASSORCLAUDOSUS VARCHAR(80) COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD CLASSORCCTALUGUEL VARCHAR(80) COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD MAXOBSCLI CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD CODEMPMP INTEGER;

ALTER TABLE SGPREFERE1 ADD CODFILIALMP SMALLINT;

ALTER TABLE SGPREFERE1 ADD ANOPLANMP SMALLINT;

ALTER TABLE SGPREFERE1 ADD CODPLANMP CHAR(13) COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD ANOPLANJP SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Ano da conta de planejamento de Juros Pagos.'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'ANOPLANJP';

ALTER TABLE SGPREFERE1 ADD CODEMPMR INTEGER;

ALTER TABLE SGPREFERE1 ADD CODFILIALMR SMALLINT;

ALTER TABLE SGPREFERE1 ADD ANOPLANMR SMALLINT;

ALTER TABLE SGPREFERE1 ADD CODPLANMR CHAR(13) COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD ANOPLANJR SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Ano da conta de planejamento de Juros Recebidos.'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'ANOPLANJR';

ALTER TABLE SGPREFERE1 ADD ANOPLANDR SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Ano da conta de planejamento de Descontos recebidos.'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'ANOPLANDR';

ALTER TABLE SGPREFERE1 ADD ANOPLANDC SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Ano da conta de planejamento de Descontos concedidos.'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'ANOPLANDC';

ALTER TABLE SGPREFERE1 ADD FORMATODANFENFCE SMALLINT;

ALTER TABLE SGPREFERE1 ADD ANOPLANPC SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Ano do planejamento padro para pagamento com cheques.'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'ANOPLANPC';

ALTER TABLE SGPREFERE1 ADD CODEMPIP INTEGER;

ALTER TABLE SGPREFERE1 ADD CODFILIALIP SMALLINT;

ALTER TABLE SGPREFERE1 ADD CODIMGPD INTEGER;

ALTER TABLE SGPREFERE1 ADD ALTQTDFATPARC CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD BLOQNFEVDAUTORIZ CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD OBRIGTIPOFISC CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD MATRICEMPFN CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD CODEMPRS INTEGER;

ALTER TABLE SGPREFERE1 ADD CODFILIALRS SMALLINT;

ALTER TABLE SGPREFERE1 ADD CODTIPOMOVRS INTEGER;

ALTER TABLE SGPREFERE1 ADD ESTOQALMOX CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD ALMOXPDORC CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD RATEIOESTBUSCAORC CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD OBRIGCCFIN CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD MOTOBRIGFRETE CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD VEICOBRIGFRETE CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD RNTCOBRIGFRETE CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD CLFISCALATIVA CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD CLFISCALREGIMEATUAL CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD CLFISCALVDESPECIFICA CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD DIFICMSCUSTO CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD IMPESTRUORC CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE1 ADD FORMDANFEPREIMP CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE3 ADD CODEMPTI INTEGER;

ALTER TABLE SGPREFERE3 ADD CODFILIALTI SMALLINT;

ALTER TABLE SGPREFERE3 ADD CODTIPOCLI INTEGER;

ALTER TABLE SGPREFERE3 ADD CODEMPCC INTEGER;

ALTER TABLE SGPREFERE3 ADD CODFILIALCC SMALLINT;

ALTER TABLE SGPREFERE3 ADD CODCLASCLI INTEGER;

ALTER TABLE SGPREFERE3 ADD HABVENDA3 CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE3 ADD REPLICAPROCVD3 CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE5 ADD NOMESUPERVQUALID VARCHAR(50) COLLATE PT_BR;

ALTER TABLE SGPREFERE5 ADD IDENTSUPERVQUALID VARCHAR(30) COLLATE PT_BR;

ALTER TABLE SGPREFERE5 ADD CARGOSUPERVQUALID VARCHAR(30) COLLATE PT_BR;

ALTER TABLE SGPREFERE5 ADD NOMEGERENTEQUALID VARCHAR(50) COLLATE PT_BR;

ALTER TABLE SGPREFERE5 ADD CARGOGERENTEQUALID VARCHAR(30) COLLATE PT_BR;

ALTER TABLE SGPREFERE5 ADD IDENTGERENTEQUALID VARCHAR(30) COLLATE PT_BR;

ALTER TABLE SGPREFERE5 ADD IMGASSSUPERVQUALID BLOB;

ALTER TABLE SGPREFERE5 ADD IMGASSGERENTEQUALID BLOB;

ALTER TABLE SGPREFERE5 ADD LAYOUTFT VARCHAR(60) COLLATE PT_BR;

ALTER TABLE SGPREFERE5 ADD CODEMPI1 INTEGER;

ALTER TABLE SGPREFERE5 ADD CODFILIALI1 SMALLINT;

ALTER TABLE SGPREFERE5 ADD CODIMGFT01 INTEGER;

ALTER TABLE SGPREFERE5 ADD CODEMPI2 INTEGER;

ALTER TABLE SGPREFERE5 ADD CODFILIALI2 SMALLINT;

ALTER TABLE SGPREFERE5 ADD CODIMGFT02 INTEGER;

ALTER TABLE SGPREFERE5 ADD CODEMPI3 INTEGER;

ALTER TABLE SGPREFERE5 ADD CODFILIALI3 SMALLINT;

ALTER TABLE SGPREFERE5 ADD CODIMGFT03 INTEGER;

ALTER TABLE SGPREFERE5 ADD CODEMPI4 INTEGER;

ALTER TABLE SGPREFERE5 ADD CODFILIALI4 SMALLINT;

ALTER TABLE SGPREFERE5 ADD CODIMGFT04 INTEGER;

ALTER TABLE SGPREFERE5 ADD CODEMPI5 INTEGER;

ALTER TABLE SGPREFERE5 ADD CODFILIALI5 SMALLINT;

ALTER TABLE SGPREFERE5 ADD CODIMGFT05 INTEGER;

ALTER TABLE SGPREFERE5 ADD CODEMPI6 INTEGER;

ALTER TABLE SGPREFERE5 ADD CODFILIALI6 SMALLINT;

ALTER TABLE SGPREFERE5 ADD CODIMGFT06 INTEGER;

ALTER TABLE SGPREFERE5 ADD CODEMPCI INTEGER;

ALTER TABLE SGPREFERE5 ADD CODFILIALCI SMALLINT;

ALTER TABLE SGPREFERE5 ADD CODCATIMG INTEGER;

ALTER TABLE SGPREFERE5 ADD ADICOPOBSVD CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE7 ADD ANOPLANCONSIG SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Ano do planejamento padro para consignao.'
WHERE RDB$RELATION_NAME = 'SGPREFERE7' AND RDB$FIELD_NAME = 'ANOPLANCONSIG';

ALTER TABLE SGPREFERE7 ADD ANOPLANVDCONSIG SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Ano do planejamento padro para venda consignada.'
WHERE RDB$RELATION_NAME = 'SGPREFERE7' AND RDB$FIELD_NAME = 'ANOPLANVDCONSIG';

ALTER TABLE SGPREFERE8 ADD CONTINGENCIAPESAGEM CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE8 ADD ALERTARETNUMSERIE CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE8 ADD DIASALERTANUMSERIE INTEGER DEFAULT 0 NOT NULL;

ALTER TABLE SGPREFERE8 ADD BLOQOSSEMLAUDOIMP CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE8 ADD BLOQINSERCAOOS CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE SGPREFERE8 ADD LAYOUTLAUDOCOLETA VARCHAR(100) COLLATE PT_BR;

ALTER TABLE SGUSUARIO ADD TIPOUSU CHAR DEFAULT 'D' NOT NULL COLLATE PT_BR;

ALTER TABLE SGUSUARIO ADD ACESESTRUITFASE CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR;

ALTER TABLE SGUSUARIO ADD SENHAUSU VARCHAR(128) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD DDDCTO2 VARCHAR(4) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD DDDCTO3 VARCHAR(4) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD DDDCTO4 VARCHAR(4) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD FONECTO2 VARCHAR(12) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD FONECTO3 VARCHAR(12) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD FONECTO4 VARCHAR(12) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD DDDCELCTO VARCHAR(4) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD DDDCELCTO2 VARCHAR(4) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD CELCTO2 VARCHAR(12) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD CODCNAE VARCHAR(15) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD CODCNAE2 VARCHAR(15) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD CODCNAE3 VARCHAR(15) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD CODCNAE4 VARCHAR(15) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD CODCNAE5 VARCHAR(15) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD CODCNAE6 VARCHAR(15) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD CODCNAE7 VARCHAR(15) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD CODCNAE8 VARCHAR(15) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD CODCNAE9 VARCHAR(15) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD CODNJ VARCHAR(5) COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD REPLICADO CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE TKCONTATO ADD DTFUNDCTO DATE;

ALTER TABLE TKCONTATO ADD DTREPL DATE;

ALTER TABLE TKCONTATO ADD HREPL TIME;

ALTER TABLE TKEMAIL ADD CODEMPCI INTEGER;

ALTER TABLE TKEMAIL ADD CODFILIALCI SMALLINT;

ALTER TABLE TKEMAIL ADD CODCATIMG INTEGER;

ALTER TABLE VDCLIENTE ADD CONSUMIDORCLI CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE VDCLIENTE ADD PEDCLIOBRIG CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE VDCLIENTE ADD SITREVCLI CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE VDCLIENTE ADD IDUSUREVCLI VARCHAR(128) COLLATE PT_BR;

ALTER TABLE VDCLIENTE ADD DTREVCLI DATE;

ALTER TABLE VDCLIENTE ADD HREVCLI TIME;

ALTER TABLE VDCLIENTE ADD VENDA3CLI CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE VDCLIENTE ADD NOMEREPLEGALCLI VARCHAR(50) COLLATE PT_BR;

ALTER TABLE VDCLIENTE ADD CARGOREPLEGALCLI VARCHAR(50) COLLATE PT_BR;

ALTER TABLE VDCLIENTE ADD CPFREPLEGALCLI VARCHAR(11) COLLATE PT_BR;

ALTER TABLE VDCLIENTE ADD RGREPLEGALCLI VARCHAR(13) COLLATE PT_BR;

ALTER TABLE VDCLIENTE ADD ENVIAIMNFSE CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE VDCONTRATO ADD CODEMPTC INTEGER;

ALTER TABLE VDCONTRATO ADD CODFILIALTC SMALLINT;

ALTER TABLE VDCONTRATO ADD CODTIPOCONTR INTEGER;

ALTER TABLE VDCONTRATO ADD VLRFRETEIDACONTR DECIMAL(15,5) DEFAULT 0;

ALTER TABLE VDCONTRATO ADD VLRFRETEVOLTACONTR DECIMAL(15,5) DEFAULT 0;

ALTER TABLE VDCONTRATO ADD VLRMULTACONTR DECIMAL(15,5) DEFAULT 0;

ALTER TABLE VDCONTRATO ADD VLRJUROSCONTR DECIMAL(15,5) DEFAULT 0;

ALTER TABLE VDCONTRATO ADD PERCMULTACONTR DECIMAL(15,5) DEFAULT 0;

ALTER TABLE VDCONTRATO ADD PERCJUROSCONTR DECIMAL(15,5) DEFAULT 0;

ALTER TABLE VDCONTRATO ADD LANCTOOUTROCLI CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE VDFRETEVD ADD CODEMPVE INTEGER;

ALTER TABLE VDFRETEVD ADD CODFILIALVE SMALLINT;

ALTER TABLE VDFRETEVD ADD CODVEIC INTEGER;

ALTER TABLE VDFRETEVD ADD CODEMPMA INTEGER;

ALTER TABLE VDFRETEVD ADD CODFILIALMA SMALLINT;

ALTER TABLE VDFRETEVD ADD CODMOT INTEGER;

ALTER TABLE VDITORCAMENTO ADD PEDCLIITORC VARCHAR(10) COLLATE PT_BR;

ALTER TABLE VDITORCAMENTO ADD NITEMCLI INTEGER;

ALTER TABLE VDITVENDA ADD PEDCLIITVENDA VARCHAR(10) COLLATE PT_BR;

ALTER TABLE VDITVENDA ADD NITEMCLI INTEGER;

ALTER TABLE VDITVENDA ADD VLRICMSDEVIDO NUMERIC(15,5) DEFAULT 0;

ALTER TABLE VDITVENDA ADD VLRICMSDIFERIDO NUMERIC(15,5) DEFAULT 0;

ALTER TABLE VDITVENDA ADD PBCOP NUMERIC(6,2) DEFAULT 0 NOT NULL;

ALTER TABLE VDITVENDA ADD ICMSPART CHAR DEFAULT 'N' NOT NULL COLLATE PT_BR;

ALTER TABLE VDITVENDA ADD PFCP NUMERIC(6,2) DEFAULT 0 NOT NULL;

ALTER TABLE VDITVENDA ADD VBCUFDEST NUMERIC(15,5) DEFAULT 0 NOT NULL;

ALTER TABLE VDITVENDA ADD VFCPUFDEST NUMERIC(15,5) DEFAULT 0 NOT NULL;

ALTER TABLE VDITVENDA ADD VICMSUFDEST NUMERIC(15,5) DEFAULT 0 NOT NULL;

ALTER TABLE VDITVENDA ADD VICMSUFREMET NUMERIC(15,5) DEFAULT 0 NOT NULL;

ALTER TABLE VDITVENDA ADD PICMSINTER NUMERIC(6,2) DEFAULT 0 NOT NULL;

ALTER TABLE VDITVENDA ADD PICMSUFDEST NUMERIC(6,2) DEFAULT 0 NOT NULL;

ALTER TABLE VDMODCONTR ADD FONTESQL CHAR DEFAULT 'S' NOT NULL COLLATE PT_BR;

ALTER TABLE VDMODCONTR ADD CODEMPIL INTEGER;

ALTER TABLE VDMODCONTR ADD CODFILIALIL SMALLINT;

ALTER TABLE VDMODCONTR ADD CODIMGLG INTEGER;

ALTER TABLE VDMOTORISTA ADD DTVENCCNH DATE;

ALTER TABLE VDORCAMENTO ADD PEDCLIORC VARCHAR(10) COLLATE PT_BR;

ALTER TABLE VDROMANEIO ADD VOLUMES DECIMAL(15,5);

ALTER TABLE VDTRANSP ADD VALIDRNTC DATE;

ALTER TABLE VDVEICULO ADD PLACA1 VARCHAR(7) COLLATE PT_BR;

ALTER TABLE VDVEICULO ADD PLACA2 VARCHAR(7) COLLATE PT_BR;

ALTER TABLE VDVEICULO ADD PLACA3 VARCHAR(7) COLLATE PT_BR;

ALTER TABLE VDVEICULO ADD EIXOS INTEGER;

ALTER TABLE VDVENDA ADD HEMITVENDA TIME DEFAULT 'now';

ALTER TABLE VDVENDA ADD HSAIDAVENDA TIME;

ALTER TABLE VDVENDA ADD CULTURA VARCHAR(25) COLLATE PT_BR;

ALTER TABLE VDVENDA ADD VLRICMSDEVIDO NUMERIC(15,5) DEFAULT 0;

ALTER TABLE VDVENDA ADD VLRICMSDIFERIDO NUMERIC(15,5) DEFAULT 0;

ALTER TABLE VDVENDA ADD VLRTOTALPAGO NUMERIC(15,5) DEFAULT 0;

ALTER TABLE VDVENDA ADD VLRTROCO NUMERIC(15,5) DEFAULT 0;

ALTER TABLE VDVENDEDOR ADD ANOPLAN SMALLINT;

ALTER TABLE ATAGENDA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATAGENDA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER PROCEDURE ATRESUMOATENDOSP01(CODEMPP INTEGER,
CODFILIALP SMALLINT,
CODCLIP INTEGER,
CODEMPCTP INTEGER,
CODFILIALCTP SMALLINT,
CODCONTRP INTEGER,
CODITCONTRP SMALLINT,
DTINIP DATE,
DTFIMP DATE)
 RETURNS(ANO SMALLINT,
MES SMALLINT,
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
CODCONTR INTEGER,
QTDCONTR DECIMAL(15,5),
DTINICIO DATE,
VALOR DECIMAL(15,5),
VALOREXCEDENTE DECIMAL(15,5),
QTDITCONTR DECIMAL(15,5),
QTDHORAS DECIMAL(15,2),
MESCOB INTEGER,
SALDOMESCOB DECIMAL(15,5),
SALDOMES DECIMAL(15,5),
SALDOPERIODO DECIMAL(15,5),
EXCEDENTEMESCOB DECIMAL(15,5),
EXCEDENTEPERIODO DECIMAL(15,5),
EXCEDENTECOB DECIMAL(15,5),
VALOREXCEDENTECOB DECIMAL(15,5),
VALORTOTALCOB DECIMAL(15,5),
VALORCONTR DECIMAL(15,5),
EXCEDENTEMES DECIMAL(15,5),
TOTFRANQUIAMES DECIMAL(15,5))
 AS
 BEGIN SUSPEND; END
^

ALTER PROCEDURE VDCONTRATOTOTSP(CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
CODCONTR INTEGER,
CODITCONTR INTEGER,
CODEMPSC INTEGER,
CODFILIALSC SMALLINT,
CODCONTRSC INTEGER,
CODEMPTA INTEGER,
CODFILIALTA SMALLINT,
CODTAREFA INTEGER,
CODEMPST INTEGER,
CODFILIALST SMALLINT,
CODTAREFAST INTEGER,
DATAINI DATE,
DATAFIM DATE)
 RETURNS(TOTALPREVGERAL NUMERIC(15,5),
TOTALPREVPER NUMERIC(15,5),
TOTALGERAL NUMERIC(15,5),
TOTALCOBCLIGERAL NUMERIC(15,5),
TOTALANT NUMERIC(15,5),
TOTALCOBCLIANT NUMERIC(15,5),
TOTALPER NUMERIC(15,5),
TOTALCOBCLIPER NUMERIC(15,5),
SALDOANT NUMERIC(15,5),
SALDOPER NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

DROP VIEW ATATENDIMENTOVW06;

DROP VIEW ATATENDIMENTOVW03;

DROP VIEW ATATENDIMENTOVW08;

DROP VIEW ATATENDIMENTOVW02;

DROP VIEW ATATENDIMENTOVW04;

DROP VIEW ATATENDIMENTOVW01;

DROP VIEW VWCUSTOPROJ01;

ALTER TABLE ATATENDENTE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATATENDENTE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

DROP VIEW ATATENDIMENTOVW07;

ALTER TABLE ATATENDIMENTO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER ATATENDIMENTOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE ATATENDIMENTO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATATENDIMENTOITREC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATATENDIMENTOITREC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATATENDIMENTOORC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATATENDIMENTOORC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATATENDOAGENDA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATATENDOAGENDA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATATRIBUICAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATATRIBUICAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATCLASATENDO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATCLASATENDO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATCONVATRIB ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATCONVATRIB ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATCONVATRIBTB ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATCONVATRIBTB ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATCONVENIADO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATCONVENIADO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATENCAMINHADOR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATENCAMINHADOR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATMODATENDO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATMODATENDO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATSETOR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATSETOR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATSETORATENDENTE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATSETORATENDENTE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATTIPOATEND ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATTIPOATEND ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATTIPOATENDO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATTIPOATENDO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATTIPOATENDOSETOR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATTIPOATENDOSETOR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE ATTIPOCONV ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE ATTIPOCONV ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CBCONTAEXT ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CBCONTAEXT ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty CPADICCOMPRAPEDSP for drop CPCOMPRA(SERIE) */
SET TERM ^ ;

ALTER PROCEDURE CPADICCOMPRAPEDSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODCOMPRA INTEGER,
DOCCOMPRA INTEGER,
CODEMPTM INTEGER,
CODFILIALTM SMALLINT,
CODTIPOMOV INTEGER,
CODEMPFR INTEGER,
CODFILIALFR SMALLINT,
CODFOR INTEGER,
CODEMPPG INTEGER,
CODFILIALPG SMALLINT,
CODPLANOPAG INTEGER)
 RETURNS(IRET INTEGER)
 AS
 BEGIN SUSPEND; END
^

/* Empty CPGERAENTRADASP for drop CPCOMPRA(SERIE) */
ALTER PROCEDURE CPGERAENTRADASP(CODEMP INTEGER,
CODFILIAL INTEGER,
CODFILIALVD INTEGER,
TIPOVENDA CHAR,
CODVENDA INTEGER,
CITEM CHAR)
 RETURNS(CODCOMPRA INTEGER)
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

DROP VIEW EQCONFESTOQVW01;

SET TERM ^ ;

ALTER TRIGGER CPCOMPRATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPCOMPRA ALTER COLUMN SERIE TYPE VARCHAR(5);

ALTER TABLE CPCOMPRA ALTER COLUMN PERCDESCCOMPRA TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER CPCOMPRATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPITCOMPRATGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPITCOMPRATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPITCOMPRATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPCOMPRA ALTER COLUMN VLRPRODCOMPRA TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER CPCOMPRATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPFRETECPTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPFRETECPTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPCOMPRA ALTER COLUMN VLRLIQCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRDESCCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRDESCITCOMPRA TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER CPITCOMPRATGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPCOMPRA ALTER COLUMN VLRADICCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEICMSCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEICMSSTCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEIPICOMPRA TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER LFITCOMPRATGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER LFITCOMPRATGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER LFITCOMPRATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEPISCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASECOFINSCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSSTCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRIPICOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRPISCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRCOFINSCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRFUNRURALCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRFRETECOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLROUTRASCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRISENTASCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN QTDFRETECOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEIICOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRIICOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSDIFERIDO TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSCREDPRESUM TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLRISSCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRA ALTER COLUMN VLROUTRASDESP TYPE NUMERIC(15,5);

/* String-length truncation not supported:
ALTER TABLE CPCOMPRA ALTER COLUMN CHAVENFEVALIDA TYPE CHAR */
ALTER TABLE CPCOMPRA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPCOMPRA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPCOMPRAPED ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPCOMPRAPED ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPCOMPRASOL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPCOMPRASOL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty CPGERAITENTRADASP for drop CPCOMPRAVENDA(QTDDEV) */
SET TERM ^ ;

ALTER PROCEDURE CPGERAITENTRADASP(CODEMP INTEGER,
CODFILIAL INTEGER,
CODCOMPRA INTEGER,
CODFILIALVD INTEGER,
TIPOVENDA CHAR,
CODVENDA INTEGER,
CODITVENDA INTEGER,
QTDIT INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE CPCOMPRAVENDA ALTER COLUMN QTDDEV TYPE NUMERIC(15,5);

ALTER TABLE CPCOMPRAVENDA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPCOMPRAVENDA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER CPCOTTGBIBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPCOTACAO ALTER COLUMN QTDCOT TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER CPCOTACAOTGAIAU001
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPCOTACAO ALTER COLUMN QTDAPROVCOT TYPE NUMERIC(15,5);

/* Empty CPADICITCOMPRARECMERCSP for drop CPCOTACAO(PRECOCOT) */
SET TERM ^ ;

ALTER PROCEDURE CPADICITCOMPRARECMERCSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
TICKET INTEGER,
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
QTDITCOMPRA NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE CPCOTACAO ALTER COLUMN PRECOCOT TYPE NUMERIC(15,5);

ALTER TABLE CPCOTACAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPCOTACAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

/* Empty CPGERADEVOLUCAOSP for drop CPDEVOLUCAO(QTDDEV) */
SET TERM ^ ;

ALTER PROCEDURE CPGERADEVOLUCAOSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODCOMPRA INTEGER,
CODITCOMPRA SMALLINT,
CODEMPVD INTEGER,
CODFILIALVD SMALLINT,
CODVENDA INTEGER,
CODITVENDA INTEGER,
TIPOVENDA CHAR(2),
QTDDEV NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER VDITVENDATGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPDEVOLUCAO ALTER COLUMN QTDDEV TYPE NUMERIC(15,5);

ALTER TABLE CPDEVOLUCAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPDEVOLUCAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPEQUIVCFOP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPEQUIVCFOP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

DROP VIEW FNFLUXOCAIXAVW01;

ALTER TABLE CPFORNECED ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER CPFORNECEDTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPFORNECED ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPFRETECP ALTER COLUMN VLRFRETECP TYPE NUMERIC(15,5);

ALTER TABLE CPFRETECP ALTER COLUMN QTDFRETECP TYPE NUMERIC(15,5);

ALTER TABLE CPFRETECP ALTER COLUMN PESOBRUTCP TYPE NUMERIC(15,5);

ALTER TABLE CPFRETECP ALTER COLUMN PESOLIQCP TYPE NUMERIC(15,5);

ALTER TABLE CPFRETECP ALTER COLUMN ALIQICMSFRETECP TYPE NUMERIC(15,5);

ALTER TABLE CPFRETECP ALTER COLUMN VLRICMSFRETECP TYPE NUMERIC(15,5);

ALTER TABLE CPFRETECP ALTER COLUMN VLRSEGFRETECP TYPE NUMERIC(15,5);

ALTER TABLE CPFRETECP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPFRETECP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER CPIMPORTACAOTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPIMPORTACAOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPITIMPORTACAOTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPITIMPORTACAOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPIMPORTACAO ALTER COLUMN COTACAOMOEDA TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER CPITIMPORTACAOTGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPITIMPORTACAOTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPITIMPORTACAOTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPIMPORTACAO ALTER COLUMN PESOBRUTO TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN PESOLIQUIDO TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRFRETEMI TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRFRETE TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VMLEMI TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VMLDMI TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VMLE TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VMLD TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRSEGUROMI TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRSEGURO TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRII TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRIPI TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRPIS TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRCOFINS TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRDIREITOSAD TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRTHC TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRTHCMI TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRTXSISCOMEX TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRAD TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRADMI TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRBASEICMS TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRICMS TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRICMSDIFERIDO TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRICMSDEVIDO TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRICMSCREDPRESUM TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRICMSRECOLHIMENTO TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRDESPAD TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN VLRCOMPL TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPIMPORTACAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPIMPORTACAOADIC ALTER COLUMN VLRTXSISCOMEX TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAOADIC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPIMPORTACAOADIC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPIMPORTACAOCOMPL ALTER COLUMN VLRDESPADIC TYPE NUMERIC(15,5);

ALTER TABLE CPIMPORTACAOCOMPL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPIMPORTACAOCOMPL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty CPADICITCOMPRAPEDSP for drop CPITCOMPRA(QTDITCOMPRA) */
SET TERM ^ ;

ALTER PROCEDURE CPADICITCOMPRAPEDSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODCOMPRA INTEGER,
CODEMPPC INTEGER,
CODFILIALPC SMALLINT,
CODCOMPRAPC INTEGER,
CODITCOMPRAPC INTEGER,
TPAGRUP CHAR,
QTDITCOMPRA FLOAT,
VLRDESCITCOMPRA NUMERIC(15,5),
PRECOITCOMPRA NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

/* Empty EQRELGIROPROD for drop CPITCOMPRA(QTDITCOMPRA) */
ALTER PROCEDURE EQRELGIROPROD(CODEMP INTEGER,
CODFILIAL INTEGER,
DATA_BASE DATE)
 RETURNS(CODEMPPD INTEGER,
CODFILIALPD SMALLINT,
CODPROD INTEGER,
REFPROD VARCHAR(20),
CODFABPROD CHAR(15),
CODBARPROD CHAR(13),
DESCPROD VARCHAR(100),
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
DOCCOMPRA INTEGER,
IDENTCONTAINER CHAR(20),
CODITCOMPRA SMALLINT,
DTULTCP DATE,
SALDOANT NUMERIC(15,5),
QTDULTCP NUMERIC(15,5),
QTDVENDIDA NUMERIC(15,5),
SALDOATU NUMERIC(15,5),
CODEMPGP INTEGER,
CODFILIALGP INTEGER,
CODGRUP CHAR(14))
 AS
 BEGIN SUSPEND; END
^

/* Empty EQRELGIROPRODPERI for drop CPITCOMPRA(QTDITCOMPRA) */
ALTER PROCEDURE EQRELGIROPRODPERI(CODEMP INTEGER,
CODFILIAL INTEGER,
DATA_INI DATE,
DATA_FIM DATE)
 RETURNS(CODEMPPD INTEGER,
CODFILIALPD SMALLINT,
CODPROD INTEGER,
REFPROD VARCHAR(20),
CODFABPROD CHAR(15),
CODBARPROD CHAR(13),
DESCPROD VARCHAR(100),
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
DOCCOMPRA INTEGER,
IDENTCONTAINER CHAR(20),
CODITCOMPRA SMALLINT,
DTULTCP DATE,
SALDOANT NUMERIC(15,5),
QTDULTCP NUMERIC(15,5),
QTDVENDIDA NUMERIC(15,5),
SALDOATU NUMERIC(15,5),
CODEMPGP INTEGER,
CODFILIALGP INTEGER,
CODGRUP CHAR(14))
 AS
 BEGIN SUSPEND; END
^

/* Empty LFBUSCAFISCALSP02 for drop CPITCOMPRA(QTDITCOMPRA) */
ALTER PROCEDURE LFBUSCAFISCALSP02(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODVENDA INTEGER,
TIPOVENDA CHAR,
CODITVENDA SMALLINT,
CODCOMPRA INTEGER,
CODITCOMPRA SMALLINT)
 RETURNS(VLRBASEPIS NUMERIC(15,5),
VLRBASECOFINS NUMERIC(15,5),
VLRPIS NUMERIC(15,5),
VLRCOFINS NUMERIC(15,5),
VLRIR NUMERIC(15,5),
VLRCSOCIAL NUMERIC(15,5),
VLRIPIIT NUMERIC(15,5),
VLRBASENCM DECIMAL(15,5),
ALIQNACNCM DECIMAL(9,2),
ALIQIMPNCM DECIMAL(9,2),
VLRNACNCM DECIMAL(15,2),
VLRIMPNCM DECIMAL(15,2),
ORIGFISC CHAR)
 AS
 BEGIN SUSPEND; END
^

ALTER TRIGGER CPITCOMPRATGBD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPITCOMPRATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPITCOMPRA ALTER COLUMN QTDITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN QTDITCOMPRACANC TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN PRECOITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN PERCDESCITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRDESCITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN PERCICMSITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRBASEICMSITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRICMSITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN PERCICMSSTITCOMPRA TYPE NUMERIC(15,5);

/* Empty LFGERALFITCOMPRASP for drop CPITCOMPRA(VLRBASEICMSSTITCOMPRA) */
SET TERM ^ ;

ALTER PROCEDURE LFGERALFITCOMPRASP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODCOMPRA INTEGER,
CODITCOMPRA SMALLINT)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRBASEICMSSTITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRICMSSTITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN PERCIPIITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRBASEIPIITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRIPIITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRBASEFUNRURALITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN ALIQFUNRURALITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRFUNRURALITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRLIQITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRADICITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRFRETEITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRISENTASITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLROUTRASITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRPRODITCOMPRA TYPE NUMERIC(15,5);

/* Empty EQCUSTOPRODSP for drop CPITCOMPRA(CUSTOITCOMPRA) */
SET TERM ^ ;

ALTER PROCEDURE EQCUSTOPRODSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
DTESTOQ DATE,
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CCOMSALDO CHAR(10))
 RETURNS(SLDPROD NUMERIC(15,5),
CUSTOUNIT NUMERIC(15,5),
CUSTOTOT NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

ALTER TABLE CPITCOMPRA ALTER COLUMN CUSTOITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN CUSTOVDITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN DESCDI TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN ALIQISSITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRISSITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRIIITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRITOUTRASDESPITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRTXSISCOMEXITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE CPITCOMPRA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPITCOMPRA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPITCOMPRASERIE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER CPITCOMPRASERIETGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPITCOMPRASERIE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN QTD TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN PESOLIQUIDO TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN PESOBRUTO TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN PRECOMI TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN PRECO TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VMLEMI TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VMLDMI TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VMLE TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VMLD TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRFRETEMI TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRFRETE TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRSEGUROMI TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRSEGURO TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRTHCMI TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRTHC TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRADMI TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRAD TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN ALIQICMSIMP TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN ALIQICMSUF TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN PERCDIFERICMS TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN PERCCREDPRESIMP TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN ALIQIPI TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN ALIQPIS TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN ALIQCOFINS TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN ALIQII TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRII TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRIPI TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRPIS TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRCOFINS TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRBASEICMS TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRICMS TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRICMSDIFERIDO TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRICMSDEVIDO TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRICMSCREDPRESUM TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRICMSRECOLHIMENTO TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRITDESPAD TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRTXSISCOMEX TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRVMCV TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN VLRCOMPL TYPE NUMERIC(15,5);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPITIMPORTACAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPITORDCOMPRA ALTER COLUMN QTDITORDCP TYPE NUMERIC(15,5);

ALTER TABLE CPITORDCOMPRA ALTER COLUMN PRECOITORDCP TYPE NUMERIC(15,5);

/* Empty FNADICPAGARSP02 for drop CPITORDCOMPRA(QTDAPITORDCP) */
SET TERM ^ ;

ALTER PROCEDURE FNADICPAGARSP02(CODEMPOC INTEGER,
CODFILIALOC SMALLINT,
CODORDCP INTEGER,
CODEMPPP INTEGER,
CODFILIALPP SMALLINT,
CODPLANOPAG INTEGER,
CODEMPFR INTEGER,
CODFILIALFR SMALLINT,
CODFOR INTEGER,
OBSPAG VARCHAR(2000))
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE CPITORDCOMPRA ALTER COLUMN QTDAPITORDCP TYPE NUMERIC(15,5);

ALTER TABLE CPITORDCOMPRA ALTER COLUMN VLRBRUTITORDCP TYPE NUMERIC(15,5);

ALTER TABLE CPITORDCOMPRA ALTER COLUMN VLRBRUTAPITORDCP TYPE NUMERIC(15,5);

ALTER TABLE CPITORDCOMPRA ALTER COLUMN ALIQIPIITORDCP TYPE NUMERIC(15,5);

ALTER TABLE CPITORDCOMPRA ALTER COLUMN VLRIPIITORDCP TYPE NUMERIC(15,5);

ALTER TABLE CPITORDCOMPRA ALTER COLUMN VLRIPIAPITORDCP TYPE NUMERIC(15,5);

ALTER TABLE CPITORDCOMPRA ALTER COLUMN VLRLIQITORDCP TYPE NUMERIC(15,5);

ALTER TABLE CPITORDCOMPRA ALTER COLUMN VLRLIQAPITORDCP TYPE NUMERIC(15,5);

ALTER TABLE CPITORDCOMPRA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPITORDCOMPRA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPITORDCOMPRAPE ALTER COLUMN QTDITPE TYPE NUMERIC(15,5);

ALTER TABLE CPITORDCOMPRAPE ALTER COLUMN QTDITENTPE TYPE NUMERIC(15,5);

ALTER TABLE CPITORDCOMPRAPE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPITORDCOMPRAPE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER CPITSOLTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPITSOLTGBU02
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPITSOLICITACAO ALTER COLUMN QTDITSOL TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER CPITSOLSTSOL
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPITSOLICITACAO ALTER COLUMN QTDAPROVITSOL TYPE NUMERIC(15,5);

ALTER TABLE CPITSOLICITACAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER CPITSOLICITACAOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPITSOLICITACAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPITSUMSOL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPITSUMSOL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPORDCOMPRA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER CPORDCOMPRATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPORDCOMPRA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty EQCOPIAPROD for drop CPPRODFOR(REFPRODFOR) */
SET TERM ^ ;

ALTER PROCEDURE EQCOPIAPROD(ICODPROD INTEGER,
ICODEMP INTEGER,
ICODFILIAL INTEGER)
 RETURNS(ICOD INTEGER)
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

RECONNECT;

/* Drop: CPPRODFORIDX01 (TIdxData) */
DROP INDEX CPPRODFORIDX01;

ALTER TABLE CPPRODFOR ALTER COLUMN REFPRODFOR TYPE VARCHAR(50);

ALTER TABLE CPPRODFOR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPPRODFOR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPRATEIO ALTER COLUMN VLRRATEIO TYPE NUMERIC(15,5);

ALTER TABLE CPRATEIO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPRATEIO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPSOLICITACAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER CPSOLICITACAOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPSOLICITACAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPSUMSOL ALTER COLUMN QTDITSOL TYPE NUMERIC(15,5);

ALTER TABLE CPSUMSOL ALTER COLUMN QTDAPROVITSOL TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER CPSUMSOLTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPSUMSOL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER CPSUMSOLTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPSUMSOL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPTABFOR ALTER COLUMN PRECOPRODTFOR TYPE NUMERIC(15,5);

ALTER TABLE CPTABFOR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPTABFOR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CPTIPOFOR ALTER COLUMN PERCBASEINSS TYPE NUMERIC(15,5);

ALTER TABLE CPTIPOFOR ALTER COLUMN PERCRETOUTROS TYPE NUMERIC(15,5);

ALTER TABLE CPTIPOFOR ALTER COLUMN PERCBASEIRRF TYPE NUMERIC(15,5);

ALTER TABLE CPTIPOFOR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CPTIPOFOR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CRCHAMADO ALTER COLUMN QTDHORASPREVISAO TYPE NUMERIC(15,5);

ALTER TABLE CRCHAMADO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CRCHAMADO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CRCHAMADOANEXO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CRCHAMADOANEXO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CRFICHAORC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CRFICHAORC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE CRQUALIFICACAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CRQUALIFICACAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

DROP VIEW VDCONTRATOVW01;

ALTER TABLE CRTAREFA ALTER COLUMN TEMPODECTAREFA TYPE NUMERIC(15,5);

ALTER TABLE CRTAREFAPER ALTER COLUMN TEMPODECTAREFA TYPE NUMERIC(15,5);

ALTER TABLE CRTIPOCHAMADO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE CRTIPOCHAMADO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQALMOX ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQALMOX ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQALMOXFILIAL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQALMOXFILIAL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQCODALTPROD ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQCODALTPRODBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQCODALTPROD ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQETIQPROD ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQETIQPROD ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQEXPEDAMOSTRAGEMTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQITEXPEDICAOTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQEXPEDAMOSTRAGEM ALTER COLUMN PESOAMOST TYPE NUMERIC(15,5);

ALTER TABLE EQEXPEDAMOSTRAGEM ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQEXPEDAMOSTRAGEM ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQEXPEDICAO ALTER COLUMN PESOENTRADA TYPE NUMERIC(15,5);

ALTER TABLE EQEXPEDICAO ALTER COLUMN PESOSAIDA TYPE NUMERIC(15,5);

ALTER TABLE EQEXPEDICAO ALTER COLUMN QTDINFORMADA TYPE NUMERIC(15,5);

ALTER TABLE EQEXPEDICAO ALTER COLUMN PRECOPESO TYPE NUMERIC(15,5);

ALTER TABLE EQEXPEDICAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQEXPEDICAOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQEXPEDICAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQFATCONV ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQFATCONV ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQGRUPO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQGRUPOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQGRUPO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQGUIATRAF ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQGUIATRAF ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQINVPRODTGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQINVPRODTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQINVPRODTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQINVPROD ALTER COLUMN QTDINVP TYPE NUMERIC(15,5);

ALTER TABLE EQINVPROD ALTER COLUMN PRECOINVP TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER EQINVPRODTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQINVPROD ALTER COLUMN SLDATUALINVP TYPE NUMERIC(15,5);

ALTER TABLE EQINVPROD ALTER COLUMN SLDDIGINVP TYPE NUMERIC(15,5);

ALTER TABLE EQINVPROD ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQINVPRODTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQINVPROD ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQITEXPEDICAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQITEXPEDICAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQITMODGRADE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQITMODGRADE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQITRECMERCTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQITRECMERC ALTER COLUMN MEDIAAMOSTRAGEM TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER EQITRECMERCTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQITRECMERCTGBD
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQITRECMERC ALTER COLUMN QTDITRECMERC TYPE NUMERIC(15,5);

ALTER TABLE EQITRECMERC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQITRECMERC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQITRECMERCITCP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQITRECMERCITCP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty EQGERARMAOSSP for drop EQITRECMERCITOS(QTDITOS) */
SET TERM ^ ;

ALTER PROCEDURE EQGERARMAOSSP(CODEMPRM INTEGER,
CODFILIALRM INTEGER,
TICKET INTEGER,
CODITRECMERC SMALLINT)
 RETURNS(CODRMA INTEGER)
 AS
 BEGIN SUSPEND; END
^

/* Empty VDADICITORCRECMERCSP for drop EQITRECMERCITOS(QTDITOS) */
ALTER PROCEDURE VDADICITORCRECMERCSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
TICKET INTEGER,
CODEMPOC INTEGER,
CODFILIALOC SMALLINT,
CODORC INTEGER,
COMPONENTES CHAR,
SERVICOS CHAR,
NOVOS CHAR)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE EQITRECMERCITOS ALTER COLUMN QTDITOS TYPE NUMERIC(15,5);

ALTER TABLE EQITRECMERCITOS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQITRECMERCITOS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQITRECMERCITOSITORC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQITRECMERCITOSITORC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQITRECMERCSERIE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQITRECMERCSERIETGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQITRECMERCSERIE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty EQGERARMASP for drop EQITRMA(QTDITRMA) */
SET TERM ^ ;

ALTER PROCEDURE EQGERARMASP(CODEMPOP INTEGER,
CODFILIALOP INTEGER,
CODOP INTEGER,
SEQOP SMALLINT)
 AS
 BEGIN EXIT; END
^

ALTER PROCEDURE EQACERTACUSTORMASP AS
 BEGIN EXIT; END
^

SET TERM ; ^

DROP VIEW VWTMPCUSTOITRMA;

SET TERM ^ ;

ALTER TRIGGER EQITRMATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQITRMATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPITOPTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQITRMA ALTER COLUMN QTDITRMA TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER EQITRMASTRMA
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQITRMATGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQITRMATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQITRMA ALTER COLUMN QTDAPROVITRMA TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER EQITRMATGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQITRMA ALTER COLUMN QTDEXPITRMA TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER EQRMATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQITRMA ALTER COLUMN PRECOITRMA TYPE NUMERIC(15,5);

ALTER TABLE EQITRMA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQITRMA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQITSIMILAR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQITSIMILARBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQITSIMILAR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQLANCTOEXP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQLANCTOEXP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQLOCDESCARGA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQLOCDESCARGA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty EQRELPEPSSP for drop EQLOTE(SLDLOTE) */
SET TERM ^ ;

ALTER PROCEDURE EQRELPEPSSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
DTESTOQ DATE,
ICODEMPMC INTEGER,
SCODFILIALMC SMALLINT,
CCODMARCA CHAR(6),
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP VARCHAR(14),
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CLOTEPROD CHAR,
SOPRODSALDO CHAR)
 RETURNS(CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD CHAR(100),
SLDPROD NUMERIC(15,5),
CUSTOUNIT NUMERIC(15,5),
CUSTOTOT NUMERIC(15,5),
CODBARPROD CHAR(13),
CODFABPROD CHAR(15),
ATIVOPROD CHAR,
CODUNID CHAR(20),
TIPOPROD VARCHAR(2),
CODNCM VARCHAR(10),
EXTIPI CHAR(2),
COD_GEN CHAR(2),
CODSERV CHAR(5),
ALIQ_ICMS NUMERIC(9,2),
CODNBM VARCHAR(12),
CODLOTE VARCHAR(20),
VENCTOLOTE DATE,
SLDLOTE NUMERIC(15,5),
CODGRUP VARCHAR(14),
SIGLAGRUP VARCHAR(10))
 AS
 BEGIN SUSPEND; END
^

/* Empty EQSALDOLOTEATEQSP for drop EQLOTE(SLDLOTE) */
ALTER PROCEDURE EQSALDOLOTEATEQSP(ICODEMPLEOLD INTEGER,
SCODFILIALLEOLD SMALLINT,
ICODPROD INTEGER,
CCODLOTEOLD VARCHAR(20),
ICODEMPLENEW INTEGER,
SCODFILIALLENEW SMALLINT,
CCODLOTENEW VARCHAR(20),
SOPERADOR SMALLINT,
NQTDMOVPRODOLD NUMERIC(15,5),
NQTDMOVPRODNEW NUMERIC(15,5),
ICODEMPAXOLD INTEGER,
SCODFILIALAXOLD SMALLINT,
ICODALMOXOLD INTEGER,
ICODEMPAXNEW INTEGER,
SCODFILIALAXNEW SMALLINT,
ICODALMOXNEW INTEGER)
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER EQLOTETGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQLOTETGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQLOTE ALTER COLUMN SLDLOTE TYPE NUMERIC(15,5);

ALTER TABLE EQLOTE ALTER COLUMN SLDRESLOTE TYPE NUMERIC(15,5);

ALTER TABLE EQLOTE ALTER COLUMN SLDCONSIGLOTE TYPE NUMERIC(15,5);

/* Empty PPITOPSP01 for drop EQLOTE(SLDLIQLOTE) */
SET TERM ^ ;

ALTER PROCEDURE PPITOPSP01(ICODEMP INTEGER,
ICODFILIAL SMALLINT,
ICODOP INTEGER,
ISEQOP SMALLINT)
 AS
 BEGIN EXIT; END
^

/* Empty VDADICITVENDAORCSP for drop EQLOTE(SLDLIQLOTE) */
ALTER PROCEDURE VDADICITVENDAORCSP(FILIALATUAL INTEGER,
ICODVENDA INTEGER,
ICODORC INTEGER,
ICODITORC INTEGER,
ICODFILIAL SMALLINT,
ICODEMP INTEGER,
STIPOVENDA CHAR(10),
TPAGRUP CHAR,
IQTDITVENDA NUMERIC(15,5),
VLRDESCITVENDA NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER PPITOPTGBI02
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQLOTE ALTER COLUMN SLDLIQLOTE TYPE NUMERIC(15,5);

ALTER TABLE EQLOTE ALTER COLUMN QTDPRODLOTE TYPE NUMERIC(15,5);

ALTER TABLE EQLOTE ALTER COLUMN DINILOTE SET DEFAULT 'now';

ALTER TABLE EQLOTE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQLOTE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQMARCA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQMARCA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQMODGRADE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQMODGRADE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQMODLOTE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQMODLOTE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQMOVEXP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQMOVEXP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty EQCALCPEPSSP for drop EQMOVPROD(QTDMOVPROD) */
SET TERM ^ ;

ALTER PROCEDURE EQCALCPEPSSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
NSLDPROD NUMERIC(15,5),
DTESTOQ DATE,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(NCUSTOPEPS NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

/* Empty EQMOVPRODISP for drop EQMOVPROD(QTDMOVPROD) */
ALTER PROCEDURE EQMOVPRODISP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE VARCHAR(20),
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4),
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR,
NQTDMOVPROD NUMERIC(15,5),
NPRECOMOVPROD NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
SEQSUBPROD SMALLINT,
ESTOQTIPOMOVPD CHAR,
TIPONF CHAR)
 AS
 BEGIN EXIT; END
^

/* Empty EQMOVPRODPRCSLDSP for drop EQMOVPROD(QTDMOVPROD) */
ALTER PROCEDURE EQMOVPRODPRCSLDSP(SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
DDTMOVPROD DATE,
DDTMOVPRODPRC DATE,
NSLDMOVPROD NUMERIC(15,5),
NCUSTOMPMMOVPROD NUMERIC(15,5),
NSLDMOVPRODAX NUMERIC(15,5),
NCUSTOMPMMOVPRODAX NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
TIPONF CHAR)
 RETURNS(NSLDPRC NUMERIC(15,5),
NCUSTOMPMPRC NUMERIC(15,5),
NSLDPRCAX NUMERIC(15,5),
NCUSTOMPMPRCAX NUMERIC(15,5),
ESTOQTIPOMOVPD CHAR)
 AS
 BEGIN SUSPEND; END
^

/* Empty EQMOVPRODUSP for drop EQMOVPROD(QTDMOVPROD) */
ALTER PROCEDURE EQMOVPRODUSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE VARCHAR(20),
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4),
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR,
NQTDMOVPROD NUMERIC(15,5),
NPRECOMOVPROD NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
SEQSUBPROD BIGINT,
ESTOQTIPOMOVPD CHAR,
TIPONF CHAR)
 AS
 BEGIN EXIT; END
^

/* Empty EQRELDEMANDASP for drop EQMOVPROD(QTDMOVPROD) */
ALTER PROCEDURE EQRELDEMANDASP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
SCODFILIALPD SMALLINT,
DDTINI DATE,
DDTFIM DATE)
 RETURNS(CODMARCA CHAR(6),
CODGRUP CHAR(14),
CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD CHAR(100),
DESCGRUP CHAR(50),
SLDINI NUMERIC(15,5),
VLRCOMPRAS NUMERIC(15,5),
VLRDEVENT NUMERIC(15,5),
VLROUTENT NUMERIC(15,5),
VLRVENDAS NUMERIC(15,5),
VLRDEVSAI NUMERIC(15,5),
VLROUTSAI NUMERIC(15,5),
SLDFIM NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

ALTER TRIGGER EQMOVPRODTGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQMOVPRODTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQMOVPRODTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQMOVPROD ALTER COLUMN QTDMOVPROD TYPE NUMERIC(15,5);

ALTER TABLE EQMOVPROD ALTER COLUMN PRECOMOVPROD TYPE NUMERIC(15,5);

/* Empty EQMOVPRODSLDSP for drop EQMOVPROD(CUSTOMPMMOVPROD) */
SET TERM ^ ;

ALTER PROCEDURE EQMOVPRODSLDSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
DDTMOVPROD DATE,
NCUSTOMPMMOVPROD NUMERIC(15,5),
NCUSTOMPMMOVPRODAX NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR)
 RETURNS(NSALDO NUMERIC(15,5),
NCUSTOMPM NUMERIC(15,5),
ICODMOVPRODSLD INTEGER,
NSALDOAX NUMERIC(15,5),
NCUSTOMPMAX NUMERIC(15,5),
ICODMOVPRODSLDAX INTEGER)
 AS
 BEGIN SUSPEND; END
^

/* Empty EQPRODUTOSP01 for drop EQMOVPROD(CUSTOMPMMOVPROD) */
ALTER PROCEDURE EQPRODUTOSP01(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(NSALDO NUMERIC(15,5),
NSALDOAX NUMERIC(15,5),
NCUSTOMPM NUMERIC(15,5),
NCUSTOPEPS NUMERIC(15,5),
NCUSTOMPMAX NUMERIC(15,5),
NCUSTOPEPSAX NUMERIC(15,5),
NCUSTOINFO NUMERIC(15,5),
NCUSTOUC NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

ALTER TABLE EQMOVPROD ALTER COLUMN CUSTOMPMMOVPROD TYPE NUMERIC(15,5);

ALTER TABLE EQMOVPROD ALTER COLUMN CUSTOMPMMOVPRODAX TYPE NUMERIC(15,5);

ALTER TABLE EQMOVPROD ALTER COLUMN SLDMOVPROD TYPE NUMERIC(15,5);

ALTER TABLE EQMOVPROD ALTER COLUMN SLDMOVPRODAX TYPE NUMERIC(15,5);

ALTER TABLE EQMOVPROD ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQMOVPRODTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQMOVPROD ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQMOVSERIE DROP CONSTRAINT EQMOVSERIEFKEQRECMERC;

ALTER TABLE EQMOVSERIE DROP CONSTRAINT EQMOVSERIEFKRECMERC;

SET TERM ^ ;

ALTER TRIGGER EQITRECMERCSERIETGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQMOVSERIE ALTER COLUMN TICKET TYPE INTEGER;

ALTER TABLE EQMOVSERIE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQMOVSERIE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQPROCEXPED ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQPROCEXPED ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQPROCRECMERC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQPROCRECMERC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQPRODACESSO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQPRODACESSO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQPRODPLAN ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQPRODPLAN ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

DROP VIEW PPLISTAOPVW01;

DROP VIEW VWPROD_PRECO_CUSTO;

ALTER TABLE EQPRODUTO ALTER COLUMN QTDMINPROD TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN QTDMAXPROD TYPE NUMERIC(15,5);

/* Empty EQMOVPRODCKCPSP for drop EQPRODUTO(CUSTOMPMPROD) */
SET TERM ^ ;

ALTER PROCEDURE EQMOVPRODCKCPSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODCOMPRA INTEGER,
ICODINVPROD INTEGER,
DDTMOVPROD DATE,
NQTDMOVPROD NUMERIC(15,5),
NCUSTOMPMMOVPROD NUMERIC(15,5))
 RETURNS(DDTULTCPPROD DATE,
NQTDULTCPPROD NUMERIC(15,5),
DDTMPMPROD DATE,
NCUSTOMPMPROD NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

ALTER TRIGGER PPOPENTRADATGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPOPTGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPOPTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQPRODUTO ALTER COLUMN CUSTOMPMPROD TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN CUSTOPEPSPROD TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN CUSTOINFOPROD TYPE NUMERIC(15,5);

/* Empty VDBUSCAPRECOSP for drop EQPRODUTO(PRECOBASEPROD) */
SET TERM ^ ;

ALTER PROCEDURE VDBUSCAPRECOSP(ICODPROD INTEGER,
ICODCLI INTEGER,
ICODEMPCL INTEGER,
ICODFILIALCL SMALLINT,
ICODPLANOPAG INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPTM INTEGER,
ICODFILIALTM SMALLINT,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 RETURNS(PRECO NUMERIC(14,5),
CODCLASCLIP INTEGER,
CODPLANOPAGP INTEGER,
CODPRECOPRODP INTEGER,
CODTABP INTEGER)
 AS
 BEGIN SUSPEND; END
^

ALTER TRIGGER EQPRODUTOTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQPRODUTOTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQPRODUTO ALTER COLUMN PRECOBASEPROD TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER VDITVENDATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDITVENDATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQPRODUTO ALTER COLUMN PRECOCOMISPROD TYPE NUMERIC(15,5);

/* Empty EQMOVPRODATEQSP for drop EQPRODUTO(SLDPROD) */
SET TERM ^ ;

ALTER PROCEDURE EQMOVPRODATEQSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLEOLD INTEGER,
SCODFILIALLEOLD SMALLINT,
CCODLOTEOLD VARCHAR(20),
ICODEMPLENEW INTEGER,
SCODFILIALLENEW SMALLINT,
CCODLOTENEW VARCHAR(20),
SOPERADOR SMALLINT,
NQTDMOVPRODOLD NUMERIC(15,5),
NQTDMOVPRODNEW NUMERIC(15,5),
ICODEMPAXOLD INTEGER,
SCODFILIALAXOLD SMALLINT,
ICODALMOXOLD INTEGER,
ICODEMPAXNEW INTEGER,
SCODFILIALAXNEW SMALLINT,
ICODALMOXNEW INTEGER)
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER EQPRODUTOTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQPRODUTOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQPRODUTO ALTER COLUMN SLDPROD TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN SLDRESPROD TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN SLDCONSIGPROD TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN SLDLIQPROD TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN QTDULTCPPROD TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN COMPRIMENTO TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN LARGURA TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN ESPESSURA TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN QTDEMBALAGEM TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN CUBAGEM TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN QTDHORASSERV TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN FATORFSC TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQPRODUTO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQPRODUTOLOG ALTER COLUMN PRECOBASEPRODANT TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTOLOG ALTER COLUMN PRECOBASEPRODNOVO TYPE NUMERIC(15,5);

ALTER TABLE EQPRODUTOLOG ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQPRODUTOLOG ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQRECAMOSTRAGEM ALTER COLUMN PESOAMOST TYPE NUMERIC(15,5);

ALTER TABLE EQRECAMOSTRAGEM ALTER COLUMN PESOAMOST2 TYPE NUMERIC(15,5);

ALTER TABLE EQRECAMOSTRAGEM ALTER COLUMN IMPUREZA TYPE NUMERIC(15,5);

ALTER TABLE EQRECAMOSTRAGEM ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQRECAMOSTRAGEM ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQRECMERC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQRECMERC ALTER COLUMN MEDIAAMOSTRAGEM TYPE NUMERIC(15,5);

ALTER TABLE EQRECMERC ALTER COLUMN OBSRECMERC TYPE VARCHAR(1000);

ALTER TABLE EQRECMERC ALTER COLUMN DESCONTO TYPE NUMERIC(15,5);

ALTER TABLE EQRECMERC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQRMATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQRMA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQRMATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQRMA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQRMAAL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQRMAAL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQSALDOLOTETGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQSALDOLOTETGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQSALDOLOTE ALTER COLUMN SLDLOTE TYPE NUMERIC(15,5);

ALTER TABLE EQSALDOLOTE ALTER COLUMN SLDRESLOTE TYPE NUMERIC(15,5);

ALTER TABLE EQSALDOLOTE ALTER COLUMN SLDCONSIGLOTE TYPE NUMERIC(15,5);

ALTER TABLE EQSALDOLOTE ALTER COLUMN SLDLIQLOTE TYPE NUMERIC(15,5);

ALTER TABLE EQSALDOLOTE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQSALDOLOTE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty EQSALDOPRODATEQSP for drop EQSALDOPROD(SLDPROD) */
SET TERM ^ ;

ALTER PROCEDURE EQSALDOPRODATEQSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
SOPERADOR SMALLINT,
NQTDMOVPRODOLD NUMERIC(15,5),
NQTDMOVPRODNEW NUMERIC(15,5),
ICODEMPAXOLD INTEGER,
SCODFILIALAXOLD SMALLINT,
ICODALMOXOLD INTEGER,
ICODEMPAXNEW INTEGER,
SCODFILIALAXNEW SMALLINT,
ICODALMOXNEW INTEGER)
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER EQSALDOPRODTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQSALDOPRODTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQSALDOPROD ALTER COLUMN SLDPROD TYPE NUMERIC(15,5);

ALTER TABLE EQSALDOPROD ALTER COLUMN SLDRESPROD TYPE NUMERIC(15,5);

ALTER TABLE EQSALDOPROD ALTER COLUMN SLDCONSIGPROD TYPE NUMERIC(15,5);

ALTER TABLE EQSALDOPROD ALTER COLUMN SLDLIQPROD TYPE NUMERIC(15,5);

ALTER TABLE EQSALDOPROD ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQSALDOPROD ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQSECAO ALTER COLUMN DESCSECAO TYPE VARCHAR(100);

ALTER TABLE EQSECAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQSECAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQSERIE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQSERIE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQSIMILAR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQSIMILAR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQTIPOEXP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQTIPOEXP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQTIPOEXPEDICAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQTIPOEXPEDICAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQTIPOMOV DROP CONSTRAINT EQTIPOMOVFKLFSERIE;

/* Empty VDADICVENDAORCSP for drop EQTIPOMOV(SERIE) */
SET TERM ^ ;

ALTER PROCEDURE VDADICVENDAORCSP(ICODORC INTEGER,
ICODFILIAL SMALLINT,
ICODEMP INTEGER,
STIPOVENDA CHAR(10),
NEWCODVENDA INTEGER,
DTSAIDAVENDA DATE)
 RETURNS(IRET INTEGER)
 AS
 BEGIN SUSPEND; END
^

ALTER TRIGGER VDVENDATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQTIPOMOV ALTER COLUMN SERIE TYPE VARCHAR(5);

ALTER TABLE EQTIPOMOV ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER EQTIPOMOVTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQTIPOMOV ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQTIPOMOVUSU ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQTIPOMOVUSU ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQTIPORECMERC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQTIPORECMERC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQUNIDADE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQUNIDADE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE EQVARGRADE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE EQVARGRADE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNBANCO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNBANCO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNBORDERO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNBORDERO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNCARTCOB ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNCARTCOB ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNCC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNCC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNCONTA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNCONTA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNCONTAUSU ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNCONTAUSU ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNCONTAVINCULADA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNCONTAVINCULADA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNCOTMOEDA ALTER COLUMN VALORCOT TYPE NUMERIC(15,5);

ALTER TABLE FNCOTMOEDA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNCOTMOEDA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNFBNCLI ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNFBNCLI ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNFBNCODRET ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNFBNCODRET ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNFBNREC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNFBNREC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNFINALIDADE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNFINALIDADE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNHISTPAD ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNHISTPAD ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNITBORDERO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNITBORDERO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNITFBNCODRET ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNITFBNCODRET ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNITMODBOLETO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNITMODBOLETO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER FNITPAGARTGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNITPAGARTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNITPAGARTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNPAGARTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNITPAGAR ALTER COLUMN VLRITPAG TYPE NUMERIC(15,5);

ALTER TABLE FNITPAGAR ALTER COLUMN VLRDESCITPAG TYPE NUMERIC(15,5);

ALTER TABLE FNITPAGAR ALTER COLUMN VLRMULTAITPAG TYPE NUMERIC(15,5);

ALTER TABLE FNITPAGAR ALTER COLUMN VLRJUROSITPAG TYPE NUMERIC(15,5);

ALTER TABLE FNITPAGAR ALTER COLUMN VLRDEVITPAG TYPE NUMERIC(15,5);

ALTER TABLE FNITPAGAR ALTER COLUMN VLRPARCITPAG TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER FNPAGCHEQTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNITPAGAR ALTER COLUMN VLRPAGOITPAG TYPE NUMERIC(15,5);

ALTER TABLE FNITPAGAR ALTER COLUMN VLRAPAGITPAG TYPE NUMERIC(15,5);

ALTER TABLE FNITPAGAR ALTER COLUMN VLRADICITPAG TYPE NUMERIC(15,5);

ALTER TABLE FNITPAGAR ALTER COLUMN VLRCANCITPAG TYPE NUMERIC(15,5);

ALTER TABLE FNITPAGAR ALTER COLUMN VLRCANCITPAG SET DEFAULT 0;

ALTER TABLE FNITPAGAR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNITPAGAR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER FNBORDEROTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNITRECEBERTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNITRECEBERTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNITRECEBERTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNITRECEBER ALTER COLUMN VLRITREC TYPE NUMERIC(15,5);

/* Empty FNADICITRECEBERSP01 for drop FNITRECEBER(VLRDESCITREC) */
SET TERM ^ ;

ALTER PROCEDURE FNADICITRECEBERSP01(CALTVLR CHAR,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRDESCITREC NUMERIC(15,5),
NVLRMULTAITREC NUMERIC(15,5),
NVLRJUROSITREC NUMERIC(15,5),
NVLRPARCITREC NUMERIC(15,5),
NVLRPAGOITREC NUMERIC(15,5),
DDTITREC DATE,
DDTCOMPITREC DATE,
DDTVENCITREC DATE,
CSTATUSITREC CHAR(2),
CFLAG CHAR,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3),
ICODEMPTC INTEGER,
SCODFILIALTC SMALLINT,
ICODTIPOCOB INTEGER,
ICODEMPCB INTEGER,
SCODFILIALCB SMALLINT,
CODCARTCOB CHAR(3),
NVLRCOMIITREC NUMERIC(15,5),
OBSITREC VARCHAR(250),
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
NUMCONTA CHAR(10),
CODEMPPN INTEGER,
CODFILIALPN SMALLINT,
CODPLAN CHAR(13),
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC SMALLINT,
CODCC CHAR(19),
VLRBASECOMIS NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER FNRECEBERTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNITRECEBER ALTER COLUMN VLRDESCITREC TYPE NUMERIC(15,5);

ALTER TABLE FNITRECEBER ALTER COLUMN VLRMULTAITREC TYPE NUMERIC(15,5);

ALTER TABLE FNITRECEBER ALTER COLUMN VLRJUROSITREC TYPE NUMERIC(15,5);

ALTER TABLE FNITRECEBER ALTER COLUMN VLRDEVITREC TYPE NUMERIC(15,5);

/* Empty FNITRECEBERSP01 for drop FNITRECEBER(VLRPARCITREC) */
SET TERM ^ ;

ALTER PROCEDURE FNITRECEBERSP01(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
NVLRPARCREC NUMERIC(15,5),
NVLRCOMIREC NUMERIC(15,5),
INROPARCREC INTEGER,
CCLASCOMIS CHAR)
 AS
 BEGIN EXIT; END
^

/* Empty FNLIBCREDSP for drop FNITRECEBER(VLRPARCITREC) */
ALTER PROCEDURE FNLIBCREDSP(CODEMPVD INTEGER,
CODFILIALVD INTEGER,
TIPOVENDA CHAR,
CODVENDA INTEGER,
CODCLI INTEGER,
CODEMPCL INTEGER,
CODFILIALCL INTEGER,
VLRVENDA NUMERIC(15,5),
VLRADIC NUMERIC(15,2),
CODITEM INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE FNITRECEBER ALTER COLUMN VLRPARCITREC TYPE NUMERIC(15,5);

ALTER TABLE FNITRECEBER ALTER COLUMN VLRPAGOITREC TYPE NUMERIC(15,5);

ALTER TABLE FNITRECEBER ALTER COLUMN VLRAPAGITREC TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER FNITRECEBERTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNITRECEBER ALTER COLUMN VLRCOMIITREC TYPE NUMERIC(15,5);

ALTER TABLE FNITRECEBER ALTER COLUMN VLRCANCITREC TYPE NUMERIC(15,5);

ALTER TABLE FNITRECEBER ALTER COLUMN VLRCANCITREC SET DEFAULT 0;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRBASECOMIS TYPE NUMERIC(15,5);

ALTER TABLE FNITRECEBER ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNITRECEBER ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNITRENEGREC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNITRENEGREC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNITTBJUROS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNITTBJUROS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty FNADICLANCASP01 for drop FNLANCA(VLRLANCA) */
SET TERM ^ ;

ALTER PROCEDURE FNADICLANCASP01(ICODREC INTEGER,
INPARCITREC INTEGER,
PDVITREC CHAR,
SNUMCONTA CHAR(10),
ICODEMPCA INTEGER,
ICODFILIALCA INTEGER,
ICODCLI INTEGER,
ICODEMPCL INTEGER,
ICODFILIALCL INTEGER,
SCODPLAN CHAR(13),
ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
IANOCC INTEGER,
SCODCC CHAR(19),
ICODEMPCC INTEGER,
ICODFILIALCC INTEGER,
DDTCOMPITREC DATE,
DDTPAGOITREC DATE,
SDOCLANCAITREC VARCHAR(15),
SOBSITREC CHAR(250),
DVLRPAGOITREC NUMERIC(15,5),
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DVLRPAGOJUROS NUMERIC(15,5),
DVLRDESC NUMERIC(15,5),
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
CODCONTR INTEGER,
CODITCONTR SMALLINT)
 AS
 BEGIN EXIT; END
^

/* Empty FNADICLANCASP02 for drop FNLANCA(VLRLANCA) */
ALTER PROCEDURE FNADICLANCASP02(ICODPAG INTEGER,
INPARCPAG INTEGER,
SNUMCONTA CHAR(10),
ICODEMPCA INTEGER,
ICODFILIALCA INTEGER,
ICODFOR INTEGER,
ICODEMPFR INTEGER,
ICODFILIALFR INTEGER,
SCODPLAN CHAR(13),
ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
IANOCC INTEGER,
SCODCC CHAR(19),
ICODEMPCC INTEGER,
ICODFILIALCC INTEGER,
DDTCOMPITPAG DATE,
DDTPAGOITPAG DATE,
SDOCLANCAITPAG VARCHAR(15),
SOBSITPAG CHAR(250),
DVLRPAGOITPAG NUMERIC(15,5),
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DVLRJUROSPAG NUMERIC(15,5),
DVLRDESC NUMERIC(15,5),
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
CODCONTR INTEGER,
CODITCONTR SMALLINT)
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER FNLANCATGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNLANCATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNPAGTOCOMITGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNSUBLANCATGBD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNSUBLANCATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNSUBLANCATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNLANCA ALTER COLUMN VLRLANCA TYPE NUMERIC(15,5);

ALTER TABLE FNLANCA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNLANCA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNLIBCRED ALTER COLUMN VLRAUTORIZLCRED TYPE NUMERIC(15,5);

ALTER TABLE FNLIBCRED ALTER COLUMN VLRUTILLCRED TYPE NUMERIC(15,5);

ALTER TABLE FNLIBCRED ALTER COLUMN VLRVENDACRED TYPE NUMERIC(15,5);

ALTER TABLE FNLIBCRED ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNLIBCRED ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNMODBOLETO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNMODBOLETO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNMOEDA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNMOEDA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty FNADICPAGARSP01 for drop FNPAGAR(VLRDESCPAG) */
SET TERM ^ ;

ALTER PROCEDURE FNADICPAGARSP01(CODCOMPRA INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
CODPLANOPAG INTEGER,
ICODEMPFR INTEGER,
ICODFILIALFR SMALLINT,
CODFOR INTEGER,
VLRLIQCOMPRA NUMERIC(18,2),
DTSAIDACOMPRA DATE,
DTCOMPCOMPRA DATE,
DOCCOMPRA INTEGER,
ICODEMPBO INTEGER,
ICODFILIALBO SMALLINT,
CODBANCO CHAR(3),
FLAG CHAR,
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
CODEMPTC INTEGER,
CODFILIALTC SMALLINT,
CODTIPOCOB INTEGER,
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
NUMCONTA CHAR(10),
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC SMALLINT,
CODCC CHAR(19),
CODEMPPN INTEGER,
CODFILIALPN SMALLINT,
CODPLAN CHAR(13),
OBSPAG VARCHAR(250))
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER FNPAGARTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNPAGAR ALTER COLUMN VLRDESCPAG TYPE NUMERIC(15,5);

ALTER TABLE FNPAGAR ALTER COLUMN VLRMULTAPAG TYPE NUMERIC(15,5);

ALTER TABLE FNPAGAR ALTER COLUMN VLRJUROSPAG TYPE NUMERIC(15,5);

ALTER TABLE FNPAGAR ALTER COLUMN VLRDEVPAG TYPE NUMERIC(15,5);

ALTER TABLE FNPAGAR ALTER COLUMN VLRPARCPAG TYPE NUMERIC(15,5);

ALTER TABLE FNPAGAR ALTER COLUMN VLRPAGOPAG TYPE NUMERIC(15,5);

ALTER TABLE FNPAGAR ALTER COLUMN VLRAPAGPAG TYPE NUMERIC(15,5);

ALTER TABLE FNPAGAR ALTER COLUMN VLRPAG TYPE NUMERIC(15,5);

ALTER TABLE FNPAGAR ALTER COLUMN VLRADICPAG TYPE NUMERIC(15,5);

ALTER TABLE FNPAGAR ALTER COLUMN VLRBASEIRRF TYPE NUMERIC(15,5);

ALTER TABLE FNPAGAR ALTER COLUMN VLRBASEINSS TYPE NUMERIC(15,5);

ALTER TABLE FNPAGAR ALTER COLUMN VLRRETIRRF TYPE NUMERIC(15,5);

ALTER TABLE FNPAGAR ALTER COLUMN VLRRETINSS TYPE NUMERIC(15,5);

ALTER TABLE FNPAGAR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNPAGAR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty VDBAIXACOMISSAOSP for drop FNPAGTOCOMI(VLRPCOMI) */
SET TERM ^ ;

ALTER PROCEDURE VDBAIXACOMISSAOSP(STIPO CHAR,
DINI DATE,
DFIM DATE,
ICODVEND INTEGER,
ICODEMPVD INTEGER,
ICODFILIALVD SMALLINT,
SCODCONTA CHAR(10),
ICODEMPCA INTEGER,
ICODFILIALCA SMALLINT,
SCODPLAN CHAR(13),
ICODEMPPN INTEGER,
ICODFILIALPN SMALLINT,
DDATA DATE,
IDOC INTEGER,
DVLR NUMERIC(15,5),
SOBS CHAR(50),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE FNPAGTOCOMI ALTER COLUMN VLRPCOMI TYPE NUMERIC(15,5);

ALTER TABLE FNPAGTOCOMI ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNPAGTOCOMI ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNPARCPAG ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNPARCPAG ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER FNPLANEJAMENTOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNPLANOPAG ALTER COLUMN PERCDESC TYPE NUMERIC(15,5);

ALTER TABLE FNPLANOPAG ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNPLANOPAG ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty FNADICRECEBERSP01 for drop FNRECEBER(VLRREC) */
SET TERM ^ ;

ALTER PROCEDURE FNADICRECEBERSP01(TIPOVENDA CHAR,
CODVENDA INTEGER,
CODEMPTC INTEGER,
CODFILIALTC INTEGER,
CODTIPOCOB INTEGER,
CODEMPPG INTEGER,
CODFILIALPG SMALLINT,
CODPLANOPAG INTEGER,
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
CODEMPVD INTEGER,
CODFILIALVD SMALLINT,
CODVEND INTEGER,
VLRLIQVENDA NUMERIC(15,5),
DTVENDA DATE,
DTCOMP DATE,
VLRCOMISVENDA NUMERIC(15,5),
DOCVENDA INTEGER,
CODEMPBO INTEGER,
CODFILIALBO SMALLINT,
CODBANCO CHAR(3),
CODEMP INTEGER,
CODFILIAL SMALLINT,
CODEMPCB INTEGER,
CODFILIALCB SMALLINT,
CODCARTCOB CHAR(3),
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
NUMCONTA CHAR(10),
FLAG CHAR,
OBSREC VARCHAR(250),
VLRBASECOMIS NUMERIC(15,5),
VLRRETENSAOISS NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER FNRECEBERTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNRECEBERTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNRECEBERTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNRECEBER ALTER COLUMN VLRREC TYPE NUMERIC(15,5);

ALTER TABLE FNRECEBER ALTER COLUMN VLRDESCREC TYPE NUMERIC(15,5);

ALTER TABLE FNRECEBER ALTER COLUMN VLRMULTAREC TYPE NUMERIC(15,5);

ALTER TABLE FNRECEBER ALTER COLUMN VLRJUROSREC TYPE NUMERIC(15,5);

ALTER TABLE FNRECEBER ALTER COLUMN VLRDEVREC TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER VDVENDATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNRECEBER ALTER COLUMN VLRPARCREC TYPE NUMERIC(15,5);

ALTER TABLE FNRECEBER ALTER COLUMN VLRPAGOREC TYPE NUMERIC(15,5);

ALTER TABLE FNRECEBER ALTER COLUMN VLRAPAGREC TYPE NUMERIC(15,5);

ALTER TABLE FNRECEBER ALTER COLUMN VLRBASECOMIS TYPE NUMERIC(15,5);

ALTER TABLE FNRECEBER ALTER COLUMN VLRRETENSAOISS TYPE NUMERIC(15,5);

ALTER TABLE FNRECEBER ALTER COLUMN VLRCOMIREC TYPE NUMERIC(15,5);

ALTER TABLE FNRECEBER ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNRECEBER ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNRENEGREC ALTER COLUMN VLRORIGINAL TYPE NUMERIC(15,5);

ALTER TABLE FNRENEGREC ALTER COLUMN VLRDESCONTO TYPE NUMERIC(15,5);

ALTER TABLE FNRENEGREC ALTER COLUMN VLRADICIONAL TYPE NUMERIC(15,5);

ALTER TABLE FNRENEGREC ALTER COLUMN VLRJUROS TYPE NUMERIC(15,5);

ALTER TABLE FNRENEGREC ALTER COLUMN VLRLIQRENEGREC TYPE NUMERIC(15,5);

ALTER TABLE FNRENEGREC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNRENEGREC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty FNSALDOPLANSP for drop FNSALDOLANCA(PREVSL) */
SET TERM ^ ;

ALTER PROCEDURE FNSALDOPLANSP(ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
SCODPLANANT CHAR(13),
DDATAANT DATE,
DVLRANT NUMERIC(15,5),
SCODPLANATU CHAR(13),
DDATAATU DATE,
DVLRATU NUMERIC(15,5))
 RETURNS(SRETORNO CHAR)
 AS
 BEGIN SUSPEND; END
^

ALTER TRIGGER FNSALDOLANCATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNSALDOLANCA ALTER COLUMN PREVSL TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER FNSALDOLANCATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNSUBLANCATGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNSUBLANCATGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNSUBLANCATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNSALDOLANCA ALTER COLUMN SALDOSL TYPE NUMERIC(15,5);

ALTER TABLE FNSALDOLANCA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNSALDOLANCA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNSUBLANCA ALTER COLUMN VLRSUBLANCA TYPE NUMERIC(15,5);

ALTER TABLE FNSUBLANCA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNSUBLANCA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNTBJUROS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNTBJUROS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNTIPOCOB ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNTIPOCOB ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE FNTIPOCRED ALTER COLUMN VLRTPCRED TYPE NUMERIC(15,5);

ALTER TABLE FNTIPOCRED ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE FNTIPOCRED ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFCLFISCAL ALTER COLUMN MARGEMVLAGR TYPE NUMERIC(15,5);

ALTER TABLE LFCLFISCAL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFCLFISCAL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFCSOSN ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFCSOSN ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFFRETE ALTER COLUMN QTDFRETE TYPE NUMERIC(15,5);

ALTER TABLE LFFRETE ALTER COLUMN VLRMERCADORIA TYPE NUMERIC(15,5);

ALTER TABLE LFFRETE ALTER COLUMN VLRFRETE TYPE NUMERIC(15,5);

ALTER TABLE LFFRETE ALTER COLUMN VLRFRETENOTA TYPE NUMERIC(15,5);

ALTER TABLE LFFRETE ALTER COLUMN PESOBRUTO TYPE NUMERIC(15,5);

ALTER TABLE LFFRETE ALTER COLUMN PESOLIQUIDO TYPE NUMERIC(15,5);

ALTER TABLE LFFRETE ALTER COLUMN ALIQICMSFRETE TYPE NUMERIC(15,5);

ALTER TABLE LFFRETE ALTER COLUMN VLRICMSFRETE TYPE NUMERIC(15,5);

ALTER TABLE LFFRETE ALTER COLUMN VLRBASEICMSFRETE TYPE NUMERIC(15,5);

ALTER TABLE LFFRETE ALTER COLUMN SERIE TYPE VARCHAR(5);

ALTER TABLE LFFRETE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER LFFRETETGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE LFFRETE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFFRETECOMPRA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFFRETECOMPRA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFFRETEVENDA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFFRETEVENDA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty LFBUSCAFISCALSP for drop LFITCLFISCAL(MARGEMVLAGR) */
SET TERM ^ ;

ALTER PROCEDURE LFBUSCAFISCALSP(CODEMP INTEGER,
CODFILIAL INTEGER,
CODPROD INTEGER,
CODEMPCF INTEGER,
CODFILIALCF INTEGER,
CODCF INTEGER,
CODEMPTM INTEGER,
CODFILIALTM SMALLINT,
CODTIPOMOV INTEGER,
TIPOBUSCA CHAR(2),
CODNAT CHAR(4),
CODEMPIFP INTEGER,
CODFILIALIFP SMALLINT,
CODFISCP CHAR(13),
CODITFISCP INTEGER)
 RETURNS(ORIGFISC CHAR,
CODTRATTRIB CHAR(2),
REDFISC NUMERIC(9,2),
TIPOFISC CHAR(2),
CODMENS INTEGER,
ALIQFISC NUMERIC(9,2),
ALIQIPIFISC NUMERIC(9,2),
TPREDICMSFISC CHAR,
TIPOST CHAR(2),
MARGEMVLAGR NUMERIC(15,2),
CODEMPIF INTEGER,
CODFILIALIF SMALLINT,
CODFISC CHAR(13),
CODITFISC INTEGER,
ALIQFISCINTRA NUMERIC(9,2),
ALIQPIS NUMERIC(9,2),
ALIQCOFINS NUMERIC(9,2),
ALIQCSOCIAL NUMERIC(9,2),
ALIQIR NUMERIC(9,2),
REDBASEST CHAR,
ALIQISS NUMERIC(6,2),
ADICIPIBASEICMS CHAR,
CALCSTCM CHAR,
ALIQICMSSTCM NUMERIC(9,2))
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

ALTER TABLE LFITCLFISCAL ALTER COLUMN MARGEMVLAGR TYPE NUMERIC(15,5);

/* Empty LFBUSCAPREVTRIBORC for drop LFITCLFISCAL(VLRIPIUNIDTRIB) */
SET TERM ^ ;

ALTER PROCEDURE LFBUSCAPREVTRIBORC(CODEMP INTEGER,
CODFILIAL INTEGER,
CODORC INTEGER,
TIPOORC CHAR,
CODITORC SMALLINT)
 RETURNS(VLRICMS NUMERIC(15,5),
VLRIPI NUMERIC(15,5),
VLRPIS NUMERIC(15,5),
VLRCOFINS NUMERIC(15,5),
VLRIR NUMERIC(15,5),
VLRCSOCIAL NUMERIC(15,5),
VLRISS NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

/* Empty LFGERALFITVENDASP for drop LFITCLFISCAL(VLRIPIUNIDTRIB) */
ALTER PROCEDURE LFGERALFITVENDASP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODVENDA INTEGER,
TIPOVENDA CHAR(2),
CODITVENDA SMALLINT)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE LFITCLFISCAL ALTER COLUMN VLRIPIUNIDTRIB TYPE NUMERIC(15,5);

ALTER TABLE LFITCLFISCAL ALTER COLUMN VLRPISUNIDTRIB TYPE NUMERIC(15,5);

ALTER TABLE LFITCLFISCAL ALTER COLUMN VLRCOFUNIDTRIB TYPE NUMERIC(15,5);

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQICMSIMP TYPE NUMERIC(15,5);

ALTER TABLE LFITCLFISCAL ALTER COLUMN PERCCREDPRESIMP TYPE NUMERIC(15,5);

ALTER TABLE LFITCLFISCAL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFITCLFISCAL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFITCOMPRA ALTER COLUMN ALIQCOFINS TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRIPIUNIDTRIB TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN ALIQREDBCICMS TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN ALIQREDBCICMSST TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN ALIQICMSST TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN ALIQPIS TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRPISUNIDTRIB TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRBASEPIS TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRBASECOFINS TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRCOFUNIDTRIB TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRIR TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRPIS TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRCOFINS TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRCSOCIAL TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN MARGEMVLAGRITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRBASEICMSSTITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRICMSSTITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN PERCISSITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRBASEISSITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRISSITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN PERCICMSSIMPLES TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRBASEICMSSTITRETCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRICMSSTRETITCOMPRA TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN ALIQII TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRBASEII TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRII TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRICMSDIFERIDO TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRICMSDEVIDO TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRICMSCREDPRESUM TYPE NUMERIC(15,5);

ALTER TABLE LFITCOMPRA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFITCOMPRA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFITNATOPER ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFITNATOPER ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFITREGRAFISCAL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFITREGRAFISCAL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFITVENDA ALTER COLUMN ALIQCOFINS TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN VLRIPIUNIDTRIB TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN ALIQREDBCICMS TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN ALIQREDBCICMSST TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN ALIQICMSST TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN ALIQPIS TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN VLRPISUNIDTRIB TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER LFITVENDATGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER LFITVENDATGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER LFITVENDATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE LFITVENDA ALTER COLUMN VLRBASEPIS TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN VLRBASECOFINS TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN VLRCOFUNIDTRIB TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN VLRIR TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN VLRPIS TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN VLRCOFINS TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN VLRCSOCIAL TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN VLRBASEICMSITVENDA TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER VDFRETEVDTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDFRETEVDTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE LFITVENDA ALTER COLUMN VLRBASEICMSFRETEITVENDA TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN VLRICMSFRETEITVENDA TYPE NUMERIC(15,5);

ALTER TABLE LFITVENDA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFITVENDA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN SERIELF TYPE VARCHAR(5);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN VLRCONTABILLF TYPE NUMERIC(15,5);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN VLRBASEICMSLF TYPE NUMERIC(15,5);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN VLRICMSLF TYPE NUMERIC(15,5);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN VLRISENTASICMSLF TYPE NUMERIC(15,5);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN VLROUTRASICMSLF TYPE NUMERIC(15,5);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN VLRBASEIPILF TYPE NUMERIC(15,5);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN VLRIPILF TYPE NUMERIC(15,5);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN VLRISENTASIPILF TYPE NUMERIC(15,5);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN VLROUTRASIPILF TYPE NUMERIC(15,5);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN VLRBASEICMSSTLF TYPE NUMERIC(15,5);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN VLRICMSSTLF TYPE NUMERIC(15,5);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN VLRACESSORIASLF TYPE NUMERIC(15,5);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFLIVROFISCAL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFMENSAGEM ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFMENSAGEM ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFMODDOCFISC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFMODDOCFISC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFMODNOTA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFMODNOTA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFNATOPER ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFNATOPER ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFNBM ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFNBM ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFNCM ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFNCM ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFNCMNBM ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFNCMNBM ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFREGRAFISCAL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFREGRAFISCAL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

RECONNECT;

ALTER TABLE LFSEQSERIE DROP CONSTRAINT LFSEQSERIEPK;

/* Empty LFNOVODOCSP for drop LFSEQSERIE(SERIE) */
SET TERM ^ ;

ALTER PROCEDURE LFNOVODOCSP(SSERIE CHAR(4),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 RETURNS(DOC INTEGER)
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

ALTER TABLE LFSEQSERIE ALTER COLUMN SERIE TYPE VARCHAR(5);

RECONNECT;

ALTER TABLE VDVENDA DROP CONSTRAINT VDVENDAFKLFSERIE;

ALTER TABLE LFSERIE DROP CONSTRAINT LFSERIEPK;

ALTER TABLE LFSERIE ALTER COLUMN SERIE TYPE VARCHAR(5);

ALTER TABLE LFSERIE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFSERIE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFSERVICO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFSERVICO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFSITTRIB ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFSITTRIB ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty LFBUSCAICMSSP for drop LFTABICMS(ALIQTI) */
SET TERM ^ ;

ALTER PROCEDURE LFBUSCAICMSSP(CODNAT CHAR(4),
ESTCLI CHAR(2),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 RETURNS(PERCICMS NUMERIC(9,2),
PERCICMSINTRA NUMERIC(9,2))
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

ALTER TABLE LFTABICMS ALTER COLUMN ALIQTI TYPE NUMERIC(6,2);

ALTER TABLE LFTABICMS ALTER COLUMN ALIQINTRATI TYPE NUMERIC(6,2);

ALTER TABLE LFTABICMS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFTABICMS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE LFTRATTRIB ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE LFTRATTRIB ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE MGPRODUTO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE MGPRODUTO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPDISTRIB ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPDISTRIB ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPESTRUANALISE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPESTRUANALISE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty PPGERAOP for drop PPESTRUFASE(TEMPOEF) */
SET TERM ^ ;

ALTER PROCEDURE PPGERAOP(TIPOPROCESS CHAR,
CODEMPOP INTEGER,
CODFILIALOP SMALLINT,
CODOP INTEGER,
SEQOP INTEGER,
CODEMPPD INTEGER,
CODFILIALPD SMALLINT,
CODPROD INTEGER,
CODEMPOC INTEGER,
CODFILIALOC SMALLINT,
CODORC INTEGER,
TIPOORC CHAR,
CODITORC SMALLINT,
QTDSUGPRODOP NUMERIC(15,5),
DTFABROP DATE,
SEQEST SMALLINT,
CODEMPET INTEGER,
CODFILIALET SMALLINT,
CODEST SMALLINT,
AGRUPDATAAPROV CHAR,
AGRUPDTFABROP CHAR,
AGRUPCODCLI CHAR,
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
DATAAPROV DATE,
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
CODITCOMPRA SMALLINT,
JUSTFICQTDPROD VARCHAR(500),
CODEMPPDENTRADA INTEGER,
CODFILIALPDENTRADA SMALLINT,
CODPRODENTRADA INTEGER,
QTDENTRADA NUMERIC(15,5))
 RETURNS(CODOPRET INTEGER,
SEQOPRET SMALLINT)
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

ALTER TABLE PPESTRUFASE ALTER COLUMN TEMPOEF TYPE NUMERIC(15,5);

ALTER TABLE PPESTRUFASE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPESTRUFASE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty PPITOPSP02 for drop PPESTRUTURA(QTDEST) */
SET TERM ^ ;

ALTER PROCEDURE PPITOPSP02(ICODEMP INTEGER,
ICODFILIAL SMALLINT,
ICODOP INTEGER,
ISEQOP SMALLINT)
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER PPOPENTRADATGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPESTRUTURA ALTER COLUMN QTDEST TYPE NUMERIC(15,5);

ALTER TABLE PPESTRUTURA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER PPESTRUTURATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPESTRUTURA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPFASE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPFASE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPFOTOMTAN ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPFOTOMTAN ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty PPCUSTOPRODSP for drop PPITESTRUTURA(QTDITEST) */
SET TERM ^ ;

ALTER PROCEDURE PPCUSTOPRODSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
DTESTOQ DATE,
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CCOMSALDO CHAR(10))
 RETURNS(CUSTOUNIT NUMERIC(15,5),
SLDPROD NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

ALTER TRIGGER PPOPFASETGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPITESTRUTURA ALTER COLUMN QTDITEST TYPE NUMERIC(15,9);

SET TERM ^ ;

ALTER TRIGGER PPITESTRUTURATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPITESTRUTURA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER PPITESTRUTURATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPITESTRUTURA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPITESTRUTURASUBPROD ALTER COLUMN QTDITESTSP TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER PPITESTRUTURASUBPRODTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPITESTRUTURASUBPROD ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER PPITESTRUTURASUBPRODTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPITESTRUTURASUBPROD ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER PPOPTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPITOP ALTER COLUMN QTDITOP TYPE NUMERIC(15,5);

ALTER TABLE PPITOP ALTER COLUMN QTDCOPIAITOP TYPE NUMERIC(15,5);

ALTER TABLE PPITOP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER PPITOPTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPITOP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPITRETCP ALTER COLUMN QTDITRET TYPE NUMERIC(15,5);

ALTER TABLE PPITRETCP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPITRETCP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPOP ALTER COLUMN QTDSUGPRODOP TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER PPOPTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPOP ALTER COLUMN QTDPREVPRODOP TYPE NUMERIC(15,5);

ALTER TABLE PPOP ALTER COLUMN QTDFINALPRODOP TYPE NUMERIC(15,5);

/* Empty PPATUDISTOPSP for drop PPOP(QTDDISTPOP) */
SET TERM ^ ;

ALTER PROCEDURE PPATUDISTOPSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
NQTDDISTOLD NUMERIC(15,5),
NQTDDISTNEW NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE PPOP ALTER COLUMN QTDDISTPOP TYPE NUMERIC(15,5);

ALTER TABLE PPOP ALTER COLUMN QTDDISTIOP TYPE NUMERIC(15,5);

ALTER TABLE PPOP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPOP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPOPACAOCORRET ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPOPACAOCORRET ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPOPCQ ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER PPOPCQTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPOPCQ ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPOPENTRADA ALTER COLUMN QTDENT TYPE NUMERIC(15,5);

ALTER TABLE PPOPENTRADA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPOPENTRADA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPOPFASE ALTER COLUMN TEMPOOF TYPE NUMERIC(15,5);

ALTER TABLE PPOPFASE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER PPOPFASETGBU0
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPOPFASE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPOPITORC ALTER COLUMN QTDPROD TYPE NUMERIC(15,5);

ALTER TABLE PPOPITORC ALTER COLUMN QTDFINALPRODITORC TYPE NUMERIC(15,5);

ALTER TABLE PPOPITORC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPOPITORC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER PPOPSUBPRODTGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPOPSUBPRODTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPOPSUBPROD ALTER COLUMN QTDITSP TYPE NUMERIC(15,5);

ALTER TABLE PPOPSUBPROD ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER PPOPSUBPRODTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPOPSUBPROD ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPPROCESSAOPTMP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPPROCESSAOPTMP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPRECURSO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPRECURSO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPRETCP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPRETCP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PPTIPOREC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PPTIPOREC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PVCAIXA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER PVCAIXATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PVCAIXA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PVCAIXAIMP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PVCAIXAIMP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PVLEITURAX ALTER COLUMN TT01 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT02 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT03 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT04 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT05 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT06 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT07 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT08 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT09 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT10 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT11 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT12 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT13 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT14 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT15 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TT16 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TISENCAO TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TNINCIDENCIA TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TSUBSTITUICAO TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TN1 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TN2 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TN3 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TN4 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TN5 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TN6 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TN7 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TN8 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TN9 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TSANGRIA TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TSUPRIMENTO TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN TGTOTAL TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN ALIQ01 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN ALIQ02 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN ALIQ03 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN ALIQ04 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN ALIQ05 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN ALIQ06 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN ALIQ07 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN ALIQ08 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN ALIQ09 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN ALIQ10 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN ALIQ11 TYPE NUMERIC(15,5);

ALTER TABLE PVLEITURAX ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PVLEITURAX ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty PVABRECAIXASP for drop PVMOVCAIXA(VLRMOV) */
SET TERM ^ ;

ALTER PROCEDURE PVABRECAIXASP(ICODCAIXA INTEGER,
SCODFILIAL SMALLINT,
ICODEMP INTEGER,
NVLRINICAIXA NUMERIC(15,5),
DDTAMOV DATE,
ICODFILIALUS SMALLINT,
CIDUSU CHAR(8))
 AS
 BEGIN EXIT; END
^

/* Empty PVADICMOVCAIXASP01 for drop PVMOVCAIXA(VLRMOV) */
ALTER PROCEDURE PVADICMOVCAIXASP01(ICODCAIXA INTEGER,
NVLRINICAIXA NUMERIC(18,3),
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
DDTAMOV DATE)
 AS
 BEGIN EXIT; END
^

/* Empty PVFECHACAIXASP for drop PVMOVCAIXA(VLRMOV) */
ALTER PROCEDURE PVFECHACAIXASP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODCAIXA INTEGER,
DDTAMOV DATE,
REDUZ CHAR,
ICODFILIALUS SMALLINT,
CIDUSU CHAR(8))
 AS
 BEGIN EXIT; END
^

/* Empty PVFECHAVENDASP for drop PVMOVCAIXA(VLRMOV) */
ALTER PROCEDURE PVFECHAVENDASP(ICODEMP INTEGER,
ICODFILIAL SMALLINT,
NVALOR NUMERIC(15,5),
ITERM INTEGER,
DDTAMOV DATE,
CIDUSU CHAR(8))
 AS
 BEGIN EXIT; END
^

/* Empty PVSANGRIASP for drop PVMOVCAIXA(VLRMOV) */
ALTER PROCEDURE PVSANGRIASP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
NVALOR NUMERIC(18,3),
ICODCAIXA INTEGER,
DDTAMOV DATE,
CIDUSU CHAR(8))
 AS
 BEGIN EXIT; END
^

/* Empty PVSUPRIMENTOSP for drop PVMOVCAIXA(VLRMOV) */
ALTER PROCEDURE PVSUPRIMENTOSP(ICODEMP INTEGER,
ICODFILIAL SMALLINT,
NVALOR NUMERIC(18,3),
ITERM INTEGER,
DDTAMOV DATE,
CIDUSU CHAR(8))
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER PVMOVCAIXATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PVMOVCAIXA ALTER COLUMN VLRMOV TYPE NUMERIC(15,5);

/* Empty PVRETMOVCAIXASP for drop PVMOVCAIXA(VLRSLDMOV) */
SET TERM ^ ;

ALTER PROCEDURE PVRETMOVCAIXASP(ICODCAIXA INTEGER,
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DDTAMOV DATE)
 RETURNS(DDTAMOVRET DATE,
CTIPOMOV CHAR,
NVLRSLDMOV NUMERIC(15,5),
CIDUSU CHAR(8))
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

ALTER TABLE PVMOVCAIXA ALTER COLUMN VLRSLDMOV TYPE NUMERIC(15,5);

ALTER TABLE PVMOVCAIXA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PVMOVCAIXA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PVSEQMOVCAIXA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PVSEQMOVCAIXA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE PVSEQUENCIA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE PVSEQUENCIA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHAREA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHAREA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHBENEFICIO ALTER COLUMN VALORBENEF TYPE NUMERIC(15,5);

ALTER TABLE RHBENEFICIO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHBENEFICIO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty RHLISTACANDVAGASP for drop RHCANDIDATO(PRETENSAOSAL) */
SET TERM ^ ;

ALTER PROCEDURE RHLISTACANDVAGASP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODVAGA INTEGER,
ICODFUNC INTEGER)
 RETURNS(CODCAND INTEGER,
NOMECAND CHAR(50),
FONECAND CHAR(12),
PRETENSAOSAL NUMERIC(15,2),
QUALIFICACOES INTEGER,
RESTRICOES INTEGER,
CURSOS INTEGER,
EXPERIENCIA INTEGER,
STVAGACAND CHAR(2),
STCAND CHAR(2))
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

ALTER TABLE RHCANDIDATO ALTER COLUMN PRETENSAOSAL TYPE NUMERIC(15,5);

ALTER TABLE RHCANDIDATO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHCANDIDATO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHCANDIDATOCARAC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHCANDIDATOCARAC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHCANDIDATOCURSO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHCANDIDATOCURSO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHCANDIDATOFUNC ALTER COLUMN SALARIO TYPE NUMERIC(15,5);

ALTER TABLE RHCANDIDATOFUNC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHCANDIDATOFUNC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHCANDIDATOSTATUS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHCANDIDATOSTATUS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHCARACTERISTICA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHCARACTERISTICA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHCODGPS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHCODGPS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHCURSO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHCURSO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHDEPTO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHDEPTO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHEMPREGADO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHEMPREGADO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHEMPREGADOBENEF ALTER COLUMN QTDBENEF TYPE NUMERIC(15,5);

ALTER TABLE RHEMPREGADOBENEF ALTER COLUMN VLRTOTBENEF TYPE NUMERIC(15,5);

ALTER TABLE RHEMPREGADOBENEF ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHEMPREGADOBENEF ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHEMPREGADOR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHEMPREGADOR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHEMPREGADOSAL ALTER COLUMN VALORSAL TYPE NUMERIC(15,5);

ALTER TABLE RHEMPREGADOSAL ALTER COLUMN CUSTOHORATRAB TYPE NUMERIC(15,5);

ALTER TABLE RHEMPREGADOSAL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHEMPREGADOSAL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHEXPEDIENTE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHEXPEDIENTE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHEXPEDMES ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHEXPEDMES ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHFUNCAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHFUNCAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHNIVELCURSO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHNIVELCURSO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHPONTO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHPONTO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHTABELAINSS ALTER COLUMN TETO TYPE NUMERIC(15,5);

ALTER TABLE RHTABELAINSS ALTER COLUMN ALIQUOTA TYPE NUMERIC(15,5);

ALTER TABLE RHTABELAINSS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHTABELAINSS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHTABELAIRRF ALTER COLUMN TETO TYPE NUMERIC(15,5);

ALTER TABLE RHTABELAIRRF ALTER COLUMN ALIQUOTA TYPE NUMERIC(15,5);

ALTER TABLE RHTABELAIRRF ALTER COLUMN REDUCAODEPENDENTE TYPE NUMERIC(15,5);

ALTER TABLE RHTABELAIRRF ALTER COLUMN DEDUCAO TYPE NUMERIC(15,5);

ALTER TABLE RHTABELAIRRF ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHTABELAIRRF ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHTURNO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHTURNO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty RHLISTAVAGACANDSP for drop RHVAGA(FAIXASALINI) */
SET TERM ^ ;

ALTER PROCEDURE RHLISTAVAGACANDSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODCAND INTEGER)
 RETURNS(CODVAGA INTEGER,
NOMEEMPR CHAR(60),
CODFUNC INTEGER,
DESCFUNC VARCHAR(100),
FAIXASALINI NUMERIC(15,2),
FAIXASALFIM NUMERIC(15,2),
STVAGA CHAR(2),
QUALIFICACOES INTEGER,
RESTRICOES INTEGER,
CURSOS INTEGER,
STVAGACAND CHAR(2))
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

ALTER TABLE RHVAGA ALTER COLUMN FAIXASALINI TYPE NUMERIC(15,5);

ALTER TABLE RHVAGA ALTER COLUMN FAIXASALFIM TYPE NUMERIC(15,5);

ALTER TABLE RHVAGA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHVAGA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHVAGACANDIDATO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHVAGACANDIDATO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHVAGACARACQUALI ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHVAGACARACQUALI ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHVAGACARACREST ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHVAGACARACREST ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHVAGACURSO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHVAGACURSO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE RHVAGASTATUS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE RHVAGASTATUS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGACESSOEU ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGACESSOEU ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGACESSOMG ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGACESSOMG ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGACESSOMU ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGACESSOMU ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGAGENDA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER SGAGENDATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE SGAGENDA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGAGENTE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGAGENTE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGATRIBUICAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGATRIBUICAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGATRIBUSU ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGATRIBUSU ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGBAIRRO ALTER COLUMN VLRFRETE TYPE NUMERIC(15,5);

ALTER TABLE SGBAIRRO ALTER COLUMN QTDFRETE TYPE NUMERIC(15,5);

ALTER TABLE SGBAIRRO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGBAIRRO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGCATIMG ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGCATIMG ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGCONEXAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGCONEXAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGEMPRESA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGEMPRESA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGEQVCLIFOR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGEQVCLIFOR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGESTACAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGESTACAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGESTACAOBAL ALTER COLUMN DRIVERBAL TYPE VARCHAR(100);

ALTER TABLE SGESTACAOBAL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGESTACAOBAL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGESTACAOIMP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGESTACAOIMP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGESTCIVIL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGESTCIVIL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGFILIAL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGFILIAL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGFLUXO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGFLUXO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGGATILHO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGGATILHO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGGRAUINST ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGGRAUINST ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGGRPUSU ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGGRPUSU ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGIMAGEM ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGIMAGEM ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGIMPRESSORA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGIMPRESSORA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGITFLUXO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGITFLUXO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGITPREFERE6 ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGITPREFERE6 ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGITPROCESSO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGITPROCESSO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGITTABELA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGITTABELA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGLOG ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGLOG ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGMENU ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGMENU ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGMENUOBJ ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGMENUOBJ ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGMODETIQUETA ALTER COLUMN DESCMODETIQ TYPE CHAR(100);

/* WARNING:
Cannot perform safe conversion of SGMODETIQUETA.TXAMODETIQ datatype from VARCHAR(1000) to BLOB SUB_TYPE 1 */
ALTER TABLE SGMODETIQUETA ALTER COLUMN MODETIQ TYPE VARCHAR(100);

ALTER TABLE SGMODETIQUETA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGMODETIQUETA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGMODULO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGMODULO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGMUNICIPIO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGMUNICIPIO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGOBJETO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGOBJETO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGOBJETOTB ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGOBJETOTB ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGPAIS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGPAIS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGPAPEL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGPAPEL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGPREFERE1 DROP CONSTRAINT SGPREFERE1FKEQTIPO;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTM TYPE INTEGER;

ALTER TABLE SGPREFERE1 DROP CONSTRAINT SGPREFERE1FK9EQTIP;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT9 TYPE INTEGER;

ALTER TABLE SGPREFERE1 ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGPREFERE1 ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGPREFERE2 ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGPREFERE2 ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGPREFERE3 ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGPREFERE3 ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGPREFERE4 ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGPREFERE4 ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGPREFERE5 ALTER COLUMN NOMERESP TYPE VARCHAR(50);

ALTER TABLE SGPREFERE5 ALTER COLUMN IDENTPROFRESP TYPE VARCHAR(30);

ALTER TABLE SGPREFERE5 ALTER COLUMN CARGORESP TYPE VARCHAR(30);

ALTER TABLE SGPREFERE5 ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGPREFERE5 ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGPREFERE6 ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGPREFERE6 ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGPREFERE7 ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGPREFERE7 ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGPREFERE8 ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGPREFERE8 ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGPROCESSO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGPROCESSO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGSEQUENCE_ID ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGSEQUENCE_ID ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGSEQUENCIA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGSEQUENCIA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGSISTEMA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGSISTEMA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGSQUID_ACTION ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGSQUID_ACTION ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGSQUID_HIER ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGSQUID_HIER ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGSQUID_LOG ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGSQUID_LOG ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGSQUID_METHOD ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGSQUID_METHOD ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGTABELA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGTABELA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGTAREFA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGTAREFA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGTIPOAGENDA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGTIPOAGENDA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGTRATARET ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGTRATARET ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGUF ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGUF ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGUNIFCOD ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGUNIFCOD ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGUSUARIO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER SGUSUARIOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE SGUSUARIO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SGVARIAVEL ALTER COLUMN VLRDECIMAL TYPE NUMERIC(15,5);

ALTER TABLE SGVARIAVEL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SGVARIAVEL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SVAVALIACAO ALTER COLUMN QTDAVAL TYPE NUMERIC(15,5);

ALTER TABLE SVAVALIACAO ALTER COLUMN PRECOAVAL TYPE NUMERIC(15,5);

ALTER TABLE SVAVALIACAO ALTER COLUMN VLRTOTAVAL TYPE NUMERIC(15,5);

ALTER TABLE SVAVALIACAO ALTER COLUMN VLRDESCAVAL TYPE NUMERIC(15,5);

ALTER TABLE SVAVALIACAO ALTER COLUMN VLRLIQAVAL TYPE NUMERIC(15,5);

ALTER TABLE SVAVALIACAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SVAVALIACAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SVEXECUCAO ALTER COLUMN QTDEXEC TYPE NUMERIC(15,5);

ALTER TABLE SVEXECUCAO ALTER COLUMN PRECOEXEC TYPE NUMERIC(15,5);

ALTER TABLE SVEXECUCAO ALTER COLUMN VLRTOTEXEC TYPE NUMERIC(15,5);

ALTER TABLE SVEXECUCAO ALTER COLUMN VLRDESCEXEC TYPE NUMERIC(15,5);

ALTER TABLE SVEXECUCAO ALTER COLUMN VLRLIQEXEC TYPE NUMERIC(15,5);

ALTER TABLE SVEXECUCAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SVEXECUCAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SVITOS ALTER COLUMN QTDITOS TYPE NUMERIC(15,5);

ALTER TABLE SVITOS ALTER COLUMN PRECOITOS TYPE NUMERIC(15,5);

ALTER TABLE SVITOS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SVITOS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE SVOS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE SVOS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKATIVIDADE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKATIVIDADE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKCAMPANHA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKCAMPANHA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKCAMPANHACLI ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKCAMPANHACLI ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

DROP VIEW TKCONTCLIVW03;

DROP VIEW TKCONTCLIVW01;

DROP VIEW TKCONTCLIVW02;

ALTER TABLE TKCAMPANHACTO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKCAMPANHACTO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKCAMPANHAEMAIL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKCAMPANHAEMAIL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKCONFEMAIL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKCONFEMAIL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKCONTATO ALTER COLUMN DDDCTO TYPE VARCHAR(4);

/* Empty TKCONTCLISP for drop TKCONTATO(FONECTO) */
SET TERM ^ ;

ALTER PROCEDURE TKCONTCLISP(CODEMP INTEGER,
CODFILIAL INTEGER,
CODCTO INTEGER,
CODFILIALTI INTEGER,
CODTIPOCLI INTEGER,
CODFILIALCC INTEGER,
CODCLASCLI INTEGER,
CODFILIALSR INTEGER,
CODSETOR INTEGER)
 RETURNS(IRET INTEGER)
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

ALTER TABLE TKCONTATO ALTER COLUMN FONECTO TYPE VARCHAR(12);

ALTER TABLE TKCONTATO ALTER COLUMN CELCTO TYPE VARCHAR(12);

ALTER TABLE TKCONTATO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER TKCONTATOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE TKCONTATO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKCONTCLI ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKCONTCLI ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKCONTPESSOA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKCONTPESSOA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKCTOATIV ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKCTOATIV ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKCTOGRPINT ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKCTOGRPINT ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKEMAIL ALTER COLUMN FORMATO TYPE VARCHAR(10);

ALTER TABLE TKEMAIL ALTER COLUMN CHARSET TYPE VARCHAR(10);

ALTER TABLE TKEMAIL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKEMAIL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKHISTORICO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKHISTORICO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKORIGCONT ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKORIGCONT ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKSETORCTO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKSETORCTO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKSITCAMP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKSITCAMP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKTIPOCONT ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKTIPOCONT ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE TKTIPOIMP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE TKTIPOIMP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDAUXVENDA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDAUXVENDA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLASCLI ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCLASCLI ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLCOMIS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER VDCLCOMISTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDCLCOMIS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLIAUTP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCLIAUTP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLICOMPL ALTER COLUMN RENDATRABCLI TYPE NUMERIC(15,5);

ALTER TABLE VDCLICOMPL ALTER COLUMN OUTRENDACLI TYPE NUMERIC(15,5);

ALTER TABLE VDCLICOMPL ALTER COLUMN RENDACONJCLI TYPE NUMERIC(15,5);

ALTER TABLE VDCLICOMPL ALTER COLUMN RENDAAVALCLI TYPE NUMERIC(15,5);

ALTER TABLE VDCLICOMPL ALTER COLUMN FATURCLI TYPE NUMERIC(15,5);

ALTER TABLE VDCLICOMPL ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCLICOMPL ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLICONTAS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCLICONTAS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLIENTE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER VDCLIENTETGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDCLIENTE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLIENTEFOR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCLIENTEFOR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLIIMOV ALTER COLUMN VALORIMOV TYPE NUMERIC(15,5);

ALTER TABLE VDCLIIMOV ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCLIIMOV ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLIMETAVEND ALTER COLUMN VLRMETAVEND TYPE NUMERIC(15,5);

ALTER TABLE VDCLIMETAVEND ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCLIMETAVEND ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLIREFC ALTER COLUMN VLRMAIORCP TYPE NUMERIC(15,5);

ALTER TABLE VDCLIREFC ALTER COLUMN VLRULTCP TYPE NUMERIC(15,5);

ALTER TABLE VDCLIREFC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCLIREFC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLIREFP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCLIREFP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLISOCIOS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCLISOCIOS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLITERRA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCLITERRA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCLIVEIC ALTER COLUMN VALORVEIC TYPE NUMERIC(15,5);

ALTER TABLE VDCLIVEIC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCLIVEIC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty FNESTORNACOMISSAOSP for drop VDCOMISSAO(VLRVENDACOMI) */
SET TERM ^ ;

ALTER PROCEDURE FNESTORNACOMISSAOSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODREC INTEGER,
NPARCITREC SMALLINT)
 AS
 BEGIN EXIT; END
^

/* Empty VDADICCOMISSAOSP for drop VDCOMISSAO(VLRVENDACOMI) */
ALTER PROCEDURE VDADICCOMISSAOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRVENDACOMI NUMERIC(15,5),
NVLRCOMI NUMERIC(15,5),
DDATACOMI DATE,
DDTCOMPCOMI DATE,
DDTVENCCOMI DATE,
CTIPOCOMI CHAR,
CODEMPVD INTEGER,
CODFILIALVD SMALLINT,
CODVEND INTEGER)
 AS
 BEGIN EXIT; END
^

/* Empty VDESTORNACOMISSAOSP for drop VDCOMISSAO(VLRVENDACOMI) */
ALTER PROCEDURE VDESTORNACOMISSAOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
ICODVEND INTEGER,
DINI DATE,
DFIM DATE,
CORDEM CHAR)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE VDCOMISSAO ALTER COLUMN VLRVENDACOMI TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER VDCOMISSAOTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDCOMISSAOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDCOMISSAO ALTER COLUMN VLRCOMI TYPE NUMERIC(15,5);

ALTER TABLE VDCOMISSAO ALTER COLUMN VLRPAGOCOMI TYPE NUMERIC(15,5);

ALTER TABLE VDCOMISSAO ALTER COLUMN VLRAPAGCOMI TYPE NUMERIC(15,5);

ALTER TABLE VDCOMISSAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCOMISSAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCONSIGNACAO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCONSIGNACAO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCONTRATO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCONTRATO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDCONTRORC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDCONTRORC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDETIQCLI ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDETIQCLI ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDFOTOPROD ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDFOTOPROD ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty VDBUSCACUSTOVENDASP for drop VDFRETEVD(VLRFRETEVD) */
SET TERM ^ ;

ALTER PROCEDURE VDBUSCACUSTOVENDASP(CODEMPVD INTEGER,
CODFILIALVD SMALLINT,
CODVENDA INTEGER,
TIPOVENDA CHAR,
CODEMPOC INTEGER,
CODFILIALOC INTEGER,
CODORC INTEGER,
TIPOORC CHAR,
CODITORC INTEGER)
 RETURNS(VLRPROD NUMERIC(15,5),
VLRDESC NUMERIC(15,5),
VLRICMS NUMERIC(15,5),
VLROUTRAS NUMERIC(15,5),
VLRCOMIS NUMERIC(15,5),
VLRADIC NUMERIC(15,5),
VLRIPI NUMERIC(15,5),
VLRPIS NUMERIC(15,5),
VLRCOFINS NUMERIC(15,5),
VLRIR NUMERIC(15,5),
VLRCSOCIAL NUMERIC(15,5),
VLRFRETE NUMERIC(15,5),
TIPOFRETE CHAR,
ADICFRETE CHAR,
VLRCUSTOPEPS NUMERIC(15,5),
VLRCUSTOMPM NUMERIC(15,5),
VLRPRECOULTCP NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

ALTER TABLE VDFRETEVD ALTER COLUMN VLRFRETEVD TYPE NUMERIC(15,5);

ALTER TABLE VDFRETEVD ALTER COLUMN QTDFRETEVD TYPE NUMERIC(15,5);

ALTER TABLE VDFRETEVD ALTER COLUMN PESOBRUTVD TYPE NUMERIC(15,5);

ALTER TABLE VDFRETEVD ALTER COLUMN PESOLIQVD TYPE NUMERIC(15,5);

ALTER TABLE VDFRETEVD ALTER COLUMN VLRBASEICMSFRETEVD TYPE NUMERIC(15,5);

ALTER TABLE VDFRETEVD ALTER COLUMN ALIQICMSFRETEVD TYPE NUMERIC(15,5);

ALTER TABLE VDFRETEVD ALTER COLUMN VLRICMSFRETEVD TYPE NUMERIC(15,5);

ALTER TABLE VDFRETEVD ALTER COLUMN VLRSEGFRETEVD TYPE NUMERIC(15,5);

ALTER TABLE VDFRETEVD ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDFRETEVD ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDITCONTRATO ALTER COLUMN QTDITCONTR TYPE NUMERIC(15,5);

ALTER TABLE VDITCONTRATO ALTER COLUMN VLRITCONTR TYPE NUMERIC(15,5);

ALTER TABLE VDITCONTRATO ALTER COLUMN VLRITCONTREXCED TYPE NUMERIC(15,5);

ALTER TABLE VDITCONTRATO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDITCONTRATO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDITCONTRATOAND ALTER COLUMN PERCAND TYPE NUMERIC(15,5);

ALTER TABLE VDITCONTRATOAND ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDITCONTRATOAND ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER VDITORCAMENTOTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDITORCAMENTOTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDITCUSTOORC ALTER COLUMN VLRPRECOULTCP TYPE NUMERIC(15,5);

ALTER TABLE VDITCUSTOORC ALTER COLUMN VLRCUSTOMPM TYPE NUMERIC(15,5);

ALTER TABLE VDITCUSTOORC ALTER COLUMN VLRCUSTOPEPS TYPE NUMERIC(15,5);

ALTER TABLE VDITCUSTOORC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDITCUSTOORC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER VDITVENDATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDITCUSTOVENDA ALTER COLUMN VLRPRECOULTCP TYPE NUMERIC(15,5);

ALTER TABLE VDITCUSTOVENDA ALTER COLUMN VLRCUSTOMPM TYPE NUMERIC(15,5);

ALTER TABLE VDITCUSTOVENDA ALTER COLUMN VLRCUSTOPEPS TYPE NUMERIC(15,5);

ALTER TABLE VDITCUSTOVENDA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDITCUSTOVENDA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDITKIT ALTER COLUMN QTDITKIT TYPE NUMERIC(15,5);

ALTER TABLE VDITKIT ALTER COLUMN PRECOITKIT TYPE NUMERIC(15,5);

ALTER TABLE VDITKIT ALTER COLUMN VLRTOTITKIT TYPE NUMERIC(15,5);

ALTER TABLE VDITKIT ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER VDITKITTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDITKIT ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty VDATUDESCVENDAORCSP for drop VDITORCAMENTO(QTDITORC) */
SET TERM ^ ;

ALTER PROCEDURE VDATUDESCVENDAORCSP(CODEMPVD INTEGER,
CODFILIALVD SMALLINT,
TIPOVENDA CHAR,
CODVENDA INTEGER)
 AS
 BEGIN EXIT; END
^

/* Empty VDCOPIAORCSP for drop VDITORCAMENTO(QTDITORC) */
ALTER PROCEDURE VDCOPIAORCSP(CODEMP INTEGER,
CODFILIAL INTEGER,
CODORC INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER)
 RETURNS(IRET INTEGER)
 AS
 BEGIN SUSPEND; END
^

/* Empty VDUPVENDAORCSP for drop VDITORCAMENTO(QTDITORC) */
ALTER PROCEDURE VDUPVENDAORCSP(ICODEMP INTEGER,
ICODFILIAL INTEGER,
ICODORC INTEGER,
ICODITORC INTEGER,
ICODFILIALVD INTEGER,
ICODVENDA INTEGER,
ICODITVENDA INTEGER,
STIPOVENDA CHAR(10))
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER VDITORCAMENTOTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDITORCAMENTOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDITORCAMENTO ALTER COLUMN QTDITORC TYPE NUMERIC(15,5);

ALTER TABLE VDITORCAMENTO ALTER COLUMN QTDAPROVITORC TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER VDVENDAORCTGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDITORCAMENTO ALTER COLUMN QTDAFATITORC TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER VDVENDAORCTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDITORCAMENTO ALTER COLUMN QTDFATITORC TYPE NUMERIC(15,5);

ALTER TABLE VDITORCAMENTO ALTER COLUMN PRECOITORC TYPE NUMERIC(15,5);

ALTER TABLE VDITORCAMENTO ALTER COLUMN PERCDESCITORC TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER VDITORCAMENTOTGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDITORCAMENTO ALTER COLUMN VLRDESCITORC TYPE NUMERIC(15,5);

ALTER TABLE VDITORCAMENTO ALTER COLUMN VLRLIQITORC TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER VDORCAMENTOTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDITORCAMENTO ALTER COLUMN VLRPRODITORC TYPE NUMERIC(15,5);

ALTER TABLE VDITORCAMENTO ALTER COLUMN VLRCOMISITORC TYPE NUMERIC(15,5);

ALTER TABLE VDITORCAMENTO ALTER COLUMN VLRFRETEITORC TYPE NUMERIC(15,5);

ALTER TABLE VDITORCAMENTO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDITORCAMENTO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDITREGRACOMIS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDITREGRACOMIS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDITROMANEIO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDITROMANEIO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

/* Empty VDADICITEMPDVSP for drop VDITVENDA(QTDITVENDA) */
SET TERM ^ ;

ALTER PROCEDURE VDADICITEMPDVSP(CODVENDA INTEGER,
CODEMP INTEGER,
CODFILIAL CHAR(8),
CODPROD INTEGER,
CODEMPPD INTEGER,
CODFILIALPD INTEGER,
QTDITVENDA NUMERIC(9,5),
VLRPRECOITVENDA NUMERIC(18,5),
VLRDESCITVENDA NUMERIC(18,5),
PERCDESCITVENDA NUMERIC(15,5),
VLRCOMISITVENDA NUMERIC(15,5),
PERCCOMISITVENDA NUMERIC(15,5),
SCODLOTE VARCHAR(20),
CODEMPLE INTEGER,
CODFILIALLE SMALLINT,
CODFILIALCV SMALLINT,
CODCONV INTEGER)
 RETURNS(CODITVENDA INTEGER,
PERCICMSITVENDA NUMERIC(9,2),
VLRBASEICMSITVENDA NUMERIC(18,3),
VLRICMSITVENDA NUMERIC(18,3),
VLRLIQITVENDA NUMERIC(18,3),
TIPOFISC CHAR(2))
 AS
 BEGIN SUSPEND; END
^

/* Empty VDRETULTVDCLIPROD for drop VDITVENDA(QTDITVENDA) */
ALTER PROCEDURE VDRETULTVDCLIPROD(ICODEMP INTEGER,
ICODCLI INTEGER,
ICODFILIALVD SMALLINT,
ICODVEND INTEGER,
DTINI DATE,
DTFIM DATE,
CODEMPTIPOCL INTEGER,
CODFILIALTIPOCL SMALLINT,
CODTIPOCLI INTEGER)
 RETURNS(RAZCLI_RET CHAR(60),
CODCLI_RET INTEGER,
DESCPROD_RET CHAR(50),
CODPROD_RET INTEGER,
DTEMITVENDA_RET DATE,
DOCVENDA_RET INTEGER,
SERIE_RET CHAR(4),
PRECOVENDA_RET NUMERIC(15,4),
OBSITVENDA_RET VARCHAR(500),
REFPROD_RET VARCHAR(20),
QTDPROD_RET NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

DROP VIEW ATATENDIMENTOVW05;

SET TERM ^ ;

ALTER TRIGGER VDITVENDATGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDITVENDATGBD
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDITVENDA ALTER COLUMN QTDITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN QTDITVENDACANC TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN PRECOITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN PERCDESCITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRDESCITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN PERCICMSITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEICMSITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRICMSITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN PERCIPIITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEIPIITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRIPIITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRLIQITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN PERCCOMISITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRCOMISITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRADICITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN PERCISSITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRISSITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRFRETEITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRPRODITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRISENTASITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLROUTRASITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEISSITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEICMSBRUTITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEICMSSTITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRICMSSTITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASECOMISITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN MARGEMVLAGRITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN QTDDEVITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEICMSSTRETITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN VLRICMSSTRETITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDITVENDA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDITVENDA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDITVENDASERIE ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER VDITVENDASERIETGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDITVENDASERIE ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDKIT ALTER COLUMN QTDKIT TYPE NUMERIC(15,5);

ALTER TABLE VDKIT ALTER COLUMN PRECOKIT TYPE NUMERIC(15,5);

ALTER TABLE VDKIT ALTER COLUMN VLRTOTKIT TYPE NUMERIC(15,5);

SET TERM ^ ;

ALTER TRIGGER VDKITTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDKIT ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER VDKITTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDKIT ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDLOGSITCONTR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDLOGSITCONTR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDMODCONTR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDMODCONTR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDMOTORISTA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDMOTORISTA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDOBSCLI ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDOBSCLI ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER VDORCAMENTOTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDORCAMENTOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRPRODORC TYPE NUMERIC(15,5);

ALTER TABLE VDORCAMENTO ALTER COLUMN PERCDESCORC TYPE NUMERIC(15,5);

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRDESCORC TYPE NUMERIC(15,5);

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRADICORC TYPE NUMERIC(15,5);

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRDESCITORC TYPE NUMERIC(15,5);

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRLIQORC TYPE NUMERIC(15,5);

/* Empty ATADICATENDIMENTOSP for drop VDORCAMENTO(STATUSORC) */
SET TERM ^ ;

ALTER PROCEDURE ATADICATENDIMENTOSP(ICODCONV INTEGER,
ICODTIPOATENDO INTEGER,
ICODATEND INTEGER,
ICODSETOR INTEGER,
VOBSATENDO VARCHAR(10000),
ICODEMP INTEGER,
ICODFILIAL INTEGER,
IDOC INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

RECONNECT;

/* Drop: VDORCAMENTOIDXSTORC (TIdxData) */
DROP INDEX VDORCAMENTOIDXSTORC;

ALTER TABLE VDORCAMENTO ALTER COLUMN STATUSORC SET DEFAULT '*';

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRFRETEORC TYPE NUMERIC(15,5);

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRCOMISORC TYPE NUMERIC(15,5);

ALTER TABLE VDORCAMENTO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDORCAMENTO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDPRAZOENT ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDPRAZOENT ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER VDPRECOPRODTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDPRECOPROD ALTER COLUMN PRECOPROD TYPE NUMERIC(15,5);

ALTER TABLE VDPRECOPROD ALTER COLUMN PRECOANT TYPE NUMERIC(15,5);

ALTER TABLE VDPRECOPROD ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDPRECOPROD ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDPREVTRIBITORC ALTER COLUMN VLRICMSITORC TYPE NUMERIC(15,5);

ALTER TABLE VDPREVTRIBITORC ALTER COLUMN VLRIPIITORC TYPE NUMERIC(15,5);

ALTER TABLE VDPREVTRIBITORC ALTER COLUMN VLRPISITORC TYPE NUMERIC(15,5);

ALTER TABLE VDPREVTRIBITORC ALTER COLUMN VLRCOFINSITORC TYPE NUMERIC(15,5);

ALTER TABLE VDPREVTRIBITORC ALTER COLUMN VLRIRITORC TYPE NUMERIC(15,5);

ALTER TABLE VDPREVTRIBITORC ALTER COLUMN VLRCSOCIALITORC TYPE NUMERIC(15,5);

ALTER TABLE VDPREVTRIBITORC ALTER COLUMN VLRISSITORC TYPE NUMERIC(15,5);

ALTER TABLE VDPREVTRIBITORC ALTER COLUMN VLRSIMPLESITORC TYPE NUMERIC(15,5);

ALTER TABLE VDPREVTRIBITORC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDPREVTRIBITORC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDREGCOMISDESC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDREGCOMISDESC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDREGRACOMIS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDREGRACOMIS ALTER COLUMN PERCCOMISGERAL TYPE NUMERIC(15,5);

ALTER TABLE VDREGRACOMIS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDREMCONSIG ALTER COLUMN QTDSAIDA TYPE NUMERIC(15,5);

ALTER TABLE VDREMCONSIG ALTER COLUMN QTDDEVOL TYPE NUMERIC(15,5);

ALTER TABLE VDREMCONSIG ALTER COLUMN QTDTROCA TYPE NUMERIC(15,5);

ALTER TABLE VDREMCONSIG ALTER COLUMN QTDBONIF TYPE NUMERIC(15,5);

ALTER TABLE VDREMCONSIG ALTER COLUMN PRECO TYPE NUMERIC(15,5);

ALTER TABLE VDREMCONSIG ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDREMCONSIG ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDROMANEIO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDROMANEIO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDSETOR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDSETOR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDSETORROTA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDSETORROTA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDSTATUSORC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDSTATUSORC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDTABPRECO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDTABPRECO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDTEF ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDTEF ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDTIPOCLI ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDTIPOCLI ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDTRANSP ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER VDTRANSPTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDTRANSP ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDVEICULO ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDVEICULO ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

SET TERM ^ ;

ALTER TRIGGER VDVENDATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDVENDA ALTER COLUMN SERIE TYPE VARCHAR(5);

/* Empty VDGERACOMISSAOSP for drop VDVENDA(VLRPRODVENDA) */
SET TERM ^ ;

ALTER PROCEDURE VDGERACOMISSAOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRCOMIITREC NUMERIC(15,5),
DDTVENCITREC DATE)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE VDVENDA ALTER COLUMN VLRPRODVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN PERCDESCVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRDESCVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRDESCITVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEICMSVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRICMSVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRISENTASVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLROUTRASVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEIPIVENDA TYPE NUMERIC(15,5);

/* Empty VDEVOLUVENDAS for drop VDVENDA(VLRLIQVENDA) */
SET TERM ^ ;

ALTER PROCEDURE VDEVOLUVENDAS(ICODEMP SMALLINT,
ICODFILIAL SMALLINT,
DATAINI DATE,
DATAFIM DATE,
ICODTIPOCLI SMALLINT,
ICODCLI SMALLINT,
FILTRAVENDAS CHAR,
FATURADO CHAR,
FINANCEIRO CHAR,
EMITIDO CHAR)
 RETURNS(VALOR NUMERIC(15,5),
MES SMALLINT,
ANO SMALLINT)
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

ALTER TABLE VDVENDA ALTER COLUMN VLRLIQVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRCOMISVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRFRETEVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRADICVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRIPIVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEISSVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRISSVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRPISVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRCOFINSVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRIRVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRCSOCIALVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRICMSSTVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEICMSSTVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRICMSSIMPLES TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEPISVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRBASECOFINSVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN VLRBASECOMIS TYPE NUMERIC(15,5);

ALTER TABLE VDVENDA ALTER COLUMN MOTIVOCANCVENDA TYPE VARCHAR(255);

ALTER TABLE VDVENDA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDVENDA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDVENDACOMIS ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDVENDACOMIS ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDVENDACONSIG ALTER COLUMN PRECO TYPE NUMERIC(15,5);

ALTER TABLE VDVENDACONSIG ALTER COLUMN PRECOVENDA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDACONSIG ALTER COLUMN QTDVENDACO TYPE NUMERIC(15,5);

ALTER TABLE VDVENDACONSIG ALTER COLUMN QTDTROCA TYPE NUMERIC(15,5);

ALTER TABLE VDVENDACONSIG ALTER COLUMN QTDBONIF TYPE NUMERIC(15,5);

ALTER TABLE VDVENDACONSIG ALTER COLUMN DESCONTO TYPE NUMERIC(15,5);

ALTER TABLE VDVENDACONSIG ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDVENDACONSIG ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDVENDAENTREGA ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDVENDAENTREGA ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDVENDAORC ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDVENDAORC ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDVENDEDOR ALTER COLUMN IDUSUINS TYPE VARCHAR(128);

ALTER TABLE VDVENDEDOR ALTER COLUMN IDUSUALT TYPE VARCHAR(128);

ALTER TABLE VDVENDEDOR ALTER COLUMN VLRABONO TYPE NUMERIC(15,5);

ALTER TABLE VDVENDEDOR ALTER COLUMN VLRDESCONTO TYPE NUMERIC(15,5);

/* Drop table-fields... */
ALTER TABLE CPCOMPRA DROP VLRICMSDEVIDO;


/* Create Procedure... */
SET TERM ^ ;

CREATE PROCEDURE CPRETULTCPFORPROD(CODEMP INTEGER,
CODFOR INTEGER,
CODFILIALCP SMALLINT,
DTINI DATE,
DTFIM DATE,
CODEMPTIPOFR INTEGER,
CODFILIALTIPOFR SMALLINT,
CODTIPOFOR INTEGER)
 RETURNS(RAZFOR_RET CHAR(60),
CODFOR_RET INTEGER,
DESCPROD_RET CHAR(100),
CODPROD_RET INTEGER,
DTEMITCOMPRA_RET DATE,
DTENTCOMPRA_RET DATE,
DOCCOMPRA_RET INTEGER,
SERIE_RET VARCHAR(5),
PRECOCOMPRA_RET NUMERIC(15,4),
OBSITCOMPRA_RET VARCHAR(10000),
REFPROD_RET VARCHAR(20),
QTDPROD_RET NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

CREATE PROCEDURE EQESTOQUELOTESP(CODEMP INTEGER,
CODFILIAL SMALLINT,
DATAINI DATE,
DATAFIN DATE,
TIPOPROD VARCHAR(2))
 RETURNS(CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD VARCHAR(100),
CODLOTE VARCHAR(20),
SLDLOTEATUAL NUMERIC(15,5),
QTDMOVPROD NUMERIC(15,5),
CUSTOMPMPROD NUMERIC(15,5),
SLDLOTEPERIODO NUMERIC(15,5),
DTENTCOMPRA DATE,
SERIECOMPRA VARCHAR(5),
DOCCOMPRA INTEGER,
VLRLIQITCOMPRA NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

CREATE PROCEDURE VDBUSCAPRECOSP01(CODPROD INTEGER,
CODCLI INTEGER,
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODPLANOPAG INTEGER,
CODEMPPG INTEGER,
CODFILIALPG SMALLINT,
CODTIPOMOV INTEGER,
CODEMPTM INTEGER,
CODFILIALTM SMALLINT,
CODEMP INTEGER,
CODFILIAL SMALLINT,
CODEMPTB INTEGER,
CODFILIALTB SMALLINT,
CODTAB INTEGER)
 RETURNS(PRECO NUMERIC(14,5),
CODCLASCLIP INTEGER,
CODPLANOPAGP INTEGER,
CODPRECOPRODP INTEGER,
CODTABP INTEGER)
 AS
 BEGIN SUSPEND; END
^

CREATE PROCEDURE VDCOPIAPEDSP(CODEMP INTEGER,
CODFILIAL INTEGER,
CODCLI INTEGER,
CODEMPCL INTEGER,
CODFILIALCL INTEGER,
CODPED INTEGER)
 RETURNS(IRET INTEGER)
 AS
 BEGIN SUSPEND; END
^

CREATE PROCEDURE VDRETLISTAPRODSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
DTINI DATE,
DTFIM DATE,
CODFORNECEDOR INTEGER)
 RETURNS(CODFOR INTEGER,
REFPROD CHAR(13),
DESCPROD CHAR(60),
COMPRA NUMERIC(15,2),
PRECOPROD1 NUMERIC(15,2),
VENDA NUMERIC(15,2))
 AS
 BEGIN SUSPEND; END
^


/* Drop domains... */
SET TERM ; ^

/* Drop: NUMERICDN (TDmnData) */
DROP DOMAIN NUMERICDN;

/* Drop: NUMERICDN2 (TDmnData) */
DROP DOMAIN NUMERICDN2;

/* Create view: ATATENDIMENTOVW01 (ViwData.CreateDependDef) */
CREATE VIEW ATATENDIMENTOVW01(
CODEMP,
CODFILIAL,
CODATENDO,
CODEMPAE,
CODFILIALAE,
CODATEND,
NOMEATEND,
PARTPREMIATEND,
CODEMPEP,
CODFILIALEP,
MATEMPR,
COEMPEA,
CODFILIALEA,
CODESPEC,
DESCESPEC,
CODEMPCT,
CODFILIALCT,
CODCONTR,
DESCCONTR,
CODITCONTR,
CODEMPTA,
CODFILIALTA,
CODTAREFA,
TPCOBCONTR,
ANOATENDO,
MESATENDO,
QTDCONTR,
QTDITCONTR,
VLRITCONTR,
VLRITCONTREXCED,
DTINICIO,
STATUSATENDO,
RAZCLI,
NOMECLI,
CODCLI,
CODEMPCL,
CODFILIALCL,
CODEMPCH,
CODFILIALCH,
CODCHAMADO,
DESCCHAMADO,
CODEMPTO,
CODFILIALTO,
CODTPATENDO,
DESCTPATENDO,
OBSATENDO,
DATAATENDO,
DATAATENDOFIN,
HORAATENDO,
HORAATENDOFIN,
PGCOMIESPEC,
COBCLIESPEC,
CONTMETAESPEC,
MRELCOBESPEC,
BHESPEC,
TEMPOMINCOBESPEC,
TEMPOMAXCOBESPEC,
PERCCOMIESPEC,
TOTALMIN,
SITREVATENDO,
SITCONTR,
DESCSITCONTR,
DTPREVFIN,
TIPOATENDO,
DOCATENDO,
CODEMPOC,
CODFILIALOC,
TIPOORC,
CODORC,
IDUSUINS,
DTINS,
HINS,
IDUSUALT,
DTALT,
HALT)
 AS 
select a.codemp, a.codfilial, a.codatendo
  , a.codempae, a.codfilialae, a.codatend, ate.nomeatend, ate.partpremiatend, ate.codempep, codfilialep, matempr
  , a.codempea, a.codfilialea, a.codespec, e.descespec
  , a.codempct, a.codfilialct, a.codcontr, ct.desccontr, a.coditcontr 
  , a.codempta, a.codfilialta, a.codtarefa, ct.tpcobcontr
  , extract(year from a.dataatendo) anoatendo, extract(month from a.dataatendo) mesatendo
  , ( select sum(qtditcontr) from vditcontrato ics 
     where ics.codemp=a.codempct and ics.codfilial=a.codfilialct 
     and ics.codcontr=a.codcontr and ics.franquiaitcontr='S') qtdcontr 
  , ict.qtditcontr, ict.vlritcontr, ict.vlritcontrexced, ct.dtinicio
  , a.statusatendo, c.razcli, c.nomecli, c.codcli, c.codemp, c.codfilial
  , a.codempch, a.codfilialch, a.codchamado, ch.descchamado
  , a.codempto, a.codfilialto, a.codtpatendo, ta.desctpatendo
  , a.obsatendo, a.dataatendo, a.dataatendofin, a.horaatendo, a.horaatendofin
  , e.pgcomiespec, e.cobcliespec, e.contmetaespec, e.mrelcobespec, e.bhespec
  , e.tempomincobespec, e.tempomaxcobespec, e.perccomiespec, ((a.horaatendofin-a.horaatendo) / 60) TOTALMIN
  , a.sitrevatendo
  , ct.sitcontr, ct.descsitcontr, ct.dtprevfin, ta.tipoatendo, a.docatendo, atc.codempoc, atc.codfilialoc, atc.tipoorc, atc.codorc
  , a.idusuins, a.dtins, a.hins, a.idusualt, a.dtalt, a.halt
from  atatendimento a
inner join atatendente ate on
ate.codemp=a.codempae and ate.codfilial=a.codfilialae and ate.codatend=a.codatend
inner join vdcliente c on
c.codemp=a.codempcl and c.codfilial=a.codfilialcl and c.codcli=a.codcli
left outer join attipoatendo ta on
ta.codemp=a.codempto and ta.codfilial=a.codfilialto and ta.codtpatendo=a.codtpatendo
left outer join atespecatend e on
e.codemp=a.codempea and e.codfilial=a.codfilialea and e.codespec=a.codespec
left outer join crchamado ch on
ch.codemp=a.codempch and ch.codfilial=a.codfilialch and ch.codchamado=a.codchamado 
left outer join vdcontrato ct on
ct.codemp=a.codempct and ct.codfilial=a.codfilialct and ct.codcontr=a.codcontr
left outer join vditcontrato ict on
ict.codemp=a.codempct and ict.codfilial=a.codfilialct and ict.codcontr=a.codcontr and ict.coditcontr=a.coditcontr
left outer join atatendimentoorc atc on
atc.codemp=a.codemp and atc.codfilial=a.codfilial and atc.codatendo=a.codatendo
;

/* Create view: ATATENDIMENTOVW02 (ViwData.CreateDependDef) */
CREATE VIEW ATATENDIMENTOVW02(
CODEMP,
CODFILIAL,
CODATENDO,
CODEMPAE,
CODFILIALAE,
CODATEND,
NOMEATEND,
PARTPREMIATEND,
CODEMPEP,
CODFILIALEP,
MATEMPR,
CODEMPEA,
CODFILIALEA,
CODESPEC,
DESCESPEC,
CODEMPCT,
CODFILIALCT,
CODCONTR,
CODITCONTR,
CODEMPTA,
CODFILIALTA,
CODTAREFA,
TPCOBCONTR,
ANOATENDO,
MESATENDO,
QTDCONTR,
QTDITCONTR,
VLRITCONTR,
VLRITCONTREXCED,
DTINICIO,
STATUSATENDO,
RAZCLI,
NOMECLI,
CODCLI,
CODEMPCL,
CODFILIALCL,
CODEMPCH,
CODFILIALCH,
CODCHAMADO,
DESCCHAMADO,
CODEMPTO,
CODFILIALTO,
CODTPATENDO,
DESCTPATENDO,
OBSATENDO,
DATAATENDO,
DATAATENDOFIN,
HORAATENDO,
HORAATENDOFIN,
PGCOMIESPEC,
COBCLIESPEC,
CONTMETAESPEC,
MRELCOBESPEC,
BHESPEC,
TEMPOMINCOBESPEC,
TEMPOMAXCOBESPEC,
PERCCOMIESPEC,
TOTALMIN,
TOTALGERAL,
TOTALMETA,
TOTALCOMIS,
TOTALCOBCLI,
TOTALBH,
SITREVATENDO,
TIPOATENDO,
DOCATENDO,
CODEMPOC,
CODFILIALOC,
TIPOORC,
CODORC,
IDUSUINS,
DTINS,
HINS,
IDUSUALT,
DTALT,
HALT)
 AS 
select A.CODEMP, A.CODFILIAL, A.CODATENDO, 
A.CODEMPAE, A.CODFILIALAE, A.CODATEND, A.NOMEATEND, A.PARTPREMIATEND, A.CODEMPEP, CODFILIALEP, MATEMPR,
A.COEMPEA, A.CODFILIALEA, A.CODESPEC, A.DESCESPEC, 
 A.CODEMPCT, A.CODFILIALCT, A.CODCONTR,  A.CODITCONTR, A.CODEMPTA, A.CODFILIALTA, A.CODTAREFA, A.TPCOBCONTR,
 A.ANOATENDO, A.MESATENDO, A.QTDCONTR,
 A.QTDITCONTR, A.VLRITCONTR, A.VLRITCONTREXCED, A.DTINICIO,
 A.STATUSATENDO, A.RAZCLI, A.NOMECLI, A.CODCLI,
  A.CODEMPCL, A.CODFILIALCL, A.CODEMPCH, A.CODFILIALCH, A.CODCHAMADO, A.DESCCHAMADO,
  A.CODEMPTO, A.CODFILIALTO, A.CODTPATENDO,
   A.DESCTPATENDO, A.OBSATENDO, A.DATAATENDO, A.DATAATENDOFIN, A.HORAATENDO, A.HORAATENDOFIN,
    A.PGCOMIESPEC, A.COBCLIESPEC, A.CONTMETAESPEC, A.MRELCOBESPEC, A.BHESPEC, A.TEMPOMINCOBESPEC, A.TEMPOMAXCOBESPEC,
     A.PERCCOMIESPEC, A.TOTALMIN, 
  (a.totalmin) / 60  totalgeral, 
(( (case when a.contmetaespec='S' then (case when 
a.totalmin<a.tempomincobespec 
then a.tempomincobespec else 
(case when a.totalmin>a.tempomaxcobespec and a.tempomaxcobespec<>0 
then a.tempomaxcobespec else a.totalmin end) end)  else 0 end) 
)/60 ) totalmeta, 
(( (case when a.pgcomiespec='S' then (case when a.totalmin<a.tempomincobespec 
then a.tempomincobespec else 
(case when a.totalmin>a.tempomaxcobespec and a.tempomaxcobespec<>0 
then a.tempomaxcobespec else a.totalmin end) end)  else 0 end) 
)/60 ) totalcomis, 
(( (case when a.cobcliespec='S' and a.statusatendo<>'NC' then (case when a.totalmin<a.tempomincobespec 
then a.tempomincobespec else 
(case when a.totalmin>a.tempomaxcobespec and a.tempomaxcobespec<>0 
then a.tempomaxcobespec else a.totalmin end) end)  else 0 end) 
)/60 ) totalcobcli,
( (case when a.bhespec='S' then a.totalmin else 0 end)/60 ) totalbh,
a.sitrevatendo, a.tipoatendo, a.docatendo, a.codempoc, a.codfilialoc, a.tipoorc, a.codorc
, a.idusuins, a.dtins, a.hins, a.idusualt, a.dtalt, a.halt
from atatendimentovw01 a
;

/* Create view: ATATENDIMENTOVW05 (ViwData.CreateDependDef) */
CREATE VIEW ATATENDIMENTOVW05(
CODEMP,
CODFILIAL,
TIPOVENDA,
CODVENDA,
CODITVENDA,
CODEMPCL,
CODFILIALCL,
CODCLI,
SERIE,
DOCVENDA,
DTEMITVENDA,
DTSAIDAVENDA,
QTDITVENDA,
PRECOITVENDA,
VLRLIQITVENDA,
CODEMPPD,
CODFILIALPD,
CODPROD,
CODEMPCT,
CODFILIALCT,
CODCONTR,
CODITCONTR,
DTINIAPURA,
DTFINAPURA)
 AS 
select iv.codemp, iv.codfilial, iv.tipovenda, iv.codvenda, iv.coditvenda, 
v.codempcl, v.codfilialcl, v.codcli,
v.serie, v.docvenda, v.dtemitvenda, v.dtsaidavenda, iv.qtditvenda, iv.precoitvenda, iv.vlrliqitvenda,
iv.codemppd, iv.codfilialpd, iv.codprod,
ic.codempct, ic.codfilialct, ic.codcontr, ic.coditcontr, ic.dtiniapura, ic.dtfinapura 
from  vdvenda v, vditvenda iv
left outer join vditvendavditcontr ic
on ic.codemp=iv.codemp and ic.codfilial=iv.codfilial and ic.tipovenda=iv.tipovenda and 
ic.codvenda=iv.codvenda and ic.coditvenda=iv.coditvenda
where v.codemp=iv.codemp and v.codfilial=iv.codfilial and v.tipovenda=iv.tipovenda and 
v.codvenda=iv.codvenda and  
iv.qtditvenda is not null and 
iv.qtditvenda>0
;

/* Create view: ATATENDIMENTOVW07 (ViwData.CreateDependDef) */
CREATE VIEW ATATENDIMENTOVW07(
CODEMPCL,
CODFILIALCL,
CODCLI,
RAZCLI,
CODEMPCT,
CODFILIALCT,
CODCONTR,
DESCCONTR,
DESCSITCONTR,
SITCONTR,
TPCONTR,
TPCOBCONTR,
QTDCONTR,
TOTHORAS)
 AS 
select ct.codempcl, ct.codfilialcl, ct.codcli, cl.razcli,
 ct.codemp codempct, ct.codfilial codfilialct, ct.codcontr, ct.desccontr,
 ct.descsitcontr, ct.sitcontr, ct.tpcontr, ct.tpcobcontr,
 sum(it.qtditcontr) qtdcontr, sum((select sum( (a.horaatendofin-a.horaatendo) / 60/60) 
 from atatendimento a 
 where a.codempct=ct.codemp and a.codfilialct=ct.codfilial and a.codcontr=ct.codcontr and
 a.coditcontr=it.coditcontr
  ))  tothoras
 from vdcliente cl, vditcontrato it, vdcontrato ct
  where it.codemp=ct.codemp and it.codfilial=ct.codfilial and it.codcontr=ct.codcontr and
 cl.codemp=ct.codempcl and cl.codfilial=ct.codfilialcl and cl.codcli=ct.codcli 
  group by ct.codempcl, ct.codfilialcl, ct.codcli, cl.razcli,
 ct.codemp, ct.codfilial, ct.codcontr, ct.desccontr,
 ct.descsitcontr, ct.sitcontr, ct.tpcontr, ct.tpcobcontr
;

/* Create view: ATATENDIMENTOVW08 (ViwData.CreateDependDef) */
CREATE VIEW ATATENDIMENTOVW08(
DATAATENDO,
DTFINCONTR,
CODEMPAE,
CODFILIALAE,
CODATEND,
NOMEATEND,
CODEMPCT,
CODFILIALCT,
CODCONTR,
CODITCONTR,
DESCCONTR,
DESCITCONTR,
TPCOBCONTR,
SITCONTR,
TOTALCOMIS,
CODEMPOC,
CODFILIALOC,
TIPOORC,
CODORC)
 AS 
select a.dataatendo, fn.dtfincontr, a.codempae, a.codfilialae, a.codatend, a.nomeatend,
a.codempct, a.codfilialct, a.codcontr, a.coditcontr, ct.desccontr, ic.descitcontr,
ct.tpcobcontr, ct.sitcontr,
sum(a.totalcomis) totalcomis, a.codempoc, a.codfilialoc, a.tipoorc, a.codorc
from atatendimentovw02 a, vditcontrato ic,  vdcontrato ct
left outer join vdfincontr fn
on fn.codemp=ct.codemp and fn.codfilial=ct.codfilial and
fn.codcontr=ct.codcontr
where ct.codemp=a.codempct and ct.codfilial=a.codfilialct and ct.codcontr=a.codcontr and
ic.codemp=a.codempct and ic.codfilial=a.codfilialct and ic.codcontr=a.codcontr and
ic.coditcontr=a.coditcontr and ct.recebcontr='S' and
( (ct.tpcobcontr='ES' and fn.dtfincontr is not null) or (ct.tpcobcontr='ME') )
group by a.dataatendo, fn.dtfincontr, a.codempae, a.codfilialae, a.codatend, a.nomeatend,
a.codempct, a.codfilialct, a.codcontr, a.coditcontr, ct.desccontr, ic.descitcontr,
ct.tpcobcontr, ct.sitcontr, a.codempoc, a.codfilialoc, a.tipoorc, a.codorc
;

/* Create view: EQCONFESTOQVW01 (ViwData.CreateDependDef) */
CREATE VIEW EQCONFESTOQVW01(
CODEMP,
CODFILIAL,
ATIVOPROD,
DESCPROD,
CODPROD,
REFPROD,
SLDLIQPROD,
QTDINVP,
QTDITCOMPRA,
QTDFINALPRODOP,
QTDEXPITRMA,
QTDITVENDA,
SLDMOVPROD,
SLDLIQPRODAX)
 AS 
SELECT P.CODEMP, P.CODFILIAL, P.ATIVOPROD, P.DESCPROD,P.CODPROD,P.REFPROD,P.SLDLIQPROD,
    COALESCE((SELECT SUM(QTDINVP)  FROM EQINVPROD IT WHERE IT.CODEMPPD=P.CODEMP AND
       IT.CODFILIALPD=P.CODFILIAL AND IT.CODPROD=P.CODPROD ),0) QTDINVP,
   COALESCE((SELECT SUM(QTDITCOMPRA)  FROM CPITCOMPRA IC, CPCOMPRA C, EQTIPOMOV TM
       WHERE IC.CODEMPPD=P.CODEMP AND IC.CODFILIALPD=P.CODFILIAL AND
       IC.CODPROD=P.CODPROD AND  C.CODCOMPRA=IC.CODCOMPRA AND
       C.CODEMP=IC.CODEMP AND C.CODFILIAL=IC.CODFILIAL AND  TM.CODTIPOMOV=C.CODTIPOMOV AND
       TM.CODEMP=C.CODEMPTM AND TM.CODFILIAL=C.CODFILIALTM AND TM.ESTOQTIPOMOV='S' ),0) QTDITCOMPRA,
   COALESCE((SELECT SUM(QTDFINALPRODOP) FROM PPOP O, EQTIPOMOV TM
      WHERE O.CODEMPPD=P.CODEMP AND O.CODFILIALPD=P.CODFILIAL AND O.CODPROD=P.CODPROD AND
      TM.CODTIPOMOV=O.CODTIPOMOV AND TM.CODEMP=O.CODEMPTM AND
      TM.CODFILIAL=O.CODFILIALTM  AND TM.ESTOQTIPOMOV='S' ),0) QTDFINALPRODOP,
   COALESCE((SELECT SUM(QTDEXPITRMA) FROM EQRMA R, EQITRMA IR, EQTIPOMOV TM  WHERE IR.CODEMPPD=P.CODEMP AND
      IR.CODFILIALPD=P.CODFILIAL AND IR.CODPROD=P.CODPROD AND  R.CODRMA=IR.CODRMA AND
      R.CODEMP=IR.CODEMP AND R.CODFILIAL=IR.CODFILIAL AND
      TM.CODTIPOMOV=R.CODTIPOMOV AND TM.CODEMP=R.CODEMPTM AND
      TM.CODFILIAL=R.CODFILIALTM  AND TM.ESTOQTIPOMOV='S' ),0) QTDEXPITRMA,
   COALESCE((SELECT SUM(QTDITVENDA) FROM VDITVENDA IV, VDVENDA V, EQTIPOMOV TM
      WHERE IV.CODEMPPD=P.CODEMP AND IV.CODFILIALPD=P.CODFILIAL AND IV.CODPROD=P.CODPROD AND
      V.CODVENDA=IV.CODVENDA AND V.TIPOVENDA=IV.TIPOVENDA AND
      V.CODEMP=IV.CODEMP AND V.CODFILIAL=IV.CODFILIAL AND
      (SUBSTR(V.STATUSVENDA,1,1) NOT IN ('C','N')) AND TM.CODTIPOMOV=V.CODTIPOMOV AND
      TM.CODEMP=V.CODEMPTM AND TM.CODFILIAL=V.CODFILIALTM  AND TM.ESTOQTIPOMOV='S' ),0) QTDITVENDA,
   COALESCE((SELECT FIRST 1 M.SLDMOVPROD FROM EQMOVPROD M WHERE M.CODEMPPD=P.CODEMP AND
      M.CODFILIALPD=P.CODFILIAL AND  M.CODPROD=P.CODPROD
      ORDER BY M.DTMOVPROD DESC, M.CODMOVPROD DESC ),0) SLDMOVPROD,
   COALESCE((SELECT SUM(SP.SLDLIQPROD) FROM EQSALDOPROD SP WHERE SP.CODEMP=P.CODEMP AND
      SP.CODFILIAL=P.CODFILIAL AND SP.CODPROD=P.CODPROD),0) SLDLIQPRODAX
   FROM EQPRODUTO P
;

/* Create view: FNFLUXOCAIXAVW01 (ViwData.CreateDependDef) */
CREATE VIEW FNFLUXOCAIXAVW01(
ORDEM,
TIPOLANCA,
SUBTIPO,
CODEMP,
CODFILIAL,
CODRECPAGLANC,
NPARCRECPAGLANC,
DTEMISSAO,
DTCOMP,
DTVENCTORECPAG,
DOC,
CODIGO,
RAZAO,
HISTORICO,
VALOR)
 AS 
select cast(1 as smallint) ordem,
'L' tipolanca,
(case when sl.codfor is null and sl.codcli is null then 'A' when sl.codfor is null then 'C' else 'F' end) subtipo,
sl.codemp, sl.codfilial, sl.codlanca codrecpaglanc, sl.codsublanca nparcrecpaglanc,
sl.dtcompsublanca dtemissao,
sl.dtcompsublanca dtcomp,
sl.datasublanca dtvenctorecpag,
l.doclanca doc,
(case when sl.codfor is null then sl.codcli else sl.codfor end) codigo,
(case when sl.codfor is null then cl.razcli else fl.razfor end) razao,
sl.histsublanca historico,
(sl.vlrsublanca*-1) valor
from fnlanca l, fnsublanca sl
left outer join vdcliente cl on
cl.codemp=sl.codempcl and cl.codfilial=sl.codfilialcl and cl.codcli=sl.codcli 
left outer join cpforneced fl on
fl.codemp=sl.codempfr and fl.codfilial=sl.codfilialfr and fl.codfor=sl.codfor
where l.codemp=sl.codemp and l.codfilial=sl.codfilial and l.codlanca=sl.codlanca and
sl.codpag is null and sl.codrec is null and sl.codsublanca<>0 and l.transflanca = 'N'
union all
select cast(2 as smallint) ordem,
'R' tipolanca,
'R' subtipo,
ir.codemp, ir.codfilial, ir.codrec codrecpaglanc, ir.nparcitrec nparcrecpaglanc,
r.datarec dtemissao,
ir.dtcompitrec dtcomp,
ir.dtvencitrec dtvenctorecpag,
ir.doclancaitrec doc,
r.codcli codigo,
c.razcli razao,
ir.obsitrec historico,
ir.vlrapagitrec valor
from fnreceber r, vdcliente c, fnitreceber ir
where ir.codemp=r.codemp and ir.codfilial=r.codfilial and ir.codrec=r.codrec and
c.codemp=r.codempcl and c.codfilial=r.codfilialcl and c.codcli=r.codcli and
ir.vlrapagitrec<>0 and ir.statusitrec not in ('CR')
union all
select cast(2 as smallint) ordem,
'R' tipolanca,
'L' subtipo,
ir.codemp, ir.codfilial, ir.codrec codrecpaglanc, ir.nparcitrec nparcrecpaglanc,
r.datarec dtemissao,
slr.dtcompsublanca dtcomp,
slr.datasublanca dtvenctorecpag,
lr.doclanca doc,
r.codcli codigo,
c.razcli razao,
slr.histsublanca historico,
slr.vlrsublanca*-1 valor
from fnreceber r, vdcliente c, fnitreceber ir, fnsublanca slr, fnlanca lr
where ir.codemp=r.codemp and ir.codfilial=r.codfilial and ir.codrec=r.codrec and
c.codemp=r.codempcl and c.codfilial=r.codfilialcl and c.codcli=r.codcli and
slr.codemprc=ir.codemp and slr.codfilialrc=ir.codfilial and slr.codrec=ir.codrec and slr.nparcitrec=ir.nparcitrec and
slr.codsublanca<>0 and
lr.codemp=slr.codemp and lr.codfilial=slr.codfilial and lr.codlanca=slr.codlanca and lr.transflanca = 'N'
union all
select cast(3 as smallint) ordem,
'P' tipolanca,
'P' subtipo,
ip.codemp, ip.codfilial, ip.codpag codrecpaglanc, ip.nparcpag nparcrecpaglanc,
p.datapag dtemissao,
ip.dtcompitpag dtcomp,
ip.dtvencitpag dtvenctorecpag,
ip.doclancaitpag doc,
f.codfor codigo,
f.razfor razao,
ip.obsitpag historico,
ip.vlrapagitpag*-1 valor
from fnpagar p, cpforneced f, fnitpagar ip
where ip.codemp=p.codemp and ip.codfilial=p.codfilial and ip.codpag=p.codpag and
f.codemp=p.codempfr and f.codfilial=p.codfilialfr and f.codfor=p.codfor and
ip.vlrapagitpag<>0 and ip.statusitpag not in ('CP')
union all
select cast(3 as smallint) ordem,
'P' tipolanca,
'L' subtipo,
ip.codemp, ip.codfilial, ip.codpag codrecpaglanc, ip.nparcpag nparcrecpaglanc,
p.datapag dtemissao,
slp.dtcompsublanca dtcomp,
slp.datasublanca dtvenctorecpag,
ip.doclancaitpag doc,
f.codfor codigo,
f.razfor razao,
slp.histsublanca historico,
slp.vlrsublanca*-1 valor
from fnpagar p, cpforneced f, fnitpagar ip, fnsublanca slp, fnlanca lp
where ip.codemp=p.codemp and ip.codfilial=p.codfilial and ip.codpag=p.codpag and
f.codemp=p.codempfr and f.codfilial=p.codfilialfr and f.codfor=p.codfor and
slp.codemppg=ip.codemp and slp.codfilialpg=ip.codfilial and slp.codpag=ip.codpag and slp.nparcpag=ip.nparcpag and slp.codsublanca<>0 and
lp.codemp=slp.codemp and lp.codfilial=slp.codfilial and lp.codlanca=slp.codlanca  and lp.transflanca = 'N'
;

/* Create view: PPLISTAOPVW01 (ViwData.CreateDependDef) */
CREATE VIEW PPLISTAOPVW01(
CODEMP,
CODFILIAL,
DTEMITOP,
DTFABROP,
CODOP,
SEQOP,
DESCEST,
SITOP,
TEMPOTOT,
TEMPOFIN,
FASEATUAL,
TOTFASES,
QTDSUG,
QTDPREV,
QTDFINAL,
CODPROD,
REFPROD,
CODSECAO)
 AS 
select op.codemp,op.codfilial,op.dtemitop, op.dtfabrop,op.codop, op.seqop, et.descest,op.sitop,
(select coalesce(sum( ef.tempoef ),0)
    from ppestrufase ef
    where
    ef.codemp=et.codemp and ef.codfilial=et.codfilial and ef.codprod=et.codprod and ef.seqest=et.seqest) as tempotot,
(select coalesce(sum( opf.tempoof ),0)
    from ppopfase opf
    where
    opf.codemp=op.codemp and opf.codfilial=op.codfilial and opf.codop=op.codop and opf.seqop=op.seqop
    and opf.sitfs='FN') as tempofin,
(select coalesce(min(opf.seqof),0) from ppopfase opf
    where
    opf.codemp=op.codemp and opf.codfilial=op.codfilial and opf.codop=op.codop and opf.seqop=op.seqop
    and opf.sitfs='PE') as faseatual,
(select count(*) from ppopfase opf
    where
    opf.codemp=op.codemp and opf.codfilial=op.codfilial and opf.codop=op.codop and opf.seqop=op.seqop) as totfases,
    op.qtdsugprodop,
    op.qtdprevprodop,
    op.qtdfinalprodop,
    pd.codprod, pd.refprod, pd.codsecao
from ppop op, ppestrutura et, eqproduto pd
where
et.codemp=op.codemppd and et.codfilial=op.codfilialpd and et.codprod=op.codprod and et.seqest=op.seqest
and pd.codemp=op.codemppd and pd.codfilial=op.codfilialpd and pd.codprod=op.codprod
;

/* Create view: VDCONTRATOVW01 (ViwData.CreateDependDef) */
CREATE VIEW VDCONTRATOVW01(
IDX,
INDICE,
IDX01,
IDX02,
IDX03,
IDX04,
IDX05,
TIPO,
CODEMPCT,
CODFILIALCT,
CODCONTR,
DESCCONTR,
CODEMPSC,
CODFILIALSC,
CODCONTRSC,
DESCCONTRSC,
CODITCONTR,
DESCITCONTR,
CODEMPTA,
CODFILIALTA,
CODTAREFA,
DESCTAREFA,
CODEMPST,
CODFILIALST,
CODTAREFAST,
DESCTAREFAST)
 AS 
select 1 idx,
cast(ct.indexcontr as varchar(100)) indice,
ct.indexcontr idx01,
cast(0 as integer) idx02,
cast(0 as integer) idx03,
cast(0 as integer) idx04,
cast(0 as integer) idx05,
cast((case when ct.tpcontr='C' then 'CT' else 'PJ' end) as char(2))  tipo, ct.codemp codempct,
ct.codfilial codfilialct, ct.codcontr, ct.desccontr,
cast(null as  integer) codempsc, cast(null as smallint) codfilialsc,
cast(null as integer) codcontrsc, cast(null as char(80)) desccontrsc,
cast(null as smallint) coditcontr, cast(null as varchar(80)) descitcontr,
cast(null as integer) codempta,
cast(null as smallint) codfilialta,
cast(null as integer) codtarefa,
cast(null as varchar(100)) desctarefa,
cast(null as integer) codempst,
cast(null as smallint) codfilialst,
cast(null as integer) codtarefast,
cast(null as varchar(100)) desctarefast
from vdcontrato ct
where ct.tpcontr in ('C','P')
union all
select 1 idx,
cast(ct.indexcontr||'.'||sc.indexcontr as varchar(100)) indice,
ct.indexcontr idx01,
sc.indexcontr idx02,
cast(0 as integer) idx03,
cast(0 as integer) idx04,
cast(0 as integer) idx05,
cast((sc.tpcontr||ct.tpcontr) as char(2)) tipo, sc.codempsp codempct, sc.codfilialsp codfilialct, sc.codcontrsp codcontr, ct.desccontr,
sc.codemp codempsc, sc.codfilial codfilialsc, sc.codcontr codcontrsc, sc.desccontr desccontrsc,
cast(null as smallint) coditcontr, cast(null as varchar(80)) descitcontr,
cast(null as integer) codempta,
cast(null as smallint) codfilialta,
cast(null as integer) codtarefa,
cast(null as varchar(100)) desctarefa,
cast(null as integer) codempst,
cast(null as smallint) codfilialst,
cast(null as integer) codtarefast,
cast(null as varchar(100)) desctarefast
from vdcontrato sc, vdcontrato ct
where sc.tpcontr='S' and sc.codcontrsp is not null and
ct.codemp=sc.codempsp and ct.codfilial=sc.codfilialsp and ct.codcontr=sc.codcontrsp
union all
select 2 idx,
cast(ct.indexcontr||'.'||ic.indexitcontr as varchar(100)) indice,
ct.indexcontr idx01,
ic.indexitcontr idx02,
cast(0 as integer) idx03,
cast(0 as integer) idx04,
cast(0 as integer) idx05,
cast((case when ct.tpcontr='C' then 'IC' else 'IP' end) as char(2)) tipo, ct.codemp codempct,
ct.codfilial codfilialct, ct.codcontr, ct.desccontr,
cast(null as  integer) codempsc, cast(null as smallint) codfilialsc,
cast(null as integer) codcontrsc, cast(null as char(80) ) desccontrsc,
ic.coditcontr, ic.descitcontr,
cast(null as integer) codempta,
cast(null as smallint) codfilialta,
cast(null as integer) codtarefa,
cast(null as varchar(100)) desctarefa,
cast(null as integer) codempst,
cast(null as smallint) codfilialst,
cast(null as integer) codtarefast,
cast(null as varchar(100)) desctarefast
from vdcontrato ct, vditcontrato ic
where ct.tpcontr in ('C','P') and
ic.codemp=ct.codemp and ic.codfilial=ct.codfilial and ic.codcontr=ct.codcontr
union all
select 2 idx,
cast(ct.indexcontr||'.'||sc.indexcontr||'.'||ic.indexitcontr as varchar(100)) indice,
ct.indexcontr idx01,
sc.indexcontr idx02,
ic.indexitcontr idx03,
cast(0 as integer) idx04,
cast(0 as integer) idx05,
cast('IS' as char(2)) tipo, sc.codempsp codempct,
sc.codfilialsp codfilialct, sc.codcontrsp codcontr, ct.desccontr,
sc.codemp codempsc, sc.codfilial codfilialsc, sc.codcontr codcontrsc, sc.desccontr desccontrsc,
ic.coditcontr, ic.descitcontr,
cast(null as integer) codempta,
cast(null as smallint) codfilialta,
cast(null as integer) codtarefa,
cast(null as varchar(100)) desctarefa,
cast(null as integer) codempst,
cast(null as smallint) codfilialst,
cast(null as integer) codtarefast,
cast(null as varchar(100)) desctarefast
from vdcontrato sc, vdcontrato ct, vditcontrato ic
where sc.tpcontr='S' and sc.codcontrsp is not null and
ic.codemp=sc.codemp and ic.codfilial=sc.codfilial and ic.codcontr=sc.codcontr and
ct.codemp=sc.codempsp and ct.codfilial=sc.codfilialsp and ct.codcontr=sc.codcontrsp
union all
select 3 idx,
cast(ct.indexcontr||'.'||ic.indexitcontr||'.'||ta.indextarefa as varchar(100)) indice,
ct.indexcontr idx01,
ic.indexitcontr idx02,
ta.indextarefa idx03,
cast(0 as integer) idx04,
cast(0 as integer) idx05,
cast( 'TA' as char(2))  tipo, ct.codemp codempct,
ct.codfilial codfilialct, ct.codcontr, ct.desccontr desccontr,
cast(null as  integer) codempsc, cast(null as smallint) codfilialsc,
cast(null as integer) codcontrsc, cast(null as char(80)) desccontrsc,
ic.coditcontr, ic.descitcontr,
ta.codemp codempta,
ta.codfilial codfilialta,
ta.codtarefa,
ta.desctarefa,
cast(null as integer) codempst,
cast(null as smallint) codfilialst,
cast(null as integer) codtarefast,
cast(null as varchar(100)) desctarefast
from vdcontrato ct, vditcontrato ic, crtarefa ta
where ct.tpcontr in ('C','P') and
ic.codemp=ct.codemp and ic.codfilial=ct.codfilial and ic.codcontr=ct.codcontr and
ta.codempct=ic.codemp and ta.codfilialct=ic.codfilial and ta.codcontr=ic.codcontr and
ta.coditcontr=ic.coditcontr and ta.tipotarefa='T'
union all
select 3 idx,
cast(ct.indexcontr||'.'||sc.indexcontr||'.'||ic.indexitcontr||'.'||ta.indextarefa as varchar(100)) indice,
ct.indexcontr idx01,
sc.indexcontr idx02,
ic.indexitcontr idx03,
ta.indextarefa idx04,
cast(0 as integer) idx05,
cast('TA' as char(2)) tipo, sc.codempsp codempct, sc.codfilialsp codfilialct, sc.codcontrsp codcontr, ct.desccontr,
sc.codemp codempsc, sc.codfilial codfilialsc, sc.codcontr codcontrsc, sc.desccontr desccontrsc,
ic.coditcontr, ic.descitcontr,
ta.codemp codempta,
ta.codfilial codfilialta,
ta.codtarefa,
ta.desctarefa,
cast(null as integer) codempst,
cast(null as smallint) codfilialst,
cast(null as integer) codtarefast,
cast(null as varchar(100)) desctarefast
from vdcontrato sc, vdcontrato ct, vditcontrato ic, crtarefa ta
where sc.tpcontr='S' and sc.codcontrsp is not null and
ic.codemp=sc.codemp and ic.codfilial=sc.codfilial and ic.codcontr=sc.codcontr and
ct.codemp=sc.codempsp and ct.codfilial=sc.codfilialsp and ct.codcontr=sc.codcontrsp  and
ta.codempct=ic.codemp and ta.codfilialct=ic.codfilial and ta.codcontr=ic.codcontr and
ta.coditcontr=ic.coditcontr and ta.tipotarefa='T'
union all
select 4 idx,
cast(ct.indexcontr||'.'||ic.indexitcontr||'.'||ta.indextarefa||'.'||st.indextarefa as varchar(100)) indice,
ct.indexcontr idx01,
ic.indexitcontr idx02,
ta.indextarefa idx03,
st.indextarefa idx04,
cast( 0 as integer) indx05,
cast( 'ST' as char(2))  tipo, ct.codemp codempct,
ct.codfilial codfilialct, ct.codcontr, ct.desccontr desccontr,
cast(null as  integer) codempsc, cast(null as smallint) codfilialsc,
cast(null as integer) codcontrsc, cast(null as char(80)) desccontrsc,
ic.coditcontr, ic.descitcontr,
ta.codemp codempta,
ta.codfilial codfilialta,
ta.codtarefa,
ta.desctarefa,
st.codemp codempst,
st.codfilial codfilialst,
st.codtarefa codtarefast,
st.desctarefa desctarefast
from vdcontrato ct, vditcontrato ic, crtarefa ta, crtarefa st
where ct.tpcontr in ('C','P') and
ic.codemp=ct.codemp and ic.codfilial=ct.codfilial and ic.codcontr=ct.codcontr and
ta.codempct=ic.codemp and ta.codfilialct=ic.codfilial and ta.codcontr=ic.codcontr and
ta.coditcontr=ic.coditcontr and
st.codempta=ta.codemp and st.codfilialta=ta.codfilial and st.codtarefata=ta.codtarefa and
st.tipotarefa='S'
union all
select 4 idx,
cast(ct.indexcontr||'.'||sc.indexcontr||'.'||ic.indexitcontr||'.'||ta.indextarefa||'.'||st.indextarefa as varchar(100)) indice,
ct.indexcontr idx01,
sc.indexcontr idx02,
ic.indexitcontr idx03,
ta.indextarefa idx04,
st.indextarefa idx05,
cast('ST' as char(2)) tipo, sc.codempsp codempct, sc.codfilialsp codfilialct, sc.codcontrsp codcontr, ct.desccontr,
sc.codemp codempsc, sc.codfilial codfilialsc, sc.codcontr codcontrsc, sc.desccontr desccontrsc,
ic.coditcontr, ic.descitcontr,
ta.codemp codempta,
ta.codfilial codfilialta,
ta.codtarefa,
ta.desctarefa,
st.codemp codempst,
st.codfilial codfilialst,
st.codtarefa codtarefast,
st.desctarefa desctarefast
from vdcontrato sc, vdcontrato ct, vditcontrato ic, crtarefa ta, crtarefa st
where sc.tpcontr='S' and sc.codcontrsp is not null and
ic.codemp=sc.codemp and ic.codfilial=sc.codfilial and ic.codcontr=sc.codcontr and
ct.codemp=sc.codempsp and ct.codfilial=sc.codfilialsp and ct.codcontr=sc.codcontrsp  and
ta.codempct=ic.codemp and ta.codfilialct=ic.codfilial and ta.codcontr=ic.codcontr and
ta.coditcontr=ic.coditcontr and
st.codempta=ta.codemp and st.codfilialta=ta.codfilial and st.codtarefata=ta.codtarefa and
st.tipotarefa='S'
;

/* Create view: VWCUSTOPROJ01 (ViwData.CreateDependDef) */
CREATE VIEW VWCUSTOPROJ01(
CODEMP,
CODFILIAL,
CODCLI,
DATA,
DESCCUSTO,
CODCONTR,
CODITCONTR,
TPCONTR,
VLRPREVREC,
QTDCUSTO,
VLRCUSTO,
TIPOCUSTO)
 AS 
select ad.codemp, ad.codfilial, ad.codcli, ad.dataatendo ,cast('Hora trabalhada - ' || rtrim(ae.nomeatend)  as varchar(200)) as desccusto, ad.codcontr
,ad.coditcontr, co.tpcontr ,ic.vlritcontr * ic.qtditcontr as vlrreceitaprev,
 ( ad.horaatendofin  - ad.horaatendo ) / 3600 as qtd , sa.custohoratrab as custo, 'M' as tipo
from
vditcontrato ic, atatendimento ad, atatendente ae, rhempregado em, rhempregadosal sa, vdcontrato co
where
ic.codemp=ad.codempct and ic.codfilial=ad.codfilialct and ic.codcontr=ad.codcontr and ic.coditcontr=ad.coditcontr and
co.codemp=ic.codemp and co.codfilial=ic.codfilial and co.codcontr=ic.codcontr and
ae.codemp=ad.codempae and ae.codfilial=ad.codfilialae and ae.codatend=ad.codatend and
em.codemp=ae.codempep and em.codfilial=ae.codfilialep and em.matempr=ae.matempr and
sa.codemp=em.codemp and sa.codfilial=em.codfilial and sa.matempr=em.matempr and sa.seqsal=
(
    select first 1 seqsal from rhempregadosal s1 where s1.codemp=em.codemp and
    s1.codfilial=em.codfilial and s1.matempr=em.matempr and
    s1.dtvigor < cast('today' as date) order by s1.dtvigor desc
)
-- Custos de outras despesas financeiras;
union all
select sl.codemp, sl.codfilial, co.codcli, sl.datasublanca, cast(sl.histsublanca as varchar(200)) as desccusto, ic.codcontr, ic.coditcontr, co.tpcontr ,ic.vlritcontr * ic.qtditcontr as vlrreceitaprev,
1.00 as qtd, sl.vlrsublanca  as custo, 'F' as tipo
from
vditcontrato ic, vdcontrato co, fnsublanca sl, fnplanejamento pl
where
ic.codemp=sl.codempct and ic.codfilial=sl.codfilialct and ic.codcontr=sl.codcontr and ic.coditcontr=sl.coditcontr and
co.codemp=ic.codemp and co.codfilial=ic.codfilial and co.codcontr=ic.codcontr
and pl.codemp=sl.codemppn and pl.codfilial=sl.codfilialpn and pl.codplan=sl.codplan and pl.anoplan=sl.anoplan and pl.tipoplan='D'
union all
--Custos de estoque
select ir.codemp, ir.codfilial, co.codcli, rma.dtaexprma, cast(pd.descprod as varchar(200)) as desccusto ,ic.codcontr, ic.coditcontr, co.tpcontr, ic.vlritcontr * ic.qtditcontr as vlrreceitaprev,
ir.qtdexpitrma as qtd, ir.precoitrma as custo, 'E' as tipo
from
vditcontrato ic, vdcontrato co, eqrma rma, eqitrma ir, eqproduto pd
where ic.codemp=rma.codempct and ic.codfilial=rma.codfilialct and ic.codcontr=rma.codcontr and ic.coditcontr=rma.coditcontr and
co.codemp=ic.codemp and co.codfilial=ic.codfilial and co.codcontr=ic.codcontr
and ir.codemp=rma.codemp and ir.codfilial=rma.codfilial and ir.codrma=rma.codrma and
pd.codemp=ir.codemppd and pd.codfilial=ir.codfilialpd and pd.codprod=ir.codprod and
ir.sitexpitrma='ET'
;

/* Create view: VWPROD_PRECO_CUSTO (ViwData.CreateDependDef) */
CREATE VIEW VWPROD_PRECO_CUSTO(
REFPROD,
CODSECAO,
DESCPROD,
PRECOBASEPROD,
CUSTO)
 AS 
select pd.refprod, pd.codsecao, pd.descprod, pd.precobaseprod,
(case
when (select custounit from eqcustoprodsp(pd.codemp, pd.codfilial, pd.codprod,cast('today' as date),'M',pd.codempax, pd.codfilialax,pd.codalmox, null)) > 0
then (select custounit from eqcustoprodsp(pd.codemp, pd.codfilial, pd.codprod,cast('today' as date),'M',pd.codempax, pd.codfilialax,pd.codalmox, null))

else pd.custoinfoprod end) custo
from eqproduto pd
;

/* Create view: VWTMPCUSTOITRMA (ViwData.CreateDependDef) */
CREATE VIEW VWTMPCUSTOITRMA(
CODEMP,
CODFILIAL,
CODRMA,
CODITRMA,
CODPROD,
CUSTODATA)
 AS 
select ITR.CODEMP,ITR.CODFILIAL,ITR.CODRMA,ITR.CODITRMA,ITR.CODPROD,COALESCE((SELECT FIRST 1 MP.CUSTOMPMMOVPROD
    FROM EQMOVPROD MP
    WHERE MP.CODEMPPD=ITR.codemppd AND MP.CODFILIALPD=ITR.codfilialpd
    AND MP.CODPROD=ITR.codprod AND MP.dtmovprod <= rm.dtareqrma
    ORDER BY MP.DTMOVPROD DESC, MP.CODMOVPROD DESC),0) AS CUSTO
from eqitrma itr, eqrma rm where rm.codrma = itr.codrma
;

/* Create Views... */
/* Create view: ATATENDIMENTOVW03 (ViwData.CreateDependDef) */
CREATE VIEW ATATENDIMENTOVW03(
CODEMP,
CODFILIAL,
CODATENDO,
CODEMPAE,
CODFILIALAE,
CODATEND,
NOMEATEND,
PARTPREMIATEND,
CODEMPEP,
CODFILIALEP,
MATEMPR,
NOMEEMPR,
DATAATENDO,
HORAATENDO,
HORAATENDOFIN,
CODEMPTO,
CODFILIALTO,
CODTURNO,
DESCTURNO,
CODEMPEA,
CODFILIALEA,
CODESPEC,
DESCESPEC,
PERCCOMIESPEC,
CODEMPCT,
CODFILIALCT,
CODCONTR,
CODITCONTR,
CODEMPTA,
CODFILIALTA,
CODTAREFA,
TPCOBCONTR,
ANOATENDO,
MESATENDO,
HORASEXPED,
TOTALCOMIS,
TOTALMIN,
TOTALGERAL,
TOTALBH,
SITREVATENDO,
TIPOATENDO,
DOCATENDO,
CODEMPOC,
CODFILIALOC,
TIPOORC,
CODORC)
 AS 
select a.codemp, a.codfilial, a.codatendo, 
    a.codempae, a.codfilialae, a.codatend, a.nomeatend, a.partpremiatend,
     a.codempep, a.codfilialep, a.matempr, e.nomeempr,
     a.dataatendo, a.horaatendo, a.horaatendofin,
    e.codempto, e.codfilialto, e.codturno, t.descturno,
    a.codempea, a.codfilialea, a.codespec, a.descespec, a.perccomiespec,
    a.codempct, a.codfilialct, a.codcontr, a.coditcontr,
    a.codempta, a.codfilialta, a.codtarefa, 
    a.tpcobcontr,
    a.anoatendo, a.mesatendo, 
    x.horasexped, a.totalcomis, a.totalmin, a.totalgeral,
    ( a.totalbh * ( 1 +  
       ((case when extract(weekday from a.dataatendo)=6 then t.percbhtbsabturno 
          when extract(weekday from a.dataatendo)=0 then t.percbhtbdomturno
          when coalesce(f.trabfer,'N')='S' then t.percbhtbferturno
          else 0 end
       )/100 ) )
    ) totalbh,
    a.sitrevatendo, a.tipoatendo, a.docatendo, a.codempoc, a.codfilialoc, a.tipoorc, a.codorc
    from atatendimentovw02 a
    left outer join rhempregado e on
    e.codemp=a.codempep and e.codfilial=a.codfilialep and e.matempr=a.matempr
    left outer join rhturno t on
    t.codemp=e.codempto and t.codfilial=e.codfilialto and t.codturno=e.codturno
    left outer join rhexpedmes x on
    x.codemp=e.codempto and x.codfilial=e.codfilialto and x.codturno=e.codturno and 
    x.anoexped=extract(year from a.dataatendo) and x.mesexped=extract(month from a.dataatendo)
    left outer join sgferiado f on
    f.codemp=a.codemp and f.codfilial=a.codfilial and f.datafer=a.dataatendo
;

/* Create view: ATATENDIMENTOVW04 (ViwData.CreateDependDef) */
CREATE VIEW ATATENDIMENTOVW04(
DATAATENDO,
CODEMPCT,
CODFILIALCT,
CODCONTR,
CODITCONTR,
ANOATENDO,
MESATENDO,
TOTALHORASTRAB,
CODEMPOC,
CODFILIALOC,
TIPOORC,
CODORC)
 AS 
select a.dataatendo, a.codempct, a.codfilialct, a.codcontr, a.coditcontr, a.anoatendo, a.mesatendo, sum(totalmin)/60 totalhorastrab, a.codempoc, a.codfilialoc, a.tipoorc, a.codorc
from atatendimentovw01 a
group by a.dataatendo, a.codempct, a.codfilialct, a.codcontr, a.coditcontr, a.anoatendo, a.mesatendo, a.codempoc, a.codfilialoc, a.tipoorc, a.codorc
;

/* Create view: ATATENDIMENTOVW06 (ViwData.CreateDependDef) */
CREATE VIEW ATATENDIMENTOVW06(
CODEMP,
CODFILIAL,
CODATENDO,
CODEMPAE,
CODFILIALAE,
CODATEND,
NOMEATEND,
CODEMPEP,
CODFILIALEP,
MATEMPR,
NOMEEMPR,
DATAATENDO,
HORAATENDO,
HORAATENDOFIN,
CODEMPTO,
CODFILIALTO,
CODTURNO,
DESCTURNO,
CODEMPEA,
CODFILIALEA,
CODESPEC,
DESCESPEC,
PERCCOMIESPEC,
CODEMPCT,
CODFILIALCT,
CODCONTR,
CODITCONTR,
TPCOBCONTR,
ANOATENDO,
MESATENDO,
HORASEXPED,
TOTALCOMIS,
TOTALGERAL,
TOTALBH,
TOTALHORASTRAB,
VLRLIQITVENDA,
SITREVATENDO,
CODEMPOC,
CODFILIALOC,
TIPOORC,
CODORC)
 AS 
select a.codemp, a.codfilial, a.codatendo, a.codempae, a.codfilialae, a.codatend, 
a.nomeatend, a.codempep, a.codfilialep, a.matempr, a.nomeempr, a.dataatendo, 
a.horaatendo, a.horaatendofin, a.codempto, a.codfilialto, a.codturno, a.descturno,
a.codempea, a.codfilialea, a.codespec, a.descespec, perccomiespec,
a.codempct, a.codfilialct, a.codcontr, a.coditcontr, a.tpcobcontr,
a.anoatendo, a.mesatendo, 
a.horasexped, a.totalcomis, a.totalgeral, a.totalbh,
 ( case when a.tpcobcontr='ES' then ( select s1.totalhorastrab from atatendimentovw04 s1
        where s1.codempct=a.codempct and s1.codfilialct=a.codfilialct and 
        s1.codcontr=a.codcontr and s1.coditcontr=a.coditcontr ) 
   else ( select s1.totalhorastrab from atatendimentovw04 s1
        where s1.codempct=a.codempct and s1.codfilialct=a.codfilialct and 
        s1.codcontr=a.codcontr and s1.coditcontr=a.coditcontr and 
        s1.anoatendo=a.anoatendo and s1.mesatendo=a.mesatendo ) end) totalhorastrab, 
  ( case when a.tpcobcontr='ES' then ( select s2.vlrliqitvenda from atatendimentovw05 s2
        where s2.codempct=a.codempct and s2.codfilialct=a.codfilialct and 
         s2.codcontr=a.codcontr and s2.coditcontr=a.coditcontr)
        else ( select s2.vlrliqitvenda from atatendimentovw05 s2
        where s2.codempct=a.codempct and s2.codfilialct=a.codfilialct and 
         s2.codcontr=a.codcontr and s2.coditcontr=a.coditcontr and
         a.dataatendo between s2.dtiniapura and s2.dtfinapura) end ) vlrliqitvenda,
   a.sitrevatendo, a.codempoc, a.codfilialoc, a.tipoorc, a.codorc
from atatendimentovw03 a
;

/* Create view: FNRAZCLIVW01 (ViwData.CreateDependDef) */
CREATE VIEW FNRAZCLIVW01(
CODEMPCL,
CODFILIALCL,
CODCLI,
RAZCLI,
CODEMPRC,
CODFILIALRC,
CODEMPSL,
CODFILIALSL,
CODEMPCP,
CODFILIALCP,
DATA,
TIPO,
TIPOSUBLANCA,
DOC,
VLRDEB,
VLRCRED)
 AS 
-- Parcelas
select c.codemp codempcl, c.codfilial codfilialcl
, c.codcli, c.razcli
, r.codemp codemprc, r.codfilial codfilialrc
, null codempsl, null codfilialsl
, null codempcp, null codfilialcp
, r.datarec data
, 'Q' tipo, 'V' tiposublanca
, r.docrec doc, sum(ir.vlrparcitrec) vlrdeb, 0.00 vlrcred
from fnreceber r, vdcliente c, fnitreceber ir
where c.codemp=r.codempcl and c.codfilial=r.codfilialcl and c.codcli=r.codcli
and ir.codemp=r.codemp and ir.codfilial=r.codfilial and ir.codrec=r.codrec
group by 1, 2, 3, 4, 5, 6, 11, 14
union all
-- Pagamentos
select c.codemp codempcl, c.codfilial codfilialcl
, c.codcli, c.razcli
, null codemprc, null codfilialrc
, sl.codemp codempsl, sl.codfilial codfilialsl
, null codempcp, null codfilialcp
, sl.datasublanca data
, (case when sl.tiposublanca='P' then 'R' else 'X' end) tipo
, sl.tiposublanca, r.docrec doc
, (case when sl.tiposublanca in ('J','D','M') then sl.vlrsublanca*-1 else 0.00 end) vlrdeb,
sl.vlrsublanca vlrcred
from fnsublanca sl, fnreceber r, vdcliente c
where sl.codemprc=r.codemp and sl.codfilialrc=r.codfilial
and sl.codrec=r.codrec and c.codemp=r.codempcl and c.codfilial=r.codfilialcl
and c.codcli=r.codcli and sl.codsublanca<>0
union all
-- Cancelamento
select c.codemp codempcl, c.codfilial codfilialcl
, c.codcli, c.razcli
, r.codemp codemprc, r.codfilial codfilialrc
, null codempsl, null codfilialsl
, null codempcp, null codfilialcp
, ir.dtvencitrec data
, 'X' tipo, 'X' tiposublanca
, r.docrec doc, 0.00 vlrdeb, coalesce(sum(ir.vlrcancitrec),0)*-1 vlrcred
from fnreceber r, fnitreceber ir, vdcliente c
where r.codempcl=c.codemp and r.codfilialcl=c.codfilial and r.codcli=c.codcli
and ir.codemp=r.codemp and ir.codfilial=r.codfilial and ir.codrec=r.codrec
and ir.statusitrec in ('CR')
group by 1, 2, 3, 4, 5, 6, 11, 14
-- Devolues
union all
select c.codemp codempcl, c.codfilial codfilialcl
, c.codcli, c.razcli
, null codemprc, null codfilialrc
, null codempsl, null codfilialsl
, cp.codemp codempcp, cp.codfilial codfilialcp
, cp.dtentcompra data
, 'Z' tipo, 'Z' tiposublanca, cp.doccompra doc, 0.00 vlrdeb
, (cp.vlrliqcompra * -1) vlrcred
from cpcompra cp, eqtipomov tm, eqclifor cf, vdcliente c
where tm.codemp=cp.codemptm and tm.codfilial=cp.codfilialtm
and tm.codtipomov=cp.codtipomov and tm.estipomov='E' and tm.tipomov='DV'
and cf.codemp=c.codemp and cf.codfilial=c.codfilial and cf.codcli=c.codcli
and cp.codempfr=cf.codempfr and cp.codfilialfr=cf.codfilialfr and cp.codfor=cf.codfor
order by 3, 4, 11, 12, 14, 13
;

/* Create view: FNRAZFORVW01 (ViwData.CreateDependDef) */
CREATE VIEW FNRAZFORVW01(
CODEMPFR,
CODFILIALFR,
CODFOR,
RAZFOR,
CODEMPPG,
CODFILIALPG,
CODEMPSL,
CODFILIALSL,
CODEMPVD,
CODFILIALVD,
DATA,
TIPO,
TIPOSUBLANCA,
DOC,
VLRDEB,
VLRCRED)
 AS 
-- Parcelas
select f.codemp codempfr, f.codfilial codfilialfr
, f.codfor codemit, f.razfor razemit
, p.codemp codemppg, p.codfilial codfilialpg
, null codempsl, null codfilialsl
, null codempvd, null codfilialvd
, p.datapag data
, 'C' tipo, 'C' tiposublanca
, p.docpag doc, 0.00 vlrdeb, sum(ip.vlrparcitpag) vlrcred
from fnpagar p, cpforneced f, fnitpagar ip
where f.codemp=p.codempfr and f.codfilial=p.codfilialfr and f.codfor=p.codfor
and ip.codemp=p.codemp and ip.codfilial=p.codfilial and ip.codpag=p.codpag
group by 1, 2, 3, 4, 5, 6, 11, 14
union all
-- Pagamentos
select f.codemp codempfr, f.codfilial codfilialfr
, f.codfor codemit, f.razfor razemit
, null codemppg, null codfilialpg
, sl.codemp codempsl, sl.codfilial codfilialsl
, null codempvd, null codfilialvd
, sl.datasublanca data
,  (case when sl.tiposublanca='P' then 'P' else 'X' end) tipo
, sl.tiposublanca, p.docpag doc
, sl.vlrsublanca vlrdeb, (case when sl.tiposublanca in ('J','D','M')
then sl.vlrsublanca else 0.00 end) vlrcred
from fnsublanca sl , cpforneced f, fnpagar p
where f.codemp=sl.codempfr and f.codfilial=sl.codfilialfr
and p.codemp=sl.codemppg and p.codfilial=sl.codfilialpg and p.codpag=sl.codpag
and f.codfor=sl.codfor and sl.codsublanca<>0 
union all
-- Cancelamento
select f.codemp codempfr, f.codfilial codfilialfr
, f.codfor, f.razfor
, p.codemp codemppg, p.codfilial codfilialpg
, null codempsl, null codfilialsl
, null codempvd, null codfilialvd
, ip.dtvencitpag data
, 'X' tipo, 'X' tiposublanca
, p.docpag doc, coalesce(sum(ip.vlrcancitpag),0) vlrdeb
, 0.00 vlrcred
from fnpagar p, fnitpagar ip, cpforneced f
where f.codemp=p.codempfr and f.codfilial=p.codfilialfr and p.codfor=f.codfor
and ip.codemp=p.codemp and ip.codfilial=p.codfilial and ip.codpag=p.codpag
and ip.statusitpag in ('CP')
group by 1, 2, 3, 4, 5, 6, 11, 14
union all
--  Devolues
select f.codemp codempfr, f.codfilial codfilialfr, f.codfor codemit, f.razfor razemit
, null codemppg, null codfilialpg
, null codempsl, null codfilialsl
, vd.codemp codempvd, vd.codfilialvd
, vd.dtemitvenda data
, 'Z' tipo, 'Z' tiposublanca, vd.docvenda doc, vd.vlrliqvenda vlrdeb, 0.00 vlrcred
from vdvenda vd, eqtipomov tm, eqclifor cf, cpforneced f
where tm.codemp=vd.codemptm and tm.codfilial=vd.codfilialtm and tm.codtipomov=vd.codtipomov
and tm.estipomov='S' and tm.tipomov='DV' and cf.codempfr=f.codemp and cf.codfilialfr=f.codfilial
and cf.codfor=f.codfor and vd.codempcl=cf.codemp and vd.codfilialcl=cf.codfilial
and vd.codcli=cf.codcli
;

/* Create view: SGUNIFCODVW01 (ViwData.CreateDependDef) */
CREATE VIEW SGUNIFCODVW01(
CODEMP,
CODFILIAL,
CODUNIFCOD,
TIPOUNIFCOD,
DESCUNIFCOD,
CODTMP,
DTINS,
HINS,
IDUSUINS,
DALT,
HALT,
IDUSUALT,
CNPJ,
RAZAO)
 AS 
select uc.codemp, uc.codfilial, uc.codunifcod, uc.tipounifcod
, uc.descunifcod, uc.codtmp, uc.dtins, uc.hins, uc.idusuins, uc.dtalt, uc.halt, uc.idusualt
, case when uc.tipounifcod='C' then cl.cnpjcli 
when uc.tipounifcod='F' then fr.cnpjfor
when uc.tipounifcod='T' then tr.cnpjtran
when uc.tipounifcod='E' then fl.cnpjfilial
else null end cnpj
, case when uc.tipounifcod='C' then cl.razcli 
when uc.tipounifcod='F' then fr.razfor
when uc.tipounifcod='T' then tr.raztran
when uc.tipounifcod='E' then fl.razfilial
else null end razao
from sgunifcod uc
left outer join vdcliente cl
on uc.tipounifcod='C' and cl.codempuc=uc.codemp and cl.codfilialuc=uc.codfilial and cl.codunifcod=uc.codunifcod
left outer join cpforneced fr
on uc.tipounifcod='F' and fr.codempuc=uc.codemp and fr.codfilialuc=uc.codfilial and fr.codunifcod=uc.codunifcod
left outer join vdtransp tr
on uc.tipounifcod='T' and tr.codempuc=uc.codemp and tr.codfilialuc=uc.codfilial and tr.codunifcod=uc.codunifcod
left outer join sgfilial  fl
on uc.tipounifcod='E' and fl.codempuc=uc.codemp and fl.codfilialuc=uc.codfilial and fl.codunifcod=uc.codunifcod
;

/* Create view: TKCONTCLIVW01 (ViwData.CreateDependDef) */
CREATE VIEW TKCONTCLIVW01(
TIPOCTO,
CODEMP,
CODFILIAL,
CODCTO,
RAZCTO,
NOMECTO,
CONTCTO,
EMAILCTO,
OBSCTO,
CODEMPTO,
CODFILIALTO,
CODTIPOCONT,
CODEMPSR,
CODFILIALSR,
CODSETOR,
CODEMPOC,
CODFILIALOC,
CODORIGCONT,
CODEMPTI,
CODFILIALTI,
CODTIPOCLI,
CODEMPCC,
CODFILIALCC,
CODCLASCLI,
ATIVO,
DTINS,
DTALT,
DTINSCC,
DTALTCC)
 AS 
select cast('O' as char(1)) tipocto,  co.codemp, co.codfilial, co.codcto,
co.razcto, co.nomecto, co.contcto, co.emailcto, co.obscto,
co.codempto, co.codfilialto, co.codtipocont,
co.codempsr, co.codfilialsr, co.codsetor,
co.codempoc, co.codfilialoc, co.codorigcont,
co.codempti, co.codfilialti, co.codtipocli,
cast(null as integer) codempcc, cast(null as smallint) codfilialcc, cast(null as integer) codclascli,
co.ativocto,
co.dtins, co.dtalt,
max(cc.dtins) dtinscc,
max(cc.dtalt) dtaltcc
from tkcontato co
left outer join tkcampanhacto cc on
cc.codempco=co.codemp and cc.codfilialco=co.codfilial and
cc.codcto=co.codcto
group by 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14
, 15, 16, 17, 18, 19, 20
, 21, 22, 23, 24, 25, 26, 27
;

/* Create view: TKCONTCLIVW02 (ViwData.CreateDependDef) */
CREATE VIEW TKCONTCLIVW02(
TIPOCTO,
CODEMP,
CODFILIAL,
CODCTO,
RAZCTO,
NOMECTO,
CONTCTO,
EMAILCTO,
OBSCTO,
CODEMPTO,
CODFILIALTO,
CODTIPOCONT,
CODEMPSR,
CODFILIALSR,
CODSETOR,
CODEMPOC,
CODFILIALOC,
CODORIGCONT,
CODEMPTI,
CODFILIALTI,
CODTIPOCLI,
CODEMPCC,
CODFILIALCC,
CODCLASCLI,
ATIVO,
DTINS,
DTALT,
DTINSCC,
DTALTCC)
 AS 
select cast('C' as char(1)) tipocto, cl.codemp,  cl.codfilial, cl.codcli,
cl.razcli razcto, cl.nomecli nomecto, cl.contcli contcto, cl.emailcli emailcto, cl.obscli obscto,
cast(0 as integer) codempto, cast(0 as smallint) codfilialto, cast(0 as integer) codtipocont,
cl.codempsr, cl.codfilialsr, cl.codsetor,
cast(null as integer) codempoc, cast(null as smallint) codfilialoc, cast(null as integer) codorigcont,
cl.codempti, cl.codfilialti, cl.codtipocli,
cl.codempcc, cl.codfilialcc, cl.codclascli,
cl.ativocli,
cl.dtins, cl.dtalt,
max(cc.dtins) dtinscc,
max(cc.dtalt) dtaltcc
from vdcliente cl
left outer join tkcampanhacto cc on
cc.codempcl=cl.codemp and cc.codfilialcl=cl.codfilial and
cc.codcli=cl.codcli
group by 1,2, 3, 4, 5, 6, 7, 8, 9
, 10, 11, 12
, 13, 14 , 15, 16, 17, 18, 19, 20
, 21, 22, 23, 24, 25, 26, 27
;

/* Create view: TKCONTCLIVW03 (ViwData.CreateDependDef) */
CREATE VIEW TKCONTCLIVW03(
TIPOCTO,
CODEMP,
CODFILIAL,
CODCTO,
RAZCTO,
NOMECTO,
CONTCTO,
EMAILCTO,
OBSCTO,
CODEMPTO,
CODFILIALTO,
CODTIPOCONT,
CODEMPSR,
CODFILIALSR,
CODSETOR,
CODEMPOC,
CODFILIALOC,
CODORIGCONT,
CODEMPTI,
CODFILIALTI,
CODTIPOCLI,
CODEMPCC,
CODFILIALCC,
CODCLASCLI,
ATIVO,
DTINS,
DTALT,
DTINSCC,
DTALTCC)
 AS 
select tipocto, codemp, codfilial, codcto
   , razcto, nomecto, contcto, emailcto, obscto
   , codempto, codfilialto, codtipocont
   , codempsr , codfilialsr, codsetor
   , codempoc, codfilialoc, codorigcont
   , codempti, codfilialti, codtipocli
   , codempcc, codfilialcc, codclascli
   , ativo
   , dtins,  dtalt, dtinscc, dtaltcc
   from tkcontclivw01
  union all
   select tipocto, codemp, codfilial, codcto
   , razcto, nomecto, contcto, emailcto, obscto
   , codempto, codfilialto, codtipocont
   , codempsr , codfilialsr, codsetor
   , codempoc, codfilialoc, codorigcont
   , codempti, codfilialti, codtipocli
   , codempcc, codfilialcc, codclascli
   , ativo
   , dtins,  dtalt, dtinscc, dtaltcc
      from tkcontclivw02
;


/* Create index... */
CREATE INDEX CPPRODFORIDX01 ON CPPRODFOR(REFPRODFOR, CODFILIAL, CODEMP);

CREATE INDEX RPCONTATOIDXNOMECONT ON RPCONTATO(NOMECONT);

CREATE INDEX RPETIQPRODIDX01 ON RPETIQPROD(NRCONEXAO, CODPROD);

CREATE INDEX RPFORNECEDORIDXRAZFOR ON RPFORNECEDOR(RAZFOR);

CREATE INDEX RPGRUPOIDXDESCGRUP ON RPGRUPO(DESCGRUP);

CREATE INDEX RPPEDIDOIDXDATAPED ON RPPEDIDO(DATAPED);

CREATE UNIQUE INDEX RPPRODUTOIDCREFPROD ON RPPRODUTO(REFPROD);

CREATE INDEX RPPRODUTOIDXDESCPROD ON RPPRODUTO(DESCPROD);

CREATE INDEX RPTRANSPIDXRAZTRAN ON RPTRANSP(RAZTRAN);

CREATE INDEX RPUNIDADEIDXDESCUNID ON RPUNIDADE(DESCUNID);

CREATE INDEX RPVENDEDORIDXNOMEVEND ON RPVENDEDOR(NOMEVEND);

CREATE INDEX TKCONTATOIDX01 ON TKCONTATO(CNPJCTO, CODEMP, CODFILIAL);

CREATE INDEX VDORCAMENTOIDXSTORC ON VDORCAMENTO(STATUSORC);


/* Alter index (Drop, Create)... */
RECONNECT;

/* Drop: EQMOVPRODIDX02 (TIdxData) */
DROP INDEX EQMOVPRODIDX02;

CREATE DESC INDEX EQMOVPRODIDX02 ON EQMOVPROD(CODPROD, DTMOVPROD, CODMOVPROD, CODALMOX);

RECONNECT;

/* Drop: FNSUBLANCAIDXDTSUBLANCA (TIdxData) */
DROP INDEX FNSUBLANCAIDXDTSUBLANCA;

CREATE INDEX FNSUBLANCAIDXDTSUBLANCA ON FNSUBLANCA(CODPLAN, ANOPLAN, DATASUBLANCA, CODLANCA, CODFILIAL, CODEMP);


/* Create Primary Key... */
ALTER TABLE RPCOMISSAO ADD PRIMARY KEY (CODEMP, CODFILIAL, CODPED, CODITPED);

ALTER TABLE RPFATURAMENTO ADD PRIMARY KEY (CODEMP, CODFILIAL, CODPED, CODITPED);

ALTER TABLE EQGRUPOIMG ADD CONSTRAINT EQGRUPOIMGPK PRIMARY KEY (CODGRUP, SEQIMG, CODFILIAL, CODEMP);

ALTER TABLE EQITRMLOGALERTA ADD CONSTRAINT EQITRMLOGALERTAPK PRIMARY KEY (ID);

ALTER TABLE EQSEQLOTE ADD CONSTRAINT EQSEQLOTEPK PRIMARY KEY (CODPROD, CODFILIALPD, CODEMPPD, CODFILIAL, CODEMP);

ALTER TABLE EQTIPOCTRLPROD ADD CONSTRAINT EQTIPOCTRLPRODPK PRIMARY KEY (CODTPCTRL, CODFILIAL, CODEMP);

ALTER TABLE FNPLANEJAMENTO ADD CONSTRAINT FNPLANEJAMENTOPK PRIMARY KEY (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNSALDOLANCA ADD CONSTRAINT FNSALDOLANCAPK PRIMARY KEY (DATASL, CODFILIALPN, CODEMPPN, CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNTIPOCOBVD ADD CONSTRAINT FNTIPOCOBVDPK PRIMARY KEY (ID);

ALTER TABLE LFCESTNCM ADD CONSTRAINT LFCESTNCMPK PRIMARY KEY (CODCEST, CODNCM);

ALTER TABLE LFCEST ADD CONSTRAINT LFCESTPK PRIMARY KEY (CODCEST);

ALTER TABLE LFENQIPI ADD CONSTRAINT LFENQIPIPK PRIMARY KEY (CODENQ, CODFILIAL, CODEMP);

ALTER TABLE LFSEQSERIE ADD CONSTRAINT LFSEQSERIEPK PRIMARY KEY (SERIE, CODFILIAL, CODEMP, SEQSERIE, CODFILIALSS, CODEMPSS);

ALTER TABLE LFSERIE ADD CONSTRAINT LFSERIEPK PRIMARY KEY (SERIE, CODFILIAL, CODEMP);

ALTER TABLE RPITPEDIDO ADD CONSTRAINT PRITPEDIDOPK PRIMARY KEY (CODITPED, CODPED, CODFILIAL, CODEMP);

ALTER TABLE RPCLIENTE ADD CONSTRAINT RPCLIENTEPK PRIMARY KEY (CODCLI, CODFILIAL, CODEMP);

ALTER TABLE RPCONTATO ADD CONSTRAINT RPCONTATOPK PRIMARY KEY (CODEMP, CODFILIAL, CODCONT);

ALTER TABLE RPCOTMOEDA ADD CONSTRAINT RPCOTMOEDAPK PRIMARY KEY (DATACOT, CODMOEDA, CODFILIAL, CODEMP);

ALTER TABLE RPFORNECEDOR ADD CONSTRAINT RPFORNECEDORPK PRIMARY KEY (CODFOR, CODFILIAL, CODEMP);

ALTER TABLE RPGRUPO ADD CONSTRAINT RPGRUPOPK PRIMARY KEY (CODGRUP, CODFILIAL, CODEMP);

ALTER TABLE RPITNOTA ADD CONSTRAINT RPITNOTAPK PRIMARY KEY (DOCNOTA, CODITPED, CODPED, CODFILIAL, CODEMP);

ALTER TABLE RPMOEDA ADD CONSTRAINT RPMOEDAPK PRIMARY KEY (CODMOEDA, CODFILIAL, CODEMP);

ALTER TABLE RPPARCPLANOPAG ADD CONSTRAINT RPPARCPLANOPAGPK PRIMARY KEY (NROPARCPAG, CODPLANOPAG, CODFILIAL, CODEMP);

ALTER TABLE RPPEDIDO ADD CONSTRAINT RPPEDIDOPK PRIMARY KEY (CODPED, CODFILIAL, CODEMP);

ALTER TABLE RPPLANOPAG ADD CONSTRAINT RPPLANOPAGPK PRIMARY KEY (CODPLANOPAG, CODFILIAL, CODEMP);

ALTER TABLE RPPRODUTO ADD CONSTRAINT RPPRODUTOPK PRIMARY KEY (CODPROD, CODFILIAL, CODEMP);

ALTER TABLE RPTIPOCLI ADD CONSTRAINT RPTIPOCLIPK PRIMARY KEY (CODTIPOCLI, CODFILIAL, CODEMP);

ALTER TABLE RPTRANSP ADD CONSTRAINT RPTRANSPPK PRIMARY KEY (CODTRAN, CODFILIAL, CODEMP);

ALTER TABLE RPUNIDADE ADD CONSTRAINT RPUNIDADEPK PRIMARY KEY (CODUNID, CODFILIAL, CODEMP);

ALTER TABLE RPVENDEDOR ADD CONSTRAINT RPVENDEDORPK PRIMARY KEY (CODVEND, CODFILIAL, CODEMP);

ALTER TABLE SGIEST ADD CONSTRAINT SGIESTPK PRIMARY KEY (SIGLAUF, CODPAIS, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE9 ADD CONSTRAINT SGPREFERE9PK PRIMARY KEY (CODFILIAL, CODEMP);

ALTER TABLE VDCONTREMPREGADO ADD CONSTRAINT VDCONTREMPREGADOPK PRIMARY KEY (CODCONTR, SEQ, CODFILIAL, CODEMP);

ALTER TABLE VDFUNCAOPROJ ADD CONSTRAINT VDFUNCAOPROJPK PRIMARY KEY (CODFUNCAOPROJ, CODFILIAL, CODEMP);

ALTER TABLE VDTIPOCONTR ADD CONSTRAINT VDTIPOCONTRPK PRIMARY KEY (CODTIPOCONTR, CODFILIAL, CODEMP);

/* Create Unique... */
ALTER TABLE FNCONTA ADD CONSTRAINT FNCONTAUNIQFNPLANEJA UNIQUE (CODEMPPN, CODFILIALPN, CODPLAN, ANOPLAN);

/* Create Foreign Key... */
RECONNECT;

ALTER TABLE ATCONVENIADO ADD CONSTRAINT ATCONVENIADOFKSGMU FOREIGN KEY (CODMUNIC, SIGLAUF, CODPAIS) REFERENCES SGMUNICIPIO (CODMUNIC, SIGLAUF, CODPAIS);

ALTER TABLE CPCOMPRA ADD CONSTRAINT CPCOMPRAFKFNPLANEJAMENTO FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE CPCOMPRAVENDA ADD CONSTRAINT CPCOMPRAVENDAFKCPI FOREIGN KEY (CODCOMPRA, CODITCOMPRA, CODFILIAL, CODEMP) REFERENCES CPITCOMPRA (CODCOMPRA, CODITCOMPRA, CODFILIAL, CODEMP) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE CPITSOLICITACAO ADD CONSTRAINT CPITSOLICITAFKVDCT FOREIGN KEY (CODCONTR, CODFILIAL, CODEMP) REFERENCES VDCONTRATO (CODCONTR, CODFILIAL, CODEMP);

ALTER TABLE CPRATEIO ADD CONSTRAINT CPRATEIOFKFNPLANEJ FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALFN, CODEMPFN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE CPSOLICITACAO ADD CONSTRAINT CPSOLICITACAOFKVDC FOREIGN KEY (CODCONTR, CODFILIAL, CODEMP) REFERENCES VDCONTRATO (CODCONTR, CODFILIAL, CODEMP);

ALTER TABLE EQGRUPOIMG ADD CONSTRAINT EQGRUPOIMGFKEQGRUP FOREIGN KEY (CODGRUP, CODFILIAL, CODEMP) REFERENCES EQGRUPO (CODGRUP, CODFILIAL, CODEMP);

ALTER TABLE EQMOVSERIE ADD CONSTRAINT EQMOVSERIEFKEQRECMERC FOREIGN KEY (TICKET, CODITRECMERC, CODFILIALRC, CODEMPRC) REFERENCES EQITRECMERC (TICKET, CODITRECMERC, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE EQMOVSERIE ADD CONSTRAINT EQMOVSERIEFKRECMERC FOREIGN KEY (TICKET, CODFILIALRC, CODEMPRC) REFERENCES EQRECMERC (TICKET, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE EQPRODPLAN ADD CONSTRAINT EQPRODPLANFKFNPLAN FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE EQPRODUTO ADD CONSTRAINT EQPRODUTOFKEQTPCTR FOREIGN KEY (CODTPCTRL, CODFILIALTL, CODEMPTL) REFERENCES EQTIPOCTRLPROD (CODTPCTRL, CODFILIAL, CODEMP);

ALTER TABLE EQRMA ADD CONSTRAINT EQRMAFKCLI FOREIGN KEY (CODCLI, CODFILIALCL, CODEMPCL) REFERENCES VDCLIENTE (CODCLI, CODFILIAL, CODEMP);

ALTER TABLE EQSALDOPROD ADD CONSTRAINT EQSALDOPRODFKEQALM FOREIGN KEY (CODALMOX, CODFILIALAX, CODEMPAX) REFERENCES EQALMOX (CODALMOX, CODFILIAL, CODEMP);

ALTER TABLE EQSALDOPROD ADD CONSTRAINT EQSALDOPRODFKEQPRO FOREIGN KEY (CODPROD, CODFILIAL, CODEMP) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);

ALTER TABLE EQSEQLOTE ADD CONSTRAINT EQSEQLOTEFKEQPRODU FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);

ALTER TABLE EQTIPOMOV ADD CONSTRAINT EQTIPOMOVFKLFSERCO FOREIGN KEY (SERIEC, CODFILIALSC, CODEMPSC) REFERENCES LFSERIE (SERIE, CODFILIAL, CODEMP);

ALTER TABLE EQTIPOMOV ADD CONSTRAINT EQTIPOMOVFKLFSERIE FOREIGN KEY (SERIE, CODFILIALSE, CODEMPSE) REFERENCES LFSERIE (SERIE, CODFILIAL, CODEMP);

ALTER TABLE FNBANCO ADD CONSTRAINT FNBANCOFKFNBANCO FOREIGN KEY (CODBANCOBP, CODFILIALBP, CODEMPBP) REFERENCES FNBANCO (CODBANCO, CODFILIAL, CODEMP);

ALTER TABLE FNCONTA ADD CONSTRAINT FNCONTAFKFNPLANEJA FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNCONTA ADD CONSTRAINT FNCONTAFKFNPLANPO FOREIGN KEY (CODPLANPO, ANOPLANPO, CODFILIALPO, CODEMPPO) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNFBNCLI ADD CONSTRAINT FNFBNCLIFKFNPLANEJ FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNITPAGAR ADD CONSTRAINT FNITPAGARFKFNPLANE FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNITPAGAR ADD CONSTRAINT FNITPAGARFKRHEMPRE FOREIGN KEY (MATEMPR, CODFILIALEM, CODEMPEM) REFERENCES RHEMPREGADO (MATEMPR, CODFILIAL, CODEMP);

ALTER TABLE FNITRECEBER ADD CONSTRAINT FNITRECEBERFKFNPLA FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNITRECEBER ADD CONSTRAINT FNITRECEBERFKRHEMP FOREIGN KEY (MATEMPR, CODFILIALEM, CODEMPEM) REFERENCES RHEMPREGADO (MATEMPR, CODFILIAL, CODEMP);

ALTER TABLE FNLANCA ADD CONSTRAINT FNLANCAFKFNPLANEJA FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNPAGAR ADD CONSTRAINT FNPAGARFKFNPLANEJ FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNPAGTOCOMI ADD CONSTRAINT FNPAGTOCOMIFKFNPLA FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNPLANEJAMENTO ADD CONSTRAINT FNPLANEJAMFKFNPLAN FOREIGN KEY (CODSUBPLAN, ANOPLANSP, CODFILIALSP, CODEMPSP) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNPLANOPAG ADD CONSTRAINT FNPLANOPAGFKFNPLAN FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNRECEBER ADD CONSTRAINT FNRECEBERFKFNPLANEJ FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNSALDOLANCA ADD CONSTRAINT FNSALDOLANCAFKFNPL FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNSUBLANCA ADD CONSTRAINT FNSUBLANCAFKFNPLAN FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNSUBLANCA ADD CONSTRAINT FNSUBLANCAFKRHEMPR FOREIGN KEY (MATEMPR, CODFILIALEM, CODEMPEM) REFERENCES RHEMPREGADO (MATEMPR, CODFILIAL, CODEMP);

ALTER TABLE FNSUBLANCA ADD CONSTRAINT FNSUBLANCAFKTIPOCOB FOREIGN KEY (CODTIPOCOB, CODFILIALTC, CODEMPTC) REFERENCES FNTIPOCOB (CODTIPOCOB, CODFILIAL, CODEMP);

ALTER TABLE FNTIPOCOBVD ADD CONSTRAINT FNTIPOCOBVDFKFNCC FOREIGN KEY (CODCC, ANOCC, CODFILIALCC, CODEMPCC) REFERENCES FNCC (CODCC, ANOCC, CODFILIAL, CODEMP);

ALTER TABLE FNTIPOCOBVD ADD CONSTRAINT FNTIPOCOBVDFKFNCT FOREIGN KEY (NUMCONTA, CODFILIALCT, CODEMPCT) REFERENCES FNCONTA (NUMCONTA, CODFILIAL, CODEMP);

ALTER TABLE FNTIPOCOBVD ADD CONSTRAINT FNTIPOCOBVDFKFNPN FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNTIPOCOBVD ADD CONSTRAINT FNTIPOCOBVDFKFNTP FOREIGN KEY (CODTIPOCOB, CODFILIALTC, CODEMPTC) REFERENCES FNTIPOCOB (CODTIPOCOB, CODFILIAL, CODEMP);

ALTER TABLE LFCESTNCM ADD CONSTRAINT LFCESTNCMFKLFCEST FOREIGN KEY (CODCEST) REFERENCES LFCEST (CODCEST);

ALTER TABLE LFENQIPI ADD CONSTRAINT LFENQIPIFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);

ALTER TABLE LFITCLFISCAL ADD CONSTRAINT LFITCLFISCALFKENQIPI FOREIGN KEY (CODENQ, CODFILIALEQ, CODEMPEQ) REFERENCES LFENQIPI (CODENQ, CODFILIAL, CODEMP);

ALTER TABLE LFITCLFISCAL ADD CONSTRAINT LFITCLSFISCALFKLFCEST FOREIGN KEY (CODCEST) REFERENCES LFCEST (CODCEST);

ALTER TABLE RPCLIENTE ADD CONSTRAINT RPCLIENTEFKRPCLIENTE FOREIGN KEY (CODCLICP, CODFILIALCP, CODEMPCP) REFERENCES RPCLIENTE (CODCLI, CODFILIAL, CODEMP);

ALTER TABLE RPCLIENTE ADD CONSTRAINT RPCLIENTEFKRPPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIALPG, CODEMPPG) REFERENCES RPPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);

ALTER TABLE RPCLIENTE ADD CONSTRAINT RPCLIENTEFKRPTIPOCLI FOREIGN KEY (CODTIPOCLI, CODFILIALTC, CODEMPTC) REFERENCES RPTIPOCLI (CODTIPOCLI, CODFILIAL, CODEMP);

ALTER TABLE RPCLIENTE ADD CONSTRAINT RPCLIENTEFKRPVENDEDOR FOREIGN KEY (CODVEND, CODFILIALVO, CODEMPVO) REFERENCES RPVENDEDOR (CODVEND, CODFILIAL, CODEMP);

ALTER TABLE RPCOMISSAO ADD CONSTRAINT RPCOMISSFKFAT FOREIGN KEY (CODEMP, CODFILIAL, CODPED, CODITPED) REFERENCES RPFATURAMENTO (CODEMP, CODFILIAL, CODPED, CODITPED);

ALTER TABLE RPCOMISSAO ADD CONSTRAINT RPCOMISSFKVEND FOREIGN KEY (CODVEND, CODFILIALVD, CODEMPVD) REFERENCES RPVENDEDOR (CODVEND, CODFILIAL, CODEMP);

ALTER TABLE RPCOTMOEDA ADD CONSTRAINT RPCOTMOEDAFKMOEDA FOREIGN KEY (CODMOEDA, CODFILIAL, CODEMP) REFERENCES RPMOEDA (CODMOEDA, CODFILIAL, CODEMP);

ALTER TABLE RPFATURAMENTO ADD CONSTRAINT RPFATFKITPEDIDO FOREIGN KEY (CODITPED, CODPED, CODFILIAL, CODEMP) REFERENCES RPITPEDIDO (CODITPED, CODPED, CODFILIAL, CODEMP);

ALTER TABLE RPGRUPO ADD CONSTRAINT RPGRUPOFKGRUPO FOREIGN KEY (CODSUBGRUP, CODFILIALSG, CODEMPSG) REFERENCES RPGRUPO (CODGRUP, CODFILIAL, CODEMP);

ALTER TABLE RPITPEDIDO ADD CONSTRAINT RPITPEDIDOFKRPPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES RPPRODUTO (CODPROD, CODFILIAL, CODEMP);

ALTER TABLE RPPARCPLANOPAG ADD CONSTRAINT RPPARCPLANOPAGFKPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIAL, CODEMP) REFERENCES RPPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);

ALTER TABLE RPPEDIDO ADD CONSTRAINT RPPEDIDOFKRPCLIENTE FOREIGN KEY (CODCLI, CODFILIALCL, CODEMPCL) REFERENCES RPCLIENTE (CODCLI, CODFILIAL, CODEMP);

ALTER TABLE RPPEDIDO ADD CONSTRAINT RPPEDIDOFKRPFORNECEDOR FOREIGN KEY (CODFOR, CODFILIALFO, CODEMPFO) REFERENCES RPFORNECEDOR (CODFOR, CODFILIAL, CODEMP);

ALTER TABLE RPPEDIDO ADD CONSTRAINT RPPEDIDOFKRPMOEDA FOREIGN KEY (CODMOEDA, CODFILIALMO, CODEMPMO) REFERENCES RPMOEDA (CODMOEDA, CODFILIAL, CODEMP);

ALTER TABLE RPPEDIDO ADD CONSTRAINT RPPEDIDOFKRPPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIALPG, CODEMPPG) REFERENCES RPPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);

ALTER TABLE RPPEDIDO ADD CONSTRAINT RPPEDIDOFKRPTRANSP FOREIGN KEY (CODTRAN, CODFILIALTP, CODEMPTP) REFERENCES RPTRANSP (CODTRAN, CODFILIAL, CODEMP);

ALTER TABLE RPPEDIDO ADD CONSTRAINT RPPEDIDOFKRPVENDEDOR FOREIGN KEY (CODVEND, CODFILIALVD, CODEMPVD) REFERENCES RPVENDEDOR (CODVEND, CODFILIAL, CODEMP);

ALTER TABLE RPPRODUTO ADD CONSTRAINT RPPRODUTOFKRPFORNECEDOR FOREIGN KEY (CODFOR, CODFILIALFO, CODEMPFO) REFERENCES RPFORNECEDOR (CODFOR, CODFILIAL, CODEMP);

ALTER TABLE RPPRODUTO ADD CONSTRAINT RPPRODUTOFKRPGRUPO FOREIGN KEY (CODGRUP, CODFILIALGP, CODEMPGP) REFERENCES RPGRUPO (CODGRUP, CODFILIAL, CODEMP);

ALTER TABLE RPPRODUTO ADD CONSTRAINT RPPRODUTOFKRPUNIDADE FOREIGN KEY (CODUNID, CODFILIALUD, CODEMPUD) REFERENCES RPUNIDADE (CODUNID, CODFILIAL, CODEMP);

ALTER TABLE SGIEST ADD CONSTRAINT SGIESTFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);

ALTER TABLE SGIEST ADD CONSTRAINT SGIESTFKSGUF FOREIGN KEY (SIGLAUF, CODPAIS) REFERENCES SGUF (SIGLAUF, CODPAIS);

ALTER TABLE SGIMPRESSORA ADD CONSTRAINT SGIMPRESSORAFKMODD FOREIGN KEY (CODMODDOCFISC, CODFILIALMD, CODEMPMD) REFERENCES LFMODDOCFISC (CODMODDOCFISC, CODFILIAL, CODEMP);

ALTER TABLE SGMODETIQUETA ADD CONSTRAINT SGMODETIQUETAFKCIM FOREIGN KEY (CODCATIMG, CODFILIALCI, CODEMPCI) REFERENCES SGCATIMG (CODCATIMG, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE7 ADD CONSTRAINT SGPREF7FKFNPLANCONSIG FOREIGN KEY (CODPLANCONSIG, ANOPLANCONSIG, CODFILIALPC, CODEMPPC) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE7 ADD CONSTRAINT SGPREF7FNPLANVDCONSIG FOREIGN KEY (CODPLANVDCONSIG, ANOPLANVDCONSIG, CODFILIALPV, CODEMPPV) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FK2EQTRS FOREIGN KEY (CODTIPOMOVRS, CODFILIALRS, CODEMPRS) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FK9EQTIP FOREIGN KEY (CODTIPOMOV9, CODFILIALT9, CODEMPT9) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKEQTIPO FOREIGN KEY (CODTIPOMOV, CODFILIALTM, CODEMPTM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKPLANCHEQUE FOREIGN KEY (CODPLANPC, ANOPLAN, CODFILIALPC, CODEMPPC) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKPLANDC FOREIGN KEY (CODPLANDC, ANOPLANDC, CODFILIALDC, CODEMPDC) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKPLANDR FOREIGN KEY (CODPLANDR, ANOPLANDR, CODFILIALDR, CODEMPDR) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKPLANJP FOREIGN KEY (CODPLANJP, ANOPLANJP, CODFILIALJP, CODEMPJP) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKPLANJR FOREIGN KEY (CODPLANJR, ANOPLANJR, CODFILIALJR, CODEMPJR) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKPLANMP FOREIGN KEY (CODPLANMP, ANOPLANMP, CODFILIALMP, CODEMPMR) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKPLANMR FOREIGN KEY (CODPLANMR, ANOPLANMR, CODFILIALMR, CODEMPMR) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKSGIMGP FOREIGN KEY (CODIMGPD, CODFILIALIM, CODEMPIM) REFERENCES SGIMAGEM (CODIMG, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE3 ADD CONSTRAINT SGPREFERE3FKVDCLAS FOREIGN KEY (CODCLASCLI, CODFILIALCC, CODEMPCC) REFERENCES VDCLASCLI (CODCLASCLI, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE3 ADD CONSTRAINT SGPREFERE3FKVDTIPC FOREIGN KEY (CODTIPOCLI, CODFILIALTI, CODEMPTI) REFERENCES VDTIPOCLI (CODTIPOCLI, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE5 ADD CONSTRAINT SGPREFERE5FKSGCI FOREIGN KEY (CODCATIMG, CODFILIALCI, CODEMPCI) REFERENCES SGCATIMG (CODCATIMG, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE5 ADD CONSTRAINT SGPREFERE5FKSGIMG1 FOREIGN KEY (CODIMGFT01, CODFILIALI1, CODEMPI1) REFERENCES SGIMAGEM (CODIMG, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE5 ADD CONSTRAINT SGPREFERE5FKSGIMG2 FOREIGN KEY (CODIMGFT02, CODFILIALI2, CODEMPI2) REFERENCES SGIMAGEM (CODIMG, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE5 ADD CONSTRAINT SGPREFERE5FKSGIMG3 FOREIGN KEY (CODIMGFT03, CODFILIALI3, CODEMPI3) REFERENCES SGIMAGEM (CODIMG, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE5 ADD CONSTRAINT SGPREFERE5FKSGIMG4 FOREIGN KEY (CODIMGFT04, CODFILIALI4, CODEMPI4) REFERENCES SGIMAGEM (CODIMG, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE5 ADD CONSTRAINT SGPREFERE5FKSGIMG5 FOREIGN KEY (CODIMGFT05, CODFILIALI5, CODEMPI5) REFERENCES SGIMAGEM (CODIMG, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE5 ADD CONSTRAINT SGPREFERE5FKSGIMG6 FOREIGN KEY (CODIMGFT06, CODFILIALI6, CODEMPI6) REFERENCES SGIMAGEM (CODIMG, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE9 ADD CONSTRAINT SGPREFERE9FKGRUPOS FOREIGN KEY (CODGRUP, CODFILIALGP, CODEMPGP) REFERENCES RPGRUPO (CODGRUP, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE9 ADD CONSTRAINT SGPREFERE9FKPRMOEDA FOREIGN KEY (CODMOEDA, CODFILIALMO, CODEMPMO) REFERENCES RPMOEDA (CODMOEDA, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE9 ADD CONSTRAINT SGPREFERE9FKRPUNID FOREIGN KEY (CODUNID, CODFILIALUD, CODEMPUD) REFERENCES RPUNIDADE (CODUNID, CODFILIAL, CODEMP);

ALTER TABLE TKEMAIL ADD CONSTRAINT TKEMAILFKSGCATIMG FOREIGN KEY (CODCATIMG, CODFILIALCI, CODEMPCI) REFERENCES SGCATIMG (CODCATIMG, CODFILIAL, CODEMP);

ALTER TABLE VDCONTRATO ADD CONSTRAINT VDCONTRATOFKVDTIPOC FOREIGN KEY (CODTIPOCONTR, CODFILIALTC, CODEMPTC) REFERENCES VDTIPOCONTR (CODTIPOCONTR, CODFILIAL, CODEMP);

ALTER TABLE VDCONTREMPREGADO ADD CONSTRAINT VDCONTREMPRFKRHEMP FOREIGN KEY (MATEMPR, CODFILIALEP, CODEMPEP) REFERENCES RHEMPREGADO (MATEMPR, CODFILIAL, CODEMP);

ALTER TABLE VDCONTREMPREGADO ADD CONSTRAINT VDCONTREMPRFKVDCTR FOREIGN KEY (CODCONTR, CODFILIAL, CODEMP) REFERENCES VDCONTRATO (CODCONTR, CODFILIAL, CODEMP);

ALTER TABLE VDCONTREMPREGADO ADD CONSTRAINT VDCONTREMPRFKVDFCP FOREIGN KEY (CODFUNCAOPROJ, CODFILIALFP, CODEMPFP) REFERENCES VDFUNCAOPROJ (CODFUNCAOPROJ, CODFILIAL, CODEMP);

ALTER TABLE VDFRETEVD ADD CONSTRAINT VDFRETEVDFKVDMOTO FOREIGN KEY (CODMOT, CODFILIALMA, CODEMPMA) REFERENCES VDMOTORISTA (CODMOT, CODFILIAL, CODEMP);

ALTER TABLE VDFRETEVD ADD CONSTRAINT VDFRETEVDFKVDVEICU FOREIGN KEY (CODVEIC, CODFILIALVE, CODEMPVE) REFERENCES VDVEICULO (CODVEIC, CODFILIAL, CODEMP);

ALTER TABLE VDITCONTRATO ADD CONSTRAINT VDITCONTRATOFKVDCONTR FOREIGN KEY (CODCONTR, CODFILIAL, CODEMP) REFERENCES VDCONTRATO (CODCONTR, CODFILIAL, CODEMP);

ALTER TABLE VDITVENDAITVENDA ADD CONSTRAINT VDITVENDAFKITVEND1 FOREIGN KEY (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIAL, CODEMP) REFERENCES VDITVENDA (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE VDMODCONTR ADD CONSTRAINT VDMODCONTRFKSGIMGL FOREIGN KEY (CODIMGLG, CODFILIALIL, CODEMPIL) REFERENCES SGIMAGEM (CODIMG, CODFILIAL, CODEMP);

ALTER TABLE VDVENDA ADD CONSTRAINT VDVENDAFKLFSERIE FOREIGN KEY (SERIE, CODFILIALSE, CODEMPSE) REFERENCES LFSERIE (SERIE, CODFILIAL, CODEMP);

ALTER TABLE VDVENDEDOR ADD CONSTRAINT VDVENDEDORFKFNPLAN FOREIGN KEY (CODPLAN, ANOPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, ANOPLAN, CODFILIAL, CODEMP);

SET TERM ^ ;

ALTER TRIGGER PPOPSUBPRODTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

/*  Empty FNGERAITRECEBERSP01 for FNADICITRECEBERSP01(param list change)  */
ALTER PROCEDURE FNGERAITRECEBERSP01(CALTVLR CHAR,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
ICODEMPPG INTEGER,
SCODFILIALPG SMALLINT,
ICODPLANOPAG INTEGER,
NVLRREC NUMERIC(15,5),
DDATAREC DATE,
DDTCOMPREC DATE,
CFLAG CHAR,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3),
ICODEMPTC INTEGER,
SCODFILIALTC SMALLINT,
ICODTIPOCOB INTEGER,
ICODEMPCB INTEGER,
SCODFILIALCB SMALLINT,
CODCARTCOB CHAR(3),
NVLRCOMIREC NUMERIC(15,5),
OBSREC VARCHAR(250),
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
NUMCONTA CHAR(10),
CODEMPPN INTEGER,
CODFILIALPN SMALLINT,
CODPLAN CHAR(13),
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC INTEGER,
CODCC CHAR(19),
VLRBASECOMIS NUMERIC(15,5))
 RETURNS(I INTEGER)
 AS
 BEGIN SUSPEND; END
^

/*  Empty LFBUSCATRIBCOMPRA for LFBUSCAFISCALSP(param list change)  */
ALTER PROCEDURE LFBUSCATRIBCOMPRA(CODEMP INTEGER,
CODFILIAL INTEGER,
CODCOMPRA INTEGER,
CODEMPPD INTEGER,
CODFILIALPD SMALLINT,
CODPROD INTEGER,
VLRLIQ NUMERIC(15,5))
 RETURNS(VLRBASEFUNRURAL NUMERIC(15,5),
ALIQFUNRURAL NUMERIC(6,2),
VLRFUNRURAL NUMERIC(15,5),
CODEMPIF INTEGER,
CODFILIALIF SMALLINT,
CODFISC CHAR(13),
CODITFISC SMALLINT)
 AS
 BEGIN SUSPEND; END
^

/*  Empty ATBUSCAPRECOSP for VDBUSCAPRECOSP(param list change)  */
ALTER PROCEDURE ATBUSCAPRECOSP(ICODPROD INTEGER,
ICODCONV INTEGER,
ICODEMPCV INTEGER,
ICODFILIALCV SMALLINT,
ICODPLANOPAG INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 RETURNS(PRECO NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

/* Alter empty procedure EQPRODUTOSP01 with new param-list */
ALTER PROCEDURE EQPRODUTOSP01(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
DTPESQ DATE)
 RETURNS(NSALDO NUMERIC(15,5),
NSALDOAX NUMERIC(15,5),
NCUSTOMPM NUMERIC(15,5),
NCUSTOPEPS NUMERIC(15,5),
NCUSTOMPMAX NUMERIC(15,5),
NCUSTOPEPSAX NUMERIC(15,5),
NCUSTOINFO NUMERIC(15,5),
NCUSTOUC NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

/* Alter empty procedure FNADICITRECEBERSP01 with new param-list */
ALTER PROCEDURE FNADICITRECEBERSP01(CALTVLR CHAR,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRDESCITREC NUMERIC(15,5),
NVLRMULTAITREC NUMERIC(15,5),
NVLRJUROSITREC NUMERIC(15,5),
NVLRPARCITREC NUMERIC(15,5),
NVLRPAGOITREC NUMERIC(15,5),
DDTITREC DATE,
DDTCOMPITREC DATE,
DDTVENCITREC DATE,
CSTATUSITREC CHAR(2),
CFLAG CHAR,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3),
ICODEMPTC INTEGER,
SCODFILIALTC SMALLINT,
ICODTIPOCOB INTEGER,
ICODEMPCB INTEGER,
SCODFILIALCB SMALLINT,
CODCARTCOB CHAR(3),
NVLRCOMIITREC NUMERIC(15,5),
OBSITREC VARCHAR(250),
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
NUMCONTA CHAR(10),
CODEMPPN INTEGER,
CODFILIALPN SMALLINT,
CODPLAN CHAR(13),
ANOPLAN SMALLINT,
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC SMALLINT,
CODCC CHAR(19),
VLRBASECOMIS NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

/* Alter empty procedure LFBUSCAFISCALSP with new param-list */
ALTER PROCEDURE LFBUSCAFISCALSP(CODEMP INTEGER,
CODFILIALSEL INTEGER,
CODFILIALPD INTEGER,
CODPROD INTEGER,
CODEMPCF INTEGER,
CODFILIALCF INTEGER,
CODCF INTEGER,
CODEMPTM INTEGER,
CODFILIALTM SMALLINT,
CODTIPOMOV INTEGER,
TIPOBUSCA CHAR(2),
CODNAT CHAR(4),
CODEMPIFP INTEGER,
CODFILIALIFP SMALLINT,
CODFISCP CHAR(13),
CODITFISCP INTEGER)
 RETURNS(ORIGFISC CHAR,
CODTRATTRIB CHAR(2),
REDFISC NUMERIC(9,2),
TIPOFISC CHAR(2),
CODMENS INTEGER,
ALIQFISC NUMERIC(9,2),
ALIQLFISC NUMERIC(9,2),
ALIQIPIFISC NUMERIC(9,2),
TPREDICMSFISC CHAR,
TIPOST CHAR(2),
MARGEMVLAGR NUMERIC(15,5),
CODEMPIF INTEGER,
CODFILIALIF SMALLINT,
CODFISC CHAR(13),
CODITFISC INTEGER,
ALIQFISCINTRA NUMERIC(9,2),
ALIQPIS NUMERIC(9,2),
ALIQCOFINS NUMERIC(9,2),
ALIQCSOCIAL NUMERIC(9,2),
ALIQIR NUMERIC(9,2),
REDBASEST CHAR,
ALIQISS NUMERIC(6,2),
ADICIPIBASEICMS CHAR,
CALCSTCM CHAR,
ALIQICMSSTCM NUMERIC(9,2),
ICMSPART CHAR,
PBCOP NUMERIC(6,2),
PFCP NUMERIC(6,2))
 AS
 BEGIN SUSPEND; END
^

SET TERM ; ^

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da empresa do cliente ou fornecedor'
WHERE RDB$PROCEDURE_NAME = 'LFBUSCAFISCALSP' AND RDB$PARAMETER_NAME = 'CODEMPCF';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da filial do cliente ou fornecedor'
WHERE RDB$PROCEDURE_NAME = 'LFBUSCAFISCALSP' AND RDB$PARAMETER_NAME = 'CODFILIALCF';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo do cliente ou fornecedor'
WHERE RDB$PROCEDURE_NAME = 'LFBUSCAFISCALSP' AND RDB$PARAMETER_NAME = 'CODCF';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Indica se a busca  para VD venda ou CP compra'
WHERE RDB$PROCEDURE_NAME = 'LFBUSCAFISCALSP' AND RDB$PARAMETER_NAME = 'TIPOBUSCA';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da empresa do item de classificao fiscal '
WHERE RDB$PROCEDURE_NAME = 'LFBUSCAFISCALSP' AND RDB$PARAMETER_NAME = 'CODEMPIFP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da filial do tem de classificao fiscal'
WHERE RDB$PROCEDURE_NAME = 'LFBUSCAFISCALSP' AND RDB$PARAMETER_NAME = 'CODFILIALIFP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da classificao fiscal'
WHERE RDB$PROCEDURE_NAME = 'LFBUSCAFISCALSP' AND RDB$PARAMETER_NAME = 'CODFISCP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo do tem de classficiao fiscal'
WHERE RDB$PROCEDURE_NAME = 'LFBUSCAFISCALSP' AND RDB$PARAMETER_NAME = 'CODITFISCP';

/* Alter empty procedure LFBUSCAICMSSP with new param-list */
SET TERM ^ ;

ALTER PROCEDURE LFBUSCAICMSSP(CODNAT CHAR(4),
ESTCLI CHAR(2),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 RETURNS(PERCICMS NUMERIC(6,2),
PERCICMSINTRA NUMERIC(6,2),
ALIQFCPTI NUMERIC(6,2))
 AS
 BEGIN SUSPEND; END
^

/* Alter empty procedure LFNOVODOCSP with new param-list */
ALTER PROCEDURE LFNOVODOCSP(SSERIE VARCHAR(5),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 RETURNS(DOC INTEGER)
 AS
 BEGIN SUSPEND; END
^

/* Alter empty procedure VDBUSCAPRECOSP with new param-list */
ALTER PROCEDURE VDBUSCAPRECOSP(CODPROD INTEGER,
CODCLI INTEGER,
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODPLANOPAG INTEGER,
CODEMPPG INTEGER,
CODFILIALPG SMALLINT,
CODTIPOMOV INTEGER,
CODEMPTM INTEGER,
CODFILIALTM SMALLINT,
CODEMP INTEGER,
CODFILIAL SMALLINT)
 RETURNS(PRECO NUMERIC(14,5),
CODCLASCLIP INTEGER,
CODPLANOPAGP INTEGER,
CODPRECOPRODP INTEGER,
CODTABP INTEGER)
 AS
 BEGIN SUSPEND; END
^

/* Alter Procedure... */
/* Alter (ATADICATENDIMENTOSP) */
ALTER PROCEDURE ATADICATENDIMENTOSP(ICODCONV INTEGER,
ICODTIPOATENDO INTEGER,
ICODATEND INTEGER,
ICODSETOR INTEGER,
VOBSATENDO VARCHAR(10000),
ICODEMP INTEGER,
ICODFILIAL INTEGER,
IDOC INTEGER)
 AS
DECLARE VARIABLE ICODATENDO INTEGER;
DECLARE VARIABLE IFILIALATENDO INTEGER;
DECLARE VARIABLE IFILIALCONV INTEGER;
DECLARE VARIABLE IFILIALTIPOATENDO INTEGER;
DECLARE VARIABLE IFILIALATEND INTEGER;
DECLARE VARIABLE IFILIALSETOR INTEGER;
DECLARE VARIABLE IFILIALPREF INTEGER;
DECLARE VARIABLE IFILIALVEND INTEGER;
DECLARE VARIABLE IFILIALORC INTEGER;
DECLARE VARIABLE ICODTPATENDOLEV INTEGER; /*TIPO DE ATENDIMENTO PARA LEVANTAMENTOS*/
DECLARE VARIABLE ICODORC INTEGER;
DECLARE VARIABLE ICODCLI INTEGER;
DECLARE VARIABLE ICODVEND INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATATENDIMENTO') INTO IFILIALATENDO;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATCONVENIADO') INTO IFILIALCONV;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATTIPOATENDO') INTO IFILIALTIPOATENDO;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATATENDENTE') INTO IFILIALATEND;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATSETOR') INTO IFILIALSETOR;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'VDORCAMENTO') INTO IFILIALORC;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'SGPREFERE2') INTO IFILIALPREF;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'VDVENDEDOR') INTO IFILIALVEND;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALATENDO,'AT') INTO ICODATENDO;
  SELECT CODTPATENDO FROM SGPREFERE2 WHERE CODEMP=:ICODEMP AND CODFILIAL=:IFILIALPREF INTO ICODTPATENDOLEV;
  INSERT INTO ATATENDIMENTO (
    CODEMP,CODFILIAL,CODATENDO,CODCONV,
    CODEMPCV,CODFILIALCV,CODEMPTO,
    CODFILIALTO,CODTPATENDO,CODEMPAE,
    CODFILIALAE,CODATEND,CODEMPSA,CODFILIALSA,
    CODSETAT,STATUSATENDO,OBSATENDO,IDUSU,CODEMPUS,CODFILIALUS,DOCATENDO)
  VALUES
  (
    :ICODEMP,:IFILIALATENDO,:ICODATENDO,:ICODCONV,
    :ICODEMP,:IFILIALCONV,:ICODEMP,
    :IFILIALTIPOATENDO,:ICODTIPOATENDO,:ICODEMP,
    :IFILIALATEND,:ICODATEND,:ICODEMP,:IFILIALSETOR,
    :ICODSETOR,'AA',:VOBSATENDO,lower(USER),:ICODEMP,:ICODFILIAL,:IDOC
  );
/*  SELECT CODORC FROM ATATENDIMENTOORC WHERE CODEMP=:ICODEMP
    AND CODFILIAL=:IFILIALORC AND CODORC=:IDOC INTO ICODORC;*/
  IF (ICODTIPOATENDO = ICODTPATENDOLEV/* AND ICODORC IS NULL*/) THEN
  BEGIN
    SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALORC,'OC') INTO ICODORC;
    SELECT CODFILIALVD,CODVEND FROM SGPREFERE2 WHERE
      CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO IFILIALVEND,ICODVEND;
    INSERT INTO VDORCAMENTO (CODEMP,CODFILIAL,TIPOORC,CODORC,CODEMPCV,CODFILIALCV,CODCONV,
        DTORC,DTVENCORC,STATUSORC,CODEMPVD,CODFILIALVD,CODVEND)
      VALUES
      (
        :ICODEMP,:IFILIALORC,'O',:ICODORC,:ICODEMP,:IFILIALCONV,:ICODCONV,
        CAST ('today' AS DATE),CAST ('today' AS DATE),'OA',:ICODEMP,:IFILIALVEND,:ICODVEND
      );


    INSERT INTO ATATENDIMENTOORC (CODEMP,CODFILIAL,CODATENDO,CODEMPOC,CODFILIALOC,TIPOORC,CODORC)
      VALUES
        (:ICODEMP,:IFILIALORC,:ICODATENDO,:ICODEMP,:IFILIALORC,'O',:ICODORC);

    UPDATE ATATENDIMENTO SET DOCATENDO = :IDOC WHERE
      CODEMP=:ICODEMP AND CODFILIAL=:IFILIALATENDO AND CODATENDO=:ICODATENDO;
  END

END
^

ALTER PROCEDURE VDBUSCAPRECOSP(CODPROD INTEGER,
CODCLI INTEGER,
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODPLANOPAG INTEGER,
CODEMPPG INTEGER,
CODFILIALPG SMALLINT,
CODTIPOMOV INTEGER,
CODEMPTM INTEGER,
CODFILIALTM SMALLINT,
CODEMP INTEGER,
CODFILIAL SMALLINT)
 RETURNS(PRECO NUMERIC(14,5),
CODCLASCLIP INTEGER,
CODPLANOPAGP INTEGER,
CODPRECOPRODP INTEGER,
CODTABP INTEGER)
 AS
begin
    select preco, codclasclip, codplanopagp, codprecoprodp, codtabp 
       from vdbuscaprecosp01 (:codprod, :codcli, :codempcl, :codfilialcl
         , :codplanopag, :codemppg, :codfilialpg, :codtipomov
         , :codemptm, :codfilialtm, :codemp, :codfilial, null, null, null)
    into :preco, :codclasclip, :codplanopagp, :codprecoprodp, :codtabp;
    suspend;
end
^

/* Alter (ATBUSCAPRECOSP) */
ALTER PROCEDURE ATBUSCAPRECOSP(ICODPROD INTEGER,
ICODCONV INTEGER,
ICODEMPCV INTEGER,
ICODFILIALCV SMALLINT,
ICODPLANOPAG INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 RETURNS(PRECO NUMERIC(15,5))
 AS
DECLARE VARIABLE iCodTipoMov INTEGER;
  DECLARE VARIABLE iCodEmpTM INTEGER;
  DECLARE VARIABLE iCodFilialTM INTEGER;
  DECLARE VARIABLE iCodCli INTEGER;
  DECLARE VARIABLE iCodEmpCli INTEGER;
  DECLARE VARIABLE iCodFilialCli INTEGER;
BEGIN
  SELECT CODTIPOMOV2,CODEMPT2,CODFILIALT2 FROM SGPREFERE1 WHERE CODEMP=:ICODEMP
         AND CODFILIAL=:ICODFILIAL INTO iCodTipoMov,iCodEmpTM,iCodFilialTM;
  SELECT CODCLI,CODEMPCL,CODFILIALCL FROM ATCONVENIADO WHERE CODCONV=:ICODCONV
         AND CODEMP=:ICODEMPCV AND CODFILIAL=:ICODFILIALCV INTO iCodCli,iCodEmpCli,iCodFilialCli;

  SELECT PRECO FROM VDBUSCAPRECOSP(:ICODPROD,:iCodCli,:iCodEmpCli,:iCodFilialCli,:ICODPLANOPAG,:ICODEMPPG,
    :ICODFILIALPG,:iCodTipoMov,:iCodEmpTM,:iCodFilialTM,:ICODEMP,:ICODFILIAL) INTO PRECO;

  SUSPEND;
END
^

/* empty dependent procedure body */
/* Clear: ATRESUMOATENDOSP02 for: ATRESUMOATENDOSP01 */
ALTER PROCEDURE ATRESUMOATENDOSP02(CODEMPCLP INTEGER,
CODFILIALCLP SMALLINT,
CODCLIP INTEGER,
CODEMPCTP INTEGER,
CODFILIALCTP SMALLINT,
CODCONTRP INTEGER,
CODITCONTRP SMALLINT,
DTINIP DATE,
DTFIMP DATE)
 RETURNS(CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
RAZCLI VARCHAR(60),
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
CODITCONTR INTEGER,
CODCONTR INTEGER,
DESCCONTR VARCHAR(100),
VLRHORA DECIMAL(15,5),
VLRHORAEXCED DECIMAL(15,5),
QTDCONTR DECIMAL(15,5),
QTDITCONTR DECIMAL(15,5),
VLRCOB DECIMAL(15,5),
VLRCOBEXCED DECIMAL(15,5),
VLRCOBTOT DECIMAL(15,5),
MES SMALLINT,
ANO SMALLINT,
QTDHORAS DECIMAL(15,5),
SALDOMES DECIMAL(15,5),
EXCEDENTEMES DECIMAL(15,5),
EXCEDENTEMESCOB DECIMAL(15,5),
ACUMULO SMALLINT,
CDATAINI DATE)
 AS
 BEGIN SUSPEND; END
^

/* Alter (ATRESUMOATENDOSP01) */
ALTER PROCEDURE ATRESUMOATENDOSP01(CODEMPP INTEGER,
CODFILIALP SMALLINT,
CODCLIP INTEGER,
CODEMPCTP INTEGER,
CODFILIALCTP SMALLINT,
CODCONTRP INTEGER,
CODITCONTRP SMALLINT,
DTINIP DATE,
DTFIMP DATE)
 RETURNS(ANO SMALLINT,
MES SMALLINT,
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
CODCONTR INTEGER,
QTDCONTR DECIMAL(15,5),
DTINICIO DATE,
VALOR DECIMAL(15,5),
VALOREXCEDENTE DECIMAL(15,5),
QTDITCONTR DECIMAL(15,5),
QTDHORAS DECIMAL(15,2),
MESCOB INTEGER,
SALDOMESCOB DECIMAL(15,5),
SALDOMES DECIMAL(15,5),
SALDOPERIODO DECIMAL(15,5),
EXCEDENTEMESCOB DECIMAL(15,5),
EXCEDENTEPERIODO DECIMAL(15,5),
EXCEDENTECOB DECIMAL(15,5),
VALOREXCEDENTECOB DECIMAL(15,5),
VALORTOTALCOB DECIMAL(15,5),
VALORCONTR DECIMAL(15,5),
EXCEDENTEMES DECIMAL(15,5),
TOTFRANQUIAMES DECIMAL(15,5))
 AS
begin
  saldoperiodo = 0;
 -- saldoperiodo2 = 0;
  saldomescob = 0;
  excedentemescob = 0;
  excedenteperiodo = 0;
--  excedenteperiodo2 = 0;
  excedentecob = 0;
  valorexcedentecob = 0;
  valortotalcob = 0;
  -- MES COBRANA
  mescob = extract(month from :dtfimp);
  -- DATA DO MS ANTERIOR A COBRANA
  --dtant = addmonth(:dtfimp, -1);
  -- MES ANTERIOR A COBRANA
 -- mesant = extract(month from :dtant);


  for select extract(year from a.dataatendo) ano
   , extract( month from a.dataatendo) mes
   , ct.codempcl, ct.codfilialcl, ct.codcli
   , ct.codemp codempct, ct.codfilial codfilialct, ct.codcontr
   , a.qtdcontr, a.dtinicio
    , avg((select avg(ic.vlritcontr) from vditcontrato ic
     where  ic.codemp=ct.codemp and ic.codfilial=ct.codfilial and ic.codcontr=ct.codcontr
     and coalesce(ic.franquiaitcontr,'N')='S' ) )  valor
   , avg((select avg(ic.vlritcontrexced) from vditcontrato ic
     where  ic.codemp=ct.codemp and ic.codfilial=ct.codfilial and ic.codcontr=ct.codcontr
     and coalesce(ic.franquiaitcontr,'N')='S' ) )  valorexcedente
   , avg((select sum(qtditcontr) from vditcontrato ic
     where  ic.codemp=ct.codemp and ic.codfilial=ct.codfilial and ic.codcontr=ct.codcontr
     and coalesce(ic.franquiaitcontr,'N')='S' ) )  qtditcontr
   , cast(sum(a.totalcobcli) as decimal(15,2)) qtdhoras
    from vdcontrato ct
    left outer join atatendimentovw02 a on
    a.codempcl=ct.codempcl and a.codfilialcl=ct.codfilialcl and a.codcli=ct.codcli
    and a.codempct=ct.codemp and a.codfilialct=ct.codfilial and a.codcontr=ct.codcontr
    and ( :coditcontrp=0 or a.coditcontr=:coditcontrp ) 
    and a.dataatendo between :dtinip  and
    :dtfimp and a.mrelcobespec='S'
    where
     ct.codempcl=:codempp and ct.codfilialcl=:codfilialp and ct.codcli=:codclip
    and ct.codemp=:codempctp and ct.codfilial=:codfilialctp  and ct.codcontr=:codcontrp
    and ct.recebcontr='S' and ct.tpcobcontr in ('ME','BI','AN') and ct.ativo='S'
    group by 1, 2, 3, 4, 5, 6, 7, 8, 9, 10
    order by 1 desc, 2 desc

   into :ano, :mes

   , :codempcl, :codfilialcl, :codcli
   , :codempct, :codfilialct, :codcontr, :qtdcontr, :dtinicio, :valor
   , :valorexcedente, :qtditcontr, :qtdhoras
   do
   begin
       /* Caso no existam lanamentos retornar ano e ms atual */
       if (:ano is null) then
          ano = extract(year from dtfimp);

       if (:mes is null) then
           mes = extract(month from dtfimp);

       -- TOTAL DE FRANQUIA NO MES
       totfranquiames = qtditcontr;

       -- SALDO MS
       if( :qtditcontr - :qtdhoras   > 0) then
           saldomes =  qtditcontr - qtdhoras;
       else
           saldomes = 0;

       -- VALOR CONTRATADO
       if (mes=mescob) then
          valorcontr = qtditcontr * valor;

       -- EXCEDENTE MES
       if( :qtdhoras < :qtditcontr ) then
          excedentemes = 0;
       else
          excedentemes = qtdhoras - qtditcontr;

       -- EXCEDENTE MES COBRANA
       if( (:qtdhoras > :qtditcontr) and (mes = mescob) ) then
          excedentemescob = excedentemes;

       if (mes=mescob) then
       begin
          --- SALDO DO MS DE COBRANA
          saldomescob = saldomescob + saldomes;
       end
       else
       begin
         -- SALDO DO PERODO
         saldoperiodo = saldoperiodo + saldomes;

         -- EXCEDENTE DO PERODO
          excedenteperiodo = excedenteperiodo + excedentemes;

       end 

   end

   -- EXCEDENTE COBRADO
   if( :excedenteperiodo - :saldoperiodo > 0) then
       excedentecob =  excedenteperiodo - saldoperiodo;
   else
       excedentecob = 0;

   if (excedentecob>0) then
      saldoperiodo = 0;

   saldoperiodo = saldoperiodo + saldomescob;
   excedentecob = excedentemescob;

   --VLRTOTAL =$V{QTDITCONTRCALC}.multiply($F{VALOR}).add($V{EXCEDENTECOB}.multiply( $V{VALOREXCEDENTE} ))

   -- VALOR A COBRAR EXCEDENTE
   valorexcedentecob = excedentecob * valorexcedente;
        
   -- VALOR TOTAL A COBRAR
   valortotalcob = (valorcontr) + (excedentecob * valorexcedente);

 -- saldoperiodo2 = 0;
  excedentemescob = 0;
  --excedenteperiodo2 = 0;

  for select extract(year from a.dataatendo) ano
   , extract( month from a.dataatendo) mes
   , ct.codempcl, ct.codfilialcl, ct.codcli
   , ct.codemp codempct, ct.codfilial codfilialct, ct.codcontr
   , a.qtdcontr, a.dtinicio
   , cast(sum(a.totalcobcli) as decimal(15,2)) qtdhoras
    from vdcontrato ct
    left outer join atatendimentovw02 a on
    a.codempcl=ct.codempcl and a.codfilialcl=ct.codfilialcl and a.codcli=ct.codcli
    and a.codempct=ct.codemp and a.codfilialct=ct.codfilial and a.codcontr=ct.codcontr
    and ( :coditcontrp=0 or a.coditcontr=:coditcontrp ) 
    and a.dataatendo between :dtinip  and
    :dtfimp and a.mrelcobespec='S'
    where
     ct.codempcl=:codempp and ct.codfilialcl=:codfilialp and ct.codcli=:codclip
    and ct.codemp=:codempctp and ct.codfilial=:codfilialctp  and ct.codcontr=:codcontrp
    and ct.recebcontr='S' and ct.tpcobcontr in ('ME','BI','AN') and ct.ativo='S'
    group by 1, 2, 3, 4, 5, 6, 7, 8, 9, 10
    order by 1 desc, 2 desc

   into :ano, :mes
   , :codempcl, :codfilialcl, :codcli
   , :codempct, :codfilialct, :codcontr
   , :qtdcontr, :dtinicio, :qtdhoras
   do
   begin
       /* Caso no existam lanamentos retornar ano e ms atual */
       if (:ano is null) then
          ano = extract(year from dtfimp);

       if (:mes is null) then
           mes = extract(month from dtfimp);

       -- TOTAL DE FRANQUIA NO MES
       totfranquiames = qtditcontr;

       -- SALDO MS
       if( :qtditcontr - :qtdhoras   > 0) then
           saldomes =  qtditcontr - qtdhoras;
       else
           saldomes = 0;

       -- VALOR CONTRATADO
       valorcontr = qtditcontr * valor;

       -- EXCEDENTE MES
       if( :qtdhoras < :qtditcontr ) then
          excedentemes = 0;
       else
          excedentemes = qtdhoras - qtditcontr;

       -- EXCEDENTE MES COBRANA
       if( (:qtdhoras < :qtditcontr)
       --or (mes <> mescob)
       ) then
          excedentemescob = 0;
       else
          excedentemescob = qtdhoras - qtditcontr;

       -- SALDO DO PERODO
--       saldoperiodo2 = saldoperiodo2 + saldomes;

       -- EXCEDENTE DO PERODO
  --     excedenteperiodo2 = excedenteperiodo2 + excedentemescob;

       --VLRTOTAL =$V{QTDITCONTRCALC}.multiply($F{VALOR}).add($V{EXCEDENTECOB}.multiply( $V{VALOREXCEDENTE} ))

       -- VALOR A COBRAR EXCEDENTE
--       valorexcedentecob = excedentecob * valorexcedente;
        
       -- VALOR TOTAL A COBRAR
--       valortotalcob = (qtditcontr * valor) + (excedentecob * valorexcedente);

      suspend;
   end


end
^

/* Alter (ATRESUMOATENDOSP02) */
ALTER PROCEDURE ATRESUMOATENDOSP02(CODEMPCLP INTEGER,
CODFILIALCLP SMALLINT,
CODCLIP INTEGER,
CODEMPCTP INTEGER,
CODFILIALCTP SMALLINT,
CODCONTRP INTEGER,
CODITCONTRP SMALLINT,
DTINIP DATE,
DTFIMP DATE)
 RETURNS(CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
RAZCLI VARCHAR(60),
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
CODITCONTR INTEGER,
CODCONTR INTEGER,
DESCCONTR VARCHAR(100),
VLRHORA DECIMAL(15,5),
VLRHORAEXCED DECIMAL(15,5),
QTDCONTR DECIMAL(15,5),
QTDITCONTR DECIMAL(15,5),
VLRCOB DECIMAL(15,5),
VLRCOBEXCED DECIMAL(15,5),
VLRCOBTOT DECIMAL(15,5),
MES SMALLINT,
ANO SMALLINT,
QTDHORAS DECIMAL(15,5),
SALDOMES DECIMAL(15,5),
EXCEDENTEMES DECIMAL(15,5),
EXCEDENTEMESCOB DECIMAL(15,5),
ACUMULO SMALLINT,
CDATAINI DATE)
 AS
declare variable dtiniac date;
begin
  for select cl.codemp codempcl, cl.codfilial codfilialcl, cl.codcli, cl.razcli
    , ct.codemp codempct, ct.codfilial codfilialct, ct.codcontr, ct.desccontr, ct.dtinicio
    from vdcliente cl, vdcontrato ct
    where cl.codemp=:codempclp and cl.codfilial=:codfilialclp and (:codclip=0 or cl.codcli=:codclip)
       and ct.codemp=:codempctp and ct.codfilial=:codfilialctp and (:codcontrp=0 or ct.codcontr=:codcontrp)
       and ct.codempcl=cl.codemp and ct.codfilialcl=cl.codfilial and ct.codcli=cl.codcli
       and ct.ativo='S' and ct.tpcobcontr in ('ME','BI','AN') and ct.recebcontr='S'
     order by cl.razcli,  cl.codcli,  ct.codcontr
  into :codempcl, :codfilialcl, :codcli, :razcli
    , :codempct, :codfilialct, :codcontr, :desccontr, :cdataini
  do
  begin


--       and i.codemp=ct.codemp  and i.codfilial=ct.codfilial and i.codcontr=ct.codcontr and (:coditcontrp=0 or i.coditcontr=:coditcontrp)

  --vditcontrato i,

      select max(i.acumuloitcontr) from vditcontrato i
      where i.codemp=:codempct  and i.codfilial=:codfilialct and i.codcontr=:codcontr and (:coditcontrp=0 or i.coditcontr=:coditcontr)
      and i.acumuloitcontr is not null
      into :acumulo;
      if ( (:acumulo is null) or (:acumulo=0) ) then
      begin
        acumulo = 0;
        dtiniac = dtinip;
      end
      else
      begin
        dtiniac = dtinip;
        dtiniac = cast( addmonth(dtiniac, -1*acumulo) as date);
        if( dtiniac > dtinip ) then
         dtiniac = dtinip;
      end
      for select a.mes, a.ano, a.qtdcontr, a.valor, a.valorexcedente, a.qtditcontr, a.qtdhoras, a.valortotalcob
       , a.saldomes, a.excedentemes, a.excedentemescob, a.valorexcedentecob , a.valorcontr
         from atresumoatendosp01(:codempcl, :codfilialcl, :codcli
         , :codempct, :codfilialct, :codcontr, :coditcontrp, :dtiniac, :dtfimp) a
      into :mes, :ano, :qtdcontr, :vlrhora, :vlrhoraexced, :qtditcontr, :qtdhoras, :vlrcobtot
      , :saldomes, :excedentemes, :excedentemescob, :vlrcobexced, :vlrcob
      do
      begin
        
      suspend;
      end
  end
end
^

/* Alter (CPADICCOMPRAPEDSP) */
ALTER PROCEDURE CPADICCOMPRAPEDSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODCOMPRA INTEGER,
DOCCOMPRA INTEGER,
CODEMPTM INTEGER,
CODFILIALTM SMALLINT,
CODTIPOMOV INTEGER,
CODEMPFR INTEGER,
CODFILIALFR SMALLINT,
CODFOR INTEGER,
CODEMPPG INTEGER,
CODFILIALPG SMALLINT,
CODPLANOPAG INTEGER,
CODEMPSE INTEGER,
CODFILIALSE SMALLINT,
SERIE VARCHAR(5))
 RETURNS(IRET INTEGER)
 AS
declare variable statuscompra char(2);
begin

    --Buscando a srie da compra
    /*select tm.codempse, tm.codfilialse, tm.serie
    from eqtipomov tm
    where tm.codemp=:codemptm and tm.codfilial=:codfilialtm and tm.codtipomov=:codtipomov
    into :codempse, :codfilialse, :serie;
    */
    --Definio do status da compra
    statuscompra = 'P1';

    --Buscando doccompra 
    -- select doc from lfnovodocsp(:serie, :codempse , :codfilialse) into doccompra;

    insert into cpcompra (
    codemp, codfilial, codcompra, codemppg, codfilialpg, codplanopag, codempfr, codfilialfr, codfor,
    codempse, codfilialse, serie, codemptm, codfilialtm, codtipomov, doccompra, dtentcompra, dtemitcompra, statuscompra, calctrib )
    values (
    :codemp, :codfilial, :codcompra, :codemppg, :codfilialpg, :codplanopag, :codempfr, :codfilialfr, :codfor,
    :codempse, :codfilialse, :serie, :codemptm, :codfilialtm, :codtipomov, :doccompra,
    cast('today' as date), cast('today' as date), :statuscompra, 'S' );

    iret = :codcompra;

    suspend;

end
^

ALTER PROCEDURE LFBUSCAFISCALSP(CODEMP INTEGER,
CODFILIALSEL INTEGER,
CODFILIALPD INTEGER,
CODPROD INTEGER,
CODEMPCF INTEGER,
CODFILIALCF INTEGER,
CODCF INTEGER,
CODEMPTM INTEGER,
CODFILIALTM SMALLINT,
CODTIPOMOV INTEGER,
TIPOBUSCA CHAR(2),
CODNAT CHAR(4),
CODEMPIFP INTEGER,
CODFILIALIFP SMALLINT,
CODFISCP CHAR(13),
CODITFISCP INTEGER)
 RETURNS(ORIGFISC CHAR,
CODTRATTRIB CHAR(2),
REDFISC NUMERIC(9,2),
TIPOFISC CHAR(2),
CODMENS INTEGER,
ALIQFISC NUMERIC(9,2),
ALIQLFISC NUMERIC(9,2),
ALIQIPIFISC NUMERIC(9,2),
TPREDICMSFISC CHAR,
TIPOST CHAR(2),
MARGEMVLAGR NUMERIC(15,5),
CODEMPIF INTEGER,
CODFILIALIF SMALLINT,
CODFISC CHAR(13),
CODITFISC INTEGER,
ALIQFISCINTRA NUMERIC(9,2),
ALIQPIS NUMERIC(9,2),
ALIQCOFINS NUMERIC(9,2),
ALIQCSOCIAL NUMERIC(9,2),
ALIQIR NUMERIC(9,2),
REDBASEST CHAR,
ALIQISS NUMERIC(6,2),
ADICIPIBASEICMS CHAR,
CALCSTCM CHAR,
ALIQICMSSTCM NUMERIC(9,2),
ICMSPART CHAR,
PBCOP NUMERIC(6,2),
PFCP NUMERIC(6,2))
 AS
declare variable noestcf char(1);
declare variable codfisccf integer;
declare variable codempfccf integer;
declare variable codfilialfccf integer;
declare variable ufcf char(2);
declare variable uffilial char(2);
declare variable clfiscalespecifica char(1);
begin
    -- Se for uma busca para venda
    if(:tipobusca='VD') then
    begin
        select coalesce(siglauf,ufcli),codempfc,codfilialfc,codfisccli
           from vdcliente
           where codemp=:codempcf and codfilial=:codfilialcf and codcli=:codcf
           into ufcf,codempfccf,codfilialfccf,codfisccf;
        select clfiscalvdespecifica from sgprefere1 where codemp=:codempcf and codfilial=:codfilialsel
           into :clfiscalespecifica;
    end
    -- Se for uma busca para compra
    else if(:tipobusca='CP') then
    begin
    	clfiscalespecifica = 'N';
        select coalesce(siglauf,uffor),codempff,codfilialff,codfiscfor
        from cpforneced fr
        where codemp=:codempcf and codfilial=:codfilialcf and codfor=:codcf
            into ufcf,codempfccf,codfilialfccf,codfisccf;
    end
    --Busca o estado da Filial
    select siglauf from sgfilial where codemp=:codemp and codfilial=:codfilialsel
    into uffilial;
    --Compara estado da filial com estado do cliente ou fornecedor
    if(uffilial=ufcf) then
    begin
        NOESTCF='S';
    end
    else
    begin
        NOESTCF='N';
    end
    -- Se o tem de classificao fiscal no foi informado deve realizar as buscas para descobrir...
    if(coditfiscp is null) then
    begin
       /*Primeira busca, mais especfica para o tipo fiscal do cliente ou fornecedor e estado de destino da mercadoria*/
        for select it.origfisc,it.codtrattrib,it.redfisc,it.aliqfisc, coalesce(it.aliqlfisc,0), it.tipofisc,it.codmens,it.aliqipifisc,
                   it.tpredicmsfisc,it.tipost,it.margemvlagr,it.codemp,it.codfilial,it.codfisc,it.coditfisc,
                   it.aliqfiscintra,it.aliqpisfisc,it.aliqcofinsfisc,it.aliqcsocialfisc,it.aliqirfisc, it.redbasest
                   ,coalesce(it.aliqissfisc, f.percissfilial ), it.adicipibaseicms, it.calcstcm, it.aliqicmsstcm
                   , it.icmspart, it.pbcop
            from lfitclfiscal it, eqproduto p, sgfilial f
            where p.codprod=:codprod and p.codfilial=:codfilialpd and p.codemp=:codemp and it.codemp=p.codempfc
                and it.codfilial=p.codfilialfc and it.codfisc=p.codfisc and it.noufitfisc=:noestcf
                and ((it.codtipomov=:codtipomov and it.codemptm=:codemptm and it.codfilial=:codfilialtm) or (it.codtipomov is null))
                and  ((it.codfisccli=:codfisccf and it.codempfc=:codempfccf and it.codfilialfc=:codfilialfccf) or (it.codfisccli is null))
                and it.siglauf=:ufcf and it.tipousoitfisc=:tipobusca
                and f.codemp=:codemp and f.codfilial=:codfilialsel
                and it.ativoitfisc='S' and it.simplesfilial=f.simplesfilial
            order by it.codtipomov desc, it.codfisccli desc
        into :origfisc, :codtrattrib, :redfisc, :aliqfisc, :aliqlfisc, :tipofisc, :codmens, :aliqipifisc, :tpredicmsfisc, :tipost, :margemvlagr,
            :codempif, :codfilialif, :codfisc, :coditfisc, :aliqfiscintra, :aliqpis, :aliqcofins, :aliqcsocial, :aliqir, :redbasest
            , :aliqiss, :adicipibaseicms, :calcstcm, :aliqicmsstcm, :icmspart, :pbcop
        do
        begin
            -- Definio do ICMS
            -- caso no tenha encontrato aliquota de icms e tratamento tributrio no for (isento, isento ou n.trib, n.trib., suspenso)
            if(codtrattrib not in ('40','30','41','50') and (aliqfisc is null or aliqfisc=0 ) ) then
            begin
                select coalesce(percicms,0), coalesce(aliqfcpti,0)
                from lfbuscaicmssp (:codnat,:ufcf,:codemp,:codfilialpd)
                into :aliqfisc, :pfcp;
            end
            else if (pfcp is null or pfcp=0) then
            begin
                select coalesce(aliqfcpti,0)
                from lfbuscaicmssp (:codnat,:ufcf,:codemp,:codfilialpd)
                into :pfcp;
            end
            suspend;
            exit;
        end
		if (clfiscalespecifica='N') then
		begin
	        /* Segunda busca, mais especfica para o tipo fiscal do cliente*/
	        for select it.origfisc,it.codtrattrib,it.redfisc,it.aliqfisc,coalesce(it.aliqlfisc,0), it.tipofisc,it.codmens,it.aliqipifisc,
	                   it.tpredicmsfisc,it.tipost,it.margemvlagr,it.codemp,it.codfilial,it.codfisc,it.coditfisc,
	                   it.aliqfiscintra,it.aliqpisfisc,it.aliqcofinsfisc,it.aliqcsocialfisc,it.aliqirfisc, it.redbasest
	                   ,coalesce(it.aliqissfisc, f.percissfilial), it.adicipibaseicms, it.calcstcm, it.aliqicmsstcm
	                   , it.icmspart, it.pbcop
	            from lfitclfiscal it, eqproduto p, sgfilial f
	            where p.codprod=:codprod and p.codfilial=:codfilialpd and p.codemp=:codemp and it.codemp=p.codempfc
	                and it.codfilial=p.codfilialfc and it.codfisc=p.codfisc and it.noufitfisc=:noestcf
	                and (((it.codtipomov=:codtipomov and it.codemptm=:codemptm and it.codfilial=:codfilialtm) or (it.codtipomov is null))
	                and   (it.codfisccli=:codfisccf and it.codempfc=:codempfccf and it.codfilialfc=:codfilialfccf))
	                and ( it.siglauf=:ufcf or it.siglauf is null )
	                and it.tipousoitfisc=:tipobusca
	                and f.codemp=:codemp and f.codfilial=:codfilialsel
	                and it.ativoitfisc='S' and it.simplesfilial=f.simplesfilial
	            order by it.coditfisc
	        into origfisc,codtrattrib,redfisc,aliqfisc, :aliqlfisc, tipofisc,codmens,aliqipifisc,tpredicmsfisc,tipost,margemvlagr,
	            codempif,codfilialif,codfisc,coditfisc,aliqfiscintra,aliqpis,aliqcofins,aliqcsocial,aliqir, redbasest
	            , aliqiss, :adicipibaseicms, :calcstcm, :aliqicmsstcm, :icmspart, :pbcop
	        do
	        begin
	            -- Definio do ICMS
	            -- caso no tenha encontrato aliquota de icms e tratamento tributrio no for (isento, isento ou n.trib, n.trib., suspenso)
	            if(codtrattrib not in ('40','30','41','50') and (aliqfisc is null or aliqfisc=0 ) ) then
	            begin
	                select coalesce(percicms,0), coalesce(aliqfcpti,0)
	                from lfbuscaicmssp (:codnat,:ufcf,:codemp,:codfilialpd)
	                into :aliqfisc, :pfcp;
	            end
	            else if (pfcp is null or pfcp=0) then
	            begin
	                select coalesce(aliqfcpti,0)
	                from lfbuscaicmssp (:codnat,:ufcf,:codemp,:codfilialpd)
	                into :pfcp;
	            end
	            suspend;
	            exit;
	        end
	
	        /* Terceira busca, mais genrica, pega excees sem tipo de movimento e tipo fiscal do cliente,
            s  executada quando a SELECT acima no retornar nenhum valor. */
	        for select it.origfisc,it.codtrattrib,it.redfisc,it.aliqfisc,coalesce(it.aliqlfisc,0), it.tipofisc,it.codmens,it.aliqipifisc,it.tpredicmsfisc,
	            it.tipost,it.margemvlagr,it.codemp,it.codfilial,it.codfisc,it.coditfisc,it.aliqfiscintra,it.aliqpisfisc,
	            it.aliqcofinsfisc,it.aliqcsocialfisc,it.aliqirfisc, it.redbasest,coalesce(it.aliqissfisc, f.percissfilial)
	            , it.adicipibaseicms, it.calcstcm, it.aliqicmsstcm
	            , it.icmspart, it.pbcop
	            from lfitclfiscal it, eqproduto p, sgfilial f
	            where
	                p.codprod=:codprod and p.codfilial=:codfilialpd and p.codemp=:codemp and
	                it.codemp=p.codempfc and it.codfilial=p.codfilialfc and it.codfisc=p.codfisc and
	                it.noufitfisc=:noestcf and
	                ( (it.codtipomov=:codtipomov and it.codemptm=:codemptm and it.codfilial=:codfilialtm) or
	                  (it.codfisccli=:codfisccf and it.codempfc=:codempfccf and it.codfilialfc=:codfilialfccf) or
	                  (it.codfisccli is null and it.codtipomov is null) ) 
	                   and ( it.siglauf=:ufcf or it.siglauf is null )
	                   and it.tipousoitfisc=:tipobusca
	                   and f.codemp=:codemp and f.codfilial=:codfilialsel
	                   and it.ativoitfisc='S' and it.simplesfilial=f.simplesfilial
	            order by (case when it.codtipomov = :codtipomov then 0 when it.codtipomov is null then 1 else 2 end)
	               , (case when it.codfisccli = :codfisccf then 0 when it.codfisccli is null then 1 else 2 end)
	            into origfisc,codtrattrib,redfisc,aliqfisc, :aliqlfisc, tipofisc,codmens,aliqipifisc,tpredicmsfisc,tipost,margemvlagr,
	                codempif,codfilialif,codfisc,coditfisc,aliqfiscintra,aliqpis,aliqcofins,aliqcsocial,aliqir, redbasest
	                , aliqiss, :adicipibaseicms, :calcstcm, :aliqicmsstcm, :icmspart, :pbcop
	        do
	        begin
	            -- Definio do ICMS
	            -- caso no tenha encontrato aliquota de icms e tratamento tributrio no for (isento, isento ou n.trib, n.trib., suspenso)
	            if(codtrattrib not in ('40','30','41','50') and (aliqfisc is null or aliqfisc=0 ) ) then
	            begin
	                select coalesce(percicms,0), coalesce(aliqfcpti,0)
	                from lfbuscaicmssp (:codnat,:ufcf,:codemp,:codfilialpd)
	                into :aliqfisc, :pfcp;
	            end
	            else if (pfcp is null or pfcp=0) then
	            begin
	                select coalesce(aliqfcpti,0)
	                from lfbuscaicmssp (:codnat,:ufcf,:codemp,:codfilialpd)
	                into :pfcp;
	            end
	            suspend;
	            exit;
	        end
	
	        /*Quarta busca, mais genrica, sem filtros por tipo de movimento e tipo fiscal.
            s  executada quando as SELECTS acima no retornarem nenhum valor.*/
	        select f.origfisc,f.codtrattrib,f.redfisc,f.aliqfisc, coalesce(f.aliqlfisc,0), f.tipofisc, f.aliqipifisc, f.tpredicmsfisc, f.tipost, f.margemvlagr,
	            f.codemp,f.codfilial,f.codfisc,f.coditfisc,f.aliqfiscintra,f.aliqpisfisc,f.aliqcofinsfisc,f.aliqcsocialfisc,f.aliqirfisc,f.redbasest
	            ,coalesce(f.aliqissfisc, f1.percissfilial), f.adicipibaseicms, f.calcstcm, f.aliqicmsstcm
	            , f.icmspart, f.pbcop
	        from lfitclfiscal f, eqproduto p, sgfilial f1
	        where
	            p.codprod=:codprod and p.codfilial=:codfilialpd and p.codemp=:codemp and
	            f.codemp=p.codempfc and f.codfilial=:codfilialsel and f.codfisc=p.codfisc and
	            f.geralfisc='S' and f.tipousoitfisc=:tipobusca
	            and f1.codemp=:codemp and f1.codfilial=:codfilialsel
	            and f.ativoitfisc='S' and f.simplesfilial=f1.simplesfilial
	        into origfisc,codtrattrib,redfisc,aliqfisc, :aliqlfisc, tipofisc,aliqipifisc,tpredicmsfisc,tipost,margemvlagr,
	            codempif,codfilialif,codfisc,coditfisc,aliqfiscintra,aliqpis,aliqcofins,aliqcsocial,aliqir,redbasest
	            ,aliqiss, :adicipibaseicms, :calcstcm, :aliqicmsstcm, icmspart, pbcop;
	    end
    
        -- Definio do ICMS
        -- caso no tenha encontrato aliquota de icms e tratamento tributrio no for (isento, isento ou n.trib, n.trib., suspenso)

        if(codtrattrib not in ('40','30','41','50') and (aliqfisc is null or aliqfisc=0 ) ) then
        begin
           select coalesce(percicms,0), coalesce(aliqfcpti,0)
           from lfbuscaicmssp (:codnat,:ufcf,:codemp,:codfilialpd)
           into :aliqfisc, :pfcp;
        end
        else if (pfcp is null or pfcp=0) then
        begin
            select coalesce(aliqfcpti,0)
            from lfbuscaicmssp (:codnat,:ufcf,:codemp,:codfilialpd)
            into :pfcp;
        end
        suspend;
    end
    -- Se o tem de classificao fiscal foi informado
    else if(coditfiscp is not null) then
    begin

       for select it.origfisc,it.codtrattrib,it.redfisc,it.aliqfisc,coalesce(it.aliqlfisc,0), it.tipofisc,it.codmens,it.aliqipifisc,
            it.tpredicmsfisc,it.tipost,it.margemvlagr,it.codemp,it.codfilial,it.codfisc,it.coditfisc,
            it.aliqfiscintra,it.aliqpisfisc,it.aliqcofinsfisc,it.aliqcsocialfisc,it.aliqirfisc, it.redbasest
            ,coalesce(it.aliqissfisc,f.percissfilial), it.adicipibaseicms , it.calcstcm, it.aliqicmsstcm
            , it.icmspart, it.pbcop
            from lfitclfiscal it, sgfilial f
            where it.codemp=:codempifp and it.codfilial=:codfilialifp and it.codfisc=:codfiscp and it.coditfisc=:coditfiscp
             and f.codemp=:codemp and f.codfilial=:codfilialsel
             and it.ativoitfisc='S' and it.simplesfilial=f.simplesfilial
        into origfisc,codtrattrib,redfisc,aliqfisc, :aliqlfisc, tipofisc,codmens,aliqipifisc,tpredicmsfisc,tipost,margemvlagr,
            codempif,codfilialif,codfisc,coditfisc,aliqfiscintra,aliqpis,aliqcofins,aliqcsocial,aliqir, redbasest
            , aliqiss, :adicipibaseicms, :calcstcm, :aliqicmsstcm, :icmspart, :pbcop
        do
        begin
            -- Definio do ICMS
            -- caso no tenha encontrato aliquota de icms e tratamento tributrio no for (isento, isento ou n.trib, n.trib., suspenso)
            if(codtrattrib not in ('40','30','41','50') and (aliqfisc is null or aliqfisc=0 ) ) then
            begin
                select coalesce(percicms,0), coalesce(aliqfcpti,0)
                from lfbuscaicmssp (:codnat,:ufcf,:codemp,:codfilialpd)
                into :aliqfisc, :pfcp;
            end
            else if (pfcp is null or pfcp=0) then
            begin
                select coalesce(aliqfcpti,0)
                from lfbuscaicmssp (:codnat,:ufcf,:codemp,:codfilialpd)
                into :pfcp;
            end
            suspend;
            exit;
        end
    end

end
^

ALTER PROCEDURE LFBUSCAICMSSP(CODNAT CHAR(4),
ESTCLI CHAR(2),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 RETURNS(PERCICMS NUMERIC(6,2),
PERCICMSINTRA NUMERIC(6,2),
ALIQFCPTI NUMERIC(6,2))
 AS
declare variable estemp char(2);
begin
    -- buscando o estado de origem
    select coalesce(siglauf, uffilial) from sgfilial where codemp=:icodemp and codfilial=:icodfilial
    into :estemp;
    -- caso estado de origem e destino sejam o mesmo
    if (estcli = estemp) then
    begin
        -- busca aliquota da tabela de cfop
        select aliqenat, aliqenat 
        from lfnatoper 
        where codnat=:codnat and codemp=:icodemp and codfilial=:icodfilial
        into :percicms, :percicmsintra;
        -- busca o percentual do fundo de combate a pobreza
        select ti.aliqfcpti 
        from lftabicms ti, lfitnatoper ino
        where ti.codemp = ino.codempti and ti.codfilial=ino.codfilialti and ti.ufti=ino.ufti and
        ino.codemp=:icodemp and ino.codfilial=:icodfilial and ino.codnat=:codnat and ino.ufti=:estcli
        into :aliqfcpti;
    end
    else
    begin
        -- busca aliquota da tabela de icms para a natureza de operao informada.
        select ti.aliqti, ti.aliqintrati, ti.aliqfcpti 
        from lftabicms ti, lfitnatoper ino
        where ti.codemp = ino.codempti and ti.codfilial=ino.codfilialti and ti.ufti=ino.ufti and
        ino.codemp=:icodemp and ino.codfilial=:icodfilial and ino.codnat=:codnat and ino.ufti=:estcli
        into :percicms, :percicmsintra, :aliqfcpti;
    end
    -- Caso no tenha natureza da operao 
    if (codnat is null) then
    begin
        select ti.aliqfcpti
        from lftabicms ti
        where ti.codemp=:icodemp and ti.codfilial=:icodfilial and ti.ufti=:estcli
        into :aliqfcpti;
    end
    -- Caso no tenha obtido a aliquota nas formas anteriores
    if (percicms is null) then
    begin
        select aliqfnat,aliqenat from lfnatoper 
        where codnat=:codnat and codemp=:icodemp and codfilial=:icodfilial
        into :percicms, :percicmsintra;
    end
  suspend;
end
^

/* Alter (CPADICITCOMPRAPEDSP) */
ALTER PROCEDURE CPADICITCOMPRAPEDSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODCOMPRA INTEGER,
CODEMPPC INTEGER,
CODFILIALPC SMALLINT,
CODCOMPRAPC INTEGER,
CODITCOMPRAPC INTEGER,
TPAGRUP CHAR,
QTDITCOMPRA FLOAT,
VLRDESCITCOMPRA NUMERIC(15,5),
PRECOITCOMPRA NUMERIC(15,5))
 AS
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codempfr integer;
declare variable codfilialfr smallint;
declare variable codfor integer;
declare variable coditcompra integer;
declare variable codemppd integer;
declare variable codfilialpd smallint;
declare variable codprod integer;
declare variable refprod varchar(20);
declare variable percdescitcompra numeric(15,5);
declare variable vlrliqitcompra numeric(15,5);
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable codlote varchar(20);
declare variable cloteprod char(1);
declare variable uffor char(2);
declare variable codempnt integer;
declare variable codfilialnt smallint;
declare variable codnat char(4);
declare variable tipofisc char(2);
declare variable percred numeric(9,2);
declare variable codtrattrib char(2);
declare variable origfisc char(1);
declare variable codmens smallint;
declare variable percicmsitcompra numeric(9,2);
declare variable codempif integer;
declare variable codfilialif smallint;
declare variable codfisc char(13);
declare variable coditfisc integer;
declare variable tipost char(2);
declare variable margemvlagr numeric(15,5);
declare variable percipiitcompra numeric(9,2);
declare variable percicmsst numeric(9,2);
declare variable tpredicms char(1);
declare variable redbaseicmsst char(1);
declare variable vlrproditcompra numeric(15,5);
declare variable vlrbaseipiitcompra numeric(15,5);
declare variable vlripiitcompra numeric(15,5);
declare variable vlrbaseicmsitcompra numeric(15,5);
declare variable vlricmsitcompra numeric(15,5);
declare variable vlrbaseicmsbrutitcompra numeric(15,5);
declare variable vlrisentasitcompra numeric(15,5);
declare variable vlroutrasitcompra numeric(15,5);
declare variable vlrbaseicmsstitcompra numeric(15,5);
declare variable vlricmsstitcompra numeric(15,5);
declare variable pfcp numeric(6,2);
begin

-- Inicializao de variaveis

    select icodfilial from sgretfilial(:codemp, 'LFNATOPER') into :codfilialnt;

    select cp.codemptm, cp.codfilialtm, cp.codtipomov, cp.codempfr,  cp.codfilialfr, cp.codfor, coalesce(fr.siglauf, fr.uffor) uffor
    from cpcompra cp, cpforneced fr
    where cp.codcompra=:codcompra and cp.codfilial=:codfilial and cp.codemp=:codemp and
    fr.codemp=cp.codempfr and fr.codfilial=cp.codfilialfr and fr.codfor=cp.codfor
    into :codemptm, :codfilialtm, :codtipomov, :codempfr, :codfilialfr, :codfor, :uffor ;

-- Busca sequencia de numerao do tem de compra

    select coalesce(max(coditcompra),0)+1 from cpitcompra where codcompra=:codcompra and codfilial=:codfilial and codemp=:codemp
    into :coditcompra;

-- Informaes do item do pedido de compra

    select it.codemppd, it.codfilialpd, it.codprod, it.percdescitcompra, it.vlrliqitcompra, it.vlrproditcompra, it.refprod,
    it.codempax, it.codfilialax, it.codalmox, it.codlote, pd.cloteprod
    from cpitcompra it, eqproduto pd
    where it.coditcompra=:coditcomprapc and it.codcompra=:codcomprapc and it.codfilial=:codfilialpc and it.codemp=:codemppc
    and pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and pd.codprod=it.codprod
    into :codemppd, :codfilialpd, :codprod, :percdescitcompra, :vlrliqitcompra, :vlrproditcompra, :refprod,
    :codempax, :codfilialax, :codalmox, :codlote, :cloteprod;

-- Buscando a natureza de operao para o tem de compra

    select codnat from lfbuscanatsp(:codfilial, :codemp, :codfilialpd, :codprod, null, null, null, :codempfr, :codfilialfr, :codfor,
    :codfilialtm, :codtipomov, null)
    into :codnat;
    
    if (:codnat is null) then
    begin
        exception cpitcompraex04 ' produto:' || :refprod; -- NO FOI POSSVEL ENCONTRAR A NATUREZA DA OPERAO PARA O TEM
    end
-- Aqui
-- Busca informaes fiscais para o tem de compra

    select tipofisc,redfisc,codtrattrib,origfisc,codmens,aliqfisc,codempif,codfilialif,codfisc,coditfisc,tipost,margemvlagr,
    aliqipifisc,aliqfiscintra,tpredicmsfisc,redbasest
    from lfbuscafiscalsp(:codemppd, :codfilial, :codfilialpd, :codprod, :codempfr,:codfilialfr, :codfor,
    :codemptm, :codfilialtm, :codtipomov, 'CP', :codnat,null,null,null,null)
    into :tipofisc, :percred, :codtrattrib, :origfisc, :codmens, :percicmsitcompra, :codempif, :codfilialif, :codfisc, :coditfisc, :tipost,
    :margemvlagr, :percipiitcompra, :percicmsst, :tpredicms, :redbaseicmsst;
    
-- Inicializando valores

    vlrproditcompra = :precoitcompra * :qtditcompra;
    vlrliqitcompra = :vlrproditcompra - :vlrdescitcompra;
    vlrbaseipiitcompra = 0;
    vlrbaseicmsitcompra = 0;
    vlricmsitcompra = 0;
    vlripiitcompra = 0;

    if (:percicmsitcompra = 0 or :percicmsitcompra is null) then
    begin
        select coalesce(percicms, 0) from lfbuscaicmssp (:codnat, :uffor,:codemp, :codfilial) into :percicmsst;
    end

    if (:percred is null) then
    begin
        percred = 0;
    end

    if(percred>0) then
    begin
        if(:tpredicms='B') then
        begin
            vlrbaseicmsitcompra = (:vlrproditcompra - :vlrdescitcompra) - ( (:vlrproditcompra - :vlrdescitcompra) * ( :percred / 100 ) );
        end
        else if(:tpredicms='V') then
        begin
            vlricmsitcompra = (:vlrbaseicmsitcompra * ( :percicmsitcompra / 100 )) -  ( (:vlrbaseicmsitcompra * ( :percicmsitcompra / 100 ) * ( :percred / 100 ) )) ;
        end
    end
    else
    begin
        vlrbaseicmsitcompra = :vlrproditcompra - :vlrdescitcompra;
        vlricmsitcompra = :vlrbaseicmsitcompra * ( :percicmsitcompra / 100 );
    end

    vlrbaseipiitcompra = cast( :vlrproditcompra - :vlrdescitcompra as decimal(15,2));
    vlrbaseicmsbrutitcompra = cast( :vlrproditcompra - :vlrdescitcompra as decimal(15,2));
    vlripiitcompra = cast(:vlrbaseipiitcompra * ( :percipiitcompra / 100 ) as decimal(15,2));

-- **** Calculo dos tributos ***

    -- Se produto for isento de ICMS
    if (:tipofisc = 'II') then
    begin
        vlrisentasitcompra = :vlrliqitcompra;
        vlrbaseicmsitcompra = 0;
        percicmsitcompra = 0;
        vlricmsitcompra = 0;
        vlroutrasitcompra = 0;
    end
    -- Se produto for de Substituio Tributria
    else if (:tipofisc = 'FF') then
    begin
        if (:tipost = 'SI' ) then -- Contribuinte Substitudo
        begin
            vlroutrasitcompra = :vlrliqitcompra;
            vlrbaseicmsitcompra = 0;
            percicmsitcompra = 0;
            vlricmsitcompra = 0;
            vlrisentasitcompra = 0;
        end
        else if (:tipost = 'SU' ) then -- Contribuinte Substituto
        begin

            if( (:percicmsst is null) or (:percicmsst=0) ) then
            begin
                select coalesce(percicmsintra,0) from lfbuscaicmssp (:codnat,:uffor,:codemp,:codfilial)
                into :percicmsst;
            end

            if(percred>0 and redbaseicmsst='S') then
            begin
            -- Quando h reduo na base do icms st , deve usar o valor da base do icms proprio como parametro
               vlrbaseicmsstitcompra = cast((  (coalesce(:margemvlagr,0) + 100) / 100 )  * (  (coalesce(:vlrbaseicmsitcompra,0) ) + (coalesce(:vlripiitcompra,0)) ) as decimal(15,2));
            end
            else
            begin
                -- Quando no h reduo na base do icms st deve usar o valor da base bruto (rem reduo)
                vlrbaseicmsstitcompra = cast((  (coalesce(:margemvlagr,0) + 100) / 100 )  * (  (coalesce(:vlrbaseicmsbrutitcompra,0) ) + (coalesce(:vlripiitcompra,0)) ) as decimal(15,2));
            end

            vlroutrasitcompra = 0;
            vlrisentasitcompra = 0;
            vlricmsstitcompra = ( (:vlrbaseicmsstitcompra * :percicmsst) / 100 ) - (:vlricmsitcompra) ;

        end
    end

    -- Se produto no for tributado e no isento

    else if (:tipofisc = 'NN') then
    begin
        vlroutrasitcompra = :vlrliqitcompra;
        vlrbaseicmsitcompra = 0;
        percicmsitcompra = 0;
        vlricmsitcompra = 0;
        vlrisentasitcompra = 0;
    end

    -- Se produto for tributado integralmente

    else if (:tipofisc = 'TT') then
    begin
        vlroutrasitcompra = 0;
        vlrisentasitcompra = 0;
    end

    -- Inserindo dados na tabela de tens de compra

    if ( :tpagrup <> 'F' ) then
    begin
        insert into cpitcompra (codemp, codfilial, codcompra, coditcompra, codempnt, codfilialnt, codnat, codemppd,
        codfilialpd, codprod, codemple, codfilialle, codlote, qtditcompra, precoitcompra, percdescitcompra,vlrdescitcompra,
        percicmsitcompra,vlrbaseicmsitcompra,vlricmsitcompra,percipiitcompra,vlrbaseipiitcompra,vlripiitcompra,vlrliqitcompra,
        vlrproditcompra,refprod, codempax,codfilialax,codalmox, codempif,codfilialif,codfisc,coditfisc
        ,vlrisentasitcompra, vlroutrasitcompra)
        values (:codemp, :codfilial, :codcompra, :coditcompra, :codemp, :codfilialnt, :codnat, :codemp,:codfilialpd, :codprod,
        :codemp, :codfilialpd, :codlote, :qtditcompra, :precoitcompra,:percdescitcompra,:vlrdescitcompra,:percicmsitcompra,:vlrbaseicmsitcompra,
        :vlricmsitcompra, :percipiitcompra, :vlrbaseipiitcompra, :vlripiitcompra, :vlrliqitcompra,:vlrproditcompra,:refprod,
        :codempax, :codfilialax, :codalmox, :codempif, :codfilialif, :codfisc, :coditfisc, :vlrisentasitcompra,:vlroutrasitcompra
        );
    end

-- Atualizando informaes de vnculo

    execute procedure cpupcomprapedsp(:codemp, :codfilial,:codcompra, :coditcompra, :codemppc, :codfilialpc, :codcomprapc, :coditcomprapc);

end
^

/* Alter (CPADICITCOMPRARECMERCSP) */
ALTER PROCEDURE CPADICITCOMPRARECMERCSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
TICKET INTEGER,
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
QTDITCOMPRA NUMERIC(15,5))
 AS
declare variable usaprecocot char(1);
declare variable codemppd integer;
declare variable codfilialpd integer;
declare variable codprod integer;
declare variable codprodant integer;
declare variable coditrecmerc integer;
declare variable codnat char(4);
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codempfr integer;
declare variable codfilialfr smallint;
declare variable codfor integer;
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable precoitcompra numeric(15,5);
declare variable aprovpreco char(1);
declare variable codemppp integer;
declare variable codfilialpp smallint;
declare variable codplanopag integer;
declare variable vlrproditcompra numeric(15,5);
declare variable qtditrecmerc numeric(15,5);
declare variable codempns integer;
declare variable codfilialns smallint;
declare variable numserietmp varchar(30);
declare variable percprecocoletacp numeric(15,5);
declare variable permititemrepcp char(1);
declare variable trocaqtd char(1);
begin
    
    -- Carregamdo variaveis
    aprovpreco = 'N';

    -- Verificando se  para buscar as quantidades
    if ( (qtditcompra is null) or (qtditcompra=0)) then
       trocaqtd = 'S';
    else 
       trocaqtd = 'N';
    
    
    -- Buscando preferncias
    select coalesce(p1.usaprecocot,'N') usaprecocot
    from sgprefere1 p1
    where p1.codemp=:codemp and p1.codfilial=:codfilial
    into :usaprecocot;
    
    -- Buscando preferncias GMS
    select coalesce(p8.percprecocoletacp,100) percprecocoletacp
    , coalesce(permititemrepcp, 'N') 
    from sgprefere8 p8
    where p8.codemp=:codemp and p8.codfilial=:codfilial
    into :percprecocoletacp, :permititemrepcp;

    -- Buscando informaes da compra
    select cp.codfilialtm, cp.codtipomov,
    cp.codempfr, cp.codfilialfr, cp.codfor,
    cp.codemppg, cp.codfilialpg, cp.codplanopag
    from cpcompra cp
    where cp.codemp=:codempcp and cp.codfilial=:codfilialcp and cp.codcompra=:codcompra
    into :codfilialtm,  :codtipomov, :codempfr, :codfilialfr, :codfor, :codemppp, :codfilialpp, :codplanopag;

    for select ir.codemppd, ir.codfilialpd, ir.codprod, ir.coditrecmerc, ir.qtditrecmerc,
        ir.codempns, ir.codfilialns, ir.numserie
        from eqitrecmerc ir
        where
        ir.codemp=:codemp and ir.codfilial=:codfilial and ir.ticket=:ticket
        into :codemppd, :codfilialpd, :codprod, :coditrecmerc, :qtditrecmerc,
        :codempns, :codfilialns, :numserietmp
        do
        begin
            if (:trocaqtd='S') then
                 qtditcompra = 0;  
            if(:permititemrepcp='S' or :codprod <> :codprodant or :codprodant is null) then
            begin

                -- Buscando a natureza da operao
                select codnat from lfbuscanatsp(:codfilial,:codemp,:codfilialpd,:codprod,:codemp,null,null,
                :codempfr,:codfilialfr,:codfor,:codfilialtm,:codtipomov,null)
                into :codnat;

                -- Buscando informaes do produto
                select pd.codempax, pd.codfilialax, pd.codalmox from eqproduto pd
                where pd.codemp=:codemppd and pd.codfilial=:codfilialpd and pd.codprod=:codprod
                into :codempax, :codfilialax, :codalmox;

                -- Buscando preo da ultima compra
--                select custounit from eqcustoprodsp(:codemppd, :codfilialpd, :codprod,
--                cast('today' as date),'U',:codempax, :codfilialax, :codalmox,'N')
--                into :precoultcp;

                -- Se deve buscar preo de cotao.
                if( 'S' = :usaprecocot) then
                begin
                    -- Deve implementar ipi, vlrliq etc... futuramente...
                    select first 1 ct.precocot
                    from cpcotacao ct, cpsolicitacao sl, cpitsolicitacao iso
                    left outer join eqrecmerc rm on
                    rm.codemp=:codemp and rm.codfilial=:codfilial and rm.ticket=:ticket
                    where
                    iso.codemp = sl.codemp and iso.codfilial=sl.codfilial and iso.codsol=sl.codsol
                    and ct.codemp=iso.codemp and ct.codfilial=iso.codfilial and ct.codsol=iso.codsol and ct.coditsol=iso.coditsol
                    and iso.codemppd=:codemppd and iso.codfilialpd=:codfilialpd and iso.codprod=:codprod
                    and ct.codempfr=:codempfr and ct.codfilialfr=:codfilialfr and ct.codfor=:codfor
                    and (ct.dtvalidcot>=cast('today' as date) and (ct.dtcot<=cast('today' as date)))
                    and ct.sititsol not in ('EF','CA')

                    and ( (ct.rendacot = rm.rendaamostragem) or ( coalesce(ct.usarendacot,'N') = 'N') )

                    and ( (ct.codemppp=:codemppp and ct.codfilialpp=:codfilialpp and ct.codplanopag=:codplanopag)
                       or (ct.codplanopag is null))

                    order by ct.dtcot desc
                    into :precoitcompra;

                    if(:precoitcompra is not null) then
                    begin
                        -- Indica que o preo  aprovado (cotado anteriormente);
                        aprovpreco = 'S';
                    end
                end

                -- Se no conseguiu obter o preo das cotaes
                if(precoitcompra is null) then
                begin
                    -- Buscando preo de compra da tabela de custos de produtos
                    select custounit from eqcustoprodsp(:codemppd, :codfilialpd, :codprod,
                    cast('today' as date),'M',:codempax, :codfilialax, :codalmox,'N')
                    into :precoitcompra;

                end

                -- verifica se quantidade est zerada (coleta) se estiver preechida (trata-se de uma pesagem)
                if ( (qtditcompra is null) or (qtditcompra = 0) ) then 
                begin
                    qtditcompra = qtditrecmerc;
                end

                if ( ( :percprecocoletacp is not null) and (:percprecocoletacp<>100) ) then
                begin
                   precoitcompra = cast( :precoitcompra / 100 * :percprecocoletacp as decimal(15,5) ); 
                end
                 
                vlrproditcompra = :precoitcompra * qtditcompra;

                -- Inserir itens
                
                insert into cpitcompra (
                codemp, codfilial, codcompra, coditcompra,
                codemppd, codfilialpd, codprod,
                codempnt, codfilialnt, codnat,
                codempax, codfilialax, codalmox,
                qtditcompra, precoitcompra, aprovpreco, vlrproditcompra,
                codempns, codfilialns, numserietmp)
                values (:codempcp, :codfilialcp, :codcompra, :coditrecmerc,
                :codemppd, :codfilialpd, :codprod,
                :codemp,:codfilial,:codnat,
                :codempax,:codfilialax,:codalmox,
                :qtditcompra, :precoitcompra, :aprovpreco, :vlrproditcompra,
                :codempns, :codfilialns,  :numserietmp) ;

                -- Inserindo vnculo entre compra e recebimento

                insert into eqitrecmercitcp(codemp, codfilial, ticket, coditrecmerc, codempcp, codfilialcp, codcompra, coditcompra)
                values(:codemp,:codfilial,:ticket,:coditrecmerc,:codempcp,:codfilialcp,:codcompra,:coditrecmerc);

                codprodant = codprod;

            end
        end



  --  suspend;
end
^

/* Alter (CPGERADEVOLUCAOSP) */
ALTER PROCEDURE CPGERADEVOLUCAOSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODCOMPRA INTEGER,
CODITCOMPRA SMALLINT,
CODEMPVD INTEGER,
CODFILIALVD SMALLINT,
CODVENDA INTEGER,
CODITVENDA INTEGER,
TIPOVENDA CHAR(2),
QTDDEV NUMERIC(15,5))
 AS
begin

    -- Limpando vnculo anterior

    delete from cpdevolucao
    where codemp=:codemp and codfilial=:codfilial and codcompra=:codcompra
    and coditcompra=:coditcompra and codempvd=:codempvd and codfilialvd=:codfilialvd
    and codvenda=:codvenda and coditvenda=:coditvenda and tipovenda=:tipovenda;

    -- Inserindo novo vnculo de devoluo
    if(:CODCOMPRA is not null and :CODITCOMPRA is not null) then
    begin
        insert into cpdevolucao
        (codemp, codfilial, codcompra, coditcompra, qtddev,
         codempvd, codfilialvd, codvenda, tipovenda, coditvenda )
        values
        (:codemp, :codfilial, :codcompra, :coditcompra, :qtddev,
         :codempvd, :codfilialvd, :codvenda, :tipovenda, :coditvenda);
    end
  suspend;
end
^

ALTER PROCEDURE LFNOVODOCSP(SSERIE VARCHAR(5),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 RETURNS(DOC INTEGER)
 AS
declare variable iseqserie integer;
declare variable icodfilialss smallint;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP, 'LFSEQSERIE')
     INTO :ICODFILIALSS;
  DOC = NULL;
  /* Utiliza o nmero sequencial do documento da tabela LFSERIE,
    para retrocompatibilidade */
  SELECT COALESCE(SS.DOCSERIE,S.SERIE) DOCSERIE, SS.SEQSERIE
     FROM LFSERIE S
     LEFT OUTER JOIN LFSEQSERIE SS
     ON SS.CODEMP=S.CODEMP AND
        SS.CODFILIAL=S.CODFILIAL AND SS.SERIE=S.SERIE AND
        SS.CODEMPSS=:ICODEMP AND SS.CODFILIALSS=:ICODFILIALSS
     WHERE S.SERIE=:SSERIE AND S.CODEMP=:ICODEMP AND
        S.CODFILIAL=:ICODFILIAL AND SS.ATIVSERIE='S'
     INTO :DOC, :ISEQSERIE;
  IF (:ISEQSERIE IS NULL) THEN
  BEGIN
     IF (:DOC IS NULL) THEN
        DOC = 0;
     DOC = DOC + 1;
     SELECT MAX(SEQSERIE) FROM LFSEQSERIE SS
        WHERE SS.CODEMP=:ICODEMP AND SS.CODFILIAL=:ICODFILIAL AND
            SS.CODEMPSS=:ICODEMP AND SS.CODFILIALSS=:ICODFILIALSS AND
            SS.SERIE=:SSERIE INTO :ISEQSERIE;
     IF (:ISEQSERIE IS NULL) THEN
         ISEQSERIE = 1;
     INSERT INTO LFSEQSERIE (CODEMP, CODFILIAL, SERIE,
         CODEMPSS, CODFILIALSS, SEQSERIE, DOCSERIE)
     VALUES (:ICODEMP, :ICODFILIAL, :SSERIE,
         :ICODEMP, :ICODFILIALSS, :ISEQSERIE, :DOC);
  END
  ELSE
  BEGIN
    DOC = DOC + 1;
  END
  UPDATE LFSEQSERIE SET DOCSERIE=:DOC
     WHERE SERIE=:SSERIE AND CODEMP=:ICODEMP AND
     CODFILIAL=:ICODFILIAL AND CODEMPSS=:ICODEMP AND
     CODFILIALSS=:ICODFILIALSS AND SEQSERIE=:ISEQSERIE;
  SUSPEND;
END
^

/* Alter (CPGERAENTRADASP) */
ALTER PROCEDURE CPGERAENTRADASP(CODEMP INTEGER,
CODFILIAL INTEGER,
CODFILIALVD INTEGER,
TIPOVENDA CHAR,
CODVENDA INTEGER,
CITEM CHAR)
 RETURNS(CODCOMPRA INTEGER)
 AS
DECLARE VARIABLE STATUSVENDA CHAR(2);
DECLARE VARIABLE CODCLI INTEGER;
DECLARE VARIABLE CODFILIALCL INTEGER;
DECLARE VARIABLE CODFILIALCP INTEGER;
DECLARE VARIABLE CODTIPOMOV INTEGER;
DECLARE VARIABLE CODFILIALTM INTEGER;
DECLARE VARIABLE SERIE INTEGER;
DECLARE VARIABLE CODFILIALSE INTEGER;
DECLARE VARIABLE DOC INTEGER;
DECLARE VARIABLE CODFOR INTEGER;
DECLARE VARIABLE CODFILIALFR INTEGER;
DECLARE VARIABLE CODITVENDA INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'CPFORNECED') INTO CODFILIALFR;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'CPCOMPRA') INTO CODFILIALCP;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'VDCLINTE') INTO CODFILIALCL;

  SELECT ISEQ FROM SPGERANUM(:CODEMP,:CODFILIAL,'CP') INTO CODCOMPRA;

  SELECT CODCLI,CODFILIALCL,STATUSVENDA FROM VDVENDA WHERE CODVENDA=:CODVENDA AND TIPOVENDA=:TIPOVENDA
    AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL INTO CODCLI,CODFILIALCL,STATUSVENDA;
  IF (SUBSTRING (STATUSVENDA FROM 1 FOR 1) IN ('C','N') ) THEN
    EXCEPTION VDVENDAEX05;
  
  SELECT CODFOR FROM CPADICFORSP(:CODEMP,:CODFILIAL,:CODFILIALCL,:CODCLI) INTO CODFOR;

  SELECT P.CODTIPOMOV5,P.CODFILIALT5,
    T.SERIE,T.CODFILIALSE FROM SGPREFERE1 P, EQTIPOMOV T WHERE P.CODEMP=:CODEMP
    AND P.CODFILIAL=:CODFILIAL AND T.CODTIPOMOV=P.CODTIPOMOV5 AND
    T.CODEMP=P.CODEMPT5 AND T.CODFILIAL=P.CODFILIALT5
    INTO CODTIPOMOV,CODFILIALTM,SERIE,CODFILIALSE;

  SELECT * FROM LFNOVODOCSP(:SERIE,:CODEMP,:CODFILIALSE) INTO DOC;

  INSERT INTO CPCOMPRA (CODEMP,CODFILIAL,CODCOMPRA,CODEMPPG,CODFILIALPG,CODPLANOPAG,
                        CODEMPFR,CODFILIALFR,CODFOR,CODEMPSE,CODFILIALSE,SERIE,
                        CODEMPTM,CODFILIALTM,CODTIPOMOV,DOCCOMPRA,DTENTCOMPRA,DTEMITCOMPRA)
                 SELECT :CODEMP,:CODFILIAL,:CODCOMPRA,CODEMPPG,CODFILIALPG,CODPLANOPAG,
                        :CODEMP,:CODFILIALFR,:CODFOR,:CODEMP,:CODFILIALSE,:SERIE,
                        CODEMP,:CODFILIALTM,:CODTIPOMOV,:DOC,DTSAIDAVENDA,DTEMITVENDA FROM
                        VDVENDA WHERE CODEMP=:CODEMP AND CODFILIAL=:CODFILIALVD AND
                        CODVENDA=:CODVENDA AND TIPOVENDA=:TIPOVENDA;
  IF (CITEM = 'S') THEN
    EXECUTE PROCEDURE CPGERAITENTRADASP(:CODEMP,:CODFILIALCP,:CODCOMPRA,:CODFILIALVD,:TIPOVENDA,:CODVENDA,NULL,NULL);
    
  UPDATE VDVENDA SET STATUSVENDA='DV' WHERE TIPOVENDA=:TIPOVENDA AND CODVENDA=:CODVENDA
    AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIALVD;
  
  SUSPEND;
END
^

/* Alter (CPGERAITENTRADASP) */
ALTER PROCEDURE CPGERAITENTRADASP(CODEMP INTEGER,
CODFILIAL INTEGER,
CODCOMPRA INTEGER,
CODFILIALVD INTEGER,
TIPOVENDA CHAR,
CODVENDA INTEGER,
CODITVENDA INTEGER,
QTDIT INTEGER)
 AS
declare variable coditcompra integer;
declare variable codfilialtm integer;
declare variable codtipomov integer;
declare variable codfilialfr integer;
declare variable codfor integer;
declare variable codnat char(4);
declare variable codfilialnt integer;
declare variable percicmsitcompra numeric(9,2);
declare variable codfilialpd integer;
declare variable codprod integer;
declare variable codfilialle integer;
declare variable codlote varchar(20);
declare variable qtditvenda numeric(18,3);
declare variable qtddevitvenda numeric(18,3);
declare variable precoitvenda numeric(18,3);
declare variable percdescitvenda numeric(15,5);
declare variable vlrdescitvenda numeric(18,3);
declare variable percicmsitvenda numeric(9,2);
declare variable vlrbaseicmsitvenda numeric(18,3);
declare variable vlricmsitvenda numeric(18,3);
declare variable percipiitvenda numeric(9,2);
declare variable vlrbaseipiitvenda numeric(18,3);
declare variable vlripiitvenda numeric(18,3);
declare variable vlrliqitvenda numeric(18,3);
declare variable vlradicitvenda numeric(18,3);
declare variable vlrfreteitvenda numeric(18,3);
declare variable vlrisentasitvenda numeric(18,3);
declare variable vlroutrasitvenda numeric(18,3);
declare variable vlrproditvenda numeric(18,3);
BEGIN
  select icodfilial from sgretfilial(:codemp,'LFNATOPER') into codfilialnt;
  select codfor,codfilialfr,codtipomov,codfilialtm from cpcompra where codcompra=:codcompra
    and codemp=:codemp and codfilial=:codfilial into
    :codfor,:codfilialfr,:codtipomov,:codfilialtm;
  for select coditvenda,codfilialpd,codprod,codfilialle,codlote,
             qtditvenda,precoitvenda,percdescitvenda,vlrdescitvenda,percicmsitvenda,
             vlrbaseicmsitvenda,vlricmsitvenda,percipiitvenda,vlrbaseipiitvenda,
             vlripiitvenda,vlrliqitvenda,vlradicitvenda,vlrfreteitvenda,vlrisentasitvenda,
             vlroutrasitvenda,vlrproditvenda,vlrproditvenda from vditvenda where
             codemp=:codemp and codfilial=:codfilialvd and codvenda=:codvenda and tipovenda=:tipovenda and
             (:coditvenda is null or coditvenda=:coditvenda)
             order by coditvenda into coditcompra,codfilialpd,codprod,codfilialle,codlote,
             qtditvenda,precoitvenda,percdescitvenda,vlrdescitvenda,percicmsitvenda,
             vlrbaseicmsitvenda,vlricmsitvenda,percipiitvenda,vlrbaseipiitvenda,
             vlripiitvenda,vlrliqitvenda,vlradicitvenda,vlrfreteitvenda,vlrisentasitvenda,
             vlroutrasitvenda,vlrproditvenda,vlrproditvenda do
  begin
      if (qtdit is null) then
        qtdit = qtditvenda;
      select sum(qtddev) from cpcompravenda where tipovenda=:tipovenda
        and codvenda=:codvenda and coditvenda=:coditvenda
        and codemp=:codemp and codfilial=:codfilial into qtddevitvenda;
      if (qtdit > qtditvenda or qtdit+qtddevitvenda > qtditvenda) then
        exception vdvendaex01 'O ITEM: '||cast(coditvenda as char(3))||' DO PEDIDO: '||
          cast(codvenda as char(6))||' JA FOI DEVOLVIDO!';
        
      select codnat from lfbuscanatsp (:codfilial,:codemp,:codfilialpd,:codprod,null,null,null,
                                   :codemp,:codfilialfr,:codfor,:codfilialtm,:codtipomov,null) into codnat;

      insert into cpitcompra (codemp,codfilial,codcompra,coditcompra,codemppd,codfilialpd,codprod,
                              codemple,codfilialle,codlote,codempnt,codfilialnt,codnat,qtditcompra,
                              precoitcompra,percdescitcompra,vlrdescitcompra,percicmsitcompra,
                              vlrbaseicmsitcompra,vlricmsitcompra,percipiitcompra,vlrbaseipiitcompra,
                              vlripiitcompra,vlrliqitcompra,vlradicitcompra,vlrfreteitcompra,
                              vlrisentasitcompra,vlroutrasitcompra,vlrproditcompra,custoitcompra)
                       values (:codemp,:codfilial,:codcompra,:coditcompra,:codemp,:codfilialpd,:codprod,
                              :codemp,:codfilialle,:codlote,:codemp,:codfilialnt,:codnat,:qtdit,
                              :precoitvenda,:percdescitvenda,:vlrdescitvenda,:percicmsitvenda,
                              :vlrbaseicmsitvenda,:vlricmsitvenda,:percipiitvenda,:vlrbaseipiitvenda,
                              :vlripiitvenda,:vlrliqitvenda,:vlradicitvenda,:vlrfreteitvenda,
                              :vlrisentasitvenda,:vlroutrasitvenda,:vlrproditvenda,:vlrproditvenda);

      insert into cpcompravenda(codemp,codfilial,codcompra,coditcompra,codempvd,
                                codfilialvd,tipovenda,codvenda,coditvenda,qtddev)
                       values (:codemp,:codfilial,:codcompra,:coditcompra,:codemp,
                               :codfilialvd,:tipovenda,:codvenda,:coditcompra,:qtdit);
  end
  suspend;
END
^

/* Alter (EQACERTACUSTORMASP) */
ALTER PROCEDURE EQACERTACUSTORMASP AS
DECLARE VARIABLE ICODRMA INTEGER;
DECLARE VARIABLE ICODFILIAL INTEGER;
DECLARE VARIABLE CUSTODATA NUMERIC(15,2);
DECLARE VARIABLE ICODITRMA INTEGER;
DECLARE VARIABLE ICODEMP INTEGER;
begin
   for select vw.codemp,vw.codfilial,vw.codrma, vw.coditrma, vw.custodata
   from vwtmpcustoitrma vw INTO ICODEMP,ICODFILIAL,ICODRMA,ICODITRMA,CUSTODATA
   do
   begin
      update eqitrma itr set itr.precoitrma=:CUSTODATA
      where itr.codemp=:ICODEMP AND itr.codfilial = :ICODFILIAL
      and itr.codrma = :ICODRMA and itr.coditrma=:ICODITRMA;
   END
  suspend;
end
^

/* empty dependent procedure body */
/* Clear: EQRELINVPRODSP for: EQCALCPEPSSP */
ALTER PROCEDURE EQRELINVPRODSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
CTIPOCUSTO CHAR,
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP CHAR(14),
DDTESTOQ DATE,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD CHAR(100),
CODGRUP CHAR(14),
SALDO NUMERIC(15,5),
CUSTO NUMERIC(15,5),
VLRESTOQ NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

/* Alter (EQCALCPEPSSP) */
ALTER PROCEDURE EQCALCPEPSSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
NSLDPROD NUMERIC(15,5),
DTESTOQ DATE,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(NCUSTOPEPS NUMERIC(15,5))
 AS
declare variable ncusto numeric(15,5);
declare variable nqtd numeric(15,5);
declare variable nresto numeric(15,5);
declare variable ncustotot numeric(15,5);
declare variable nsldtmp numeric(15,5);
begin
  /* procedure que retorna o clculo do custo peps */
  ncusto = 0;
  ncustotot = 0;
  nresto = 0;
  ncustopeps = 0;
  if ( (nsldprod is not null) and (nsldprod != 0) ) then
  begin
      nsldtmp = nsldprod;
      for select coalesce(mp.qtdmovprod,0),coalesce(mp.precomovprod,0)
        from eqmovprod mp, eqtipomov tm
         where mp.codemppd=:icodemp and mp.codfilialpd=:scodfilial and mp.codprod=:icodprod and
           mp.codemptm=tm.codemp and mp.codfilialtm=tm.codfilial and mp.codtipomov=tm.codtipomov and
           mp.tipomovprod in ('E','I') and tm.tipomov in ('IV','CP','PC') and
           mp.dtmovprod<=:dtestoq  and
           ( (:icodalmox is null) or
             (mp.codempax=:icodempax and mp.codfilialax=:scodfilialax and
             mp.codalmox=:icodalmox)
           )
         order by mp.codprod desc, mp.dtmovprod desc, mp.codmovprod desc
         into :nqtd,:ncusto do
      begin
         nresto = nsldtmp - nqtd;
         if (nresto<=0) then
         begin
           ncustotot = ncustotot + (ncusto * (nqtd+nresto) );
           break;
         end
         else
         begin
           ncustotot = ncustotot + (ncusto * nqtd);
           nsldtmp = nsldtmp - nqtd;
         end
      end
      if( (:nsldprod is not null and :nsldprod>0) and (:ncustotot is not null and :ncustotot>0) ) then
          ncustopeps = ncustotot / nsldprod;
      else
          ncustopeps = 0;
  end
  suspend;
end
^

/* Alter (EQCOPIAPROD) */
ALTER PROCEDURE EQCOPIAPROD(ICODPROD INTEGER,
ICODEMP INTEGER,
ICODFILIAL INTEGER)
 RETURNS(ICOD INTEGER)
 AS
declare variable inovocod integer;
BEGIN
  SELECT MAX(CODPROD)+1 FROM EQPRODUTO
    WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO INOVOCOD;
  INSERT INTO EQPRODUTO
      (CODPROD,CODEMP,CODFILIAL,DESCPROD,REFPROD,CODEMPAX,
      CODFILIALAX,CODALMOX,CODEMPMA,CODFILIALMA,CODMOEDA,CODEMPUD,
      CODFILIALUD,CODUNID,CODEMPFC,CODFILIALFC,CODFISC,CODEMPMC,
      CODFILIALMC,CODMARCA,DESCAUXPROD,TIPOPROD,CVPROD,CODEMPGP,
      CODFILIALGP,CODGRUP,CODBARPROD,CLOTEPROD,CODFABPROD,
      COMISPROD,PESOLIQPROD,PESOBRUTPROD,QTDMINPROD,QTDMAXPROD,
      PRECOBASEPROD,ATIVOPROD,DESCCOMPPROD)
    SELECT :INOVOCOD,:ICODEMP,:ICODFILIAL,DESCPROD,:INOVOCOD,CODEMPAX,
      CODFILIALAX,CODALMOX,CODEMPMA,CODFILIALMA,CODMOEDA,CODEMPUD,
      CODFILIALUD,CODUNID,CODEMPFC,CODFILIALFC,CODFISC,CODEMPMC,
      CODFILIALMC,CODMARCA,DESCAUXPROD,TIPOPROD,CVPROD,CODEMPGP,
      CODFILIALGP,CODGRUP,CODBARPROD,CLOTEPROD,CODFABPROD,COMISPROD,
      PESOLIQPROD,PESOBRUTPROD,QTDMINPROD,QTDMAXPROD,PRECOBASEPROD,
      ATIVOPROD,DESCCOMPPROD FROM
      EQPRODUTO WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND
      CODPROD=:ICODPROD;

    INSERT INTO VDPRECOPROD (CODEMP,CODFILIAL,CODPROD,CODPRECOPROD,
        CODEMPTB,CODFILIALTB,CODTAB,CODEMPCC,CODFILIALCC,CODCLASCLI,
        CODEMPPG,CODFILIALPG,CODPLANOPAG,PRECOPROD)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODPRECOPROD,
        CODEMPTB,CODFILIALTB,CODTAB,CODEMPCC,CODFILIALCC,CODCLASCLI,
        CODEMPPG,CODFILIALPG,CODPLANOPAG,PRECOPROD FROM VDPRECOPROD
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND
          CODPROD=:ICODPROD;

    INSERT INTO EQFATCONV (CODEMP,CODFILIAL,CODPROD,CODUNID,FATCONV)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODUNID,FATCONV FROM EQFATCONV
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODPROD=:ICODPROD;

    INSERT INTO CPPRODFOR (CODEMP,CODFILIAL,CODPROD,CODFOR,REFPRODFOR)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODFOR,REFPRODFOR FROM CPPRODFOR
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODPROD=:ICODPROD;
        
    /* se for outro produto o lote provavelmente ser outro tambm */
    /*INSERT INTO EQLOTE (CODEMP,CODFILIAL,CODPROD,CODLOTE,VENCTOLOTE,
        SLDLOTE,SLDRESLOTE,SLDCONSIGLOTE,SLDLIQLOTE,DINILOTE)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODLOTE,VENCTOLOTE,
        SLDLOTE,SLDRESLOTE,SLDCONSIGLOTE,SLDLIQLOTE,DINILOTE FROM EQLOTE
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODPROD=:ICODPROD;*/
        
    INSERT INTO VDFOTOPROD (CODEMP,CODFILIAL,CODPROD,CODFOTOPROD,DESCFOTOPROD,
        TIPOFOTOPROD,LARGFOTOPROD,ALTFOTOPROD,FOTOPROD)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODFOTOPROD,DESCFOTOPROD,
        TIPOFOTOPROD,LARGFOTOPROD,ALTFOTOPROD,FOTOPROD FROM VDFOTOPROD
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODPROD=:ICODPROD;
   ICOD = INOVOCOD;
   SUSPEND;
END
^

/* Alter (EQCUSTOPRODSP) */
ALTER PROCEDURE EQCUSTOPRODSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
DTESTOQ DATE,
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CCOMSALDO CHAR(10))
 RETURNS(SLDPROD NUMERIC(15,5),
CUSTOUNIT NUMERIC(15,5),
CUSTOTOT NUMERIC(15,5))
 AS
declare variable precobase numeric(15,5);
declare variable custompm numeric(15,5);
begin
   /* Retorna o custo unitrio do produto */
   if (ctipocusto is null) then
      ctipocusto = 'P';
   select p.precobaseprod from eqproduto p
   where p.codemp = :icodemp and p.codfilial = :scodfilial and p.codprod=:icodprod
   into :precobase;
   -- Se o almoxarifado no for selecionado, deve buscar o saldo geral
   if(:icodalmox is null) then
   begin
      -- execute procedure sgdebugsp 'eqcustoprosp','inicio do custo por almoxarifado';
      -- execute procedure sgdebugsp 'custo', 'Iniciou consulta movprod almoxarifado nulo';
      select first 1 m.sldmovprod, m.custompmmovprod
      from eqmovprod m
      where m.codemppd=:icodemp and m.codfilial=:scodfilial and m.codprod=:icodprod and m.dtmovprod<=:dtestoq
      order by m.codprod desc, m.dtmovprod desc, m.codmovprod desc
      into :sldprod, :custompm;
      -- execute procedure sgdebugsp 'custo', 'Finalizou consulta movprod almoxarifado nulo';
      -- execute procedure sgdebugsp 'eqcustoprosp','aps custo mpm';
    end
    else
    begin
       -- execute procedure sgdebugsp 'eqcustoprosp','inicio do custo geral';
       -- execute procedure sgdebugsp 'custo', 'Iniciou consulta movprod almoxarifado '||:icodalmox;
        select first 1 m.sldmovprodax, m.custompmmovprod
        from eqmovprod m
        where m.codemppd=:icodemp and m.codfilial=:scodfilial and m.codprod=:icodprod and m.dtmovprod<=:dtestoq
        and m.codempax=:icodempax and m.codfilial=:scodfilialax and m.codalmox=:icodalmox
        order by m.codprod desc, m.dtmovprod desc, m.codmovprod desc
        into :sldprod, :custompm;
        --execute procedure sgdebugsp 'custo', 'Finalizou consulta movprod almoxarifado '||:icodalmox;
        -- execute procedure sgdebugsp 'eqcustoprosp','aps o custo geral';
    end
    custounit = 0;
    custotot = 0;
    if (sldprod is null) then
        sldprod = 0;
    if ( (sldprod!=0) or (ccomsaldo!='S') ) THEN
    begin
       -- custo peps
       if (ctipocusto='P') then
       begin
          --execute procedure sgdebugsp 'custo', 'iniciou calcpeps';
          select ncustopeps from eqcalcpepssp(:icodemp,:scodfilial,:icodprod,
          :sldprod,:dtestoq, :icodempax, :scodfilialax, :icodalmox)
          into :custounit;
          -- execute procedure sgdebugsp 'custo', 'finalizou calcpeps';
         if (custounit!=0) then
             custotot = custounit*sldprod;
             --  execute procedure sgdebugsp 'eqcustoprosp','aps custo peps';
       end
       -- custo mpm
       else if (ctipocusto='M') then
       begin
          custounit = custompm;
          if (custounit is null) then
             custounit = 0;
          custotot = custounit*sldprod;
          -- execute procedure sgdebugsp 'eqcustoprosp','aps custo mpm';
       end
       -- preo base
       else if (ctipocusto='B') then
       begin
          custounit = precobase;
          if (custounit is null) then
             custounit = 0;
           custotot = custounit*sldprod;
           --    execute procedure sgdebugsp 'eqcustoprosp','aps precobase';
       end
       -- preo da ultima compra
       else if (ctipocusto='U') then
       begin
          -- execute procedure sgdebugsp 'custo', 'iniciou custo da ultima compra';
          select first 1 ic.custoitcompra from cpitcompra ic, cpcompra cp
            where cp.codemp=:icodemp and cp.codfilial=:scodfilial and cp.dtentcompra<=:dtestoq
            and ic.codemp=cp.codemp and ic.codfilial=cp.codfilial and ic.codcompra=cp.codcompra
            and ic.codemppd=:icodemp and ic.codfilialpd=:scodfilial and ic.codprod=:icodprod
            and ( (:icodalmox is null) or ( ic.codempax=:icodempax and ic.codfilial=:scodfilialax and ic.codalmox=:icodalmox) )
            order by cp.dtentcompra desc
            into :custounit;
          -- execute procedure sgdebugsp 'custo', 'finalizou custo da ultima compra';
          if (custounit is null) then
              custounit = :custompm;
         -- execute procedure sgdebugsp 'eqcustoprosp','aps ltima compra';
       end
   end
   suspend;
end
^

ALTER PROCEDURE EQPRODUTOSP01(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
DTPESQ DATE)
 RETURNS(NSALDO NUMERIC(15,5),
NSALDOAX NUMERIC(15,5),
NCUSTOMPM NUMERIC(15,5),
NCUSTOPEPS NUMERIC(15,5),
NCUSTOMPMAX NUMERIC(15,5),
NCUSTOPEPSAX NUMERIC(15,5),
NCUSTOINFO NUMERIC(15,5),
NCUSTOUC NUMERIC(15,5))
 AS
declare variable ddtmovprod date;
declare variable ddtmovprodax date;
begin

    if (:dtpesq is null) then
    begin
       dtpesq = cast('now' as date);
    end
    /* Procedure que retorna saldos e custos para a tela de cadastro de produtos */
    select first 1 mp.dtmovprod, mp.sldmovprod , mp.custompmmovprod
    from eqmovprod mp
    where mp.codemppd=:icodemp and mp.codfilialpd=:scodfilial and mp.codprod=:icodprod
    and mp.dtmovprod<=:dtpesq
    order by mp.dtmovprod desc, mp.codmovprod desc
    into :ddtmovprod, :nsaldo, :ncustompm;

    select first 1 mp.dtmovprod, mp.sldmovprodax, mp.custompmmovprodax
    from eqmovprod mp
    where mp.codemppd=:icodemp and mp.codfilialpd=:scodfilial and mp.codprod=:icodprod
    and mp.dtmovprod<=:dtpesq
    order by mp.dtmovprod desc, mp.codmovprod desc
    into :ddtmovprodax, :nsaldoax, :ncustompmax;

    select p.ncustopeps  from eqcalcpepssp(:icodemp, :scodfilial,
    :icodprod, :nsaldo, :ddtmovprod, null, null, null ) p
    into :ncustopeps;

    select p.ncustopeps  from eqcalcpepssp(:icodemp, :scodfilial,
    :icodprod, :nsaldo, :ddtmovprodax, :icodempax, :scodfilialax,
    :icodalmox ) p
    into :ncustopepsax;

    select p.custoinfoprod from eqproduto p
    where p.codemp=:icodemp and p.codfilial=:scodfilial and p.codprod=:icodprod
    into :ncustoinfo;

    select custounit from eqcustoprodsp(:icodemp, :scodfilial, :icodprod,
    :dtpesq,'U',:icodempax, :scodfilialax, :icodalmox, 'N' )
    into :ncustouc;

    if(:ncustompm is null) then
    begin
        ncustompm = :ncustoinfo;
    end

    if(:ncustopeps is null) then
    begin
        ncustopeps = :ncustoinfo;
    end

    suspend;

end
^

/* Alter (EQGERARMAOSSP) */
ALTER PROCEDURE EQGERARMAOSSP(CODEMPRM INTEGER,
CODFILIALRM INTEGER,
TICKET INTEGER,
CODITRECMERC SMALLINT)
 RETURNS(CODRMA INTEGER)
 AS
declare variable coditos smallint;
declare variable idusu1 varchar(128);
declare variable codfilialrma smallint;
declare variable codfilialpd smallint;
declare variable coditrma integer;
declare variable refprod varchar(20);
declare variable codtipomov1 integer;
declare variable codccusu1 char(19);
declare variable codfilialccusu1 smallint;
declare variable codfilialtm1 smallint;
declare variable codfilialtm smallint;
declare variable codemppd integer;
declare variable codprod integer;
declare variable codfilialle smallint;
declare variable custompmit numeric(15,5);
declare variable codlote varchar(20);
declare variable codalmox integer;
declare variable qtd numeric(15,2);
declare variable codfilialax smallint;
declare variable codfilialusu1 smallint;
declare variable anoccusu1 smallint;
declare variable statusaprovrmager char(2) = 'PE';
declare variable statusrmager char(2);
declare variable qtdaprov numeric(15,5) = 0;
begin


    -- buscando centro de custo do usurio atual
    select codfilialusu,codfilialccusu,codccusu,anoccusu,idusus
    from sgretinfousu(:codemprm, user)
    into :CODFILIALUSU1,:CODFILIALCCUSU1,:CODCCUSU1,:ANOCCUSU1,:IDUSU1;

    -- Buscando filial da rma
    SELECT ICODFILIAL FROM sgretfilial(:CODEMPRM,'EQRMA')
    into :codfilialrma;

    -- Buscando filial do lote
    SELECT ICODFILIAL FROM sgretfilial(:CODEMPRM,'EQLOTE')
    into :codfilialle;

    -- Buscando filial do tipo de movimento
    SELECT ICODFILIAL FROM sgretfilial(:CODEMPRM,'EQTIPOMOV')
    into :codfilialtm;

    -- buscando tipo de movimento para RMA
    select codfilialt8,codtipomov8 from sgprefere1
    where codemp=:codemprm and codfilial=:codfilialrm
    into :codfilialtm1,:codtipomov1;

    -- Buscado a situao pardro para RMA
    select coalesce(SITRMAOP,'PE') from sgprefere5 where codemp=:codemprm and
    codfilial=(select icodfilial from sgretfilial(:codemprm,'SGPREFERE5'))
    into :statusrmager;

    if(:statusrmager is null) then
    begin
       statusrmager = 'PE';
    end

    -- Carregando quantidade aprovada...
    QTDAPROV = 0;
    STATUSAPROVRMAGER = 'PE';

    -- Buscando cdigo novo cdigo de RMA.
    select coalesce((max(codrma)+1),1) from
    eqrma where codemp=:codemprm and codfilial=:codfilialrma
    into :codrma;

    -- Inserindo nova RMA
    insert into eqrma (codemp,codfilial,codrma,
                     codempuu,codfilialuu,idusu,
                     codempua,codfilialua,idusuaprov,
                     codempue,codfilialue,idusuexp,
                     codemptm,codfilialtm,codtipomov,
                     codempcc,codfilialcc,anocc,codcc,
                     dtareqrma,dtaaprovrma,dtaexprma,
                     sitrma,sitaprovrma,sitexprma,
                     codempos,codfilialos,ticket,coditrecmerc,motivorma)
                     values
                     (:codemprm,:codfilialrma,:codrma,
                      :codemprm, :codfilialusu1,:idusu1,
                      null,null,null,
                      null,null,null,
                      :codemprm, :codfilialtm1, :codtipomov1,
                      :codemprm,:codfilialccusu1,:anoccusu1,:codccusu1,
                      cast('now' AS DATE),null,null,
                      :STATUSRMAGER,:STATUSAPROVRMAGER,'PE',
                      :codemprm,:codfilialrm,:ticket,:coditrecmerc,
                      'REQUISIO GERADA PARA ATENDIMENTO  OS:'|| :ticket
    );

    -- Loop nos itens de Ordem de Servio.

    for select os.coditrecmerc, os.coditos, os.codemppd, os.codfilialpd, os.refprodpd, os.codprodpd, os.qtditos,
    (select ncustompm from eqprodutosp01(os.codemppd, os.codfilialpd, os.codprodpd,null,null,null, cast('now' as date))) custompmit
    from eqitrecmercitos os
    where os.codemp=:codemprm and os.codfilial=:codfilialrm and os.ticket=:ticket
--    and ( (os.coditrecmerc=:coditrecmerc) or (:coditrecmerc is null) )
    and os.gerarma='S'
    into :coditrecmerc, :coditos, :codemppd, :codfilialpd, :refprod, :codprod, :qtd, :custompmit
    do

    begin

       select coalesce((max(coditrma)+1),1) from eqitrma
       where codemp=:codemprm and codfilial=:codfilialrma and codrma=:codrma
       into :coditrma;

       if(:statusrmager='AF') then
       begin
         STATUSAPROVRMAGER = 'AT';
         QTDAPROV = :qtd;
       end

       insert into eqitrma (CODEMP,CODFILIAL,CODRMA,CODITRMA,
                            CODEMPPD,CODFILIALPD,CODPROD,REFPROD,
                            QTDITRMA,QTDAPROVITRMA,QTDEXPITRMA,PRECOITRMA,
                            CODEMPLE,CODFILIALLE,CODLOTE,
                            CODEMPAX,CODFILIALAX,CODALMOX,
                            SITITRMA,SITAPROVITRMA,SITEXPITRMA,
                            CODEMPOS,CODFILIALOS,TICKET,CODITRECMERC,CODITOS
                            )
                            values
                            (:codemprm,:codfilialrma,:codrma, :coditrma,
                            :codemprm,:codfilialpd,
                            :codprod, :refprod, :qtd, :qtdaprov, 0, :custompmit, :codemprm,
                            :codfilialle,:codlote,
                            :codemprm,:codfilialax,:codalmox,
                            :statusrmager,:statusaprovrmager,'PE',
                            :codemprm, :codfilialrm, :ticket, :coditrecmerc,:coditos
                            );

        update eqitrecmercitos os set os.gerarma='N', os.statusitos='EC'
        where os.codemp=:codemprm and os.codfilial=:codfilialrm and os.ticket=:ticket
        and os.coditrecmerc=:coditrecmerc and os.coditos=:coditos;

        suspend;

   end
end
^

/* Alter (EQGERARMASP) */
ALTER PROCEDURE EQGERARMASP(CODEMPOP INTEGER,
CODFILIALOP INTEGER,
CODOP INTEGER,
SEQOP SMALLINT)
 AS
declare variable seqof smallint;
declare variable idusu1 char(8);
declare variable seqitop integer;
declare variable coditrma integer;
declare variable refprod varchar(20);
declare variable codrma integer;
declare variable codtipomov1 integer;
declare variable codccusu1 char(19);
declare variable codfilialccusu1 smallint;
declare variable codfilialpd smallint;
declare variable codfilialtm1 smallint;
declare variable codprod integer;
declare variable codfilialle smallint;
declare variable custompmit numeric(15,5);
declare variable codlote varchar(20);
declare variable codalmox integer;
declare variable qtd numeric(15,2);
declare variable codfilialax smallint;
declare variable codfilialusu1 smallint;
declare variable anoccusu1 smallint;
declare variable statusaprovrmager char(2) = 'PE';
declare variable statusrmager char(2);
declare variable codfilialfase smallint;
declare variable qtdaprov numeric(15,5) = 0;
declare variable codfase integer;
declare variable codempos integer;
declare variable codfilialos smallint;
declare variable ticket integer;
declare variable coditrecmerc integer;
declare variable coditos integer;
begin

    -- Buscando informaes do usurio
    select codfilialusu,codfilialccusu,codccusu,anoccusu,idusus
    from sgretinfousu(:codempop, user)
    into :CODFILIALUSU1,:CODFILIALCCUSU1,:CODCCUSU1,:ANOCCUSU1,:IDUSU1;

    -- Buscando preferencias de tipo de movimento para OP
    select codfilialt8,codtipomov8
    from sgprefere1 where codemp=:CODEMPOP and codfilial=(select icodfilial from sgretfilial(:CODEMPOP, 'SGPREFERE1'))
    into :CODFILIALTM1,:CODTIPOMOV1;

    --Buscando informaes da OP.
    select op.codempos, op.codfilialos, op.ticket, op.coditrecmerc, op.coditos
    from  ppop op
    where op.codemp=:codempop and op.codfilial=:codfilialop and op.codop=:codop and op.seqop=:seqop
    into :codempos, :codfilialos, :ticket, :coditrecmerc, :coditos;

    -- Buscando preferencias para gerao de RMA
    select coalesce(SITRMAOP,'PE') from sgprefere5 where codemp=:CODEMPOP and
    codfilial=(select icodfilial from sgretfilial(:CODEMPOP,'SGPREFERE5'))
    into :STATUSRMAGER;

    QTDAPROV = 0;
    STATUSAPROVRMAGER = 'PE';

    for select codfilialfs,codfase,seqof from ppopfase opf
        where opf.codemp=:CODEMPOP and opf.codfilial=:CODFILIALOP and
        opf.codop=:CODOP and  opf.seqop=:SEQOP and
        (select count(1) from ppitop it
        where it.codemp=:CODEMPOP and it.codfilial=:CODFILIALOP and
        it.codempfs=opf.codempfs and it.codfilialfs=opf.codfilialfs and
        it.codfase=opf.codfase and it.gerarma='S' and
        it.codop=:CODOP and it.seqop=:SEQOP) > 0
        into :codfilialfase,:codfase,:SEQOF do
    begin
        select coalesce((max(codrma)+1),1)
        from eqrma
        where codemp=:CODEMPOP and codfilial=:CODFILIALOP into :CODRMA;

        insert into eqrma (codemp,codfilial,codrma,
                     codempuu,codfilialuu,idusu,
                     codempua,codfilialua,idusuaprov,
                     codempue,codfilialue,idusuexp,
                     codemptm,codfilialtm,codtipomov,
                     codempcc,codfilialcc,anocc,codcc,
                     dtareqrma,dtaaprovrma,dtaexprma,
                     sitrma,sitaprovrma,sitexprma,
                     codempof,codfilialof,codop,seqop,seqof,
                     motivorma, codempos, codfilialos, ticket, coditrecmerc)
                     values
                     (:CODEMPOP,(SELECT ICODFILIAL FROM sgretfilial(:CODEMPOP,'EQRMA')),:CODRMA,
                      :CODEMPOP, :CODFILIALUSU1,:IDUSU1,
                      null,null,null,
                      null,null,null,
                      :CODEMPOP,(SELECT ICODFILIAL FROM sgretfilial(:CODEMPOP,'EQTIPOMOV')),
                      :CODTIPOMOV1,
                      :CODEMPOP,:CODFILIALCCUSU1,:ANOCCUSU1,:CODCCUSU1,
                      cast('now' AS DATE),null,null,
                      :STATUSRMAGER,:STATUSAPROVRMAGER,'PE',
                      :CODEMPOP,:CODFILIALOP,:CODOP,:SEQOP,:SEQOF,
                      'REQUISIO GERADA PARA ATENDIMENTO  OP:'||:CODOP||' SEQ:'||:SEQOP||' - FASE:'||:CODFASE,
                      :codempos, :codfilialos, :ticket, :coditrecmerc
        );

        for select it.seqitop,it.codfilialpd,it.codprod,it.refprod,it.qtditop-coalesce(it.qtdcopiaitop,0),it.codfilialle,it.codlote,
            (select ncustompm from eqprodutosp01(it.codemppd,it.codfilialpd,it.codprod,null,null,null, cast('now' as date))),
            (SELECT CODFILIALAX FROM EQPRODUTO WHERE CODEMP=it.codemppd and codfilial=it.codfilialpd and codprod=it.codprod),
            (SELECT CODALMOX FROM EQPRODUTO WHERE CODEMP=it.codemppd and codfilial=it.codfilialpd and codprod=it.codprod)
            from ppitop it, eqproduto pd
            where
            pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and pd.codprod=it.codprod
            and it.codemp=:CODEMPOP and it.codfilial=:CODFILIALOP
            and it.codop=:CODOP and it.seqop=:SEQOP and it.codempfs=:CODEMPOP
            and it.codfilialfs=:CODFILIALFASE
            and it.codfase = :CODFASE and it.gerarma='S'
            and (('S'=(select ratauto from sgprefere5 where codemp=it.codemp and codfilial=it.codfilial))
            and (it.qtditop-coalesce(it.qtdcopiaitop, 0))<=(SELECT L.SLDLOTE FROM EQLOTE L
                                                            WHERE L.CODEMP=it.codemple AND L.CODFILIAL=it.codfilialle AND
                                                            L.CODPROD=it.codprod AND L.CODLOTE=it.codlote)
            or pd.cloteprod = 'N'
                                                            )
            into :SEQITOP, :CODFILIALPD,:CODPROD,:REFPROD,:QTD,
            :CODFILIALLE,:CODLOTE,:CUSTOMPMIT,:CODFILIALAX,:CODALMOX  DO
        begin
            select coalesce((max(coditrma)+1),1) from eqitrma
            where codemp=:CODEMPOP and codfilial=:CODFILIALOP and
            codrma=:CODRMA into :coditrma;

            if(:STATUSRMAGER='AF')then
            begin
                STATUSAPROVRMAGER = 'AT';
                QTDAPROV = :QTD;
            end

            insert into eqitrma (CODEMP,CODFILIAL,CODRMA,CODITRMA,
                            CODEMPPD,CODFILIALPD,CODPROD,REFPROD,
                            QTDITRMA,QTDAPROVITRMA,QTDEXPITRMA,PRECOITRMA,
                            CODEMPLE,CODFILIALLE,CODLOTE,
                            CODEMPAX,CODFILIALAX,CODALMOX,
                            SITITRMA,SITAPROVITRMA,SITEXPITRMA,
                            codempos, codfilialos, ticket, coditrecmerc, coditos
                            )
                            values
                            (:CODEMPOP,(SELECT ICODFILIAL FROM sgretfilial(:CODEMPOP,'EQITRMA')),:CODRMA,
                            :coditrma,
                            :CODEMPOP,(SELECT ICODFILIAL FROM sgretfilial(:CODEMPOP,'EQPRODUTO')),
                            :CODPROD,:REFPROD,:QTD,:QTDAPROV,0,:CUSTOMPMIT,:CODEMPOP,(SELECT ICODFILIAL FROM sgretfilial(:CODEMPOP,'EQLOTE')),:CODLOTE,
                            :CODEMPOP,:CODFILIALAX,:CODALMOX,
                            :STATUSRMAGER,:STATUSAPROVRMAGER,'PE',
                            :codempop, :codfilialos, :ticket, :coditrecmerc, :coditos
                            );

            update ppitop it set it.gerarma='N' where it.CODEMP=:CODEMPOP AND
                it.CODFILIAL=:CODFILIALOP AND
                it.codop=:CODOP and it.seqop=:SEQOP and it.seqitop=:seqitop;

        end

    end

    suspend;

end
^

/* Alter (EQMOVPRODATEQSP) */
ALTER PROCEDURE EQMOVPRODATEQSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLEOLD INTEGER,
SCODFILIALLEOLD SMALLINT,
CCODLOTEOLD VARCHAR(20),
ICODEMPLENEW INTEGER,
SCODFILIALLENEW SMALLINT,
CCODLOTENEW VARCHAR(20),
SOPERADOR SMALLINT,
NQTDMOVPRODOLD NUMERIC(15,5),
NQTDMOVPRODNEW NUMERIC(15,5),
ICODEMPAXOLD INTEGER,
SCODFILIALAXOLD SMALLINT,
ICODALMOXOLD INTEGER,
ICODEMPAXNEW INTEGER,
SCODFILIALAXNEW SMALLINT,
ICODALMOXNEW INTEGER)
 AS
DECLARE VARIABLE CCLOTEPROD CHAR(1);
DECLARE VARIABLE ICODALMOX INTEGER;
DECLARE VARIABLE ICODEMPAX INTEGER;
DECLARE VARIABLE SCODFILIALAX SMALLINT;
begin
  /* Procedure de atualizao do estoque */
  UPDATE EQPRODUTO SET SLDPROD = SLDPROD+((:NQTDMOVPRODNEW-:NQTDMOVPRODOLD)*:SOPERADOR)
            WHERE CODPROD=:ICODPROD AND CODEMP=:ICODEMPPD AND CODFILIAL=:SCODFILIALPD;

  SELECT CLOTEPROD, CODALMOX,CODEMPAX,CODFILIALAX FROM EQPRODUTO
     WHERE CODPROD = :ICODPROD AND CODEMP=:ICODEMPPD AND CODFILIAL = :SCODFILIALPD
      INTO :CCLOTEPROD, :ICODALMOX, :ICODEMPAX, :SCODFILIALAX;

  EXECUTE PROCEDURE EQSALDOPRODATEQSP(:ICODEMPPD, :SCODFILIALPD, :ICODPROD, :SOPERADOR,
   :NQTDMOVPRODOLD, :NQTDMOVPRODNEW, :ICODEMPAXOLD, :SCODFILIALAXOLD, :ICODALMOXOLD,
   :ICODEMPAXNEW, :SCODFILIALAXNEW, :ICODALMOXNEW);

  IF (CCLOTEPROD = 'S') THEN
  BEGIN
    IF (CCODLOTENEW IS NULL) THEN
    BEGIN
      EXCEPTION EQPRODUTOEX01 'ESTE MOVIMENTO PRECISA DE UM LOTE!';
    END
    ELSE
    BEGIN
       EXECUTE PROCEDURE EQSALDOLOTEATEQSP(:ICODEMPLEOLD, :SCODFILIALLEOLD, :ICODPROD, :CCODLOTEOLD,
          :ICODEMPLENEW, :SCODFILIALLENEW, :CCODLOTENEW, :SOPERADOR, :NQTDMOVPRODOLD, :NQTDMOVPRODNEW,
          :ICODEMPAXOLD, :SCODFILIALAXOLD, :ICODALMOXOLD, :ICODEMPAXNEW, :SCODFILIALAXNEW, :ICODALMOXNEW);
    END
  END

  suspend;
end
^

/* Alter (EQMOVPRODCKCPSP) */
ALTER PROCEDURE EQMOVPRODCKCPSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODCOMPRA INTEGER,
ICODINVPROD INTEGER,
DDTMOVPROD DATE,
NQTDMOVPROD NUMERIC(15,5),
NCUSTOMPMMOVPROD NUMERIC(15,5))
 RETURNS(DDTULTCPPROD DATE,
NQTDULTCPPROD NUMERIC(15,5),
DDTMPMPROD DATE,
NCUSTOMPMPROD NUMERIC(15,5))
 AS
begin
  /* Procedure para checar data da ltima compra */
  NCUSTOMPMPROD = 0;
  if (NCUSTOMPMMOVPROD IS NULL) then
     NCUSTOMPMMOVPROD = 0;
  if ( (ICODINVPROD IS NOT NULL) OR (ICODCOMPRA IS NOT NULL) ) then
  begin
     SELECT DTULTCPPROD,QTDULTCPPROD,DTMPMPROD, CUSTOMPMPROD FROM EQPRODUTO WHERE CODPROD=:ICODPROD
          AND CODEMP=:ICODEMPPD AND CODFILIAL = :SCODFILIALPD
          INTO :DDTULTCPPROD, :NQTDULTCPPROD, :DDTMPMPROD, :NCUSTOMPMPROD;
      if (NQTDULTCPPROD IS NULL) then
         NQTDULTCPPROD = 0;
      if (NCUSTOMPMPROD IS NULL) then
         NCUSTOMPMPROD = 0;
      if ( ICODCOMPRA IS NOT NULL ) then
      begin
         if ( (DDTMOVPROD>DDTULTCPPROD) OR (DDTULTCPPROD IS NULL) ) then
         begin
             DDTULTCPPROD = DDTMOVPROD;
             NQTDULTCPPROD = NQTDMOVPROD;
         end
      end
      if ( ( ICODINVPROD IS NOT NULL) OR (ICODCOMPRA IS NOT NULL) ) then
      begin
         if ( (DDTMOVPROD>=DDTMPMPROD OR DDTMPMPROD IS NULL) AND
              (NCUSTOMPMMOVPROD>0)  ) then
         begin
            DDTMPMPROD = DDTMOVPROD;
            NCUSTOMPMPROD = NCUSTOMPMMOVPROD;
         end
      end
  end


  suspend;
end
^

/* empty dependent procedure body */
/* Clear: EQMOVPRODIUDSP for: EQMOVPRODISP */
ALTER PROCEDURE EQMOVPRODIUDSP(CIUD CHAR,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE VARCHAR(20),
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4),
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR,
NQTDMOVPROD NUMERIC(15,5),
NPRECOMOVPROD NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
SEQSUBPROD SMALLINT,
ESTOQTIPOMOVPD CHAR,
TIPONF CHAR)
 AS
 BEGIN EXIT; END
^

/* Alter (EQMOVPRODISP) */
ALTER PROCEDURE EQMOVPRODISP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE VARCHAR(20),
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4),
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR,
NQTDMOVPROD NUMERIC(15,5),
NPRECOMOVPROD NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
SEQSUBPROD SMALLINT,
ESTOQTIPOMOVPD CHAR,
TIPONF CHAR)
 AS
declare variable scodfilial smallint;
declare variable icodmovprod integer;
declare variable cestoqmovprod char(1);
declare variable ctipomovprod char(1);
declare variable nsldmovprod numeric(15,5);
declare variable ncustompmmovprod numeric(15,5);
declare variable soperador smallint;
declare variable nsldmovprodax numeric(15,5);
declare variable ncustompmmovprodax numeric(15,5);
begin
  /* Procedure de insero na tabela eqmovprod */

  SELECT NSALDO, NCUSTOMPM, NSALDOAX, NCUSTOMPMAX FROM EQMOVPRODSLDSP(null, null, null, :ICODEMPPD,
     :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, :NPRECOMOVPROD, :NPRECOMOVPROD,
     :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX )
     INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX ;

  /* Verifica se haver mudana de saldo*/
  SELECT NSALDO, NCUSTOMPM, CESTOQMOVPROD, CTIPOMOVPROD, SOPERADOR FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
      :ICODTIPOMOV, :NQTDMOVPROD, :NPRECOMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPROD, :ESTOQTIPOMOVPD, :TIPONF)
      INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :CESTOQMOVPROD, :CTIPOMOVPROD, :SOPERADOR;

  if (CMULTIALMOX='N') then
  begin
     NSLDMOVPRODAX = NSLDMOVPROD;
     NCUSTOMPMMOVPRODAX = NCUSTOMPMMOVPROD;
  end
  else
  begin
      SELECT NSALDO, NCUSTOMPM FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
          :ICODTIPOMOV, :NQTDMOVPROD, :NPRECOMOVPROD, :NCUSTOMPMMOVPRODAX, :NSLDMOVPRODAX, :ESTOQTIPOMOVPD, :TIPONF)
        INTO :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX;
  end

  SELECT SCODFILIAL, ICODMOVPROD FROM EQMOVPRODSEQSP(:ICODEMPPD)
     INTO :SCODFILIAL, :ICODMOVPROD;  /* encontra o prximo cdigo e a filial*/

   INSERT INTO EQMOVPROD ( CODEMP, CODFILIAL, CODMOVPROD,
      CODEMPPD, CODFILIALPD , CODPROD , CODEMPLE ,
      CODFILIALLE , CODLOTE , CODEMPTM, CODFILIALTM,
      CODTIPOMOV, CODEMPIV , CODFILIALIV , CODINVPROD ,
      CODEMPCP , CODFILIALCP , CODCOMPRA , CODITCOMPRA , CODEMPVD ,
      CODFILIALVD , TIPOVENDA , CODVENDA , CODITVENDA , CODEMPRM ,
      CODFILIALRM , CODRMA , CODITRMA ,
      CODEMPOP, CODFILIALOP, CODOP, SEQOP, SEQENTOP,
      CODEMPNT , CODFILIALNT ,
      CODNAT , DTMOVPROD , DOCMOVPROD , FLAG , QTDMOVPROD ,
      PRECOMOVPROD, ESTOQMOVPROD, TIPOMOVPROD, SLDMOVPROD, CUSTOMPMMOVPROD,
      SLDMOVPRODAX, CUSTOMPMMOVPRODAX, CODEMPAX, CODFILIALAX, CODALMOX, seqsubprod )
   VALUES ( :ICODEMPPD, :SCODFILIAL, :ICODMOVPROD,
    :ICODEMPPD , :SCODFILIALPD , :ICODPROD , :ICODEMPLE ,
    :SCODFILIALLE , :CCODLOTE , :ICODEMPTM, :SCODFILIALTM,
    :ICODTIPOMOV, :ICODEMPIV , :SCODFILIALIV ,
    :ICODINVPROD , :ICODEMPCP , :SCODFILIALCP , :ICODCOMPRA ,
    :SCODITCOMPRA , :ICODEMPVD , :SCODFILIALVD , :CTIPOVENDA ,
    :ICODVENDA , :SCODITVENDA , :ICODEMPRM , :SCODFILIALRM ,
    :ICODRMA , :SCODITRMA , :ICODEMPOP, :SCODFILIALOP, :ICODOP, :SSEQOP, :sseqentop,
    :ICODEMPNT , :SCODFILIALNT , :CCODNAT ,
    :DDTMOVPROD , :IDOCMOVPROD , :CFLAG , :NQTDMOVPROD ,
    :NPRECOMOVPROD, :CESTOQMOVPROD, :CTIPOMOVPROD, :NSLDMOVPROD, :NCUSTOMPMMOVPROD,
    :NSLDMOVPRODAX,  :NCUSTOMPMMOVPRODAX, :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :seqsubprod );

  /* REPROCESSAR ESTOQUE */

  SELECT NSLDPRC, NCUSTOMPMPRC, NSLDPRCAX, NCUSTOMPMPRCAX
    FROM EQMOVPRODPRCSLDSP( :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
     :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, null, :NSLDMOVPROD, :NCUSTOMPMMOVPROD,
     :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX, :ICODEMPAX, :SCODFILIALAX, :ICODALMOX,
     :CMULTIALMOX, :TIPONF)
    INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX ;

 /* ATUALIZA O CUSTO NO CADASTRO DE PRODUTOS
   EXECUTE PROCEDURE EQMOVPRODATCUSTSP(:SOPERADOR, :ICODEMPPD, :SCODFILIAL,
    :ICODMOVPROD, :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, :NCUSTOMPMMOVPROD); 
 */


  suspend;
end
^

SET TERM ; ^

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Sequencial do subproduto'
WHERE RDB$PROCEDURE_NAME = 'EQMOVPRODISP' AND RDB$PARAMETER_NAME = 'SEQSUBPROD';

/* Alter (EQMOVPRODIUDSP) */
SET TERM ^ ;

ALTER PROCEDURE EQMOVPRODIUDSP(CIUD CHAR,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE VARCHAR(20),
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4),
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR,
NQTDMOVPROD NUMERIC(15,5),
NPRECOMOVPROD NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
SEQSUBPROD SMALLINT,
ESTOQTIPOMOVPD CHAR,
TIPONF CHAR)
 AS
declare variable cmultialmox char(1);
begin
  /* Procedure que controle INSERT, UPDATE E DELETE da tabela eqmovprod */

  /* Linha incluida para passar como parmetro se  multi almoxarifado
      Como o objetivo de evitar I/O
  */
  SELECT CMULTIALMOX FROM SGRETMULTIALMOXSP(:ICODEMPPD) INTO :CMULTIALMOX;
  
  if (CIUD='I') then /* SE FOR INSERT */
     execute procedure EQMOVPRODISP( ICODEMPPD, SCODFILIALPD, ICODPROD,
         ICODEMPLE, SCODFILIALLE, CCODLOTE, ICODEMPTM, SCODFILIALTM, ICODTIPOMOV,
         ICODEMPIV, SCODFILIALIV, ICODINVPROD, ICODEMPCP, SCODFILIALCP, ICODCOMPRA,
         SCODITCOMPRA, ICODEMPVD, SCODFILIALVD, CTIPOVENDA, ICODVENDA, SCODITVENDA,
         ICODEMPRM, SCODFILIALRM, ICODRMA, SCODITRMA,
         ICODEMPOP, SCODFILIALOP, ICODOP, SSEQOP, sseqentop,
         ICODEMPNT, SCODFILIALNT,
         CCODNAT, DDTMOVPROD, IDOCMOVPROD, CFLAG, NQTDMOVPROD, NPRECOMOVPROD,
         ICODEMPAX, SCODFILIALAX, ICODALMOX, CMULTIALMOX, :seqsubprod, :estoqtipomovpd, :tiponf);
  else if (CIUD='U') then
     execute procedure EQMOVPRODUSP( ICODEMPPD, SCODFILIALPD, ICODPROD,
         ICODEMPLE, SCODFILIALLE, CCODLOTE, ICODEMPTM, SCODFILIALTM, ICODTIPOMOV,
         ICODEMPIV, SCODFILIALIV, ICODINVPROD, ICODEMPCP, SCODFILIALCP, ICODCOMPRA,
         SCODITCOMPRA, ICODEMPVD, SCODFILIALVD, CTIPOVENDA, ICODVENDA, SCODITVENDA,
         ICODEMPRM, SCODFILIALRM, ICODRMA, SCODITRMA,
         ICODEMPOP, SCODFILIALOP, ICODOP, SSEQOP, sseqentop,
         ICODEMPNT, SCODFILIALNT,
         CCODNAT, DDTMOVPROD, IDOCMOVPROD, CFLAG, NQTDMOVPROD, NPRECOMOVPROD,
         ICODEMPAX, SCODFILIALAX, ICODALMOX, CMULTIALMOX,:seqsubprod, :estoqtipomovpd, :tiponf);
  else if (CIUD='D') then
     execute procedure EQMOVPRODDSP( ICODEMPPD, SCODFILIALPD, ICODPROD, ICODEMPIV,
         SCODFILIALIV, ICODINVPROD, ICODEMPCP, SCODFILIALCP, ICODCOMPRA, SCODITCOMPRA,
         ICODEMPVD, SCODFILIALVD, CTIPOVENDA, ICODVENDA, SCODITVENDA,
         ICODEMPRM, SCODFILIALRM, ICODRMA, SCODITRMA,
         ICODEMPOP, SCODFILIALOP, ICODOP, SSEQOP, sseqentop,
         DDTMOVPROD, ICODEMPAX, SCODFILIALAX, ICODALMOX, CMULTIALMOX, :seqsubprod, :tiponf );
--  suspend;
end
^

SET TERM ; ^

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Sequencial de subproduto'
WHERE RDB$PROCEDURE_NAME = 'EQMOVPRODIUDSP' AND RDB$PARAMETER_NAME = 'SEQSUBPROD';

/* empty dependent procedure body */
/* Clear: EQMOVPRODDSP for: EQMOVPRODPRCSLDSP */
SET TERM ^ ;

ALTER PROCEDURE EQMOVPRODDSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
DDTMOVPROD DATE,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
SEQSUBPROD SMALLINT,
TIPONF CHAR)
 AS
 BEGIN EXIT; END
^

/* Alter (EQMOVPRODPRCSLDSP) */
ALTER PROCEDURE EQMOVPRODPRCSLDSP(SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
DDTMOVPROD DATE,
DDTMOVPRODPRC DATE,
NSLDMOVPROD NUMERIC(15,5),
NCUSTOMPMMOVPROD NUMERIC(15,5),
NSLDMOVPRODAX NUMERIC(15,5),
NCUSTOMPMMOVPRODAX NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
TIPONF CHAR)
 RETURNS(NSLDPRC NUMERIC(15,5),
NCUSTOMPMPRC NUMERIC(15,5),
NSLDPRCAX NUMERIC(15,5),
NCUSTOMPMPRCAX NUMERIC(15,5),
ESTOQTIPOMOVPD CHAR)
 AS
declare variable icodemptm integer;
declare variable scodfilialtm smallint;
declare variable icodtipomov integer;
declare variable nqtdmovprod numeric(15,5);
declare variable nprecomovprod numeric(15,5);
declare variable icodmovprodprc integer;
declare variable cestoqmovprod char(1);
declare variable icodempaxprc integer;
declare variable scodfilialaxprc smallint;
declare variable icodalmoxprc integer;
begin
  /* Procedure de processamento de estoque */
  FOR SELECT MP.CODEMPTM, MP.CODFILIALTM, MP.CODTIPOMOV ,
    MP.QTDMOVPROD, MP.PRECOMOVPROD , MP.CODMOVPROD,
    MP.CODEMPAX, MP.CODFILIALAX, MP.CODALMOX, MP.ESTOQMOVPROD
    FROM EQMOVPROD MP
    WHERE MP.CODEMPPD=:ICODEMPPD AND MP.CODFILIALPD=:SCODFILIALPD AND
       MP.CODPROD=:ICODPROD AND MP.CODEMP=:ICODEMPPD AND MP.CODFILIAL=:SCODFILIAL AND
       ( (MP.DTMOVPROD = :DDTMOVPROD AND MP.CODMOVPROD > :ICODMOVPROD) OR
         (MP.DTMOVPROD>:DDTMOVPROD) ) AND  /* ALTEREI AQUI */
       ( (:DDTMOVPRODPRC IS NULL /* AND MP.CODMOVPROD!=:ICODMOVPROD */) OR
         (MP.DTMOVPROD = :DDTMOVPRODPRC AND MP.CODMOVPROD < :ICODMOVPROD) OR
         (MP.DTMOVPROD < :DDTMOVPRODPRC) )
    ORDER BY MP.DTMOVPROD, MP.CODMOVPROD
    INTO :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV,
     :NQTDMOVPROD, :NPRECOMOVPROD, :ICODMOVPRODPRC,
     :ICODEMPAXPRC, :SCODFILIALAXPRC, :ICODALMOXPRC, :ESTOQTIPOMOVPD DO
  BEGIN
      SELECT NSALDO, NCUSTOMPM, CESTOQMOVPROD FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
        :ICODTIPOMOV, :NQTDMOVPROD, :NPRECOMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPROD, :ESTOQTIPOMOVPD, :TIPONF)
      INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :CESTOQMOVPROD;
      if (CMULTIALMOX='N') then /* Se no for multi almoxarifado*/
      begin
         NSLDMOVPRODAX = NSLDMOVPROD;
         NCUSTOMPMMOVPRODAX = NCUSTOMPMMOVPROD;
         UPDATE EQMOVPROD SET SLDMOVPROD=:NSLDMOVPROD, CUSTOMPMMOVPROD=:NCUSTOMPMMOVPROD,
            SLDMOVPRODAX=:NSLDMOVPRODAX, CUSTOMPMMOVPRODAX=:NCUSTOMPMMOVPRODAX,
            ESTOQMOVPROD=:CESTOQMOVPROD
            WHERE CODEMP=:ICODEMPPD AND CODFILIAL=:SCODFILIAL AND CODMOVPROD=:ICODMOVPRODPRC;
      end
      else if (ICODEMPAX=ICODEMPAXPRC AND SCODFILIALAX=SCODFILIALAXPRC AND
          ICODALMOX=ICODALMOXPRC) then
          /* Se for multi almoxarifado e o cdigo do almoxarifado for o mesmo*/
      begin
        SELECT NSALDO, NCUSTOMPM FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
            :ICODTIPOMOV, :NQTDMOVPROD, :NPRECOMOVPROD, :NCUSTOMPMMOVPRODAX, :NSLDMOVPRODAX, :ESTOQTIPOMOVPD, :TIPONF)
            INTO :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX;
        UPDATE EQMOVPROD SET SLDMOVPROD=:NSLDMOVPROD, CUSTOMPMMOVPROD=:NCUSTOMPMMOVPROD,
            SLDMOVPRODAX=:NSLDMOVPRODAX, CUSTOMPMMOVPRODAX=:NCUSTOMPMMOVPRODAX,
            ESTOQMOVPROD=:CESTOQMOVPROD
            WHERE CODEMP=:ICODEMPPD AND CODFILIAL=:SCODFILIAL AND CODMOVPROD=:ICODMOVPRODPRC;
      end
      else /* Se for multi almoxarifado no atualiza almoxarifado diferente */
      begin
        UPDATE EQMOVPROD SET SLDMOVPROD=:NSLDMOVPROD, CUSTOMPMMOVPROD=:NCUSTOMPMMOVPROD,
            ESTOQMOVPROD=:CESTOQMOVPROD
            WHERE CODEMP=:ICODEMPPD AND CODFILIAL=:SCODFILIAL AND CODMOVPROD=:ICODMOVPRODPRC;
      end
      NSLDPRC = NSLDMOVPROD;
      NCUSTOMPMPRC = NCUSTOMPMMOVPROD;
      NSLDPRCAX = NSLDMOVPRODAX;
      NCUSTOMPMPRCAX = NCUSTOMPMMOVPRODAX;
  END
  suspend;
end
^

/* Alter (EQMOVPRODSLDSP) */
ALTER PROCEDURE EQMOVPRODSLDSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
DDTMOVPROD DATE,
NCUSTOMPMMOVPROD NUMERIC(15,5),
NCUSTOMPMMOVPRODAX NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR)
 RETURNS(NSALDO NUMERIC(15,5),
NCUSTOMPM NUMERIC(15,5),
ICODMOVPRODSLD INTEGER,
NSALDOAX NUMERIC(15,5),
NCUSTOMPMAX NUMERIC(15,5),
ICODMOVPRODSLDAX INTEGER)
 AS
begin
  /* Procedure que busca saldo e custo mdio */
  nsaldo = 0;
  ncustompm = 0;
  if (ncustompmmovprod is null) then
     ncustompmmovprod = 0;
  if (icodmovprod is null) then
     select first 1 m.sldmovprod, m.custompmmovprod, m.codmovprod
        from eqmovprod m
        where m.codemppd = :icodemppd and
          m.codfilialpd = :scodfilialpd and
          m.codprod = :icodprod and
          m.dtmovprod <= :ddtmovprod
        order by m.dtmovprod desc, m.codmovprod desc
        into :nsaldo, :ncustompm, :icodmovprodsld;
   else
     select first 1 m.sldmovprod, m.custompmmovprod, m.codmovprod
        from eqmovprod m
        where m.codemp = :icodemp and
          m.codfilial = :scodfilial and
          m.codemppd = :icodemppd and
          m.codfilialpd = :scodfilialpd and
          m.codprod = :icodprod and
          ( (m.dtmovprod = :ddtmovprod and m.codmovprod < :icodmovprod ) or
            (m.dtmovprod < :ddtmovprod ) )
        order by m.dtmovprod desc, m.codmovprod desc
        into :nsaldo, :ncustompm, :icodmovprodsld;
  if (nsaldo is null) then
     nsaldo = 0;
  if (ncustompm is null) then
     ncustompm = ncustompmmovprod;
  if (cmultialmox='N') then
  begin
      nsaldoax = nsaldo;
      ncustompmax = ncustompm;
      icodmovprodsldax = icodmovprodsld;
  end
  else
  begin
      nsaldoax = 0;
      ncustompmax = 0;
      if (ncustompmmovprodax is null) then
         ncustompmmovprodax = 0;
      if (icodmovprod is null) then
         select first 1 m.sldmovprodax, m.custompmmovprod, m.codmovprod
            from eqmovprod m
            where m.codemppd = :icodemppd and
              m.codfilialpd = :scodfilialpd and
              m.codprod = :icodprod and
              m.dtmovprod <= :ddtmovprod and
              m.codempax = :icodempax and
              m.codfilialax = :scodfilialax and
              m.codalmox= :icodalmox
            order by m.dtmovprod desc, m.codmovprod desc
            into :nsaldoax, :ncustompmax, :icodmovprodsldax;
       else
         select first 1 m.sldmovprodax, m.custompmmovprod, m.codmovprod
            from eqmovprod m
            where m.codemp = :icodemp and
              m.codfilial = :scodfilial and
              m.codemppd = :icodemppd and
              m.codfilialpd = :scodfilialpd and
              m.codprod = :icodprod and
              m.codempax = :icodempax and
              m.codfilialax = :scodfilialax and
              m.codalmox = :icodalmox and
              ( (m.dtmovprod = :ddtmovprod and m.codmovprod < :icodmovprod ) or
                (m.dtmovprod < :ddtmovprod ) )
            order by m.dtmovprod desc, m.codmovprod desc
            into :nsaldoax, :ncustompmax, :icodmovprodsldax;
      if (nsaldoax is null) then
         nsaldoax = 0;
      if (ncustompmax is null) then
         ncustompmax = ncustompmmovprod;
  end
  suspend;
end
^

/* Alter (EQMOVPRODUSP) */
ALTER PROCEDURE EQMOVPRODUSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE VARCHAR(20),
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4),
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR,
NQTDMOVPROD NUMERIC(15,5),
NPRECOMOVPROD NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
SEQSUBPROD BIGINT,
ESTOQTIPOMOVPD CHAR,
TIPONF CHAR)
 AS
declare variable icodemp integer;
declare variable scodfilial smallint;
declare variable icodmovprod integer;
declare variable nsldprc numeric(15,5);
declare variable ncustompmprc numeric(15,5);
declare variable nsldprcax numeric(15,5);
declare variable ncustompmprcax numeric(15,5);
declare variable nsldlc numeric(15,5);
declare variable ncustompmlc numeric(15,5);
declare variable nsldlcax numeric(15,5);
declare variable ncustompmlcax numeric(15,5);
declare variable ddtmovprodold date;
declare variable nprecomovprodold numeric(15,5);
declare variable nqtdmovprodold numeric(15,5);
declare variable icodemptmold integer;
declare variable scodfilialtmold smallint;
declare variable icodtipomovold integer;
declare variable calttm char(1);
declare variable ddtprc date;
declare variable ddtprcate date;
declare variable cestoqmovprod char(1);
begin
  /* Procedure de atualizao da tabela eqmovprod */

  DDTPRCATE = NULL; /* At onde deve ser processando o estoque */
 /* localiza movprod */

-- execute procedure sgdebugsp('antes da atualizao...','no inicio');

  SELECT ICODEMP, SCODFILIAL, ICODMOVPROD
    FROM EQMOVPRODRETCODSP(:ICODEMPIV, :SCODFILIALIV, :ICODINVPROD, :ICODEMPCP,
      :SCODFILIALCP, :ICODCOMPRA, :SCODITCOMPRA, :ICODEMPVD, :SCODFILIALVD,
      :CTIPOVENDA, :ICODVENDA, :SCODITVENDA, :ICODEMPRM, :SCODFILIALRM,
      :ICODRMA, :SCODITRMA, :ICODEMPOP, :SCODFILIALOP, :ICODOP, :SSEQOP, :sseqentop, :seqsubprod)
    INTO :ICODEMP, :SCODFILIAL, :ICODMOVPROD;

--  traz valores antigos

  SELECT MP.CODEMPTM, MP.CODFILIALTM, MP.CODTIPOMOV, MP.DTMOVPROD,
       MP.PRECOMOVPROD, MP.QTDMOVPROD  FROM EQMOVPROD MP
     WHERE MP.CODEMP=:ICODEMP AND MP.CODFILIAL=:SCODFILIAL AND MP.CODMOVPROD=:ICODMOVPROD
     INTO :ICODEMPTMOLD, :SCODFILIALTMOLD, :ICODTIPOMOVOLD, :DDTMOVPRODOLD,
       :NPRECOMOVPRODOLD, :NQTDMOVPRODOLD;

   /* abaixo verificao se a alterao de tipo de movimento mexe no estoque */
   SELECT CALTTM FROM EQMOVPRODCKUTMSP(:ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV,
      :ICODEMPTMOLD, :SCODFILIALTMOLD, :ICODTIPOMOVOLD) INTO :CALTTM;

   /* verifica se h relevncia para reprocessamento */
   if ( (DDTMOVPROD!=DDTMOVPRODOLD) OR (CALTTM='S') OR
        (NPRECOMOVPROD!=NPRECOMOVPRODOLD) OR (NQTDMOVPROD!=NQTDMOVPRODOLD) ) then
   begin

   -- execute procedure sgdebugsp('entrou no if','1');


      if ( DDTMOVPRODOLD IS NULL) then
         DDTMOVPRODOLD = DDTMOVPROD; /* garantir que a data antiga no e nula; */
      /* verifica qual data  menor para reprocessamento */
      if ( DDTMOVPROD<=DDTMOVPRODOLD ) then
      begin

     -- execute procedure sgdebugsp('entrou no if','2');

          DDTPRC = DDTMOVPROD;
          if (DDTMOVPROD=DDTMOVPRODOLD) then
             DDTPRCATE = null;
          else
             DDTPRCATE = DDTMOVPRODOLD;
/*          verifica lanamento anterior e traz custo e saldo */
          SELECT NSALDO, NCUSTOMPM, NSALDOAX, NCUSTOMPMAX
             FROM EQMOVPRODSLDSP(:ICODEMP, :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
             :SCODFILIALPD, :ICODPROD, :DDTPRC, :NPRECOMOVPROD, :NPRECOMOVPROD,
             :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX)
             INTO :NSLDPRC, :NCUSTOMPMPRC, :NSLDPRCAX, :NCUSTOMPMPRCAX ;

          /* verifica se havera mudana de saldo */
          SELECT NSALDO, NCUSTOMPM, CESTOQMOVPROD
              FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
              :ICODTIPOMOV, :NQTDMOVPROD, :NPRECOMOVPROD, :NCUSTOMPMPRC, :NSLDPRC, :ESTOQTIPOMOVPD, :TIPONF)
              INTO :NSLDPRC, :NCUSTOMPMPRC, :CESTOQMOVPROD;
          if (CMULTIALMOX='N') then
          begin
              NSLDPRCAX = NSLDPRC;
              NCUSTOMPMPRCAX = NCUSTOMPMPRC;
          end
          else
          begin
          SELECT NSALDO, NCUSTOMPM
              FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
              :ICODTIPOMOV, :NQTDMOVPROD, :NPRECOMOVPROD, :NCUSTOMPMPRCAX, :NSLDPRCAX, :ESTOQTIPOMOVPD, :TIPONF)
              INTO :NSLDPRCAX, :NCUSTOMPMPRCAX;
          end
          NCUSTOMPMLC = NCUSTOMPMPRC;
          NSLDLC = NSLDPRC;
          NCUSTOMPMLCAX = NCUSTOMPMPRCAX;
          NSLDLCAX = NSLDPRCAX;
      end
      else
      begin
          DDTPRC = DDTMOVPRODOLD;
          DDTPRCATE = DDTMOVPROD;
          /* verifica lanamento anterior e traz custo e saldo */

       --   execute procedure sgdebugsp('entrou no else','3');

          SELECT NSALDO, NCUSTOMPM, NSALDOAX, NCUSTOMPMAX
             FROM EQMOVPRODSLDSP(:ICODEMP, :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
             :SCODFILIALPD, :ICODPROD, :DDTPRC, 0, 0,
             :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX)
             INTO :NSLDPRC, :NCUSTOMPMPRC, :NSLDPRCAX, :NCUSTOMPMPRCAX ;

          /* verifica lanamento anterior e traz custo e saldo */
          SELECT NSALDO, NCUSTOMPM, NSALDOAX, NCUSTOMPMAX
             FROM EQMOVPRODSLDSP(:ICODEMP, :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
             :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, :NCUSTOMPMLC, :NCUSTOMPMLCAX,
             :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX)
             INTO :NSLDLC, :NCUSTOMPMLC, :NSLDLCAX, :NCUSTOMPMLCAX ;

          /* verifica se havera mudana de saldo */
          SELECT NSALDO, NCUSTOMPM, CESTOQMOVPROD
              FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
              :ICODTIPOMOV, (:NQTDMOVPROD-:NQTDMOVPRODOLD), :NPRECOMOVPROD,
              :NCUSTOMPMLC, :NSLDLC, :ESTOQTIPOMOVPD, :TIPONF)
              INTO :NSLDLC, :NCUSTOMPMLC, :CESTOQMOVPROD;
          if (CMULTIALMOX='N') then
          begin
             NSLDLCAX = NSLDLC;
             NCUSTOMPMLCAX = NCUSTOMPMLC;
          end
          else
          begin
              SELECT NSALDO, NCUSTOMPM
                  FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
                  :ICODTIPOMOV, (:NQTDMOVPROD-:NQTDMOVPRODOLD), :NPRECOMOVPROD,
                  :NCUSTOMPMLCAX, :NSLDLCAX, :ESTOQTIPOMOVPD, :TIPONF)
                  INTO :NSLDLCAX, :NCUSTOMPMLCAX;
          end

      end

       SELECT NSLDPRC, NCUSTOMPMPRC, NSLDPRCAX, NCUSTOMPMPRCAX
        FROM EQMOVPRODPRCSLDSP( :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
          :SCODFILIALPD, :ICODPROD, :DDTPRC, :DDTPRCATE, :NSLDPRC,
          :NCUSTOMPMPRC, :NSLDPRCAX, :NCUSTOMPMPRCAX,
          :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX, :TIPONF)
        INTO :NSLDPRC, :NCUSTOMPMPRC, :NSLDPRCAX, :NCUSTOMPMPRCAX;

      UPDATE EQMOVPROD SET DTMOVPROD=:DDTMOVPROD,
         QTDMOVPROD=:NQTDMOVPROD, PRECOMOVPROD=:NPRECOMOVPROD,
         SLDMOVPROD=:NSLDLC, CUSTOMPMMOVPROD=:NCUSTOMPMLC,
         SLDMOVPRODAX=:NSLDLCAX, CUSTOMPMMOVPRODAX=:NCUSTOMPMLCAX,
         FLAG=:CFLAG, CODEMPNT=:ICODEMPNT, CODFILIALNT=:SCODFILIALNT,
         CODNAT=:CCODNAT, DOCMOVPROD=:IDOCMOVPROD, CODEMPTM=:ICODEMPTM,
         CODFILIALTM=:SCODFILIALTM, CODTIPOMOV=:ICODTIPOMOV, CODEMPLE=:ICODEMPLE,
         CODFILIALLE=:SCODFILIALLE, CODLOTE=:CCODLOTE, ESTOQMOVPROD=:CESTOQMOVPROD ,
         CODEMPAX=:ICODEMPAX, CODFILIALAX=:SCODFILIALAX, CODALMOX=:ICODALMOX
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODMOVPROD=:ICODMOVPROD;
   end
   else /*  caso no tenha nenhuma alterao relevnte para processamento */

  --  execute procedure sgdebugsp('antes do reprocessamento','5SG');

      UPDATE EQMOVPROD SET FLAG=:CFLAG, CODEMPNT=:ICODEMPNT, CODFILIALNT=:SCODFILIALNT,
         CODNAT=:CCODNAT, DOCMOVPROD=:IDOCMOVPROD, CODEMPTM=:ICODEMPTM,
         CODFILIALTM=:SCODFILIALTM, CODTIPOMOV=:ICODTIPOMOV, CODEMPLE=:ICODEMPLE,
         CODFILIALLE=:SCODFILIALLE, CODLOTE=:CCODLOTE,
         CODEMPAX=:ICODEMPAX, CODFILIALAX=:SCODFILIALAX, CODALMOX=:ICODALMOX
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODMOVPROD=:ICODMOVPROD;
end
^

/* Alter (EQRELDEMANDASP) */
ALTER PROCEDURE EQRELDEMANDASP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
SCODFILIALPD SMALLINT,
DDTINI DATE,
DDTFIM DATE)
 RETURNS(CODMARCA CHAR(6),
CODGRUP CHAR(14),
CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD CHAR(100),
DESCGRUP CHAR(50),
SLDINI NUMERIC(15,5),
VLRCOMPRAS NUMERIC(15,5),
VLRDEVENT NUMERIC(15,5),
VLROUTENT NUMERIC(15,5),
VLRVENDAS NUMERIC(15,5),
VLRDEVSAI NUMERIC(15,5),
VLROUTSAI NUMERIC(15,5),
SLDFIM NUMERIC(15,5))
 AS
begin
  /* Stored procedure de relatrio de demanda */
  FOR SELECT P.CODMARCA, P.CODGRUP,P.CODPROD,
     P.REFPROD, P.DESCPROD,G.DESCGRUP,
     (SELECT FIRST 1 SLDMOVPROD FROM EQMOVPROD MP
      WHERE MP.CODEMP=:ICODEMP AND MP.CODFILIAL=:SCODFILIAL AND
         MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
         MP.CODPROD=P.CODPROD AND MP.DTMOVPROD<:DDTINI
         ORDER BY MP.DTMOVPROD DESC, MP.CODMOVPROD DESC ) SLDINI,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV IN ('CP','PC') AND TM.ESTIPOMOV = 'E') VLRCOMPRAS,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV ='DV' AND TM.ESTIPOMOV = 'E') VLRDEVENT,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP , EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV NOT IN ('CP','PC','DV') AND TM.ESTIPOMOV IN ('E','I')) VLROUTENT,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV IN ('VD','PV') AND TM.ESTIPOMOV = 'S') VLRVENDAS,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV ='DV' AND TM.ESTIPOMOV = 'S') VLRDEVSAI,
     (SELECT SUM(MP.QTDMOVPROD)
        FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV NOT IN ('VD','PV','DV') AND TM.ESTIPOMOV = 'S') VLROUTSAI
     FROM EQPRODUTO P, EQGRUPO G
         WHERE G.CODGRUP=P.CODGRUP AND G.CODEMP=P.CODEMPGP AND
           G.CODFILIAL=P.CODFILIALGP AND P.CODEMP=:ICODEMP AND
           P.CODFILIAL=:SCODFILIALPD AND P.ATIVOPROD='S'
     INTO :CODMARCA, :CODGRUP, :CODPROD, :REFPROD, :DESCPROD, :DESCGRUP,
        :SLDINI, :VLRCOMPRAS, :VLRDEVENT,  :VLROUTENT,
         :VLRVENDAS, :VLRDEVSAI, :VLROUTSAI DO
     BEGIN
        if (SLDINI IS NULL) then
           SLDINI = 0;
        if (VLROUTSAI IS NULL) then
           VLROUTSAI = 0;
        if (VLROUTENT IS NULL) then
           VLROUTENT = 0;
        if (VLRDEVSAI IS NULL) then
           VLRDEVSAI = 0;
        if (VLRDEVENT IS NULL) then
           VLRDEVENT = 0;
        if (VLRCOMPRAS IS NULL) then
           VLRCOMPRAS = 0;
        if (VLRVENDAS IS NULL) then
           VLRVENDAS = 0;
        SLDFIM = SLDINI + VLRCOMPRAS + VLRDEVENT + VLROUTENT -
           VLRVENDAS - VLRDEVSAI - VLROUTSAI;
        suspend;
     END
end
^

/* Alter (EQRELGIROPROD) */
ALTER PROCEDURE EQRELGIROPROD(CODEMP INTEGER,
CODFILIAL INTEGER,
DATA_BASE DATE)
 RETURNS(CODEMPPD INTEGER,
CODFILIALPD SMALLINT,
CODPROD INTEGER,
REFPROD VARCHAR(20),
CODFABPROD CHAR(15),
CODBARPROD CHAR(13),
DESCPROD VARCHAR(100),
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
DOCCOMPRA INTEGER,
IDENTCONTAINER CHAR(20),
CODITCOMPRA SMALLINT,
DTULTCP DATE,
SALDOANT NUMERIC(15,5),
QTDULTCP NUMERIC(15,5),
QTDVENDIDA NUMERIC(15,5),
SALDOATU NUMERIC(15,5),
CODEMPGP INTEGER,
CODFILIALGP INTEGER,
CODGRUP CHAR(14))
 AS
begin

    -- Buscando produtos ativos
    for
        select pd.codemp, pd.codfilial, pd.codprod, pd.descprod, refprod, codfabprod, codbarprod,
        codempgp, codfilialgp, codgrup
        from eqproduto pd
        where pd.ativoprod='S' and pd.codemp=:codemp and pd.codfilial=:codfilial
        into codemppd, codfilialpd, codprod, descprod, refprod, codfabprod, codbarprod,
        codempgp, codfilialgp, codgrup
    do
    begin

        -- Buscando a ultima compra do produto
        codempcp = null;
        codfilialcp = null;
        codcompra = null;
        coditcompra = null;
        dtultcp = null;
        qtdultcp = 0;
        doccompra = null;
        identcontainer = null;

        select first 1 itc.codemp, itc.codfilial, itc.codcompra, itc.coditcompra, cp.dtentcompra, itc.qtditcompra, cp.doccompra, cp.identcontainer
        from cpcompra cp, cpitcompra itc
        where
        itc.codemp=cp.codemp and itc.codfilial=cp.codfilial and itc.codcompra=cp.codcompra and
        itc.codemppd=:codemppd and itc.codfilialpd=:codfilialpd and itc.codprod=:codprod and
        cp.dtentcompra < :data_base
        order by cp.dtentcompra desc
        into codempcp, codfilialcp, codcompra, coditcompra, dtultcp, qtdultcp, doccompra, identcontainer;

        -- Buscando a ultima compra do produto

        qtdvendida = 0;

        select coalesce(sum(itv.qtditvenda),0)
        from vdvenda vd, vditvenda itv, eqtipomov tm
        where
        itv.codemp=vd.codemp and itv.codfilial=vd.codfilial and itv.codvenda=vd.codvenda and itv.tipovenda=vd.tipovenda and
        itv.codemppd=:codemppd and itv.codfilialpd=:codfilialpd and itv.codprod=:codprod and
        vd.dtsaidavenda between :data_base - 30 and :data_base and
        tm.codemp=vd.codemptm and tm.codfilial=vd.codfilialtm and tm.codtipomov=vd.codtipomov and
        tm.estoqtipomov='S'
        into :qtdvendida;

        -- Buscando saldo anterior

        saldoant = 0;

        select first 1 mp.sldmovprod
        from eqmovprod mp
        where mp.codemp=:codemp and mp.codfilial=:codfilial and mp.codemppd=:codemppd and mp.codfilialpd=:codfilialpd
        and mp.codprod=:codprod and mp.dtmovprod<:dtultcp
        order by mp.dtmovprod desc, mp.codmovprod desc
        into saldoant;

        -- Buscando saldo atual
        saldoatu = 0;

        select first 1 mp.sldmovprod
        from eqmovprod mp
        where mp.codemp=:codemp and mp.codfilial=:codfilial and mp.codemppd=:codemppd and mp.codfilialpd=:codfilialpd
        and mp.codprod=:codprod and mp.dtmovprod<=:data_base
        order by mp.dtmovprod desc, mp.codmovprod desc
        into saldoatu;

        suspend;

    end

end
^

/* Alter (EQRELGIROPRODPERI) */
ALTER PROCEDURE EQRELGIROPRODPERI(CODEMP INTEGER,
CODFILIAL INTEGER,
DATA_INI DATE,
DATA_FIM DATE)
 RETURNS(CODEMPPD INTEGER,
CODFILIALPD SMALLINT,
CODPROD INTEGER,
REFPROD VARCHAR(20),
CODFABPROD CHAR(15),
CODBARPROD CHAR(13),
DESCPROD VARCHAR(100),
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
DOCCOMPRA INTEGER,
IDENTCONTAINER CHAR(20),
CODITCOMPRA SMALLINT,
DTULTCP DATE,
SALDOANT NUMERIC(15,5),
QTDULTCP NUMERIC(15,5),
QTDVENDIDA NUMERIC(15,5),
SALDOATU NUMERIC(15,5),
CODEMPGP INTEGER,
CODFILIALGP INTEGER,
CODGRUP CHAR(14))
 AS
begin

    -- Buscando produtos ativos
    for
        select pd.codemp, pd.codfilial, pd.codprod, pd.descprod, refprod, codfabprod, codbarprod,
        codempgp, codfilialgp, codgrup
        from eqproduto pd
        where pd.ativoprod='S' and pd.codemp=:codemp and pd.codfilial=:codfilial
        into codemppd, codfilialpd, codprod, descprod, refprod, codfabprod, codbarprod,
        codempgp, codfilialgp, codgrup
    do
    begin

        -- Buscando a ultima compra do produto
        codempcp = null;
        codfilialcp = null;
        codcompra = null;
        coditcompra = null;
        dtultcp = null;
        qtdultcp = 0;
        doccompra = null;
        identcontainer = null;

        select first 1 itc.codemp, itc.codfilial, itc.codcompra, itc.coditcompra, cp.dtentcompra, itc.qtditcompra, cp.doccompra, cp.identcontainer
        from cpcompra cp, cpitcompra itc
        where
        itc.codemp=cp.codemp and itc.codfilial=cp.codfilial and itc.codcompra=cp.codcompra and
        itc.codemppd=:codemppd and itc.codfilialpd=:codfilialpd and itc.codprod=:codprod and
        cp.dtentcompra < :data_fim
        order by cp.dtentcompra desc
        into codempcp, codfilialcp, codcompra, coditcompra, dtultcp, qtdultcp, doccompra, identcontainer;

        -- Buscando a ultima compra do produto

        qtdvendida = 0;

        select coalesce(sum(itv.qtditvenda),0)
        from vdvenda vd, vditvenda itv, eqtipomov tm
        where
        itv.codemp=vd.codemp and itv.codfilial=vd.codfilial and itv.codvenda=vd.codvenda and itv.tipovenda=vd.tipovenda and
        itv.codemppd=:codemppd and itv.codfilialpd=:codfilialpd and itv.codprod=:codprod and
        vd.dtsaidavenda between :data_ini and :data_fim and
        tm.codemp=vd.codemptm and tm.codfilial=vd.codfilialtm and tm.codtipomov=vd.codtipomov and
        tm.estoqtipomov='S'
        into :qtdvendida;

        -- Buscando saldo anterior

        saldoant = 0;

        select first 1 mp.sldmovprod
        from eqmovprod mp
        where mp.codemp=:codemp and mp.codfilial=:codfilial and mp.codemppd=:codemppd and mp.codfilialpd=:codfilialpd
        and mp.codprod=:codprod and mp.dtmovprod<:dtultcp
        order by mp.dtmovprod desc, mp.codmovprod desc
        into saldoant;

        -- Buscando saldo atual
        saldoatu = 0;

        select first 1 mp.sldmovprod
        from eqmovprod mp
        where mp.codemp=:codemp and mp.codfilial=:codfilial and mp.codemppd=:codemppd and mp.codfilialpd=:codfilialpd
        and mp.codprod=:codprod and mp.dtmovprod<=:data_fim
        order by mp.dtmovprod desc, mp.codmovprod desc
        into saldoatu;

        suspend;

    end

end
^

/* Alter (EQRELINVPRODSP) */
ALTER PROCEDURE EQRELINVPRODSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
CTIPOCUSTO CHAR,
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP CHAR(14),
DDTESTOQ DATE,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD CHAR(100),
CODGRUP CHAR(14),
SALDO NUMERIC(15,5),
CUSTO NUMERIC(15,5),
VLRESTOQ NUMERIC(15,5))
 AS
declare variable cmultialmox char(1);
declare variable ncustompm numeric(15,5);
begin
  /* Relatrio de estoque */
  SELECT CMULTIALMOX FROM SGRETMULTIALMOXSP(:ICODEMP) INTO :CMULTIALMOX;

  if (CCODGRUP IS NOT NULL) then
  begin
     CCODGRUP = rtrim(CCODGRUP);
     if (strlen(CCODGRUP)<14) then
        CCODGRUP = CCODGRUP || '%';
  end
  FOR SELECT P.CODPROD, P.REFPROD, P.DESCPROD, P.CODGRUP
    FROM EQPRODUTO P
    WHERE P.CODEMP=:ICODEMP AND P.CODFILIAL=:SCODFILIAL AND
          ( ( :CCODGRUP IS NULL ) OR
            (P.CODGRUP LIKE :CCODGRUP AND P.CODEMPGP=:ICODEMPGP AND
             P.CODFILIALGP=:SCODFILIALGP) )
    INTO :CODPROD, :REFPROD, :DESCPROD, :CODGRUP DO
  BEGIN
     SELECT NSALDO, NCUSTOMPM FROM EQMOVPRODSLDSP(null, null, null, :ICODEMP,
        :SCODFILIAL, :CODPROD, :DDTESTOQ, 0, 0,
        :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX)
       INTO :SALDO, :NCUSTOMPM;
     if (CTIPOCUSTO='M') then
        CUSTO = NCUSTOMPM;
     else
        SELECT NCUSTOPEPS FROM EQCALCPEPSSP(:ICODEMP, :SCODFILIAL, :CODPROD,
          :SALDO, :DDTESTOQ, :ICODEMPAX, :SCODFILIALAX, :ICODALMOX)
        INTO :CUSTO;
     VLRESTOQ = CUSTO * SALDO;
     SUSPEND;
  END
end
^

/* Alter (EQRELPEPSSP) */
ALTER PROCEDURE EQRELPEPSSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
DTESTOQ DATE,
ICODEMPMC INTEGER,
SCODFILIALMC SMALLINT,
CCODMARCA CHAR(6),
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP VARCHAR(14),
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CLOTEPROD CHAR,
SOPRODSALDO CHAR)
 RETURNS(CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD CHAR(100),
SLDPROD NUMERIC(15,5),
CUSTOUNIT NUMERIC(15,5),
CUSTOTOT NUMERIC(15,5),
CODBARPROD CHAR(13),
CODFABPROD CHAR(15),
ATIVOPROD CHAR,
CODUNID CHAR(20),
TIPOPROD VARCHAR(2),
CODNCM VARCHAR(10),
EXTIPI CHAR(2),
COD_GEN CHAR(2),
CODSERV CHAR(5),
ALIQ_ICMS NUMERIC(9,2),
CODNBM VARCHAR(12),
CODLOTE VARCHAR(20),
VENCTOLOTE DATE,
SLDLOTE NUMERIC(15,5),
CODGRUP VARCHAR(14),
SIGLAGRUP VARCHAR(10))
 AS
begin

  /* procedure text */

  if (icodempgp is not null) then
  begin
    if (strlen(rtrim(ccodgrup))<14) then
       ccodgrup = rtrim(ccodgrup)||'%';
  end

  if (ctipocusto is null) then
     ctipocusto = 'P';

  if (:cloteprod = 'S') then
  begin
        for select p.codprod,p.refprod,p.descprod, p.codbarprod
            , p.codfabprod, p.ativoprod, p.codunid, p.tipoprod
            , fc.codncm, fc.extipi
            , substring(fc.codncm from 1 for 2) cod_gen
            , fc.codserv,
            (select first 1 ifc.aliqfisc from lfitclfiscal ifc, sgfilial fl 
            where ifc.codemp=fc.codemp and ifc.codfilial=fc.codfilial and
            ifc.geralfisc='S' and ifc.noufitfisc='S' and ifc.ativoitfisc='S'
            and fl.codemp=ifc.codemp and fl.codfilial=ifc.codfilial and fl.simplesfilial=ifc.simplesfilial) aliq_icms
            , fc.codnbm, lt.codlote, lt.venctolote, lt.sldlote, p.codgrup, gp.siglagrup
        from eqproduto p
        left outer join lfclfiscal fc
            on fc.codemp=p.codempfc and fc.codfilial=p.codfilialfc and fc.codfisc=p.codfisc
        left outer join eqlote lt
            on lt.codemp=p.codemp and lt.codfilial=p.codfilial and lt.codprod=p.codprod
        left outer join eqgrupo gp
            on gp.codemp=p.codemp and gp.codfilial=p.codfilial and gp.codgrup=p.codgrup

        where p.codemp = :icodemp and p.codfilial = :scodfilial and
            ( (:icodempmc is null) or (p.codempmc=:icodempmc and p.codfilialmc=:scodfilialmc and
             p.codmarca=:ccodmarca) ) and
            ((:icodempgp is null) or (p.codempgp=:icodempgp and p.codfilialgp=:scodfilialgp and
             p.codgrup like :ccodgrup) )
        order by p.codprod
    
        into :codprod, :refprod, :descprod, :codbarprod, :codfabprod
            , :ativoprod, :codunid, :tipoprod
            , :codncm, :extipi, :cod_gen, :codserv, :aliq_icms, :codnbm, :codlote, :venctolote, :sldlote, :codgrup, :siglagrup do
    
        begin
            select sldprod, custounit, custotot from eqcustoprodsp(:icodemp,
                 :scodfilial, :codprod, :dtestoq, :ctipocusto, :icodempax,
                 :scodfilialax, :icodalmox, 'S')
            into :sldprod, :custounit, :custotot;
            if (:soprodsaldo='N' or  :sldprod <> 0) then
                suspend;
        end
  end
  else
  begin
        for select p.codprod,p.refprod,p.descprod, p.codbarprod
            , p.codfabprod, p.ativoprod, p.codunid, p.tipoprod
            , fc.codncm, fc.extipi
            , substring(fc.codncm from 1 for 2) cod_gen
            , fc.codserv,
            (select first 1 ifc.aliqfisc from lfitclfiscal ifc, sgfilial fl 
            where ifc.codemp=fc.codemp and ifc.codfilial=fc.codfilial and
            ifc.geralfisc='S' and ifc.noufitfisc='S' and ifc.ativoitfisc='S'
            and fl.codemp=ifc.codemp and fl.codfilial=ifc.codfilial and fl.simplesfilial=ifc.simplesfilial) aliq_icms
            , fc.codnbm
        from eqproduto p
        left outer join lfclfiscal fc
            on fc.codemp=p.codempfc and fc.codfilial=p.codfilialfc and fc.codfisc=p.codfisc
        where p.codemp = :icodemp and p.codfilial = :scodfilial and
            ( (:icodempmc is null) or (p.codempmc=:icodempmc and p.codfilialmc=:scodfilialmc and
             p.codmarca=:ccodmarca) ) and
            ((:icodempgp is null) or (p.codempgp=:icodempgp and p.codfilialgp=:scodfilialgp and
             p.codgrup like :ccodgrup) )
        order by p.codprod
    
        into :codprod, :refprod, :descprod, :codbarprod, :codfabprod
            , :ativoprod, :codunid, :tipoprod
            , :codncm, :extipi, :cod_gen, :codserv, :aliq_icms, :codnbm do
    
        begin
            select sldprod, custounit, custotot from eqcustoprodsp(:icodemp,
                 :scodfilial, :codprod, :dtestoq, :ctipocusto, :icodempax,
                 :scodfilialax, :icodalmox, 'S')
            into :sldprod, :custounit, :custotot;
            if (:soprodsaldo='N' or  sldprod <> 0) then
                suspend;
        end
  end 


end
^

/* Alter (EQSALDOLOTEATEQSP) */
ALTER PROCEDURE EQSALDOLOTEATEQSP(ICODEMPLEOLD INTEGER,
SCODFILIALLEOLD SMALLINT,
ICODPROD INTEGER,
CCODLOTEOLD VARCHAR(20),
ICODEMPLENEW INTEGER,
SCODFILIALLENEW SMALLINT,
CCODLOTENEW VARCHAR(20),
SOPERADOR SMALLINT,
NQTDMOVPRODOLD NUMERIC(15,5),
NQTDMOVPRODNEW NUMERIC(15,5),
ICODEMPAXOLD INTEGER,
SCODFILIALAXOLD SMALLINT,
ICODALMOXOLD INTEGER,
ICODEMPAXNEW INTEGER,
SCODFILIALAXNEW SMALLINT,
ICODALMOXNEW INTEGER)
 AS
DECLARE VARIABLE ICODPRODSLD INTEGER;
begin
  /* Procedure de atualizao do estoque  na tabela de saldos de lotes por almoxarifado*/

  SELECT CODPROD FROM EQSALDOLOTE
     WHERE CODEMP=:ICODEMPLENEW AND CODFILIAL=:SCODFILIALLENEW AND CODPROD=:ICODPROD AND
        CODLOTE=:CCODLOTENEW AND CODEMPAX=:ICODEMPAXNEW AND 
        CODFILIALAX=:SCODFILIALAXNEW AND CODALMOX=:ICODALMOXNEW
     INTO :ICODPRODSLD;
  IF (ICODPRODSLD IS NULL) THEN
  BEGIN
     INSERT INTO EQSALDOLOTE (CODEMP, CODFILIAL, CODPROD, CODLOTE, CODEMPAX, CODFILIALAX, CODALMOX)
       VALUES (:ICODEMPLENEW, :SCODFILIALLENEW, :ICODPROD, :CCODLOTENEW, :ICODEMPAXNEW, :SCODFILIALAXNEW,
         :ICODALMOXNEW);
     NQTDMOVPRODOLD = 0;
  END

  IF ( (ICODALMOXOLD IS NULL) OR (CCODLOTEOLD IS NULL) ) THEN
    NQTDMOVPRODOLD = 0;
  ELSE IF ( (ICODEMPAXOLD!=ICODEMPAXNEW) OR (SCODFILIALAXOLD!=SCODFILIALAXNEW) OR
            (ICODALMOXOLD!=ICODALMOXNEW) OR (CCODLOTEOLD!=CCODLOTENEW) OR
            (ICODEMPLEOLD!=ICODEMPLENEW) OR (SCODFILIALLEOLD!=SCODFILIALLENEW) ) THEN
  BEGIN
      IF ((CCODLOTEOLD!=CCODLOTENEW) OR (ICODEMPLEOLD!=ICODEMPLENEW) OR
          (SCODFILIALLEOLD!=SCODFILIALLENEW) ) THEN
      BEGIN
         UPDATE EQLOTE SET SLDLOTE = SLDLOTE+((0-:NQTDMOVPRODOLD)*:SOPERADOR)
            WHERE CODLOTE=:CCODLOTEOLD AND CODPROD=:ICODPROD
            AND CODEMP=:ICODEMPLEOLD AND CODFILIAL=:SCODFILIALLEOLD;
      END
      UPDATE EQSALDOLOTE SET SLDLOTE = SLDLOTE+((0-:NQTDMOVPRODOLD)*:SOPERADOR)
         WHERE CODPROD=:ICODPROD AND CODLOTE=:CCODLOTEOLD AND CODALMOX = :ICODALMOXOLD
           AND CODEMPAX = :ICODEMPAXOLD AND CODFILIALAX = :SCODFILIALAXOLD
           AND CODEMP=:ICODEMPLEOLD AND CODFILIAL=:SCODFILIALLEOLD; 
      NQTDMOVPRODOLD=0;
  END
  UPDATE EQLOTE SET SLDLOTE = SLDLOTE+((:NQTDMOVPRODNEW-:NQTDMOVPRODOLD)*:SOPERADOR)
        WHERE CODLOTE=:CCODLOTENEW AND CODPROD=:ICODPROD
         AND CODEMP=:ICODEMPLENEW AND CODFILIAL=:SCODFILIALLENEW;
  UPDATE EQSALDOLOTE SET SLDLOTE = SLDLOTE+((:NQTDMOVPRODNEW-:NQTDMOVPRODOLD)*:SOPERADOR)
         WHERE CODPROD=:ICODPROD AND CODLOTE=:CCODLOTENEW AND CODALMOX = :ICODALMOXNEW
           AND CODEMPAX = :ICODEMPAXNEW AND CODFILIALAX = :SCODFILIALAXNEW
           AND CODEMP=:ICODEMPLENEW AND CODFILIAL=:SCODFILIALLENEW;
  suspend;
end
^

/* Alter (EQSALDOPRODATEQSP) */
ALTER PROCEDURE EQSALDOPRODATEQSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
SOPERADOR SMALLINT,
NQTDMOVPRODOLD NUMERIC(15,5),
NQTDMOVPRODNEW NUMERIC(15,5),
ICODEMPAXOLD INTEGER,
SCODFILIALAXOLD SMALLINT,
ICODALMOXOLD INTEGER,
ICODEMPAXNEW INTEGER,
SCODFILIALAXNEW SMALLINT,
ICODALMOXNEW INTEGER)
 AS
DECLARE VARIABLE ICODPRODSLD INTEGER;
begin
  /* Procedure de atualizao do estoque  na tabela de saldos por almoxarifado*/
  SELECT CODPROD FROM EQSALDOPROD
     WHERE CODEMP=:ICODEMPPD AND CODFILIAL=:SCODFILIALPD AND CODPROD=:ICODPROD AND
        CODEMPAX=:ICODEMPAXNEW AND CODFILIALAX=:SCODFILIALAXNEW AND CODALMOX=:ICODALMOXNEW
     INTO :ICODPRODSLD;
  IF (ICODPRODSLD IS NULL) THEN
  BEGIN
     INSERT INTO EQSALDOPROD (CODEMP, CODFILIAL, CODPROD, CODEMPAX, CODFILIALAX, CODALMOX)
       VALUES (:ICODEMPPD, :SCODFILIALPD, :ICODPROD, :ICODEMPAXNEW, :SCODFILIALAXNEW,
         :ICODALMOXNEW);
     NQTDMOVPRODOLD = 0;
  END

  IF (ICODALMOXOLD IS NULL) THEN
    NQTDMOVPRODOLD = 0;
  ELSE IF ( (ICODEMPAXOLD!=ICODEMPAXNEW) OR (SCODFILIALAXOLD!=SCODFILIALAXNEW) OR
            (ICODALMOXOLD!=ICODALMOXNEW) ) THEN
  BEGIN
      UPDATE EQSALDOPROD SET SLDPROD = SLDPROD+((0-:NQTDMOVPRODOLD)*:SOPERADOR)
         WHERE CODPROD=:ICODPROD AND CODALMOX = :ICODALMOXOLD
           AND CODEMPAX = :ICODEMPAXOLD AND CODFILIALAX = :SCODFILIALAXOLD
           AND CODEMP=:ICODEMPPD AND CODFILIAL=:SCODFILIALPD;
      NQTDMOVPRODOLD=0;
  END
  UPDATE EQSALDOPROD SET SLDPROD = SLDPROD+((:NQTDMOVPRODNEW-:NQTDMOVPRODOLD)*:SOPERADOR)
         WHERE CODPROD=:ICODPROD AND CODALMOX = :ICODALMOXNEW
           AND CODEMPAX = :ICODEMPAXNEW AND CODFILIALAX = :SCODFILIALAXNEW
           AND CODEMP=:ICODEMPPD AND CODFILIAL=:SCODFILIALPD;
  suspend;
end
^

/* Alter (FNADICITRECEBERSP01) */
ALTER PROCEDURE FNADICITRECEBERSP01(CALTVLR CHAR,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRDESCITREC NUMERIC(15,5),
NVLRMULTAITREC NUMERIC(15,5),
NVLRJUROSITREC NUMERIC(15,5),
NVLRPARCITREC NUMERIC(15,5),
NVLRPAGOITREC NUMERIC(15,5),
DDTITREC DATE,
DDTCOMPITREC DATE,
DDTVENCITREC DATE,
CSTATUSITREC CHAR(2),
CFLAG CHAR,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3),
ICODEMPTC INTEGER,
SCODFILIALTC SMALLINT,
ICODTIPOCOB INTEGER,
ICODEMPCB INTEGER,
SCODFILIALCB SMALLINT,
CODCARTCOB CHAR(3),
NVLRCOMIITREC NUMERIC(15,5),
OBSITREC VARCHAR(250),
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
NUMCONTA CHAR(10),
CODEMPPN INTEGER,
CODFILIALPN SMALLINT,
CODPLAN CHAR(13),
ANOPLAN SMALLINT,
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC SMALLINT,
CODCC CHAR(19),
VLRBASECOMIS NUMERIC(15,5))
 AS
declare variable inparcitrecold integer;
declare variable doclancaitrec varchar(15);
begin
   SELECT ir.doclancaitrec,ir.NPARCITREC FROM FNITRECEBER IR WHERE IR.CODEMP=:ICODEMP AND
     IR.CODFILIAL=:SCODFILIAL AND IR.CODREC=:ICODREC AND
     IR.NPARCITREC=:INPARCITREC INTO :doclancaitrec, :INPARCITRECOLD;

   IF (INPARCITRECOLD IS NULL) THEN
     /* Faz insero na tabela de parcelas do contas a receber */
      INSERT INTO FNITRECEBER(CODEMP,CODFILIAL,CODREC,NPARCITREC,VLRDESCITREC,VLRMULTAITREC,
              VLRJUROSITREC,VLRPARCITREC,VLRPAGOITREC,DTITREC, DTCOMPITREC, DTVENCITREC,
              STATUSITREC,FLAG,CODEMPBO,CODFILIALBO,CODBANCO,
              CODEMPTC, CODFILIALTC, CODTIPOCOB,
              CODEMPCB, CODFILIALCB, CODCARTCOB, VLRCOMIITREC, OBSITREC, CODEMPCA,CODFILIALCA,NUMCONTA,dtprevitrec,
              codemppn, codfilialpn, codplan, anoplan, codempcc, codfilialcc, anocc, codcc, vlrbasecomis, doclancaitrec)
              VALUES
             (:ICODEMP,:SCODFILIAL,:ICODREC,:INPARCITREC,:NVLRDESCITREC,:NVLRMULTAITREC,
             :NVLRJUROSITREC,:NVLRPARCITREC,:NVLRPAGOITREC, :DDTITREC, :DDTCOMPITREC, :DDTVENCITREC,
             :CSTATUSITREC,:CFLAG,:ICODEMPBO,:SCODFILIALBO,:CCODBANCO,
             :ICODEMPTC, :SCODFILIALTC, :ICODTIPOCOB,
             :ICODEMPCB, :SCODFILIALCB, :CODCARTCOB, :NVLRCOMIITREC, :OBSITREC, :codempca, :codfilialca, :numconta,:ddtvencitrec,
             :codemppn, :codfilialpn, :codplan, :anoplan, :codempcc, :codfilialcc, :anocc, :codcc,:vlrbasecomis,:doclancaitrec );
   ELSE
   BEGIN
       SELECT VLRDESCITREC, VLRMULTAITREC, VLRJUROSITREC, VLRPAGOITREC, STATUSITREC
       FROM FNITRECEBER
       WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODREC=:ICODREC AND
            NPARCITREC=:INPARCITREC
       INTO :NVLRDESCITREC, :NVLRMULTAITREC, :NVLRJUROSITREC, :NVLRPAGOITREC, :CSTATUSITREC;

       IF (CALTVLR='S') THEN /* Flag que indica se  para mudar os valores do contas a receber */
       BEGIN

           UPDATE FNITRECEBER SET ALTUSUITREC='N',VLRDESCITREC=:NVLRDESCITREC,VLRMULTAITREC=:NVLRMULTAITREC,
                  VLRJUROSITREC=:NVLRJUROSITREC,VLRPARCITREC=:NVLRPARCITREC,
                  VLRPAGOITREC=:NVLRPAGOITREC,DTITREC=:DDTITREC,STATUSITREC=:CSTATUSITREC,
                  FLAG=:CFLAG,CODEMPBO=:ICODEMPBO,CODFILIALBO=:SCODFILIALBO,
                  CODBANCO=:CCODBANCO,CODEMPTC=:ICODEMPTC, CODFILIALTC=:SCODFILIALTC, 
                  CODTIPOCOB=:ICODTIPOCOB,
                  CODEMPCB=:ICODEMPCB, CODFILIALCB=:SCODFILIALCB, CODCARTCOB=:CODCARTCOB,
                  VLRCOMIITREC=:NVLRCOMIITREC, CODEMPCA=:codempca, codfilialca=:codfilialca, numconta=:numconta,
                  vlrbasecomis=:vlrbasecomis, obsitrec=:obsitrec
            WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODREC=:ICODREC AND
                NPARCITREC=:INPARCITREC;
       END
       ELSE
           UPDATE FNITRECEBER SET ALTUSUITREC='N',DTITREC=:DDTITREC,
                  STATUSITREC=:CSTATUSITREC, FLAG=:CFLAG,CODEMPBO=:ICODEMPBO,
                  CODFILIALBO=:SCODFILIALBO,CODBANCO=:CCODBANCO,CODEMPTC=:ICODEMPTC,
                  CODFILIALTC=:SCODFILIALTC, CODTIPOCOB=:ICODTIPOCOB,
                  CODEMPCB=:ICODEMPCB, CODFILIALCB=:SCODFILIALCB, CODCARTCOB=:CODCARTCOB,
                  VLRCOMIITREC=:NVLRCOMIITREC, obsitrec=:obsitrec
            WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODREC=:ICODREC AND
                NPARCITREC=:INPARCITREC;
  END
 -- suspend;
end
^

/* Alter (FNADICLANCASP01) */
ALTER PROCEDURE FNADICLANCASP01(ICODREC INTEGER,
INPARCITREC INTEGER,
PDVITREC CHAR,
SNUMCONTA CHAR(10),
ICODEMPCA INTEGER,
ICODFILIALCA INTEGER,
ICODCLI INTEGER,
ICODEMPCL INTEGER,
ICODFILIALCL INTEGER,
SCODPLAN CHAR(13),
ANOPLAN SMALLINT,
ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
IANOCC INTEGER,
SCODCC CHAR(19),
ICODEMPCC INTEGER,
ICODFILIALCC INTEGER,
DDTCOMPITREC DATE,
DDTPAGOITREC DATE,
SDOCLANCAITREC VARCHAR(15),
SOBSITREC CHAR(250),
DVLRPAGOITREC NUMERIC(15,5),
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DVLRPAGOJUROS NUMERIC(15,5),
DVLRDESC NUMERIC(15,5),
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
CODCONTR INTEGER,
CODITCONTR SMALLINT,
CODEMPEM INTEGER,
CODFILIALEM SMALLINT,
MATEMPR INTEGER,
TPAG CHAR(2),
CODEMPTC INTEGER,
CODFILIALTC SMALLINT,
CODTIPOCOB INTEGER)
 AS
declare variable icodlanca integer;
declare variable scodplanconta char(13);
declare variable anoplanconta smallint;
declare variable icodemppconta integer;
declare variable icodfilialpconta integer;
declare variable cflag char(1);
declare variable ifiliallanca integer;
declare variable tipolanca char(1);
declare variable codempjr integer;
declare variable codfilialjr smallint;
declare variable codplanjr char(13);
declare variable anoplanjr smallint;
declare variable codempdc integer;
declare variable codfilialdc smallint;
declare variable codplandc char(13);
declare variable anoplandc smallint;
declare variable codsublanca smallint = 1;
begin
    select icodfilial from sgretfilial(:icodemp,'FNLANCA') into ifiliallanca;
    select codplan,anoplan,codemppn,codfilialpn from fnconta where numconta = :snumconta
        and codemp=:icodempca and codfilial=:icodfilialca into :scodplanconta,:anoplanconta,:icodemppconta,:icodfilialpconta;
    select iseq from spgeranum(:ICODEMP,:IFILIALLANCA,'LA') into icodlanca;
    select flag from fnreceber where codrec=:icodrec
        and codemp=:icodemp and codfilial=:icodfilial into :cflag;
    select codempjr,codfilialjr,codplanjr,anoplanjr,codempdc,codfilialdc,codplandc, anoplandc from sgprefere1
        where codemp=:icodemp and codfilial=:icodfilial
        into :codempjr,:codfilialjr,:codplanjr,:anoplanjr,:codempdc,:codfilialdc,:codplandc, :anoplandc;
    if (icodcli is null) then
        tipolanca = 'A';
    else
        tipolanca = 'C';
    if ( (dvlrpagojuros is null) or (:codplanjr is null)  ) then
        dvlrpagojuros = 0;
    else
        dvlrpagoitrec = dvlrpagoitrec - dvlrpagojuros;
    if (dvlrdesc is null  or (:codplandc is null) ) then
        dvlrdesc = 0;
    else
        dvlrpagoitrec = dvlrpagoitrec + dvlrdesc;
    insert into fnlanca (tipolanca,codemp,codfilial,codlanca,codemprc,codfilialrc,codrec,nparcitrec,codemppn,codfilialpn,codplan,anoplan, 
        dtcomplanca, datalanca, doclanca,histblanca,dtprevlanca,vlrlanca,flag,codempcl,codfilialcl,codcli,pdvitrec)
        values (:tipolanca,:icodemp,:ifiliallanca,:icodlanca,:icodemp,:icodfilial,:icodrec,:inparcitrec,:icodemppconta,:icodfilialpconta,
                :scodplanconta,:anoplanconta,:ddtcompitrec, :ddtpagoitrec,:sdoclancaitrec,:sobsitrec,:ddtpagoitrec,0,:cflag,:icodempcl,:icodfilialcl,:icodcli,:pdvitrec
        );
    insert into fnsublanca (codemp,codfilial,codlanca,codsublanca,codempcl,codfilialcl,codcli,codemppn,codfilialpn,codplan,anoplan,
                codemprc, codfilialrc, codrec, nparcitrec,
                codempcc, codfilialcc,anocc,codcc,origsublanca, dtcompsublanca, datasublanca,dtprevsublanca,vlrsublanca,flag, codempct, codfilialct, codcontr, coditcontr
                , codempem, codfilialem, matempr, tpag, codemptc, codfilialtc, codtipocob)
        values (:icodemp,:ifiliallanca,:icodlanca,:codsublanca,:icodempcl,:icodfilialcl,:icodcli,:icodemppn,:icodfilialpn,:scodplan,:anoplan,
                :icodemp, :icodfilial, :icodrec, :inparcitrec,
                :icodempcc,:icodfilialcc,:ianocc,:scodcc,'S',:ddtcompitrec,:ddtpagoitrec,:ddtpagoitrec,:dvlrpagoitrec*-1,:cflag, :codempct, :codfilialct, :codcontr, :coditcontr
                , :codempem, :codfilialem, :matempr, :tpag, :codemptc, :codfilialtc, :codtipocob
        );
    -- Lanamento dos juros em conta distinta.
    if(dvlrpagojuros > 0) then
    begin
        codsublanca = codsublanca + 1;
        insert into fnsublanca (codemp,codfilial,codlanca,codsublanca,codempcl,codfilialcl,codcli,codemppn,codfilialpn,codplan,anoplan,
                 codemprc, codfilialrc, codrec, nparcitrec,
                  codempcc, codfilialcc,anocc,codcc,origsublanca,dtcompsublanca,datasublanca,dtprevsublanca,vlrsublanca,flag, tiposublanca, codempct, codfilialct, codcontr, coditcontr
                  , codempem, codfilialem, matempr, tpag, codemptc, codfilialtc, codtipocob)
        values (:icodemp,:ifiliallanca,:icodlanca,:codsublanca,:icodempcl,:icodfilialcl,:icodcli,:codempjr,:codfilialjr,:codplanjr,:anoplanjr,
                :icodemp, :icodfilial, :icodrec, :inparcitrec,
                :icodempcc, :icodfilialcc,:ianocc,:scodcc,'S',:ddtcompitrec,:ddtpagoitrec,:ddtpagoitrec,:dvlrpagojuros*-1,:cflag, 'J', :codempct, :codfilialct, :codcontr, :coditcontr
                , :codempem, :codfilialem, :matempr, :tpag, :codemptc, :codfilialtc, :codtipocob
        );
    end
    -- Lanamento do desconto em conta distinta.
    if(dvlrdesc > 0) then
    begin
        codsublanca = codsublanca + 1;
        insert into fnsublanca (codemp,codfilial,codlanca,codsublanca,codempcl,codfilialcl,codcli,codemppn,codfilialpn,codplan,anoplan,
             codemprc, codfilialrc, codrec, nparcitrec,
             codempcc, codfilialcc,anocc,codcc,origsublanca,dtcompsublanca,datasublanca,dtprevsublanca,vlrsublanca,flag, tiposublanca
             , codempct, codfilialct, codcontr, coditcontr
             , codempem, codfilialem, matempr, tpag, codemptc, codfilialtc, codtipocob)
        values (:icodemp,:ifiliallanca,:icodlanca,:codsublanca,:icodempcl,:icodfilialcl,:icodcli,:codempdc,:codfilialdc,:codplandc,:anoplandc,
               :icodemp, :icodfilial, :icodrec, :inparcitrec,
             :icodempcc, :icodfilialcc,:ianocc,:scodcc,'S',:ddtcompitrec,:ddtpagoitrec,:ddtpagoitrec,:dvlrdesc,:cflag, 'D'
             , :codempct, :codfilialct, :codcontr, :coditcontr
             , :codempem, :codfilialem, :matempr, :tpag, :codemptc, :codfilialtc, :codtipocob
        );
    end
end
^

/* Alter (FNADICLANCASP02) */
ALTER PROCEDURE FNADICLANCASP02(ICODPAG INTEGER,
INPARCPAG INTEGER,
SNUMCONTA CHAR(10),
ICODEMPCA INTEGER,
ICODFILIALCA INTEGER,
ICODFOR INTEGER,
ICODEMPFR INTEGER,
ICODFILIALFR INTEGER,
ANOPLAN SMALLINT,
SCODPLAN CHAR(13),
ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
IANOCC INTEGER,
SCODCC CHAR(19),
ICODEMPCC INTEGER,
ICODFILIALCC INTEGER,
DDTCOMPITPAG DATE,
DDTPAGOITPAG DATE,
SDOCLANCAITPAG VARCHAR(15),
SOBSITPAG CHAR(250),
DVLRPAGOITPAG NUMERIC(15,5),
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DVLRJUROSPAG NUMERIC(15,5),
DVLRDESC NUMERIC(15,5),
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
CODCONTR INTEGER,
CODITCONTR SMALLINT,
CODEMPEM INTEGER,
CODFILIALEM SMALLINT,
MATEMPR INTEGER)
 AS
declare variable icodlanca integer;
declare variable scodplanconta char(13);
declare variable anoplanconta smallint;
declare variable icodemppconta integer;
declare variable icodfilialpconta integer;
declare variable cflag char(1);
declare variable ifiliallanca integer;
declare variable tipolanca char(1);
declare variable codempjp integer;
declare variable codfilialjp smallint;
declare variable codplanjp char(13);
declare variable anoplanjp smallint;
declare variable codempdr integer;
declare variable codfilialdr smallint;
declare variable anoplandr smallint;
declare variable codplandr char(13);
declare variable codsublanca smallint = 1;
BEGIN

    SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNLANCA')
    INTO IFILIALLANCA;

    select codplan,anoplan,codemp,codfilial from fnconta
    where numconta=:snumconta and codemp=:icodempca and codfilial=:icodfilialca
    into :scodplanconta,:anoplanconta,:icodemppconta,:icodfilialpconta;

    SELECT ISEQ FROM SPGERANUM(:iCODEMP,:IFILIALLANCA,'LA')
    INTO :iCodLanca;

    select flag from fnpagar
    where codpag=:icodpag and codemp=:icodemp and codfilial=:icodfilial
    into :cflag;

    select codempjp,codfilialjp,codplanjp,anoplanjp,codempdr,codfilialdr,codplandr, anoplandr
    from sgprefere1
    where codemp=:icodemp and codfilial=:icodfilial
    into :codempjp,:codfilialjp,:codplanjp,:anoplanjp, :codempdr,:codfilialdr,:codplandr, :anoplandr;

    IF (ICODFOR IS NULL) THEN
        TIPOLANCA = 'A';
      ELSE
        TIPOLANCA = 'F';

    if ( (dvlrjurospag is null) or (:codplanjp is null)  ) then
        dvlrjurospag = 0;
    else
        dvlrpagoitpag = dvlrpagoitpag - dvlrjurospag;

    if (dvlrdesc is null  or (:codplandr is null) ) then
        dvlrdesc = 0;
    else
        dvlrpagoitpag = dvlrpagoitpag + dvlrdesc;

    insert into fnlanca (tipolanca,codemp,codfilial,codlanca,codemppg,codfilialpg,codpag,
                         nparcpag,codemppn,codfilialpn,codplan,anoplan,dtcomplanca,datalanca,doclanca,
                         histblanca,dtprevlanca,vlrlanca,flag, codempfr, codfilialfr, codfor)
         values (:tipolanca,:icodemp,:ifiliallanca,:icodlanca,:icodemp,:icodfilial,:icodpag,
                 :inparcpag,:icodemppconta,:icodfilialpconta,:scodplanconta, :anoplanconta, :ddtcompitpag, :ddtpagoitpag,:sdoclancaitpag,
                 :sobsitpag,:ddtpagoitpag,0,:cflag, :icodempfr, :icodfilialfr, :icodfor
         );

    insert into fnsublanca (codemp,codfilial,codlanca,codsublanca,codempfr,codfilialfr,codfor,codemppn,codfilialpn, codplan, anoplan,
        codemppg, codfilialpg, codpag, nparcpag,
        codempcc,codfilialcc,anocc,codcc,origsublanca,dtcompsublanca,datasublanca,dtprevsublanca,vlrsublanca,flag,
        codempct, codfilialct, codcontr, coditcontr, codempem, codfilialem, matempr)
        values (:icodemp,:ifiliallanca,:icodlanca,:codsublanca,:icodempfr,:icodfilialfr,:icodfor,:icodemppn,:icodfilialpn, :scodplan, :anoplan,
        :icodemp,:icodfilial,:icodpag, :inparcpag,
        :icodempcc,:icodfilialcc,:ianocc,:scodcc,'E',:ddtcompitpag,:ddtpagoitpag,:ddtpagoitpag,:dvlrpagoitpag,:cflag,
        :codempct, :codfilialct, :codcontr, :coditcontr, :codempem, :codfilialem, :matempr);

    -- Lanamento dos juros em conta distinta.

    IF(DVLRJUROSPAG >0) THEN
    BEGIN

        CODSUBLANCA = CODSUBLANCA + 1;

        insert into fnsublanca (codemp,codfilial,codlanca,codsublanca,codempfr,codfilialfr,codfor,
             codemppn,codfilialpn,codplan,anoplan,codempcc,codfilialcc,anocc,codcc,origsublanca,dtcompsublanca,datasublanca,dtprevsublanca,vlrsublanca,
             codemppg, codfilialpg, codpag, nparcpag, flag, tiposublanca
             , codempct, codfilialct, codcontr, coditcontr, codempem, codfilialem, matempr
             )
            values (:icodemp,:ifiliallanca,:icodlanca,:codsublanca,:icodempfr,:icodfilialfr,:icodfor,
            :codempjp,:codfilialjp,:codplanjp,:anoplanjp,:icodempcc,:icodfilialcc,:ianocc,:scodcc,'E',:ddtcompitpag,:ddtpagoitpag,:ddtpagoitpag,:dvlrjurospag,
            :icodemp, :icodfilial, :icodpag, :inparcpag,:cflag, 'J'
            , :codempct, :codfilialct, :codcontr, :coditcontr, :codempem, :codfilialem, :matempr
            );

    END

    -- Lanamento de desconto em conta distinta.
    if(dvlrdesc >0) then
    begin
        codsublanca = codsublanca + 1;
        insert into fnsublanca (codemp,codfilial,codlanca,codsublanca,codempfr,codfilialfr,codfor,
        codemppn,codfilialpn,codplan,anoplan,codempcc,codfilialcc,anocc,codcc,origsublanca,dtcompsublanca,datasublanca,dtprevsublanca,vlrsublanca,
              codemppg, codfilialpg, codpag, nparcpag, flag, tiposublanca
              , codempct, codfilialct, codcontr, coditcontr, codempem, codfilialem, matempr)
            values (:icodemp,:ifiliallanca,:icodlanca,:codsublanca,:icodempfr,:icodfilialfr,:icodfor,
             :codempdr,:codfilialdr,:codplandr,:anoplandr,:icodempcc,:icodfilialcc,:ianocc,:scodcc,'E',:ddtcompitpag,:ddtpagoitpag,:ddtpagoitpag,:dvlrdesc*-1
             ,:icodemp, :icodfilial, :icodpag, :inparcpag, :cflag, 'D'
             ,:codempct, :codfilialct, :codcontr, :coditcontr, :codempem, :codfilialem, :matempr
             );
    end

END
^

/* Alter (FNADICPAGARSP01) */
ALTER PROCEDURE FNADICPAGARSP01(CODCOMPRA INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
CODPLANOPAG INTEGER,
ICODEMPFR INTEGER,
ICODFILIALFR SMALLINT,
CODFOR INTEGER,
VLRLIQCOMPRA NUMERIC(18,2),
DTSAIDACOMPRA DATE,
DTCOMPCOMPRA DATE,
DOCCOMPRA INTEGER,
ICODEMPBO INTEGER,
ICODFILIALBO SMALLINT,
CODBANCO CHAR(3),
FLAG CHAR,
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
CODEMPTC INTEGER,
CODFILIALTC SMALLINT,
CODTIPOCOB INTEGER,
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
NUMCONTA CHAR(10),
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC SMALLINT,
CODCC CHAR(19),
CODEMPPN INTEGER,
CODFILIALPN SMALLINT,
CODPLAN CHAR(13),
ANOPLAN SMALLINT,
OBSPAG VARCHAR(250))
 AS
declare variable icodpagar integer;
declare variable ifilialpagar integer;
declare variable numparcs integer;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNPAGAR') INTO IFILIALPAGAR;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALPAGAR,'PA') INTO ICODPAGAR;
  SELECT COALESCE(PARCPLANOPAG,0) FROM FNPLANOPAG WHERE CODEMP=:icodemppg AND CODFILIAL=:icodfilialpg AND codplanopag=:codplanopag
  INTO NUMPARCS;

  IF(numparcs>0) THEN
  BEGIN
      INSERT INTO FNPAGAR (CODEMP,CODFILIAL,CODPAG,CODPLANOPAG,CODEMPPG,CODFILIALPG,CODFOR,CODEMPFR,
                          CODFILIALFR,CODCOMPRA,CODEMPCP,CODFILIALCP,VLRPAG,
                          VLRDESCPAG,VLRMULTAPAG,VLRJUROSPAG,VLRPARCPAG,VLRPAGOPAG,
                          VLRAPAGPAG,DATAPAG, DTCOMPPAG, STATUSPAG,DOCPAG,CODBANCO,CODEMPBO,CODFILIALBO,FLAG,
                          CODEMPTC, CODFILIALTC, CODTIPOCOB,
                          codempca, codfilialca,  numconta, codempcc, codfilialcc, anocc, codcc, codemppn, codfilialpn, codplan, anoplan, obspag)
                          VALUES (
                                 :ICODEMP,:IFILIALPAGAR,:ICODPAGAR,:CodPlanoPag,:ICODEMPPG,:ICODFILIALPG,:CodFor,:ICODEMPFR,
                                 :ICODFILIALFR,:CodCompra,:ICODEMP,:ICODFILIAL,:VlrLiqCompra,
                                 0,0,0,:VlrLiqCompra,0,:VlrLiqCompra,:dtSaidaCompra, :DTCOMPCOMPRA, 'P1',:DocCompra,
                                 :CodBanco,:ICODEMPBO,:ICODFILIALBO,:FLAG,
                                 :CODEMPTC, :CODFILIALTC, :CODTIPOCOB,
                                 :codempct, :codfilialct, :numconta, :codempcc, :codfilialcc, :anocc, :codcc, :codemppn, :codfilialpn, :codplan, :anoplan, :obspag
                          );
   END
END
^

/* Alter (FNADICPAGARSP02) */
ALTER PROCEDURE FNADICPAGARSP02(CODEMPOC INTEGER,
CODFILIALOC SMALLINT,
CODORDCP INTEGER,
CODEMPPP INTEGER,
CODFILIALPP SMALLINT,
CODPLANOPAG INTEGER,
CODEMPFR INTEGER,
CODFILIALFR SMALLINT,
CODFOR INTEGER,
OBSPAG VARCHAR(2000))
 AS
declare variable codpag integer;
declare variable codfilialpag integer;
declare variable numparcs integer;
declare variable valor decimal(15,5);
declare variable data date;

BEGIN     
    
    -- Buscando filial para tabela FNPAGAR
    select icodfilial from sgretfilial( :codemppp, 'FNPAGAR' ) into :codfilialpag;

    -- Gerando cdigo do pagamento
    select iseq from spgeranum( :codemppp, :codfilialpag, 'PA') into :codpag;

    -- Consultando nmero de parcelas do plano de pagamento
    select coalesce( parcplanopag, 0 ) from fnplanopag
        where codemp=:codemppp and codfilial=:codfilialpp and codplanopag=:codplanopag
        into :numparcs;

    -- Limpando empenhos anteriores
    delete from fnpagar pg where pg.codempoc=:codempoc and pg.codfilialoc=:codfilialoc and pg.codordcp=:codordcp;

    -- Precorre tabela de previses de entrega para gerar os empenhos no contas a pagar.
    for select pe.dtitpe data, sum(( io.vlrliqapitordcp/io.qtdapitordcp ) * cast(pe.qtditpe-pe.qtditentpe as decimal(8,2))) valor
        from cpitordcompra io, cpitordcomprape pe
        where
            io.codemp=:codempoc and io.codfilial=:codfilialoc and io.codordcp=:codordcp and
            pe.codemp=io.codemp and pe.codfilial=io.codfilial and pe.codordcp=io.codordcp and pe.coditordcp=io.coditordcp and
            (pe.qtditpe-pe.qtditentpe) >0
        group by pe.dtitpe
        order by pe.dtitpe
        into data, :valor

        do begin
                    
            -- Se existirem parcelas a gerar.

            if( numparcs>0 ) then
            begin

                insert into fnpagar (
                    codemp, codfilial, codpag,
                    codemppg, codfilialpg, codplanopag,
                    codempfr, codfilialfr, codfor,
                    codempoc, codfilialoc, codordcp,
                    vlrpag, vlrparcpag, vlrapagpag,
                    datapag, dtcomppag, statuspag, docpag, obspag )
                values (
                    :codempoc, :codfilialpag, :codpag,
                    :codemppp, :codfilialpp, :codplanopag,
                    :codempfr, :codfilialfr, :codfor,
                    :codempoc, :codfilialoc, :codordcp,
                    :valor, :valor, :valor,
                    :data, :data, 'P1', :codordcp, substring(:obspag from 1 for 250)
                );

                 -- Gerando cdigo do pagamento
                 select iseq from spgeranum( :codemppp, :codfilialpag, 'PA') into :codpag;

            end
     end

END
^

/* Alter (FNADICRECEBERSP01) */
ALTER PROCEDURE FNADICRECEBERSP01(TIPOVENDA CHAR,
CODVENDA INTEGER,
CODEMPTC INTEGER,
CODFILIALTC INTEGER,
CODTIPOCOB INTEGER,
CODEMPPG INTEGER,
CODFILIALPG SMALLINT,
CODPLANOPAG INTEGER,
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
CODEMPVD INTEGER,
CODFILIALVD SMALLINT,
CODVEND INTEGER,
VLRLIQVENDA NUMERIC(15,5),
DTVENDA DATE,
DTCOMP DATE,
VLRCOMISVENDA NUMERIC(15,5),
DOCVENDA INTEGER,
CODEMPBO INTEGER,
CODFILIALBO SMALLINT,
CODBANCO CHAR(3),
CODEMP INTEGER,
CODFILIAL SMALLINT,
CODEMPCB INTEGER,
CODFILIALCB SMALLINT,
CODCARTCOB CHAR(3),
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
NUMCONTA CHAR(10),
FLAG CHAR,
OBSREC VARCHAR(250),
VLRBASECOMIS NUMERIC(15,5),
VLRRETENSAOISS NUMERIC(15,5))
 AS
declare variable codrec integer;
declare variable codfilialrc smallint;
declare variable parcplanopag integer;
BEGIN
  SELECT R.CODREC,R.CODFILIAL FROM FNRECEBER R
     WHERE R.CODEMPVA=:CODEMP AND R.CODFILIALVA=:CODFILIAL AND
       R.TIPOVENDA=:TIPOVENDA AND R.CODVENDA=:CODVENDA
     INTO :CODREC,:CODFILIALRC;
  SELECT PARCPLANOPAG FROM FNPLANOPAG WHERE CODEMP=:CODEMPPG AND
     CODFILIAL=:CODFILIALPG AND CODPLANOPAG=:CODPLANOPAG
     INTO :PARCPLANOPAG;

  IF ( (CODREC IS NULL) AND (PARCPLANOPAG>0) ) THEN
  BEGIN
     SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'FNRECEBER') INTO :CODFILIALRC;
     SELECT ISEQ FROM SPGERANUM(:CODEMP,:CODFILIALRC,'RC') INTO :CODREC;

     -- Caso haja retenso de ISS deve
     if(coalesce(:vlrretensaoiss,0)>0) then
     begin
        vlrliqvenda = vlrliqvenda - vlrretensaoiss;
     end

     INSERT INTO FNRECEBER (CODEMP,CODFILIAL,CODREC, CODTIPOCOB, CODEMPTC, CODFILIALTC,
              CODPLANOPAG,CODEMPPG,CODFILIALPG,CODCLI,
              CODEMPCL,CODFILIALCL,CODVEND,CODEMPVD,CODFILIALVD,TIPOVENDA,CODVENDA,
              CODEMPVA,CODFILIALVA,VLRREC,
              VLRDESCREC,VLRMULTAREC,VLRJUROSREC,VLRPARCREC,VLRPAGOREC,
              VLRAPAGREC,DATAREC, DTCOMPREC, STATUSREC,VLRCOMIREC,DOCREC,CODBANCO,CODEMPBO,CODFILIALBO,
              CODEMPCB, CODFILIALCB, CODCARTCOB, CODEMPCA, CODFILIALCA, NUMCONTA,
              FLAG, OBSREC, vlrbasecomis)
              VALUES (
                     :CODEMP, :CODFILIALRC, :CODREC, :CODTIPOCOB, :CODEMPTC, :CODFILIALTC,
                     :CodPlanoPag, :CODEMPPG, :CODFILIALPG, :CodCli,
                     :CODEMPCL, :CODFILIALCL, :CodVend, :CODEMPVD, :CODFILIALVD, :TIPOVENDA, :CodVenda,
                     :CODEMP, :CODFILIAL, :VlrLiqVenda,
                     0,0,0,:VlrLiqVenda,0,:VlrLiqVenda,:dtVenda, :dtComp, 'R1',
                     :VlrComisVenda,:DocVenda,:CodBanco,:CODEMPBO,:CODFILIALBO,
                     :CODEMPCB, :CODFILIALCB, :CODCARTCOB, 
                     :CODEMPCA, :CODFILIALCA, :NUMCONTA,
                     :FLAG, :OBSREC,:vlrbasecomis
              );
  END
  ELSE IF (CODREC IS NOT NULL) THEN
  BEGIN
    IF (PARCPLANOPAG>0) THEN
    BEGIN
        UPDATE FNRECEBER SET ALTUSUREC='N',
              CODTIPOCOB=:CODTIPOCOB, CODEMPTC=:CODEMPTC, CODFILIALTC=:CODFILIALTC,
              CODPLANOPAG=:CodPlanoPag, CODEMPPG=:CODEMPPG, CODFILIALPG=:CODFILIALPG,
              CODCLI=:CodCli, CODEMPCL=:CODEMPCL, CODFILIALCL=:CODFILIALCL,
              CODVEND=:CodVend, CODEMPVD=:CODEMPVD, CODFILIALVD=:CODFILIALVD,
              VLRREC=:VlrLiqVenda, VLRDESCREC=0, VLRMULTAREC=0, VLRJUROSREC=0,
              VLRPARCREC=:VlrLiqVenda, VLRPAGOREC=0, VLRAPAGREC=:VlrLiqVenda,
              DATAREC=:dtVenda, VLRCOMIREC=:VlrComisVenda,
              /* STATUSREC='R1' */
              DOCREC=:DocVenda, 
              CODEMPBO=:CODEMPBO, CODFILIALBO=:CODFILIALBO, CODBANCO=:CODBANCO,
              CODEMPCB=:CODEMPCB, CODFILIALCB=:CODFILIALCB, CODCARTCOB=:CODCARTCOB,
              CODEMPCA=:CODEMPCA, CODFILIALCA=:CODFILIALCA, NUMCONTA=:NUMCONTA,
              FLAG=:FLAG, vlrbasecomis=:vlrbasecomis
             WHERE CODREC=:CODREC AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIALRC;

        UPDATE FNITRECEBER SET ALTUSUITREC='S', /* Atualiza os itens de contas a */
         /* receber para ajustar automaticamente os valores no cabealho */
              CODEMPBO=:CODEMPBO, CODFILIALBO=:CODFILIALBO, CODBANCO=:CODBANCO,
              CODEMPCB=:CODEMPCB, CODFILIALCB=:CODFILIALCB, CODCARTCOB=:CODCARTCOB,
              CODEMPCA=:CODEMPCA, CODFILIALCA=:CODFILIALCA, NUMCONTA=:NUMCONTA
             WHERE CODREC=:CODREC AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIALRC;
     END
     ELSE
     BEGIN
         DELETE FROM FNRECEBER WHERE CODREC=:CODREC AND CODEMP=:CODEMP AND
            CODFILIAL=:CODFILIALRC;
     END
   END

END
^

SET TERM ; ^

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Indica se deve ser realizada a retenso do tributo ISS (descontando do valor final do ttulo)'
WHERE RDB$PROCEDURE_NAME = 'FNADICRECEBERSP01' AND RDB$PARAMETER_NAME = 'VLRRETENSAOISS';

/* Alter (FNESTORNACOMISSAOSP) */
SET TERM ^ ;

ALTER PROCEDURE FNESTORNACOMISSAOSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODREC INTEGER,
NPARCITREC SMALLINT)
 AS
declare variable vlrvendacomi numeric(15,5);
declare variable vlrcomi numeric(15,5);
declare variable datacomi date;
declare variable dtcompcomi date;
declare variable dtvenccomi date;
declare variable tipocomi char(1);
declare variable statuscomi char(2);
declare variable dtatual date;
declare variable dtvencitrec date;
declare variable codempvd integer;
declare variable codfilialvd smallint;
declare variable codvend integer;
begin
  /* Procedure Text */
  dtatual = cast( 'now' as date);

  select first 1 c.statuscomi, c.tipocomi, c.codempvd, c.codfilialvd, c.codvend
  , c.vlrvendacomi, c.vlrcomi, c.datacomi, c.dtcompcomi, ir.dtvencitrec , c.dtvenccomi
  from vdcomissao c, fnitreceber ir
  where c.codemprc=:codemp and c.codfilialrc=:codfilial and c.codrec=:codrec and c.nparcitrec=:nparcitrec and tipocomi='R'
  and ir.codemp=c.codemprc and ir.codfilial=c.codfilialrc and ir.codrec=c.codrec and ir.nparcitrec=c.nparcitrec
  and c.statuscomi<>'CE'
  order by c.codcomi desc
  into :statuscomi, :tipocomi, :codempvd, :codfilialvd,  :codvend
  , :vlrvendacomi, :vlrcomi, :datacomi, :dtcompcomi, :dtvencitrec, :dtvenccomi;

  if (statuscomi not in ('CP') ) then
  begin
      update vdcomissao c set c.statuscomi='C1'
      where c.codemprc=:codemp and c.codfilialrc=:codfilial and c.codrec=:codrec and c.nparcitrec=:nparcitrec
      and tipocomi='R' and statuscomi not in ('CP','CE');
  end
  else if (statuscomi in ('CP') ) then
  begin
      vlrcomi = vlrcomi * -1; /* Transforma o valor da comisso em negativo */
      /* para gerar estorno */
      execute procedure vdadiccomissaosp(:codemp,:codfilial,:codrec,
         :nparcitrec, :vlrvendacomi, :vlrcomi, :datacomi , :dtcompcomi, :dtvenccomi,
         :tipocomi, :codempvd, :codfilialvd, : codvend );

     -- execute vdadiccomissaosp
  end

  /*UPDATE VDCOMISSAO SET STATUSCOMI='C1'
              WHERE CODREC=new.CODREC AND NPARCITREC=new.NPARCITREC
              AND CODEMPRC = new.CODEMP AND CODFILIALRC=new.CODFILIAL
              AND CODEMP=new.CODEMP AND CODFILIAL=:SCODFILIALCI
              AND STATUSCOMI NOT IN ('CE') AND TIPOCOMI='R';
    */
--  FOR SELECT C.CODCOMI,C.CODEMPRC, C.CODFILIALRC , C.CODREC, C.NPARCITREC,
--      C.VLRVENDACOMI, C.VLRCOMI, C.DATACOMI , C.DTCOMPCOMI, C.DTVENCCOMI,
--      C.TIPOCOMI, C.STATUSCOMI , IR.STATUSITREC, IR.DTVENCITREC
--    FROM VDCOMISSAO C, FNITRECEBER IR, FNRECEBER R
--    WHERE C.CODEMP=:CODEMP AND C.CODFILIAL=:CODFILIAL AND
--       IR.CODEMP=C.CODEMPRC AND IR.CODFILIAL=C.CODFILIALRC AND
--       IR.CODREC=C.CODREC AND IR.NPARCITREC=C.NPARCITREC AND
--       R.CODEMP=C.CODEMPRC AND R.CODFILIAL=C.CODFILIALRC AND
--       R.CODREC=C.CODREC
       --AND R.CODEMPVD=:CODEMPVD
       --AND
       --R.CODFILIALVD=:CODFILIALVD
       --AND R.CODVEND=:CODVEND AND
       --and ( (:CORDEM = 'V')  OR (C.DATACOMI BETWEEN :DINI AND :DFIM) ) AND
       --( (:CORDEM = 'E')  OR (C.DTVENCCOMI BETWEEN :DINI AND :DFIM) ) AND
--       and C.STATUSCOMI IN ('C2','CP') AND
--       IR.STATUSITREC NOT IN ('RP') AND
--       NOT EXISTS(SELECT * FROM VDCOMISSAO C2 /* Sub-select para verificar a */
          /* existencia de estorno anterior. */
--         WHERE C2.CODEMPRC=C.CODEMPRC AND C2.CODFILIALRC=C.CODFILIALRC AND
--         C2.CODREC=C.CODREC AND C2.NPARCITREC=C.NPARCITREC AND
--         C2.TIPOCOMI=C.TIPOCOMI AND C2.STATUSCOMI IN ('CE') )
--    INTO :CODCOMI, :CODEMP, :CODFILIAL, :CODREC, :NPARCITREC, :VLRVENDACOMI,
--      :VLRCOMI, :DATACOMI, :DTCOMPCOMI, :DTVENCCOMI, :TIPOCOMI, :STATUSCOMI, :STATUSITREC,
--      :DTVENCITREC
--  DO
--  BEGIN
--     IF ( (DTATUAL>DTVENCITREC) AND (STATUSCOMI='C2') ) THEN
     /* Caso a data atual seja maior que a data de vencimento e a */
     /* comisso no esteja paga, passa o status da comisso para no */
     /* liberada. */
--     BEGIN
--        UPDATE VDCOMISSAO SET STATUSCOMI='C1'
--          WHERE CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL AND
--            CODCOMI=:CODCOMI;
--     END
--     ELSE IF ( (DTATUAL>DTVENCITREC) AND (STATUSCOMI='CP') ) THEN
     /* Caso a comisso esteja paga e a parcela esteja vencida, */
     /* gera um estorno da comisso. */
--     BEGIN
--        VLRCOMI = VLRCOMI * -1; /* Transforma o valor da comisso em negativo */
        /* para gerar estorno */
     --   EXECUTE PROCEDURE vdadiccomissaosp(:CODEMP,:CODFILIAL,:CODREC,
       --   :NPARCITREC, :VLRVENDACOMI, :VLRCOMI, :DATACOMI , :DTCOMPCOMI, :DTVENCITREC,
         -- :TIPOCOMI, :codempvd, :codfilialvd, : codvend );
--     END
--  END
 -- suspend;
end
^

/* Alter (FNGERAITRECEBERSP01) */
ALTER PROCEDURE FNGERAITRECEBERSP01(CALTVLR CHAR,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
ICODEMPPG INTEGER,
SCODFILIALPG SMALLINT,
ICODPLANOPAG INTEGER,
NVLRREC NUMERIC(15,5),
DDATAREC DATE,
DDTCOMPREC DATE,
CFLAG CHAR,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3),
ICODEMPTC INTEGER,
SCODFILIALTC SMALLINT,
ICODTIPOCOB INTEGER,
ICODEMPCB INTEGER,
SCODFILIALCB SMALLINT,
CODCARTCOB CHAR(3),
NVLRCOMIREC NUMERIC(15,5),
OBSREC VARCHAR(250),
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
NUMCONTA CHAR(10),
CODEMPPN INTEGER,
CODFILIALPN SMALLINT,
CODPLAN CHAR(13),
ANOPLAN SMALLINT,
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC INTEGER,
CODCC CHAR(19),
VLRBASECOMIS NUMERIC(15,5))
 RETURNS(I INTEGER)
 AS
declare variable nperc numeric(15,5);
declare variable npercpag numeric(15,5);
declare variable nresto numeric(15,5);
declare variable inumparc integer;
declare variable idiaspag integer;
declare variable nrestocomi numeric(15,5);
declare variable nvlrcomiitrec numeric(15,5);
declare variable nvlritrec numeric(15,5);
declare variable regrvcto char(1);
declare variable rvsab char(1);
declare variable rvdom char(1);
declare variable rvfer char(1);
declare variable dtvencto date;
declare variable rvdia char(1);
declare variable dtbase date;
declare variable diavcto smallint;
declare variable casasdecfin smallint;
declare variable vlrbaseitcomis numeric(15,5);
declare variable restobasecomis numeric(15,5);
begin

    -- Inicializando variveis

    i = 0;
    nperc = 100;
    nresto = nvlrrec;
    nrestocomi = nvlrcomirec;
    dtbase = ddatarec;
    vlrbaseitcomis = vlrbasecomis;
    restobasecomis = vlrbasecomis;

    -- Buscando preferencias

    select casasdecfin from sgprefere1 where codemp=:icodemp and codfilial=:scodfilial
    into casasdecfin;

    -- Buscanco informaes do plano de pagamento
    select pp.parcplanopag, pp.regrvctoplanopag, pp.rvsabplanopag, pp.rvdomplanopag, pp.rvferplanopag, pp.rvdiaplanopag,
    pp.diavctoplanopag
    from fnplanopag pp
    where pp.codplanopag =:icodplanopag and pp.codemp=:icodemppg and pp.codfilial = :scodfilialpg
    into :inumparc, :regrvcto, :rvsab, :rvdom, :rvfer, :rvdia, :diavcto;

    -- Loop nas parcelas do plano de pagamento para gerao dos itens do contas a receber

    for select percpag, diaspag from fnparcpag
    where codplanopag=:icodplanopag and codemp=:icodemppg and codfilial =:scodfilialpg
    order by diaspag
    into :npercpag, :idiaspag
    do begin
        i = i+1;

        -- Calculando valor da parcela
        select v.deretorno from arreddouble(cast(:nvlrrec * :npercpag as numeric(15, 5))/:nperc, :casasdecfin ) v
        into :nvlritrec;

        nresto = nresto - nvlritrec;

        if (i = inumparc) then
        begin
            nvlritrec = nvlritrec + nresto;
        end

        -- Calculando o valor da comisso a pagar na parcela.
        select v.deretorno from arreddouble(cast(:nvlrcomirec * :npercpag as numeric(15, 5))/:nperc,:casasdecfin) v
        into :nvlrcomiitrec;

        nrestocomi = nrestocomi - nvlrcomiitrec;

        if (i = inumparc) then
        begin
            nvlrcomiitrec = nvlrcomiitrec + nrestocomi;
        end

         -- Calculando o valor da base da comisso especial a pagar na parcela.
        select v.deretorno from arreddouble(cast(:vlrbasecomis * :npercpag as numeric(15, 5))/:nperc,:casasdecfin) v
        into :vlrbaseitcomis;

        restobasecomis = restobasecomis - vlrbaseitcomis;

        if (i = inumparc) then
        begin
            vlrbaseitcomis = vlrbaseitcomis + restobasecomis;
        end

        -- Definindo o vencimento da parcela
        select c.dtvencret from sgcalcvencsp(:icodemp, :dtbase, :ddatarec + :idiaspag, :regrvcto,
        :rvsab, :rvdom, :rvfer, :rvdia, :diavcto, :idiaspag ) c
        into :dtvencto;

        dtbase = dtvencto;

        -- Execuntado procedimento que insere registros na tabela fnitreceber

        execute procedure fnadicitrecebersp01 (
        :caltvlr, :icodemp,:scodfilial,:icodrec,:i,0,0,0,:nvlritrec,0, :ddatarec, :ddtcomprec, :dtvencto,'R1',:cflag,
        :icodempbo,:scodfilialbo, :ccodbanco, :icodemptc, :scodfilialtc, :icodtipocob,
        :icodempcb, :scodfilialcb, :codcartcob, :nvlrcomiitrec, :obsrec, :codempca,
        :codfilialca, :numconta, :codemppn, :codfilialpn, :codplan, :anoplan, :codempcc, :codfilialcc, :anocc, :codcc, :vlrbaseitcomis);


    end
    suspend;
end
^

/* Alter (FNITRECEBERSP01) */
ALTER PROCEDURE FNITRECEBERSP01(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
NVLRPARCREC NUMERIC(15,5),
NVLRCOMIREC NUMERIC(15,5),
INROPARCREC INTEGER,
CCLASCOMIS CHAR)
 AS
declare variable inparcitrec integer;
declare variable nvlrparcitrec numeric(15,5);
declare variable nperc numeric(10,6);
declare variable nvlrcomiitrec numeric(15,5);
declare variable nresto numeric(15,5);
declare variable dvencitrec date;
begin
    -- Procedure que atualiza a comisso na tabela ITRECEBER
    nResto = nVlrComiRec;

    for select nparcitrec, vlrparcitrec, dtvencitrec from fnitreceber
    where codemp=:icodemp and codfilial=:scodfilial and codrec=:icodrec
    order by nparcitrec
    into :inparcitrec , :nvlrparcitrec, :dvencitrec do

    begin
        nperc = nvlrparcitrec / nvlrparcrec;
        nvlrcomiitrec = cast( (nvlrcomirec * nperc) as numeric(15, 5) );
        nresto = nresto - nvlrcomiitrec;

        if (inparcitrec=inroparcrec) then
        begin
            nvlrcomiitrec = nvlrcomiitrec + nresto;
        end

        update fnitreceber ir set vlrcomiitrec=:nvlrcomiitrec where codemp=:icodemp and codfilial=:scodfilial
        and codrec=:icodrec and nparcitrec=:inparcitrec;

        if (cclascomis='S') then
            execute procedure vdgeracomissaosp(:icodemp, :scodfilial, :icodrec, :inparcitrec, :nvlrcomiitrec, :dvencitrec);
    end
    suspend;
end
^

/* Alter (FNLIBCREDSP) */
ALTER PROCEDURE FNLIBCREDSP(CODEMPVD INTEGER,
CODFILIALVD INTEGER,
TIPOVENDA CHAR,
CODVENDA INTEGER,
CODCLI INTEGER,
CODEMPCL INTEGER,
CODFILIALCL INTEGER,
VLRVENDA NUMERIC(15,5),
VLRADIC NUMERIC(15,2),
CODITEM INTEGER)
 AS
declare variable prefcred char(1);
declare variable codfilial integer;
declare variable vlrcredito numeric(15,5);
declare variable ecf char(1);
declare variable vlraberto numeric(15,5);
declare variable agrup char(1);
declare variable codempclip integer;
declare variable codfilialclip smallint;
declare variable codclip integer;
declare variable vlrdif numeric(15,2);
declare variable vlrautorizado numeric(15,2);
declare variable vlrpedidoant numeric(15,2);
declare variable vlrautorizadotot numeric(15,2);
declare variable codclivencto integer;
declare variable dtvenctotr date;
begin
    select icodfilial from sgretfilial(:codempcl,'FNLIBCRED') into codfilial;
    select prefcred,lcredglobal from sgprefere1 where codemp=:codempcl and codfilial=:codfilial into prefcred, agrup;
    select first 1 cx.ecfcaixa from pvcaixa cx, sgconexao con, sgestacao est
        where est.codemp=con.codemp and est.codfilial=con.codfilial
            and est.codest=con.codterm AND cx.codfilialet=est.codfilial
            and cx.codempet=est.codemp AND cx.codest=est.codest
            and con.nrconexao=current_connection and conectado > 0
    into ecf;
    if (prefcred = 'N' or ecf='S') then /* No verificar */
        exit;
    else if (prefcred = 'L') then /*Liberar se no ultrapassar o crdito pr aprovado */
    begin
        if( :coditem is not null and :vlradic is not null  ) then
        begin
           select vi.vlrproditvenda from vditvenda vi where vi.codemp=:codempvd
           and vi.codfilial=:codfilialvd and vi.codvenda=:codvenda
           and vi.tipovenda=:tipovenda and vi.coditvenda=:coditem into :vlrdif;
        end
        vlrvenda = coalesce(vlrvenda,0) + ( coalesce(vlradic,0) - coalesce(:vlrdif,0) );
        /* busca informaes do cliente principal */
        select cli.codemppq, cli.codfilialpq, cli.codpesq
           from vdcliente cli
           where cli.codemp=:codempcl and cli.codfilial=:codfilialcl and cli.codcli=:codcli
           into codempclip, codfilialclip, codclip;
        if(agrup = 'S') then /* Verifica se deve agrupar despesas dos sub-clientes */
        begin
           /* BUSCA DE VALORES EM ABERTO */
           select coalesce(sum( (coalesce(it.vlrparcitrec,0)) - (coalesce(it.vlrpagoitrec,0)) ),0)
               from fnreceber r, vdvenda v,fnitreceber it, vdcliente cl
               where cl.codemppq=:codempclip and cl.codfilialpq=:codfilialclip and cl.codpesq=:codclip
                   and r.codempcl=cl.codemp and r.codfilialcl=cl.codfilial and r.codcli=cl.codcli
                   and (r.codempvd!=:codempvd or r.codfilialvd!=:codfilialvd or R.codvenda!=:codvenda or R.tipovenda!=:tipovenda) /* no deve contar com a venda atual */
                   and v.codemp=r.codempvd and v.codfilial=v.codfilialvd and v.codvenda=r.codvenda and v.tipovenda=r.tipovenda
                   and it.codemp=r.codemp and it.codfilial=r.codfilial and it.codrec=r.codrec and it.statusitrec not in ('RP')
               into vlraberto;
               /* BUSCA VALOR AUTORIZADO/LIBERADO */
               vlrautorizadotot = 0;
               for select lc.vlrautorizlcred,lc.vlrvendacred
                  from fnlibcred lc
                  where lc.codemp=:codempvd and lc.codfilial=:codfilialvd
                      and lc.codfilialvd=:codfilialvd and lc.codempcl=:codempcl
                      and lc.codfilialcl=:codfilialcl and lc.tipovenda=:tipovenda
                      and lc.codvenda=:codvenda and lc.dtavctolcred >= cast('today' as date)
               into :vlrautorizado, :vlrpedidoant do
               begin
                   vlrautorizadotot = :vlrautorizadotot + :vlrautorizado;
               end
               /* BUSCA DE LIMITE */
               select min(cl.dtvenctotr), sum(coalesce(tc.vlrtpcred,0))
                  from fntipocred tc, vdcliente cl
                  where cl.codemppq=:codempclip and cl.codfilial=:codfilialcl and cl.codpesq=:codclip
                      and tc.codtpcred=cl.codtpcred and tc.codemp=cl.codemptr and tc.codfilial=cl.codfilialtr
                  into :dtvenctotr, :vlrcredito;
               /* VALOR DO CREDITO  A SOMA DO CREDITO PR-FIXADO + O VALOR LIBERADO PARA O PEDIDO*/
               if ((:dtvenctotr is null) or (cast('today' as date) > :dtvenctotr)) then
               begin
                  select distinct cl.codcli
                  from fntipocred tc, vdcliente cl
                  where cl.codemppq=:codempclip and cl.codfilial=:codfilialcl and cl.codpesq=:codclip
                      and tc.codtpcred=cl.codtpcred and tc.codemp=cl.codemptr and tc.codfilial=cl.codfilialtr
                      and cl.dtvenctotr=:dtvenctotr
                  into :codclivencto;
                  exception vdvendaex04 'Validade do crdito de um dos clientes do grupo est expirada! Cd.cliente: '||:codclivencto;
               end
               if (vlrcredito is null) then 
                  vlrcredito = 0;
               if (vlrautorizadotot is null) then 
                  vlrautorizadotot = 0;
               vlrcredito = vlrcredito + vlrautorizadotot;
           end
           else /* Caso no deva agrupar as despesas dos sub-clientes */
           begin
                /* BUSCA DE VALORES EM ABERTO */
                select coalesce(sum( (coalesce(it.vlrparcitrec,0)) - (coalesce(it.vlrpagoitrec,0)) ),0)
                    from fnreceber r, vdvenda v,fnitreceber it, vdcliente cl
                    where cl.codemp=:codempvd and cl.codfilial=:codfilialvd and cl.codcli=:codcli
                        and r.codempcl=cl.codemp and r.codfilialcl=cl.codfilial and r.codcli=cl.codcli
                        and (r.codempvd!=:codempvd or r.codfilialvd!=:codfilialvd or R.codvenda!=:codvenda or R.tipovenda!=:tipovenda) /* no deve contar com a venda atual */
                        and v.codemp=r.codempvd and v.codfilial=v.codfilialvd and v.codvenda=r.codvenda and v.tipovenda=r.tipovenda
                        and it.codemp=r.codemp and it.codfilial=r.codfilial and it.codrec=r.codrec and it.statusitrec not in ('RP')
                into vlraberto;
                /* BUSCA VALOR AUTORIZADO/LIBERADO */
                vlrautorizadotot = 0;
                for select lc.vlrautorizlcred,lc.vlrvendacred
                    from fnlibcred lc
                    where lc.codemp=:codempvd and lc.codfilial=:codfilialvd
                        and lc.codfilialvd=:codfilialvd and lc.codempcl=:codempcl
                        and lc.codfilialcl=:codfilialcl and lc.tipovenda=:tipovenda
                        and lc.codvenda=:codvenda and lc.dtavctolcred >= cast('today' as date)
                into :vlrautorizado, :vlrpedidoant do
                begin
                    vlrautorizadotot = :vlrautorizadotot + :vlrautorizado;
                end
                /* BUSCA DE LIMITE */
                select cl.dtvenctotr, coalesce(tc.vlrtpcred,0)
                    from fntipocred tc, vdcliente cl
                    where cl.codcli=:codcli and cl.codemp=:codempcl
                        and cl.codfilial=:codfilialcl and tc.codtpcred=cl.codtpcred
                        and tc.codemp=cl.codemptr and tc.codfilial=cl.codfilialtr
                into :dtvenctotr, :vlrcredito;
                if ((:dtvenctotr is null) or (cast('today' as date) > :dtvenctotr)) then
                   exception vdvendaex04 'Validade do crdito do cliente expirada!';
                /* VALOR DO CREDITO  A SOMA DO CREDITO PR-FIXADO + O VALOR LIBERADO PARA O PEDIDO*/
                if (vlrcredito is null) then 
                  vlrcredito = 0;
                if (vlrautorizadotot is null) then 
                  vlrautorizadotot = 0;
                vlrcredito = vlrcredito + vlrautorizadotot;
           end
           /* CASO J EXISTA UM VALOR AUTORIZADO E O VALOR DO PEDIDO NO AUMENTOU, NO DEVE BLOQUEAR A VENDA*/
           if(vlrautorizadotot>0 and vlrpedidoant>=vlrvenda) then
           begin
               exit;
           end
           else if (vlrcredito > 0) then
           begin
              if ( (vlrvenda + vlraberto ) <= vlrcredito) then
                 exit;
              else
                 exception vdvendaex04 'VENDA:' || cast(vlrvenda as char(15)) || 'AB.: ' || cast(vlraberto as char(15)) || 'CRED.:' || cast(vlrcredito as char(15));
                /*Valor pre-aprovado insuficiente*/
           end
        end
    suspend;
end
^

/* Alter (FNSALDOPLANSP) */
ALTER PROCEDURE FNSALDOPLANSP(ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
SCODPLANANT CHAR(13),
ANOPLANANT SMALLINT,
DDATAANT DATE,
DVLRANT NUMERIC(15,5),
SCODPLANATU CHAR(13),
ANOPLANATU SMALLINT,
DDATAATU DATE,
DVLRATU NUMERIC(15,5))
 RETURNS(SRETORNO CHAR)
 AS
declare variable scodplan char(13);
  declare variable anoplan smallint;
  declare variable ddatasl date;
  declare variable dtmp date;
  declare variable dsaldosl numeric(15, 5);
  declare variable dsaldoslant numeric(15, 5);
  declare variable ifilialsaldo integer;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMPPN,'FNSALDOLANCA') INTO IFILIALSALDO;
  IF (dVlrAnt IS NULL) THEN
     dVlrAnt = 0;
  IF (dVlrAtu IS NULL) THEN
     dVlrAtu = 0;
  IF ((sCodPlanAnt IS NOT NULL) AND (rtrim(sCodPlanAnt) != '')) THEN
  BEGIN
    select codplan,anoplan,datasl,saldosl from fnsaldolanca where codplan=:scodplanant and anoplan=:anoplanant 
           and datasl =: ddataant and codemp=:icodemppn and codfilial=:ifilialsaldo
           and codemp=:icodemppn and codfilial=:icodfilialpn into scodplan, anoplan, ddatasl,dsaldosl;
    if ((scodplan = scodplanant) and (ddatasl = ddataant)) then
    begin
      update fnsaldolanca set saldosl =:dsaldosl-:dvlrant where codplan=:scodplanant and anoplan=:anoplanant
             and datasl =:ddataant and codemp=:icodemppn and codfilial=:ifilialsaldo
             and codemp=:icodemppn and codfilial=:icodfilialpn;
      for select datasl,saldosl from fnsaldolanca where codplan=:scodplanant and anoplan=:anoplanant
          and datasl >:ddataant and codemp=:icodemppn and codfilial=:ifilialsaldo
          and codemp=:icodemppn and codfilial=:icodfilialpn into :dtmp,:dsaldoslant do
      begin
         if (:dsaldoslant is null) then
            dsaldoslant = 0;
         update fnsaldolanca set saldosl = :dsaldoslant-:dvlrant where codplan=:scodplanant and anoplan=:anoplanant
                and datasl =:dtmp and codemp=:icodemppn and codfilial=:ifilialsaldo
                and codemp=:icodemppn and codfilial=:icodfilialpn;
        suspend;
      end
    end
    else
    begin
      select saldosl from fnsaldolanca where codplan=:scodplanant and anoplan=:anoplanant
             and datasl<:ddataant and codemp=:icodemppn and codfilial=:ifilialsaldo
             and codemp=:icodemppn and codfilial=:icodfilialpn into dsaldoslant;
      if (dsaldoslant is null) then
          dsaldoslant = 0;
      insert into fnsaldolanca (codemp,codfilial,codplan,anoplan,codfilialpn,codemppn,datasl,prevsl,saldosl)
             values (
                    :icodemppn,:ifilialsaldo,:scodplanant,:anoplanant, :icodemppn,:icodfilialpn,:ddataant,0,:dsaldoslant-:dvlrant
             );
      for select datasl,saldosl from fnsaldolanca where codplan=:scodplanant and anoplan=:anoplanant
                 and datasl >:ddataant and codemp=:icodemppn and codfilial=:ifilialsaldo
                 and codemp=:icodemppn and codfilial=:icodfilialpn into :dtmp,:dsaldoslant do
      begin
        if (:dsaldoslant is null) then
           dsaldoslant = 0;
        update fnsaldolanca set saldosl = :dsaldoslant-:dvlrant where codplan=:scodplanant and anoplan=:anoplanant
               and datasl =:dtmp and codemp=:icodemppn and codfilial=:ifilialsaldo
               and codemp=:icodemppn and codfilial=:icodfilialpn;
        suspend;
      end
    end
  end
  if ( (scodplanatu is not null) and (rtrim(scodplanatu) != '')) then
  begin
    select codplan,anoplan,datasl,saldosl from fnsaldolanca where codplan=:scodplanatu and anoplan=:anoplanatu
           and datasl =: ddataatu and codemp=:icodemppn and codfilial=:ifilialsaldo
  and codemp=:icodemppn and codfilial=:icodfilialpn into scodplan,anoplan,ddatasl,dsaldosl;
    if ((scodplan = scodplanatu) and (ddatasl = ddataatu)) then
    begin
      update fnsaldolanca set saldosl =:dsaldosl+:dvlratu where codplan=:scodplanatu and anoplan=:anoplanatu
             and datasl =:ddataatu and codemp=:icodemppn and codfilial=:ifilialsaldo
             and codemp=:icodemppn and codfilial=:icodfilialpn;
      for select datasl,saldosl from fnsaldolanca where codplan=:scodplanatu and anoplan=:anoplanatu
                 and datasl >:ddataatu and codemp=:icodemppn and codfilial=:ifilialsaldo
                 and codemp=:icodemppn and codfilial=:icodfilialpn into :dtmp,:dsaldoslant do
      begin
        if (:dsaldoslant is null) then
           dsaldoslant = 0;
        update fnsaldolanca set saldosl = :dsaldoslant+:dvlratu where codplan=:scodplanatu and anoplan=:anoplanatu
               and datasl =:dtmp and codemp=:icodemppn and codfilial=:ifilialsaldo
               and codemp=:icodemppn and codfilial=:icodfilialpn;
        suspend;
      end
    end
    else
    begin
      select saldosl from fnsaldolanca where codplan=:scodplanatu and anoplan=:anoplanatu
             and datasl<:ddataatu and codemp=:icodemppn and codfilial=:ifilialsaldo
             and codemp=:icodemppn and codfilial=:icodfilialpn into dsaldoslant;
      if (dsaldoslant is null) then
          dsaldoslant = 0;
      insert into fnsaldolanca (codemp,codfilial,codplan,anoplan,codemppn,codfilialpn,datasl,prevsl,saldosl)
             values (
                    :icodemppn,:ifilialsaldo,:scodplanatu,:anoplanatu,:icodemppn,:icodfilialpn,:ddataatu,0,:dsaldoslant+:dvlratu
             );
      for select datasl,saldosl from fnsaldolanca where codplan=:scodplanatu and anoplan=:anoplanatu
                 and datasl >:ddataatu and codemp=:icodemppn and codfilial=:ifilialsaldo
                 and codemp=:icodemppn and codfilial=:icodfilialpn into :dtmp,:dsaldoslant do
      begin
        if (:dsaldoslant is null) then
           dsaldoslant = 0;
        update fnsaldolanca set saldosl = :dsaldoslant+:dvlratu where codplan=:scodplanatu and anoplan=:anoplanatu
               and datasl =:dtmp and codemp=:icodemppn and codfilial=:ifilialsaldo
               and codemp=:icodemppn and codfilial=:icodfilialpn;
        suspend;
      end
    end
  end
  suspend;
end
^

/* Alter (LFBUSCAFISCALSP02) */
ALTER PROCEDURE LFBUSCAFISCALSP02(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODVENDA INTEGER,
TIPOVENDA CHAR,
CODITVENDA SMALLINT,
CODCOMPRA INTEGER,
CODITCOMPRA SMALLINT)
 RETURNS(VLRBASEPIS NUMERIC(15,5),
VLRBASECOFINS NUMERIC(15,5),
VLRPIS NUMERIC(15,5),
VLRCOFINS NUMERIC(15,5),
VLRIR NUMERIC(15,5),
VLRCSOCIAL NUMERIC(15,5),
VLRIPIIT NUMERIC(15,5),
VLRBASENCM DECIMAL(15,5),
ALIQNACNCM DECIMAL(9,2),
ALIQIMPNCM DECIMAL(9,2),
VLRNACNCM DECIMAL(15,2),
VLRIMPNCM DECIMAL(15,2),
ORIGFISC CHAR)
 AS
declare variable codempif integer;
declare variable codfilialif smallint;
declare variable codfisc char(13);
declare variable coditfisc integer;
declare variable codsittribpis char(2);
declare variable codsittribcof char(2);
declare variable vlrpisunidtrib numeric(15,5);
declare variable vlrcofunidtrib numeric(15,5);
declare variable vlrprodit numeric(15,5);
declare variable aliqpis numeric(6,2);
declare variable qtdit numeric(15,5);
declare variable aliqcofins numeric(6,2);
declare variable aliqir numeric(15,5);
declare variable aliqcsocial numeric(15,5);
declare variable vlrliqit numeric(15,5);
declare variable vlrfreteit numeric(15,5);
declare variable vlrdescit numeric(15,5);
declare variable creddebpis char(1);
declare variable creddebcof char(1);
begin
    vlrbasencm = 0;
    aliqnacncm = 0;
    aliqimpncm = 0;
    vlrnacncm = 0;
    vlrimpncm = 0;
    -- Busca de regra de classificao fiscal da venda
    if(codvenda is not null and codcompra is null) then
    begin
        select li.codsittribpis,li.codsittribcof,iv.vlrproditvenda,li.aliqpisfisc,li.vlrpisunidtrib,
        iv.qtditvenda,li.aliqcofinsfisc,coalesce(li.aliqirfisc,fi.percirfilial),coalesce(li.aliqcsocialfisc, fi.perccsocialfilial),
        iv.vlrliqitvenda, coalesce(iv.vlripiitvenda,0) vlripiitvenda, coalesce(iv.vlrfreteitvenda,0) vlrfreteitvenda,
        coalesce(iv.vlrdescitvenda,0) vlrdescitvenda, coalesce(nc.aliqnac,0) aliqnacncm, coalesce(nc.aliqimp,0) aliqimpncm,
        coalesce(iv.vlrliqitvenda,0) vlrbasencm, coalesce(li.origfisc,'0') origfisc, li.creddebpis, li.creddebcof
        from vditvenda iv left outer join lfitclfiscal li on
        li.codemp=iv.codempif and li.codfilial=iv.codfilialif and li.codfisc=iv.codfisc and li.coditfisc=iv.coditfisc
        left outer join sgfilial fi on
        fi.codemp=iv.codemp and fi.codfilial=iv.codfilial
        left outer join lfclfiscal cf on
        cf.codemp=li.codemp and cf.codfilial=li.codfilial and cf.codfisc=li.codfisc
        left outer join lfncm nc on
        nc.codncm=cf.codncm
        where
        iv.codemp=:codemp and iv.codfilial=:codfilial and iv.codvenda=:codvenda and iv.tipovenda=:tipovenda and iv.coditvenda=:coditvenda
        into
        :codsittribpis,:codsittribcof,:vlrprodit,:aliqpis,:vlrpisunidtrib,:qtdit
        ,:aliqcofins,:aliqir,:aliqcsocial,:vlrliqit,:vlripiit, :vlrfreteit, :vlrdescit
        ,:aliqnacncm, :aliqimpncm, :vlrbasencm, :origfisc, :creddebpis, :creddebcof;
    end
    -- Busca de regra de classificao fiscal da compra
    else if(codvenda is null and codcompra is not null) then
    begin
       select li.codsittribpis,li.codsittribcof,ic.vlrproditcompra,li.aliqpisfisc,li.vlrpisunidtrib,
        ic.qtditcompra,li.aliqcofinsfisc,coalesce(li.aliqirfisc,fi.percirfilial),coalesce(li.aliqcsocialfisc, fi.perccsocialfilial),
        ic.vlrliqitcompra, coalesce(ic.vlripiitcompra,0) vlripiit, coalesce(ic.vlrfreteitcompra,0) vlrfreteit,
        coalesce(ic.vlrdescitcompra,0) vlrdescit, li.creddebpis, li.creddebcof
        from cpitcompra ic 
        left outer join sgfilial fi on
        fi.codemp=ic.codemp and fi.codfilial=ic.codfilial
        left outer join lfitclfiscal li on
        li.codemp=ic.codempif and li.codfilial=ic.codfilialif and li.codfisc=ic.codfisc and li.coditfisc=ic.coditfisc
        and li.ativoitfisc='S' and li.simplesfilial=fi.simplesfilial 
        where
        ic.codemp=:codemp and ic.codfilial=:codfilial and ic.codcompra=:codcompra and ic.coditcompra=:coditcompra
        into
        :codsittribpis,:codsittribcof,:vlrprodit,:aliqpis,:vlrpisunidtrib,:qtdit,
        :aliqcofins,:aliqir,:aliqcsocial,:vlrliqit,:vlripiit, :vlrfreteit, :vlrdescit, :creddebpis, :creddebcof;
    end
    -- Definio do PIS
     if (creddebpis='S' ) then
    begin
       if ( (aliqpis is not null) and (aliqpis>0) ) then -- pis tributado pela alquota
       begin
          vlrbasepis = cast(:vlrprodit - :vlrdescit as decimal(15,2)); -- (Base do PIS = Valor total dos produtos - Implementar situaes distintas futuramente)
          vlrpis = cast((vlrbasepis * aliqpis) / 100 as decimal(15,2));
       end
       else -- pis tributado pela quantidade
       begin
          vlrpis = cast(qtdit * vlrpisunidtrib as decimal(15,2));
       end
    end
    -- Definio do COFINS
    if (creddebcof='S' ) then
    begin
       if ( (aliqcofins is not null) and (aliqcofins>0) ) then -- cofins tributado pela alquota
       begin
           vlrbasecofins = cast(:vlrprodit - :vlrdescit as decimal(15,2)); -- (Base do COFINS = Valor total dos produtos - Implementar situaes distintas futuramente)
           vlrcofins = cast((vlrbasecofins * aliqcofins) / 100 as decimal(15,2));
       end
       else -- cofins tributado pela quantidade
       begin
           vlrcofins = cast(qtdit * vlrcofunidtrib as decimal(15,2));
       end
    end
    -- Definio do IR
    vlrir = cast(((:vlrliqit + :vlripiit + :vlrfreteit) * aliqir) / 100 as decimal(15,2));
    -- Definio da CSocial
    vlrcsocial = cast(((:vlrliqit + :vlripiit + :vlrfreteit) * aliqcsocial) / 100 as decimal(15,2));
    if ( coalesce(:vlrbasencm,0)>0 ) then
    begin
       -- Clculo estimativo para lei de transparncia
       if (:origfisc in ('1','2','6','7')) then 
             vlrimpncm = cast(:vlrbasencm * :aliqimpncm / 100 as decimal(15,2));
       else
          vlrnacncm = cast(:vlrbasencm * :aliqnacncm / 100 as decimal(15,2));
    end 
  suspend;
end
^

/* Alter (LFBUSCANATSP) */
ALTER PROCEDURE LFBUSCANATSP(FILIALATUAL INTEGER,
CODEMPPD INTEGER,
CODFILIALPD SMALLINT,
CODPROD INTEGER,
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
CODEMPFR INTEGER,
CODFILIALFR SMALLINT,
CODFOR INTEGER,
CODFILIALTM SMALLINT,
CODTIPOMOV INTEGER,
CODITFISC INTEGER)
 RETURNS(CODNAT CHAR(4))
 AS
declare variable noest char(1);
declare variable cv char(1);
declare variable itmp integer;
begin

    -- Se o cdigo do fornecedor  nulo subintende-se que deve realizar a busca para uma venda usando a
    -- UF do cliente
    if (codfor is null) then
    begin
        -- Verifica se a UF do emitente (Filial)  igual o estado do destinatrio (Cliente) retorna >0 para dentro do estado
        select count(f.siglauf) from sgfilial f, vdcliente c
        where f.codemp=:codemppd and f.codfilial=:filialatual and c.codcli=:codcli and c.codemp=:codempcl
        and c.codfilial=:codfilialcl and f.siglauf=coalesce(c.siglauf,c.ufcli)
        into itmp;
        -- Atualiza varivel que indica se  compra ou venda para V (Venda)
        cv = 'V';
    end
    -- Se for uma busca de natureza de operao para compra (Busca pelo estado do fornecedor)
    else
    begin
        -- Verifica se a UF do emitente (Fornecedor)  igual o estado do destinatrio (Filial) retorna >0 para dentro do estado
        select count(f.siglauf) from sgfilial f, cpforneced fo
        where f.codemp=:codemppd and f.codfilial=:filialatual and fo.codfor=:codfor and fo.codemp=:codempfr
        and fo.codfilial=:codfilialfr and F.siglauf=coalesce(fo.uffor, fo.siglauf)
        into itmp;
        -- Atualiza varivel que indica se  compra ou venda para C (Compra)
        cv = 'C';
    end
    -- Verifica se transao  dentro ou fora do estado e atualiza a varivel NOEST
    if (itmp > 0) then
    begin
        noest='S';
    end
    else
    begin
        noest='N';
    end
    -- Primeira busca por CFOP na regra de CFOP
    select first 1 r.codnat from eqproduto p, lfitregrafiscal r, lfclfiscal c
    left outer join sgfilial fi on
    fi.codemp=c.codemp and fi.codfilial=c.codfilial
    left outer join lfitclfiscal icf on
    icf.codemp=c.codemp and icf.codfilial=c.codfilial and icf.codfisc=c.codfisc and icf.coditfisc=:coditfisc
    and icf.ativoitfisc='S' and icf.simplesfilial=fi.simplesfilial
    where p.codprod=:codprod and p.codfilial=:codfilialpd and p.codemp=:codemppd
    and c.codfisc = p.codfisc and c.codfilial = p.codfilialfc and c.codemp = p.codempfc
    and r.codregra = coalesce(icf.codregra, c.codregra) and r.codfilial = c.codfilialra and r.codemp = c.codempra
    and r.codemptm=:codemppd and r.codfilialtm=:codfilialtm and r.codtipomov=:codtipomov
    and r.cvitrf=:cv and r.noufitrf=:noest
    into codnat;
    -- Se no localizou nenhum cfop na pesquisa anterior pega a primeira cfop
    -- para a classificao fiscal do produto na regra.
    if (codnat is null) then
    begin
        select first 1 r.codnat from eqproduto p, lfitregrafiscal r, lfclfiscal c
        left outer join sgfilial fi on
        fi.codemp=c.codemp and fi.codfilial=c.codfilial
        left outer join lfitclfiscal icf on
        icf.codemp=c.codemp and icf.codfilial=c.codfilial and icf.codfisc=c.codfisc and icf.coditfisc=:coditfisc
        and icf.ativoitfisc='S' and icf.simplesfilial=fi.simplesfilial
        where p.codprod=:codprod and p.codfilial=:codfilialpd and p.codemp=:codemppd
        and c.codfisc=p.codfisc and c.codfilial=p.codfilialfc and c.codemp = p.codempfc and r.codregra = coalesce(icf.codregra, c.codregra)
        and r.codfilial = c.codfilialra and r.codemp = c.codempra
        and r.cvitrf=:cv and r.noufitrf=:noest
        order by r.codtipomov
        into codnat;
     end
    suspend;
end
^

/* Alter (LFBUSCAPREVTRIBORC) */
ALTER PROCEDURE LFBUSCAPREVTRIBORC(CODEMP INTEGER,
CODFILIALSEL INTEGER,
CODFILIAL INTEGER,
CODORC INTEGER,
TIPOORC CHAR,
CODITORC SMALLINT)
 RETURNS(VLRICMS NUMERIC(15,5),
VLRIPI NUMERIC(15,5),
VLRPIS NUMERIC(15,5),
VLRCOFINS NUMERIC(15,5),
VLRIR NUMERIC(15,5),
VLRCSOCIAL NUMERIC(15,5),
VLRISS NUMERIC(15,5))
 AS
declare variable codempcl integer;
declare variable codfilialcl smallint;
declare variable codcli integer;
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codempif integer;
declare variable codfilialif smallint;
declare variable codfisc char(13);
declare variable coditfisc smallint;
declare variable vlrbasepis numeric(15,5);
declare variable vlrbasecofins numeric(15,5);
declare variable vlrprod integer;
declare variable aliqpis numeric(6,2);
declare variable qtd numeric(15,5);
declare variable vlrpisunidtrib numeric(15,5);
declare variable codsittribcof char(2);
declare variable aliqcofins numeric(6,2);
declare variable vlrcofunidtrib numeric(15,5);
declare variable vlrliq numeric(15,5);
declare variable vlrfrete numeric(15,5);
declare variable codsittribipi char(2);
declare variable vlripiunidtrib numeric(15,5);
declare variable aliqipi numeric(6,2);
declare variable tpcalcipi char(1);
declare variable vlrbaseipi numeric(15,5);
declare variable aliqcsocial numeric(6,2);
declare variable aliqir numeric(6,2);
declare variable codemppd integer;
declare variable codfilialpd smallint;
declare variable codprod integer;
declare variable tipoprod varchar(2);
declare variable aliqiss numeric(6,2);
declare variable aliqicms numeric(6,2);
declare variable tpredicms char(1);
declare variable redicms numeric(15,5);
declare variable baseicms numeric(15,5);
declare variable codtrattrib char(2);
declare variable codsittribpis char(2);
declare variable ufcli char(2);
begin

    -- Inicializando variveis

    vlripi = 0;
    vlrfrete = 0;

    -- Buscando informaes no oramento (cliente e tipo de movimento)
    select oc.codempcl,oc.codfilialcl,oc.codcli,tm.codemptm,tm.codfilialtm,tm.codtipomovtm,coalesce(cl.siglauf,cl.ufcli)
    from vdorcamento oc, vdcliente cl, eqtipomov tm
    where oc.codemp=:codemp and oc.codfilial=:codfilial and oc.codorc=:codorc and oc.tipoorc=:tipoorc
    and cl.codemp=oc.codempcl and cl.codfilial=oc.codfilialcl and cl.codcli=oc.codcli
    and tm.codemp=oc.codemp and tm.codfilial=oc.codfilialtm and tm.codtipomov=oc.codtipomov
    into :codempcl, :codfilialcl, :codcli, :codemptm, :codfilialtm, :codtipomov, :ufcli;

    -- Buscando informaes do produto no item de oramento
    select io.codemppd, io.codfilialpd, io.codprod, io.vlrproditorc, io.qtditorc, io.vlrliqitorc, coalesce(io.vlrfreteitorc,0),
    pd.tipoprod

    from vditorcamento io, eqproduto pd
    where io.codemp=:codemp and io.codfilial=:codfilial and io.codorc=:codorc and io.tipoorc=:tipoorc and io.coditorc=:coditorc
    and pd.codemp=io.codemppd and pd.codfilial=io.codfilialpd and pd.codprod=io.codprod
    into :codemppd, :codfilialpd, :codprod, :vlrprod, :qtd, :vlrliq, :vlrfrete, :tipoprod;

    -- Buscando a regra de classificao para o tem
    select bf.codempif, bf.codfilialif, bf.codfisc, bf.coditfisc
    from lfbuscafiscalsp(:codemppd, :codfilialsel, :codfilialpd, :codprod, :codempcl, :codfilialcl, :codcli,
    :codemptm, :codfilialtm, :codtipomov, 'VD',null,null,null,null,null) bf
    into :codempif, :codfilialif, :codfisc, :coditfisc;

    -- Buscando informacoes fiscais na tabela de regras
    select cf.codsittribpis, cf.aliqpisfisc, cf.vlrpisunidtrib, cf.codsittribcof, cf.aliqcofinsfisc, cf.vlrcofunidtrib,
    cf.vlripiunidtrib, cf.aliqipifisc, cf.codsittribipi, cf.tpcalcipi,
    coalesce(cf.aliqcsocialfisc, fi.perccsocialfilial), coalesce(cf.aliqirfisc, fi.percirfilial), coalesce(cf.aliqissfisc, fi.percissfilial),
    cf.tpredicmsfisc, cf.redfisc, cf.codtrattrib
    from lfitclfiscal cf
    left outer join sgfilial fi on
    fi.codemp=:codemp and fi.codfilial=:codfilial
    where cf.codemp=:codempif and cf.codfilial=:codfilialif and cf.codfisc=:codfisc and cf.coditfisc=:coditfisc
    into :codsittribpis, :aliqpis, :vlrpisunidtrib, :codsittribcof, :aliqcofins, :vlrcofunidtrib,
    :vlripiunidtrib, :aliqipi, :codsittribipi,:tpcalcipi, :aliqcsocial, :aliqir, :aliqiss,
    :tpredicms, :redicms, :codtrattrib;

    -- Definio do IPI
    if(:codsittribipi not in ('52','53','54')) then -- IPI Tributado
    begin
        if(:tpcalcipi='P' and aliqipi is not null and aliqipi > 0) then -- Calculo pela aliquota
        begin
            vlrbaseipi = cast(:vlrliq as decimal(15,2)); -- (Base do IPI = Valor total dos produtos - Implementar situaes distintas futuramente)
            vlripi = cast((vlrbaseipi * aliqipi) / 100 as decimal(15,2));
        end
        else if (vlripiunidtrib is not null and vlripiunidtrib > 0) then -- Calculo pela quantidade
        begin
            vlripi = cast(qtd * vlripiunidtrib as decimal(15,2));
        end
    end

    -- Definio do PIS

    if(:codsittribpis in ('01','02','99') and aliqpis is not null and aliqpis > 0 ) then -- PIS Tributado pela alquota
    begin
        vlrbasepis = cast(:vlrprod as decimal(15,2)); -- (Base do PIS = Valor total dos produtos - Implementar situaes distintas futuramente)
        vlrpis = cast((vlrbasepis * aliqpis) / 100 as decimal(15,2));
    end
    else if (:codsittribpis in ('03') and vlrpisunidtrib is not null and vlrpisunidtrib > 0) then -- PIS Tributado pela quantidade
    begin
        vlrpis = cast(qtd * vlrpisunidtrib as decimal(15,2));
    end

    -- Definio do COFINS

    if(:codsittribcof in ('01','02','99') and aliqcofins is not null and aliqcofins > 0 ) then -- COFINS Tributado pela alquota
    begin
        vlrbasecofins = :vlrprod; -- (Base do COFINS = Valor total dos produtos - Implementar situaes distintas futuramente)
        vlrcofins = cast( (vlrbasecofins * aliqcofins) / 100 as decimal(15,2));
    end
    else if (:codsittribpis in ('03') and vlrcofunidtrib is not null and vlrcofunidtrib > 0) then -- COFINS Tributado pela quantidade
    begin
        vlrcofins = cast( qtd * vlrcofunidtrib as decimal(15,2));
    end

    -- Definio do IR

    if(aliqir is not null and aliqir > 0) then
    begin
        vlrir = cast(((:vlrliq + :vlripi + :vlrfrete) * aliqir) / 100 as decimal(15,2));
    end

    -- Definio da CSocial

    vlrcsocial = cast(((:vlrliq + :vlripi + :vlrfrete) * aliqcsocial) / 100 as decimal(15,2));

    -- Definio do ISS se for um servio
    if (tipoprod = 'S') then
    begin
        if ( aliqiss is not null and aliqiss > 0 ) then
        begin
            vlriss = vlrliq * (aliqiss/100);
        end
    end

    -- Definio do ICMS
    -- Calcular icms quando aliquota maio que zero e tratamento tributrio no for (isento, isento ou n.trib, n.trib., suspenso)

    if(codtrattrib not in ('40','30','41','50')) then
    begin

        if(aliqicms is null) then
        begin
            select ti.aliqti from lftabicms ti
            where codemp=:codemp and codfilial=:codfilial and ufti=:ufcli
            into aliqicms;
        end

        if (redicms>0) then -- Com reduo
        begin
            if(tpredicms='B') then -- Reduo na base de clculo
            begin
                baseicms = vlrliq * ( 1 - (redicms / 100));
                vlricms = baseicms * (aliqicms / 100);
            end
            else -- Reduo no valor
            begin

                baseicms = vlrliq;
                vlricms = baseicms * ( aliqicms / 100 );
                vlricms = vlricms * (( 100 - redicms ) / 100);


            end
        end
        else -- Sem reduo
        begin

            baseicms = vlrliq;
            vlricms = baseicms * (aliqicms / 100);

        end

    end
  suspend;
end
^

/* Alter (LFBUSCATRIBCOMPRA) */
ALTER PROCEDURE LFBUSCATRIBCOMPRA(CODEMP INTEGER,
CODFILIAL INTEGER,
CODCOMPRA INTEGER,
CODEMPPD INTEGER,
CODFILIALPD SMALLINT,
CODPROD INTEGER,
VLRLIQ NUMERIC(15,5))
 RETURNS(VLRBASEFUNRURAL NUMERIC(15,5),
ALIQFUNRURAL NUMERIC(6,2),
VLRFUNRURAL NUMERIC(15,5),
CODEMPIF INTEGER,
CODFILIALIF SMALLINT,
CODFISC CHAR(13),
CODITFISC SMALLINT)
 AS
declare variable codempfr integer;
declare variable codfilialfr smallint;
declare variable codfor integer;
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
begin

    -- Inicializando variveis

    vlrfunrural = 0;

    -- Buscando informaes na compra (fornecedor e tipo de movimento)
    select cp.codempfr,cp.codfilialfr,cp.codfor,coalesce(tm.codemptm, tm.codemp)
    ,coalesce(tm.codfilialtm,tm.codfilial),coalesce(tm.codtipomovtm, tm.codtipomov)
    from cpcompra cp, cpforneced fr, eqtipomov tm
    where cp.codemp=:codemp and cp.codfilial=:codfilial and cp.codcompra=:codcompra
    and fr.codemp=cp.codempfr and fr.codfilial=cp.codfilialfr and fr.codfor=cp.codfor
    and tm.codemp=cp.codemp and tm.codfilial=cp.codfilialtm and tm.codtipomov=cp.codtipomov
    into :codempfr, :codfilialfr, :codfor, :codemptm, :codfilialtm, :codtipomov;

    -- Buscando a regra de classificao para o tem
    select bf.codempif, bf.codfilialif, bf.codfisc, bf.coditfisc
    from lfbuscafiscalsp(:codemppd, :codfilial, :codfilialpd, :codprod, :codempfr, :codfilialfr, :codfor, :codemptm, :codfilialtm, :codtipomov, 'CP',null,null,null,null,null) bf
    into :codempif, :codfilialif, :codfisc, :coditfisc;
    -- Buscando informacoes fiscais na tabela de regras
    select cf.aliqfunruralfisc
    from lfitclfiscal cf
    left outer join sgfilial fi on
    fi.codemp=:codemp and fi.codfilial=:codfilial
    where cf.codemp=:codempif and cf.codfilial=:codfilialif and cf.codfisc=:codfisc and cf.coditfisc=:coditfisc
    into :aliqfunrural;

    -- Definio do Funrural
    if(:aliqfunrural>0) then -- Reteno do funrural
    begin
        vlrbasefunrural = cast(:vlrliq as decimal(15,2)); -- (Base do Funrural = Valor total dos produtos - Implementar situaes distintas futuramente)
        vlrfunrural = cast((vlrbasefunrural * aliqfunrural) / 100 as decimal(15,2));
    end


    suspend;
end
^

/* Alter (LFCALCCUSTOSP01) */
ALTER PROCEDURE LFCALCCUSTOSP01(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODCALC INTEGER,
QTDADE DECIMAL(15,5),
VLRCUSTOP DECIMAL(15,5),
VLRICMS DECIMAL(15,5),
VLRIPI DECIMAL(15,5),
VLRPIS DECIMAL(15,5),
VLRCOFINS DECIMAL(15,5),
VLRISS DECIMAL(15,5),
VLRFUNRURAL DECIMAL(15,5),
VLRII DECIMAL(15,5),
VLRIR DECIMAL(15,5),
VLRTXSISCOMEX DECIMAL(15,5),
VLRICMSDIFERIDO DECIMAL(15,5),
VLRICMSPRESUMIDO DECIMAL(15,5),
VLRCOMPL DECIMAL(15,5))
 RETURNS(VLRCUSTO DECIMAL(15,5))
 AS
declare variable siglacalc varchar(10);
   declare variable operacao char(1);
   declare variable vlrimposto decimal(15,5);
begin
  if (:vlrcustop is null) then
    vlrcusto = 0;
  else
    vlrcusto = vlrcustop;
  if (vlripi is null) then
   vlripi = 0;
  if (vlricms is null) then
   vlricms = 0;
  if (vlrpis is null) then
   vlrpis = 0;
  if (vlrcofins is null) then
   vlrcofins = 0;
  if (vlriss is null) then
   vlriss = 0;
  if (vlrfunrural is null) then
   vlrfunrural = 0;
  if (vlrii is null) then
   vlrii = 0;
  if (vlrir is null) then
   vlrir = 0;
  if (vlrtxsiscomex is null) then
   vlrtxsiscomex = 0;
  if (vlricmsdiferido is null) then
   vlricmsdiferido = 0;
  if (vlricmspresumido is null) then
   vlricmspresumido = 0;
  if (vlrcompl is null) then
   vlrcompl = 0; 
  for select ic.siglacalc, ic.operacaocalc
     from lfcalccusto c, lfitcalccusto ic
     where c.codemp=:codemp and c.codfilial=:codfilial and c.codcalc=:codcalc
       and ic.codemp=c.codemp and ic.codfilial=c.codfilial and ic.codcalc=c.codcalc
       into :siglacalc, :operacao do
  begin

     if (:siglacalc='IPI') then
       vlrimposto = vlripi;
     else if (:siglacalc='ICMS') then
       vlrimposto = vlricms;
     else if (:siglacalc='PIS') then
       vlrimposto = vlrpis;
     else if (:siglacalc='COFINS') then
       vlrimposto = vlrcofins;
     else if (:siglacalc='ISS') then
       vlrimposto = vlriss;
     else if (:siglacalc='FUNRURAL') then
       vlrimposto = vlrfunrural;
     else if (:siglacalc='II') then
       vlrimposto = vlrii;
     else if (:siglacalc='IR') then
       vlrimposto = vlrir;
     else if (:siglacalc='TXSISCOMEX') then
       vlrimposto = vlrtxsiscomex;
     else if (:siglacalc='ICMSDIF') then
       vlrimposto = vlricmsdiferido;
     else if (:siglacalc='ICMSPRES') then
       vlrimposto = vlricmspresumido;
     else if (:siglacalc='COMPL') then
       vlrimposto = vlrcompl;
     if (:operacao='+') then
        vlrcusto = vlrcusto + vlrimposto;
     else if (:operacao='-') then
        vlrcusto = vlrcusto - vlrimposto;
  end
  if (qtdade is not null and qtdade<>0) then
  begin
     -- Dividimos o total pela quantidade, multiplicamos o resultado novamente pela quantidade e dividimos pela quantidade, objetivando evitar dizima peridica.
      vlrcusto = cast( ( cast(vlrcusto as decimal(15,4)) / cast( qtdade as decimal(15,5) )  * cast( qtdade as decimal(15,5) ) ) as decimal(15,4) ) / cast( qtdade as decimal(15,5) ) ;
  end
  suspend;
end
^

/* Alter (LFGERALFITCOMPRASP) */
ALTER PROCEDURE LFGERALFITCOMPRASP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODCOMPRA INTEGER,
CODITCOMPRA SMALLINT)
 AS
declare variable temitem char(1);
declare variable codempsp integer;
declare variable codfilialsp smallint;
declare variable impsittribpis char(2);
declare variable codsittribpis char(2);
declare variable aliqpisfisc numeric(15,5);
declare variable vlrbasepis numeric(15,5);
declare variable vlrpis numeric(15,5);
declare variable vlrpisunidtrib numeric(15,5);
declare variable codempsc integer;
declare variable codfilialsc smallint;
declare variable impsittribcof char(2);
declare variable codsittribcof char(2);
declare variable aliqcofins numeric(15,5);
declare variable vlrbasecofins numeric(15,5);
declare variable vlrcofins numeric(15,5);
declare variable vlrcofunidtrib numeric(15,5);
declare variable vlrbaseicmsstitcompra numeric(15,5);
declare variable vlricmsstitcompra numeric(15,5);
declare variable margemvlagritcompra numeric(15,5);
declare variable codempsi integer;
declare variable codfilialsi smallint;
declare variable impsittribipi char(2);
declare variable codsittribipi char(2);
declare variable vlripiunidtrib numeric(15,5);
declare variable modbcicms smallint;
declare variable modbcicmsst smallint;
declare variable redfisc numeric(9,2);
declare variable aliqfisc integer;
declare variable vlrir numeric(15,5);
declare variable vlrcsocial numeric(15,5);
declare variable uffor char(2);
declare variable percicmsst numeric(15,5);
declare variable codempif integer;
declare variable codfilialif smallint;
declare variable codfisc char(13);
declare variable coditfisc integer;
declare variable codnat char(4);
declare variable codtrattrib char(2);
declare variable origfisc char(1);
begin
    -- Inserindo informaes fiscais na tabela LFITCOMPRA
    select 'S'
    from lfitcompra
    where codemp=:codemp and codfilial=:codfilial and codcompra=:codcompra and coditcompra=:coditcompra
    into :temitem;
    select
    li.codempsp,li.codfilialsp,li.impsittribpis,li.codsittribpis,li.aliqpisfisc,bf.vlrbasepis,bf.vlrpis,li.vlrpisunidtrib,
    li.codempsc,li.codfilialsc,li.impsittribcof,li.codsittribcof,li.aliqcofinsfisc,bf.vlrbasecofins,bf.vlrcofins,li.vlrcofunidtrib,
    li.codempsi,li.codfilialsi,li.impsittribipi,li.codsittribipi,li.vlripiunidtrib,
    li.modbcicms,li.modbcicmsst,li.redfisc,li.aliqfisc,bf.vlrir,bf.vlrcsocial, li.codtrattrib, li.origfisc
    , ic.vlrbaseicmsstitcompra, ic.vlricmsstitcompra, ic.margemvlagritcompra
    from lfbuscafiscalsp02(:codemp,:codfilial,null,null,null,:codcompra,:coditcompra) bf
    left outer join cpitcompra ic on ic.codemp=:codemp and ic.codfilial=:codfilial and ic.codcompra=:codcompra and ic.coditcompra=:coditcompra
    left outer join lfitclfiscal li on li.codemp=ic.codempif and li.codfilial=ic.codfilialif and li.codfisc=ic.codfisc and li.coditfisc=ic.coditfisc
    into
    :codempsp,:codfilialsp,:impsittribpis,:codsittribpis,:aliqpisfisc,:vlrbasepis,:vlrpis,:vlrpisunidtrib,
    :codempsc,:codfilialsc,:impsittribcof,:codsittribcof,:aliqcofins,:vlrbasecofins,:vlrcofins,:vlrcofunidtrib,
    :codempsi,:codfilialsi,:impsittribipi,:codsittribipi,:vlripiunidtrib,
    :modbcicms,:modbcicmsst,:redfisc,:aliqfisc,:vlrir,:vlrcsocial,:codtrattrib,:origfisc
    , :vlrbaseicmsstitcompra, :vlricmsstitcompra, :margemvlagritcompra;
    -- Buscando estado do fornecedor
    select coalesce(fr.siglauf,fr.uffor), ic.codempif, ic.codfilialif, ic.codfisc, ic.coditfisc, ic.codnat from cpforneced fr, cpcompra cp
    left outer join cpitcompra ic on ic.codemp=cp.codemp and ic.codfilial=cp.codfilial and ic.codcompra=cp.codcompra and ic.coditcompra=:coditcompra
    where cp.codemp=:codemp and cp.codfilial=:codfilial and cp.codcompra=:codcompra and
    fr.codemp=cp.codempfr and fr.codfilial=cp.codfilialfr and fr.codfor=cp.codfor
    into uffor,codempif, codfilialif, codfisc, coditfisc, codnat;
    -- Buscando aliquota do ICMS ST da tabela de classificao fiscal
    select coalesce(ic.aliqfiscintra,0) from lfitclfiscal ic
    where ic.codemp=:codempif and ic.codfilial=:codfilialif and ic.codfisc=:codfisc and ic.coditfisc=:coditfisc
    into percicmsst;
    -- Buscando aliquota do ICMS ST da tabela de alquotas (caso no encontre na busca naterior)
    if (percicmsst = 0) then
    begin
        select coalesce(percicmsintra,0) from lfbuscaicmssp (:codnat,:uffor,:codemp,:codfilial)
        into percicmsst;
    end
    if(:temitem='S') then
    begin
            update lfitcompra set codempsp=:codempsp,codfilialsp=:codfilialsp,impsittribpis=:impsittribpis,
            codsittribpis=:codsittribpis,aliqpis=:aliqpisfisc,vlrbasepis=:vlrbasepis,vlrpis=:vlrpis,vlrpisunidtrib=:vlrpisunidtrib,
            codempsc=:codempsc,codfilialsc=:codfilialsc,impsittribcof=:impsittribcof,codsittribcof=:codsittribcof,aliqcofins=:aliqcofins,
            vlrbasecofins=:vlrbasecofins,vlrcofins=:vlrcofins,vlrcofunidtrib=:vlrcofunidtrib,
            codempsi=:codempsi,codfilialsi=:codfilialsi,impsittribipi=:impsittribipi,codsittribipi=:codsittribipi,vlripiunidtrib=:vlripiunidtrib,
            modbcicms=:modbcicms,modbcicmsst=:modbcicmsst,aliqredbcicms=:redfisc,aliqredbcicmsst=:redfisc,aliqicmsst=:percicmsst,
            vlrir=:vlrir,vlrcsocial=:vlrcsocial, vlrbaseicmsstitcompra=:vlrbaseicmsstitcompra, vlricmsstitcompra=:vlricmsstitcompra
            , margemvlagritcompra = :margemvlagritcompra
            where codemp=:codemp and codfilial=:codfilial and codcompra=:codcompra and coditcompra=:coditcompra;
    end
    else
    begin
        insert into lfitcompra (codemp,codfilial,codcompra,coditcompra,
            codempsp,codfilialsp,impsittribpis,codsittribpis,aliqpis,vlrbasepis,vlrpis,vlrpisunidtrib,
            codempsc,codfilialsc,impsittribcof,codsittribcof,aliqcofins,vlrbasecofins,vlrcofins,vlrcofunidtrib,
            codempsi,codfilialsi,impsittribipi,codsittribipi,vlripiunidtrib,
            modbcicms,modbcicmsst,aliqredbcicms,aliqredbcicmsst,aliqicmsst,vlrir,vlrcsocial,codtrattrib,origfisc,
            vlrbaseicmsstitcompra, vlricmsstitcompra, margemvlagritcompra)
        values(:codemp,:codfilial,:codcompra,:coditcompra,
        :codempsp,:codfilialsp,:impsittribpis,:codsittribpis,:aliqpisfisc,:vlrbasepis,:vlrpis,:vlrpisunidtrib,
        :codempsc,:codfilialsc,:impsittribcof,:codsittribcof,:aliqcofins,:vlrbasecofins,:vlrcofins,:vlrcofunidtrib,
        :codempsi,:codfilialsi,:impsittribipi,:codsittribipi,:vlripiunidtrib,
        :modbcicms,:modbcicmsst,:redfisc,:redfisc,:percicmsst,:vlrir,:vlrcsocial, :codtrattrib, :origfisc,
        :vlrbaseicmsstitcompra, :vlricmsstitcompra, :margemvlagritcompra );
    end
  suspend;
end
^

/* Alter (LFGERALFITVENDASP) */
ALTER PROCEDURE LFGERALFITVENDASP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODVENDA INTEGER,
TIPOVENDA CHAR(2),
CODITVENDA SMALLINT)
 AS
declare variable temitem char(1);
declare variable codempsp integer;
declare variable codfilialsp smallint;
declare variable impsittribpis char(2);
declare variable codsittribpis char(2);
declare variable aliqpisfisc numeric(15,5);
declare variable vlrbasepis numeric(15,5);
declare variable vlrpis numeric(15,5);
declare variable vlrpisunidtrib numeric(15,5);
declare variable codempsc integer;
declare variable codfilialsc smallint;
declare variable impsittribcof char(2);
declare variable codsittribcof char(2);
declare variable aliqcofins numeric(15,5);
declare variable vlrbasecofins numeric(15,5);
declare variable vlrcofins numeric(15,5);
declare variable vlrcofunidtrib numeric(15,5);
declare variable codempsi integer;
declare variable codfilialsi smallint;
declare variable impsittribipi char(2);
declare variable codsittribipi char(2);
declare variable vlripiunidtrib numeric(15,5);
declare variable modbcicms smallint;
declare variable modbcicmsst smallint;
declare variable redfisc numeric(9,2);
declare variable aliqfisc integer;
declare variable vlrir numeric(15,5);
declare variable vlrcsocial numeric(15,5);
declare variable ufcli char(2);
declare variable percicmsst numeric(15,5);
declare variable vlrbasencm decimal(15,5);
declare variable aliqnacncm decimal(9,2);
declare variable aliqimpncm decimal(9,2);
declare variable vlrnacncm decimal(15,5);
declare variable vlrimpncm decimal(15,5);
declare variable codempif integer;
declare variable codfilialif smallint;
declare variable codfisc char(13);
declare variable coditfisc integer;
declare variable codnat char(4);
begin

    -- Inserindo informaes fiscais na tabela LFITVENDA

    select 'S'
    from lfitvenda
    where codemp=:codemp and codfilial=:codfilial and codvenda=:codvenda and tipovenda=:tipovenda and coditvenda=:coditvenda
    into :temitem;

    select
    li.codempsp,li.codfilialsp,li.impsittribpis,li.codsittribpis,li.aliqpisfisc,bf.vlrbasepis,bf.vlrpis,li.vlrpisunidtrib,
    li.codempsc,li.codfilialsc,li.impsittribcof,li.codsittribcof,li.aliqcofinsfisc,bf.vlrbasecofins,bf.vlrcofins,li.vlrcofunidtrib,
    li.codempsi,li.codfilialsi,li.impsittribipi,li.codsittribipi,li.vlripiunidtrib,
    li.modbcicms,li.modbcicmsst,li.redfisc,li.aliqfisc,bf.vlrir,bf.vlrcsocial
    , bf.vlrbasencm, bf.aliqnacncm, bf.aliqimpncm, bf.vlrnacncm, bf.vlrimpncm 
    from lfbuscafiscalsp02(:CODEMP,:CODFILIAL,:CODVENDA,:TIPOVENDA,:CODITVENDA, null, null) bf
    left outer join vditvenda iv on iv.codemp=:CODEMP and iv.codfilial=:CODFILIAL and iv.codvenda=:CODVENDA and iv.tipovenda=:TIPOVENDA and iv.coditvenda=:CODITVENDA
    left outer join lfitclfiscal li on li.codemp=iv.codempif and li.codfilial=iv.codfilialif and li.codfisc=iv.codfisc and li.coditfisc=iv.coditfisc
    into
    :CODEMPSP,:CODFILIALSP,:IMPSITTRIBPIS,:CODSITTRIBPIS,:ALIQPISFISC,:VLRBASEPIS,:VLRPIS,:VLRPISUNIDTRIB,
    :CODEMPSC,:CODFILIALSC,:IMPSITTRIBCOF,:CODSITTRIBCOF,:ALIQCOFINS,:VLRBASECOFINS,:VLRCOFINS,:VLRCOFUNIDTRIB,
    :CODEMPSI,:CODFILIALSI,:IMPSITTRIBIPI,:CODSITTRIBIPI,:VLRIPIUNIDTRIB,
    :MODBCICMS,:MODBCICMSST,:REDFISC,:ALIQFISC,:VLRIR,:VLRCSOCIAL
    , :vlrbasencm, :aliqnacncm, :aliqimpncm, :vlrnacncm, :vlrimpncm;


    -- Buscando estado do cliente
    select coalesce(cl.siglauf,cl.ufcli), iv.codempif, iv.codfilialif, iv.codfisc, iv.coditfisc, iv.codnat from vdcliente cl, vdvenda vd
    left outer join vditvenda iv on iv.codemp=vd.codemp and iv.codfilial=vd.codfilial and iv.codvenda=vd.codvenda and iv.tipovenda=vd.tipovenda and iv.coditvenda=:coditvenda
    where vd.codemp=:codemp and vd.codfilial=:codfilial and vd.codvenda=:codvenda and vd.tipovenda=:tipovenda and
    cl.codemp=vd.codempcl and cl.codfilial=vd.codfilialcl and cl.codcli=vd.codcli
    into ufcli,codempif, codfilialif, codfisc, coditfisc, codnat;

    -- Buscando aliquota do ICMS ST da tabela de classificao fiscal
    select coalesce(ic.aliqfiscintra,0) from lfitclfiscal ic
    where ic.codemp=:codempif and ic.codfilial=:codfilialif and ic.codfisc=:codfisc and ic.coditfisc=:coditfisc
    into PERCICMSST;

    -- Buscando aliquota do ICMS ST da tabela de alquotas (caso no encontre na busca naterior)
    if (percicmsst = 0) then
    begin
        select coalesce(PERCICMSINTRA,0) from lfbuscaicmssp (:codnat,:ufcli,:codemp,:codfilial)
        into PERCICMSST;
    end

    if(:TEMITEM='S') then
    begin
            update lfitvenda set codempsp=:CODEMPSP,codfilialsp=:CODFILIALSP,impsittribpis=:IMPSITTRIBPIS,
            codsittribpis=:CODSITTRIBPIS,aliqpis=:ALIQPISFISC,vlrbasepis=:VLRBASEPIS,vlrpis=:VLRPIS,vlrpisunidtrib=:VLRPISUNIDTRIB,
            codempsc=:CODEMPSC,codfilialsc=:CODFILIALSC,impsittribcof=:IMPSITTRIBCOF,codsittribcof=:CODSITTRIBCOF,aliqcofins=:ALIQCOFINS,
            vlrbasecofins=:VLRBASECOFINS,vlrcofins=:VLRCOFINS,vlrcofunidtrib=:VLRCOFUNIDTRIB,
            codempsi=:CODEMPSI,codfilialsi=:CODFILIALSI,impsittribipi=:IMPSITTRIBIPI,codsittribipi=:CODSITTRIBIPI,vlripiunidtrib=:VLRIPIUNIDTRIB,
            modbcicms=:MODBCICMS,modbcicmsst=:MODBCICMSST,aliqredbcicms=:REDFISC,aliqredbcicmsst=:REDFISC,aliqicmsst=:percicmsst,
            vlrir=:VLRIR,vlrcsocial=:VLRCSOCIAL
            , vlrbasencm=:vlrbasencm, aliqnacncm=:aliqnacncm, aliqimpncm=:aliqimpncm, vlrnacncm=:vlrnacncm, vlrimpncm=:vlrimpncm
            where codemp=:codemp and codfilial=:codfilial and codvenda=:codvenda and tipovenda=:tipovenda and coditvenda=:coditvenda;
    end
    else
    begin
        insert into lfitvenda (codemp,codfilial,codvenda,tipovenda,coditvenda,
            codempsp,codfilialsp,impsittribpis,codsittribpis,aliqpis,vlrbasepis,vlrpis,vlrpisunidtrib,
            codempsc,codfilialsc,impsittribcof,codsittribcof,aliqcofins,vlrbasecofins,vlrcofins,vlrcofunidtrib,
            codempsi,codfilialsi,impsittribipi,codsittribipi,vlripiunidtrib,
            modbcicms,modbcicmsst,aliqredbcicms,aliqredbcicmsst,aliqicmsst,vlrir,vlrcsocial
            , vlrbasencm, aliqnacncm, aliqimpncm, vlrnacncm, vlrimpncm)
        values(:CODEMP,:CODFILIAL,:CODVENDA,:TIPOVENDA,:CODITVENDA,
        :CODEMPSP,:CODFILIALSP,:IMPSITTRIBPIS,:CODSITTRIBPIS,:ALIQPISFISC,:VLRBASEPIS,:VLRPIS,:VLRPISUNIDTRIB,
        :CODEMPSC,:CODFILIALSC,:IMPSITTRIBCOF,:CODSITTRIBCOF,:ALIQCOFINS,:VLRBASECOFINS,:VLRCOFINS,:VLRCOFUNIDTRIB,
        :CODEMPSI,:CODFILIALSI,:IMPSITTRIBIPI,:CODSITTRIBIPI,:VLRIPIUNIDTRIB,
        :MODBCICMS,:MODBCICMSST,:REDFISC,:REDFISC,:percicmsst,:VLRIR,:VLRCSOCIAL
        , :vlrbasencm, :aliqnacncm, :aliqimpncm, :vlrnacncm, :vlrimpncm );

    end

  suspend;
end
^

/* Alter (PPATUDISTOPSP) */
ALTER PROCEDURE PPATUDISTOPSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
NQTDDISTOLD NUMERIC(15,5),
NQTDDISTNEW NUMERIC(15,5))
 AS
begin
  if (NQTDDISTOLD is null) then
     NQTDDISTOLD = 0;
  if (NQTDDISTNEW is null) then
     NQTDDISTNEW = 0;
  if (NQTDDISTOLD!=NQTDDISTNEW) then
     UPDATE PPOP SET QTDDISTPOP = QTDDISTPOP + (:NQTDDISTNEW-:NQTDDISTOLD)
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND
          CODOP=:ICODOP AND SEQOP=:SSEQOP ;
  suspend;
end
^

/* empty dependent procedure body */
/* Clear: PPRELCUSTOSP for: PPCUSTOPRODSP */
ALTER PROCEDURE PPRELCUSTOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
DTESTOQ DATE,
ICODEMPMC INTEGER,
SCODFILIALMC SMALLINT,
CCODMARCA CHAR(6),
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP CHAR(14),
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD CHAR(100),
TIPOPROD VARCHAR(2),
SLDPROD NUMERIC(15,5),
CUSTOUNIT NUMERIC(15,5),
CUSTOTOT NUMERIC(15,5))
 AS
 BEGIN SUSPEND; END
^

/* Alter (PPCUSTOPRODSP) */
ALTER PROCEDURE PPCUSTOPRODSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
DTESTOQ DATE,
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CCOMSALDO CHAR(10))
 RETURNS(CUSTOUNIT NUMERIC(15,5),
SLDPROD NUMERIC(15,5))
 AS
declare variable qtditest numeric(15,5);
declare variable seqest smallint;
declare variable tipoprod varchar(2);
declare variable custotot numeric(15,5);
declare variable codprodpd integer;
begin
  /* Retorna o custo unitrio do produto */
  IF (CTIPOCUSTO IS NULL) then
     CTIPOCUSTO = 'P';

  SELECT P.TIPOPROD
   FROM EQPRODUTO P
   WHERE P.CODEMP = :ICODEMP AND P.CODFILIAL = :SCODFILIAL AND
      P.CODPROD=:ICODPROD
   INTO :TIPOPROD;

  IF (TIPOPROD='F') THEN
  BEGIN
     SELECT SLDPROD FROM EQCUSTOPRODSP(:ICODEMP, :SCODFILIAL, :ICODPROD,
        :DTESTOQ, :CTIPOCUSTO,  :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, 'N')
     INTO :SLDPROD;

     CUSTOTOT = 0;

     SELECT FIRST 1 E.SEQEST FROM PPESTRUTURA E
       WHERE E.CODEMP=:ICODEMP AND E.CODFILIAL=:SCODFILIAL AND E.CODPROD=:ICODPROD
       ORDER BY E.SEQEST INTO :SEQEST;

     FOR SELECT I.CODPRODPD,I.QTDITEST FROM  PPITESTRUTURA I
        WHERE I.CODEMP=:ICODEMP AND I.CODFILIAL=:SCODFILIAL AND
          I.CODPROD=:ICODPROD AND I.SEQEST=:SEQEST
        INTO :CODPRODPD, :QTDITEST DO
     BEGIN
         SELECT CUSTOUNIT FROM PPCUSTOPRODSP(:ICODEMP, :SCODFILIAL, :CODPRODPD, :DTESTOQ,
            :CTIPOCUSTO, :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CCOMSALDO)
         INTO :CUSTOUNIT;
         CUSTOTOT = CUSTOTOT + ( CUSTOUNIT * QTDITEST)  ;
     END
  END
  ELSE
  BEGIN
     SELECT CUSTOUNIT,SLDPROD FROM EQCUSTOPRODSP(:ICODEMP, :SCODFILIAL, :ICODPROD,
        :DTESTOQ, :CTIPOCUSTO,  :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, 'N')
     INTO :CUSTOTOT, :SLDPROD;
  END
  CUSTOUNIT = CUSTOTOT;
  SUSPEND;
end
^

/* Alter (PPGERAOP) */
ALTER PROCEDURE PPGERAOP(TIPOPROCESS CHAR,
CODEMPOP INTEGER,
CODFILIALOP SMALLINT,
CODOP INTEGER,
SEQOP INTEGER,
CODEMPPD INTEGER,
CODFILIALPD SMALLINT,
CODPROD INTEGER,
CODEMPOC INTEGER,
CODFILIALOC SMALLINT,
CODORC INTEGER,
TIPOORC CHAR,
CODITORC SMALLINT,
QTDSUGPRODOP NUMERIC(15,5),
DTFABROP DATE,
SEQEST SMALLINT,
CODEMPET INTEGER,
CODFILIALET SMALLINT,
CODEST SMALLINT,
AGRUPDATAAPROV CHAR,
AGRUPDTFABROP CHAR,
AGRUPCODCLI CHAR,
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
DATAAPROV DATE,
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
CODITCOMPRA SMALLINT,
JUSTFICQTDPROD VARCHAR(500),
CODEMPPDENTRADA INTEGER,
CODFILIALPDENTRADA SMALLINT,
CODPRODENTRADA INTEGER,
QTDENTRADA NUMERIC(15,5))
 RETURNS(CODOPRET INTEGER,
SEQOPRET SMALLINT)
 AS
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable refprod varchar(20);
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable sitpadop char(2);
declare variable seqof smallint;
declare variable codempfs integer;
declare variable codfilialfs smallint;
declare variable codfase integer;
declare variable tempoefdias numeric(15,5);
declare variable tempoef numeric(15,5);
declare variable datafimprodant date;
declare variable hfimprodant time;
declare variable qtdfinalprodop numeric(15,5);
declare variable codtipomovtm integer;
declare variable sitpadopconv char(2);
declare variable codemprma integer;
declare variable codfilialrma smallint;
declare variable codrma integer;
declare variable coditrma smallint;
declare variable estdinamica char(1);
declare variable opseq char(1);
begin
    if(codop is null) then
    begin
        -- Buscando tipo de movimento para OP e preferncias.
        select p5.codemptm, p5.codfilialtm, p5.codtipomov, coalesce(tm.codtipomovtm,p5.codtipomov)
        , p5.sitpadop, p5.sitpadopconv, coalesce(p5.opseq,'N')
        from sgprefere5 p5, eqtipomov tm
        where p5.codemp=:codempop and p5.codfilial=:codfilialop and
        tm.codemp=p5.codemptm and tm.codfilial=p5.codfilialtm and tm.codtipomov=p5.codtipomov
        into :codemptm, :codfilialtm, :codtipomov, :codtipomovtm, :sitpadop, :sitpadopconv, :opseq;
        -- Busca novo cdigo para a OP caso no venha no parmetro.
        if (opseq='S') then
        begin
           select iseq from spgeranum(:codempop, :codfilialop, 'OP') into :codop;
        end
        else
        begin
            select coalesce(max(codop),0) + 1 from ppop where codemp=:codempop and codfilial=:codfilialop
            into :codop;
        end
        -- Buscando informaes do produto e estrutura.
        select pd.codempax, pd.codfilialax, pd.codalmox, pd.refprod, es.estdinamica from eqproduto pd, ppestrutura es
        where pd.codemp=:codemppd and pd.codfilial=:codfilialpd and pd.codprod=:codprod
        and es.codemp=pd.codemp and es.codfilial=pd.codfilial and es.codprod=pd.codprod and es.seqest=:seqest
        into :codempax, :codfilialax, :codalmox, :refprod, :estdinamica;
        -- Inserindo OP
        seqop = 0;
        if(sitpadop='FN' and tipoprocess in ('D','A')) then
        begin
            qtdfinalprodop = :qtdsugprodop;
            codtipomov = :codtipomovtm;
        end
        else if(sitpadopconv='FN' and tipoprocess='C') then
        begin
            qtdfinalprodop = :qtdsugprodop;
            codtipomov = :codtipomovtm;
        end
        else
        begin
            qtdfinalprodop = 0;
        end
        insert into ppop  (codemp, codfilial, codop, seqop,
                           codemppd, codfilialpd, codprod, seqest, refprod,
                           codempax, codfilialax, codalmox,
                           dtemitop, dtfabrop,
                           qtdsugprodop, qtdprevprodop, qtdfinalprodop,
                           codemple, codfilialle, codlote,
                           codemptm, codfilialtm, codtipomov,
                           sitop, codempcp, codfilialcp, codcompra, coditcompra, justficqtdprod, estdinamica)
        values ( :codempop, :codfilialop, :codop, :seqop,
                 :codemppd, :codfilialpd, :codprod, :seqest, :refprod,
                 :codempax, :codfilialax, :codalmox,
                 cast('today' as date), :dtfabrop,
                 :qtdsugprodop, :qtdsugprodop, :qtdfinalprodop, null,null,null, 
                 :codemptm, :codfilialtm, :codtipomov, :sitpadop,
                 :codempcp, :codfilialcp, :codcompra, :coditcompra, :justficqtdprod, :estdinamica

        );
        -- Caso o status padro da OP seja Finalizado
        if(:sitpadop='FN') then
        begin
            -- Inicializando variaveis
            datafimprodant = :dtfabrop;
            hfimprodant = cast('now' as time);
            -- Gerando RMAS
            execute procedure eqgerarmasp(:codempop,:codfilialop,:codop,:seqop);
            -- Finalizando Fases
            for select oe.codempfs, oe.codfilialfs, oe.codfase, oe.seqof
            from ppopfase oe, ppop op
            where oe.codemp=:codempop and oe.codfilial=:codfilialop and oe.codop=:codop and oe.seqop=:seqop and
            op.codemp=oe.codemp and op.codfilial=oe.codfilial and op.codop=oe.codop and op.seqop=oe.seqop
            order by oe.seqof
            into :codempfs, :codfilialfs, :codfase, :seqof do
            begin
                -- Buscando informaes da fase
                select ef.tempoef from ppestrufase ef
                where ef.codemp=:codempfs and ef.codfilial=:codfilialfs and ef.codfase=:codfase and
                ef.codemp=:codemppd and ef.codfilial=:codfilialpd and ef.codprod=:codprod and ef.seqest=:seqest
                into :tempoef;

                tempoefdias = (tempoef/3600) / 24; -- de segundos para dias...

                update ppopfase oe set oe.sitfs=:sitpadop, oe.obsfs='Fase finalizada automaticamente',
                oe.datainiprodfs=:datafimprodant, oe.hiniprodfs=:hfimprodant,
                oe.datafimprodfs=:datafimprodant + :tempoefdias, oe.hfimprodfs=:hfimprodant + :tempoef
                where oe.codemp=:codempop and oe.codfilial=:codfilialop and oe.codop=:codop and oe.seqop=:seqop and
                oe.seqof=:seqof;

                -- Carregando variveis para proximo registro
                datafimprodant = :datafimprodant + :tempoefdias;
                hfimprodant = :hfimprodant + :tempoef;

            end
        end

    end

    -- Caso o tipo de processamento seja Detalhado (uma OP por oramento)
    if(tipoprocess='D') then
    begin

        -- Caso o cdigo do oramento e cdigo da OP tenham sido informados (deve ocorrer no modo oramento ou a partir da segunda passagem do modo agrupado...
        if( (codorc is not null) and (codop is not null) ) then
        begin
            insert into ppopitorc (codemp, codfilial, codop, seqop, codempoc, codfilialoc, tipoorc, codorc, coditorc, qtdprod)
            values(:codempop, :codfilialop, :codop, :seqop, :codempoc, :codfilialoc, :tipoorc, :codorc, :coditorc, :qtdsugprodop);

            -- Caso a OP seja gerada j finalizada... deve mudar o status do item de oramento para produzido.
            if(sitpadop='FN') then
            begin
                update vditorcamento io set io.sitproditorc='PD'
                where io.codemp=:codempoc and io.codfilial=:codfilialoc and io.codorc=:codorc and io.coditorc=:coditorc and io.tipoorc=:tipoorc;
            end

        end
    end
    -- Caso o tipo de processamento seja Agrupado (uma OP para vrios oramentos)
    else if(tipoprocess='A') then
    begin

        for select pt.codemp,pt.codfilial, pt.codorc, pt.coditorc, pt.tipoorc, pt.dtfabrop, pt.qtdaprod
        from ppprocessaoptmp pt, vditorcamento io, vdorcamento oc
        where pt.codempet=:codempet and pt.codfilialet=:codfilialet and pt.codest=:codest
        and io.codemp=pt.codemp and io.codfilial=pt.codfilial and io.codorc=pt.codorc and io.coditorc=pt.coditorc and io.tipoorc=pt.tipoorc
        and oc.codemp=io.codemp and oc.codfilial=io.codfilial and oc.codorc=io.codorc and oc.tipoorc=io.tipoorc
        and (:agrupdataaprov='N' or io.dtaprovitorc=:dataaprov )
        and (:agrupdtfabrop='N' or pt.dtfabrop=:dtfabrop )
        and (:agrupcodcli='N' or (oc.codorc=:codcli and oc.codempcl=:codempcl and oc.codfilialcl=:codfilialcl) )
        and io.codemppd=:codemppd and io.codfilialpd=:codfilialpd and io.codprod=:codprod
        into :codempoc, :codfilialoc, :codorc, :coditorc, :tipoorc, :dtfabrop, :qtdsugprodop do
        begin

            insert into ppopitorc (codemp, codfilial, codop, seqop, codempoc, codfilialoc, tipoorc, codorc, coditorc, qtdprod)
            values(:codempop, :codfilialop, :codop, :seqop, :codempoc, :codfilialoc, :tipoorc, :codorc, :coditorc, :qtdsugprodop);

            -- Caso a OP seja gerada j finalizada... deve mudar o status do item de oramento para produzido.
            if(sitpadop='FN') then
            begin
                update vditorcamento io set io.sitproditorc='PD'
                where io.codemp=:codempoc and io.codfilial=:codfilialoc and io.codorc=:codorc and io.coditorc=:coditorc and io.tipoorc=:tipoorc;
            end

        end
    end

    -- Carregando parametros de sada
    codopret = :codop;
    seqopret = :seqop;

    suspend;

end
^

SET TERM ; ^

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Tipo de processamento (D=Detalhado, A=Agrupado, C=Comum)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'TIPOPROCESS';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da empresa da ordem de produo'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPOP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da filial da ordem de produo'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALOP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da ordem de produo'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODOP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Sequencia da ordem de produo'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'SEQOP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da empresa do produto'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPPD';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da filial do produto'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALPD';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo do produto'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODPROD';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da emrpesa do oramento'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPOC';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da filial do oramento'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALOC';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo do oramento'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODORC';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Tipo de oramento'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'TIPOORC';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo do tem de oramento'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODITORC';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Quantidade sugerida para fabricao'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'QTDSUGPRODOP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Data de fabricao'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'DTFABROP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Sequncia da estrutura'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'SEQEST';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da empresa da estao de trabalho'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPET';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da filial da estao de trabalho'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALET';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da estao de trabalho'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEST';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Indica se o agrupamento  por data de aprovao'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'AGRUPDATAAPROV';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Indica se o agrupamento  por data de fabricao'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'AGRUPDTFABROP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Indica se o agrupamento  por cdigo de cliente'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'AGRUPCODCLI';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da empresa do cliente do lote processado'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPCL';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da filial do cliente do lote processado'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALCL';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo do cliente do lote processado'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODCLI';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Data de aprovao do lote processado'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'DATAAPROV';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da empresa do item de compra (converso de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPCP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da filial do item de compra (converso de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALCP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da compra (converso de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODCOMPRA';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo do item de compra (converso de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODITCOMPRA';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Justificativa por divergencias na quantidade final (converso de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'JUSTFICQTDPROD';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da empresa do produto de entrada (converso de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPPDENTRADA';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da filial do produto de entrada (converso de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALPDENTRADA';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo do produto de entrada (converso de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODPRODENTRADA';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Quantidade do produto de entrada (converso de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'QTDENTRADA';

/* Alter (PPITOPSP01) */
SET TERM ^ ;

ALTER PROCEDURE PPITOPSP01(ICODEMP INTEGER,
ICODFILIAL SMALLINT,
ICODOP INTEGER,
ISEQOP SMALLINT)
 AS
declare variable icodemppd integer;
declare variable icodfilialpd smallint;
declare variable gerarma char(1);
declare variable crefprod varchar(20);
declare variable icodprodpd integer;
declare variable nqtditop numeric(15,5);
declare variable icodemple integer;
declare variable icodfilialle smallint;
declare variable ccodlote varchar(20);
declare variable icodempfs integer;
declare variable icodfilialfs smallint;
declare variable icodfase integer;
declare variable icodemptr integer;
declare variable icodfilialtr smallint;
declare variable icodtprec integer;
declare variable icodemprp integer;
declare variable icodfilialrp smallint;
declare variable icodrecp integer;
declare variable dtempoof numeric(15,5);
declare variable iseqof smallint;
declare variable iseqppitop integer;
declare variable qtditest numeric(15,5);
declare variable qtdest numeric(15,5);
declare variable qtdprevprodop numeric(15,5);
declare variable qtdfixa char(1);
declare variable estdinamica char(1);
declare variable permiteajusteitop char(1);
declare variable iseqsubprod integer;
declare variable qtditestsp numeric(15,5);
declare variable codempts integer;
declare variable codfilialts smallint;
declare variable codtipomovsp integer;
declare variable tipoexterno char(10);
begin

    --Loop nas fases da estrutura para gerao da tabela de fases da OP.
    for select ef.seqef, ef.codempfs, ef.codfilialfs, ef.codfase, ef.codemptr, ef.codfilialtr, ef.codtprec, ef.tempoef, o.estdinamica
    from ppestrufase ef, ppop o, ppestrutura e
    where
        o.codemp=:icodemp and o.codfilial=:icodfilial and o.codop=:icodop and o.seqop=:iseqop and
        e.codemp=o.codemppd and e.codfilial=o.codfilialpd and e.codprod=o.codprod and e.seqest=o.seqest and
        ef.codemp=e.codemp and ef.codfilial=e.codfilial and ef.codprod=e.codprod and ef.seqest=E.seqest
    into
        :iseqof, :icodempfs, :icodfilialfs, :icodfase, :icodemptr, :icodfilialtr, :icodtprec, :dtempoof, :estdinamica
    do
    begin
        -- Buscando o primeiro recurso para insero na fase (provisrio)
        select first 1 codemp, codfilial, codrecp from pprecurso r
        where r.codemp=:icodemptr and r.codfilial=:icodfilialtr and r.codtprec=:icodtprec
        into :icodemprp, :icodfilialrp, :icodrecp;

        -- Inserindo na tabela de fase por op
        insert into
            ppopfase (
                codemp, codfilial, codop, seqop, seqof, codempfs, codfilialfs, codfase, codemprp, codfilialrp, codrecp, tempoof,
                codemptr, codfilialtr, codtprec
            )
            values (
                :icodemp, :icodfilial, :icodop, :iseqop, :iseqof, :icodempfs, :icodfilialfs,:icodfase, :icodemprp, :icodfilialrp,
                :icodrecp,:dtempoof, :icodemptr, :icodfilialtr, :icodtprec
            );
    end

    -- Se a estrutura no for dinmica, deve inserir os tens

    if(coalesce(:estdinamica,'N')='N'  ) then    
    begin

        iseqppitop = 0;

        for select
            ie.codemppd, ie.codfilialpd, ie.codprodpd, ie.refprodpd, ie.rmaautoitest, ie.codempfs, ie.codfilialfs, ie.codfase,
            ie.qtditest, e.qtdest, o.qtdprevprodop, ie.qtdfixa,
            (   select min(l.codlote) from eqlote l
                where
                l.codemp=e.codemp and l.codfilial=e.codfilial and l.codprod=e.codprod and l.sldliqlote > 0 and l.venctolote =
                (   select min( ls.venctolote ) from eqlote ls where ls.codprod=l.codprod and ls.codfilial=l.codfilial and
                    ls.codemp=l.codemp and ls.sldliqlote>0)) codlote, ie.permiteajusteitest, ie.tipoexterno
            from
                ppitestrutura ie, ppestrutura e, ppop o
            where
                ie.codemp=e.codemp and ie.codfilial=e.codfilial and ie.codprod=e.codprod and ie.seqest=e.seqest and
                o.codemppd=e.codemp and o.codfilialpd=e.codfilial and o.codprod=e.codprod and o.seqest=e.seqest and
                o.codemp=:icodemp and o.codfilial=:icodfilial and o.codop=:icodop and o.seqop=:iseqop
            order by ie.codfase, ie.seqef
        into
        :icodemppd, :icodfilialpd, :icodprodpd, :crefprod, :gerarma, :icodempfs, :icodfilialfs, :icodfase,
        :qtditest,:qtdest,:qtdprevprodop,:qtdfixa,:ccodlote,:permiteajusteitop,:tipoexterno
        do
        begin
            if (:ccodlote is null ) then
            begin
                icodemple = null;
                icodfilialle = null;
            end
            else
            begin
                icodemple = icodemppd;
                icodfilialle = icodfilialpd;
            end

            iseqppitop = :iseqppitop + 1;

            if ('S'=qtdfixa) then
            begin
                nqtditop = :qtditest;
            end
            else
            begin
                nqtditop = cast(:qtditest/:qtdest as numeric(15,5) ) * cast(:qtdprevprodop as numeric(15, 5));
            end

            insert into ppitop (
                codemp, codfilial, codop, seqop, seqitop, codemppd, codfilialpd, codprod, refprod,
                codempfs, codfilialfs, codfase, qtditop, gerarma, permiteajusteitop, tipoexterno
            )
            values (
                :icodemp, :icodfilial, :icodop, :iseqop, :iseqppitop, :icodemppd, :icodfilialpd,
                :icodprodpd, :crefprod,:icodempfs, :icodfilialfs, :icodfase, :nqtditop, :gerarma,
                :permiteajusteitop, :tipoexterno
            );

        end

        -- Inserindo tabela de subprodutos

        iseqsubprod = 0;

        -- Buscando tipo de movimento para subproducao
        select codempts, codfilialts, codtipomovsp from sgprefere5 where codemp=:icodemp and codfilial=:icodfilial
        into :codempts, :codfilialts, :codtipomovsp;

        for select
            ie.codemppd, ie.codfilialpd, ie.seqitestsp, ie.codprodpd, ie.refprodpd, ie.codempfs, ie.codfilialfs, ie.codfase,
            ie.qtditestsp, e.qtdest, o.qtdprevprodop, ie.qtdfixa,
            (   select min(l.codlote) from eqlote l
                where
                l.codemp=e.codemp and l.codfilial=e.codfilial and l.codprod=e.codprod and l.sldliqlote > 0 and l.venctolote =
                (   select min( ls.venctolote ) from eqlote ls where ls.codprod=l.codprod and ls.codfilial=l.codfilial and
                    ls.codemp=l.codemp and ls.sldliqlote>0)) codlote, fs.seqof
            from
                ppitestruturasubprod ie, ppestrutura e, ppop o, ppopfase fs
            where
                ie.codemp=e.codemp and ie.codfilial=e.codfilial and ie.codprod=e.codprod and ie.seqest=e.seqest and
                o.codemppd=e.codemp and o.codfilialpd=e.codfilial and o.codprod=e.codprod and o.seqest=e.seqest and
                o.codemp=:icodemp and o.codfilial=:icodfilial and o.codop=:icodop and o.seqop=:iseqop and
                fs.codemp=ie.codempfs and fs.codfilial=ie.codfilialfs and fs.codfase=ie.codfase and fs.codop=o.codop and fs.seqop=o.seqop
            order by ie.codfase, ie.seqef
        into
        :icodemppd, :icodfilialpd, :iseqsubprod, :icodprodpd, :crefprod, :icodempfs, :icodfilialfs, :icodfase,
        :qtditestsp,:qtdest,:qtdprevprodop,:qtdfixa,:ccodlote, :iseqof
        do
        begin

            if (:ccodlote is null ) then
            begin
                icodemple = null;
                icodfilialle = null;
            end
            else
            begin
                icodemple = icodemppd;
                icodfilialle = icodfilialpd;
            end

            iseqsubprod = :iseqsubprod + 1;

           insert into ppopsubprod (codemp, codfilial, codop, seqop, seqsubprod, codemppd, codfilialpd, codprod,
                refprod, qtditsp, codempfs, codfilialfs, codfase, codemple, codfilialle, codlote, seqof, codemptm, codfilialtm, codtipomov
           )
           values(
                :icodemp, :icodfilial,:icodop,:iseqop, :iseqsubprod, :icodemppd, :icodfilialpd, :icodprodpd,
                :crefprod, :qtditestsp, :icodempfs, :icodfilialfs, :icodfase, :icodemple, :icodfilialle, :ccodlote, :iseqof, :codempts, :codfilialts, :codtipomovsp
           );



        end


    end

end
^

/* Alter (PPITOPSP02) */
ALTER PROCEDURE PPITOPSP02(ICODEMP INTEGER,
ICODFILIAL SMALLINT,
ICODOP INTEGER,
ISEQOP SMALLINT)
 AS
DECLARE VARIABLE NQTDITOP NUMERIC(15,5);
DECLARE VARIABLE ICODPRODPD INTEGER;
DECLARE VARIABLE ISEQITOP SMALLINT;
DECLARE VARIABLE ICODEMPPD INTEGER;
DECLARE VARIABLE ISEQPPITOP SMALLINT;
BEGIN
    FOR SELECT It.seqitop,
        CAST( IE.QTDITEST / E.QTDEST AS NUMERIC(15,5) ) * CAST(O.QTDFINALPRODOP AS NUMERIC(15, 5))
        FROM PPITESTRUTURA IE, PPESTRUTURA E, PPOP O, PPITOP IT
            WHERE IE.CODEMP=E.CODEMP AND IE.CODFILIAL=E.CODFILIAL AND
                IE.CODPROD=E.CODPROD AND IE.SEQEST=E.SEQEST AND
                O.CODEMPPD=E.CODEMP AND O.CODFILIALPD=E.CODFILIAL AND
                O.CODPROD=E.CODPROD AND O.SEQEST=E.SEQEST AND
                O.CODEMP=:ICODEMP AND O.CODFILIAL=:ICODFILIAL AND
                O.CODOP=:ICODOP AND O.SEQOP=:ISEQOP AND
                IT.codemp=O.CODEMP AND IT.CODFILIAL=O.CODFILIAL AND
                IT.codop=O.CODOP AND IT.seqop=O.seqop AND
                IE.codempfs=IT.codempfs AND IE.codfilial=IT.codfilialfs AND
                IE.codfase=IT.codfase and
                ie.codemppd=it.codemp and ie.codfilialpd=it.codfilial and
                ie.codprodpd=it.codprod and
                IE.qtdvariavel = 'S'
            INTO :ISEQITOP,:NQTDITOP
    DO
    BEGIN
        UPDATE PPITOP IOP SET QTDITOP=:NQTDITOP
            WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND IOP.codop=:ICODOP
                AND IOP.seqop=:ISEQOP AND IOP.seqitop=:ISEQITOP;

    END
   SUSPEND;
END
^

/* Alter (PPRELCUSTOSP) */
ALTER PROCEDURE PPRELCUSTOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
DTESTOQ DATE,
ICODEMPMC INTEGER,
SCODFILIALMC SMALLINT,
CCODMARCA CHAR(6),
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP CHAR(14),
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD CHAR(100),
TIPOPROD VARCHAR(2),
SLDPROD NUMERIC(15,5),
CUSTOUNIT NUMERIC(15,5),
CUSTOTOT NUMERIC(15,5))
 AS
begin
  /* Procedure Text */
  IF (ICODEMPGP IS NOT NULL) THEN
  BEGIN
    IF (STRLEN(RTRIM(CCODGRUP))<14) THEN
       CCODGRUP = RTRIM(CCODGRUP)||'%';
  END
  IF (CTIPOCUSTO IS NULL) then
     CTIPOCUSTO = 'P';

  FOR SELECT P.CODPROD,P.REFPROD,P.DESCPROD, P.TIPOPROD
   FROM EQPRODUTO P
   WHERE P.CODEMP = :ICODEMP AND P.CODFILIAL = :SCODFILIAL AND
   ( (:ICODEMPMC IS NULL) OR (P.CODEMPMC=:ICODEMPMC AND P.CODFILIALMC=:SCODFILIALMC AND
      P.CODMARCA=:CCODMARCA) ) AND
   ((:ICODEMPGP IS NULL) OR (P.CODEMPGP=:ICODEMPGP AND P.CODFILIALGP=:SCODFILIALGP AND
      P.CODGRUP LIKE :CCODGRUP) )
   INTO :CODPROD, :REFPROD, :DESCPROD, :TIPOPROD  DO
  BEGIN
     SELECT CUSTOUNIT,SLDPROD FROM PPCUSTOPRODSP(:ICODEMP,
        :SCODFILIAL, :CODPROD, :DTESTOQ, :CTIPOCUSTO, :ICODEMPAX,
        :SCODFILIALAX, :ICODALMOX, 'N')
       INTO :CUSTOUNIT, :SLDPROD;
     CUSTOTOT = CUSTOUNIT * SLDPROD;
     SUSPEND;
  END
end
^

/* Alter (PVABRECAIXASP) */
ALTER PROCEDURE PVABRECAIXASP(ICODCAIXA INTEGER,
SCODFILIAL SMALLINT,
ICODEMP INTEGER,
NVLRINICAIXA NUMERIC(15,5),
DDTAMOV DATE,
ICODFILIALUS SMALLINT,
CIDUSU CHAR(8))
 AS
DECLARE VARIABLE INROMOV INTEGER;
BEGIN
    SELECT INROMOV FROM PVSEQMOVCAIXASP(:ICODEMP, :SCODFILIAL, :ICODCAIXA, :DDTAMOV) INTO :INROMOV;

    INSERT INTO PVMOVCAIXA (CODCAIXA,CODFILIAL,CODEMP,DTAMOV,NROMOV,TIPOMOV,VLRSLDMOV,VLRMOV,CODEMPUS,CODFILIALUS,IDUSU) VALUES
      (:iCodCaixa,:sCodFilial,:iCodEmp,:DDTAMOV,:INROMOV,'A',:nVlrIniCaixa,:nVlrIniCaixa,:iCodEmp,:iCodFilialUs,:cIdUsu);
  SUSPEND;
END
^

/* Alter (PVADICMOVCAIXASP01) */
ALTER PROCEDURE PVADICMOVCAIXASP01(ICODCAIXA INTEGER,
NVLRINICAIXA NUMERIC(18,3),
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
DDTAMOV DATE)
 AS
DECLARE VARIABLE ICODMOVCAIXA INTEGER;
BEGIN
  SELECT INROMOV FROM PVSEQMOVCAIXASP(:ICODEMP, :SCODFILIAL, :ICODCAIXA, :DDTAMOV) INTO :ICODMOVCAIXA;
  INSERT INTO PVMOVCAIXA (CODEMP,CODFILIAL,CODCAIXA,DTAMOV,NROMOV,TIPOMOV,VLRSLDMOV,VLRMOV)
         VALUES (
                :ICODEMP,:SCODFILIAL,:iCodCaixa,:DDTAMOV,
                :ICODMOVCAIXA,'A',:nVlrIniCaixa,:nVlrIniCaixa
         );
  SUSPEND;
END
^

/* Alter (PVFECHACAIXASP) */
ALTER PROCEDURE PVFECHACAIXASP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODCAIXA INTEGER,
DDTAMOV DATE,
REDUZ CHAR,
ICODFILIALUS SMALLINT,
CIDUSU CHAR(8))
 AS
DECLARE VARIABLE ICODMOVCAIXA INTEGER;
DECLARE VARIABLE STATUSFECHA CHAR(1);
BEGIN
  SELECT INROMOV FROM PVSEQMOVCAIXASP(:ICODEMP, :SCODFILIAL, :ICODCAIXA, :DDTAMOV) INTO :ICODMOVCAIXA;

  IF (REDUZ = 'S') THEN
    STATUSFECHA = 'Z';
  ELSE
    STATUSFECHA = 'F';


  INSERT INTO PVMOVCAIXA (CODEMP,CODFILIAL,CODCAIXA,DTAMOV,NROMOV,TIPOMOV,
                          VLRMOV,CODEMPUS,CODFILIALUS,IDUSU) VALUES (
                         :ICODEMP,:SCODFILIAL,:ICODCAIXA,:DDTAMOV,
                         :ICODMOVCAIXA,:STATUSFECHA,0,:ICODEMP,:ICODFILIALUS,:CIDUSU
                         );
  SUSPEND;
END
^

/* Alter (PVFECHAVENDASP) */
ALTER PROCEDURE PVFECHAVENDASP(ICODEMP INTEGER,
ICODFILIAL SMALLINT,
NVALOR NUMERIC(15,5),
ITERM INTEGER,
DDTAMOV DATE,
CIDUSU CHAR(8))
 AS
DECLARE VARIABLE ICODMOVCAIXA INTEGER;
DECLARE VARIABLE IFILIALUSU SMALLINT;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'SGUSUARIO') INTO IFILIALUSU;
  /*SELECT ISEQ FROM SPGERANUM(:ICODEMP,:ICODFILIAL,'MC') INTO ICODMOVCAIXA;*/
  SELECT INROMOV FROM PVSEQMOVCAIXASP(:ICODEMP, :ICODFILIAL, :ITERM , :DDTAMOV) INTO :ICODMOVCAIXA;
  INSERT INTO PVMOVCAIXA (CODEMP,CODFILIAL,CODCAIXA,DTAMOV,NROMOV,TIPOMOV,VLRMOV,CODEMPUS,CODFILIALUS,IDUSU)
         VALUES (
                :ICODEMP,:ICODFILIAL,:ITERM,:DDTAMOV,
                :ICODMOVCAIXA,'V',:NVALOR,:ICODEMP,:IFILIALUSU,:CIDUSU
         );
  SUSPEND;
END
^

/* Alter (PVRETMOVCAIXASP) */
ALTER PROCEDURE PVRETMOVCAIXASP(ICODCAIXA INTEGER,
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DDTAMOV DATE)
 RETURNS(DDTAMOVRET DATE,
CTIPOMOV CHAR,
NVLRSLDMOV NUMERIC(15,5),
CIDUSU CHAR(8))
 AS
BEGIN
  SELECT DTAMOV,TIPOMOV,VLRSLDMOV,IDUSU FROM PVMOVCAIXA WHERE
         NROMOV = (
                  SELECT MAX(NROMOV) FROM PVMOVCAIXA WHERE
                         CODCAIXA=:ICODCAIXA
                         AND DTAMOV =:DDTAMOV
                         AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
                  )
         AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND DTAMOV=:DDTAMOV AND CODCAIXA=:ICODCAIXA
         INTO :DDTAMOVRET, :CTIPOMOV, :NVLRSLDMOV, :CIDUSU;

  SUSPEND;
END
^

/* Alter (PVSANGRIASP) */
ALTER PROCEDURE PVSANGRIASP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
NVALOR NUMERIC(18,3),
ICODCAIXA INTEGER,
DDTAMOV DATE,
CIDUSU CHAR(8))
 AS
DECLARE VARIABLE ICODMOVCAIXA INTEGER;
DECLARE VARIABLE IFILIALUSU INTEGER;
BEGIN
  if (NVALOR IS NULL) then
     NVALOR = 0;
  SELECT INROMOV FROM PVSEQMOVCAIXASP(:ICODEMP, :SCODFILIAL, :ICODCAIXA, :DDTAMOV) INTO :ICODMOVCAIXA;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'SGUSUARIO') INTO IFILIALUSU;
  INSERT INTO PVMOVCAIXA (CODEMP,CODFILIAL,CODCAIXA,DTAMOV,NROMOV,TIPOMOV,VLRMOV,CODEMPUS,CODFILIALUS,IDUSU)
         VALUES (
                :ICODEMP,:SCODFILIAL,:ICODCAIXA,:DDTAMOV,
                :ICODMOVCAIXA,'S',:NVALOR*-1,:ICODEMP,:IFILIALUSU,:CIDUSU
         );
  SUSPEND;
END
^

/* Alter (PVSUPRIMENTOSP) */
ALTER PROCEDURE PVSUPRIMENTOSP(ICODEMP INTEGER,
ICODFILIAL SMALLINT,
NVALOR NUMERIC(18,3),
ITERM INTEGER,
DDTAMOV DATE,
CIDUSU CHAR(8))
 AS
DECLARE VARIABLE ICODMOVCAIXA INTEGER;
DECLARE VARIABLE IFILIALUSU INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'SGUSUARIO') INTO IFILIALUSU;
  SELECT INROMOV FROM PVSEQMOVCAIXASP(:ICODEMP, :IFILIALUSU, :ITERM, :DDTAMOV) INTO :ICODMOVCAIXA;
  INSERT INTO PVMOVCAIXA (CODEMP,CODFILIAL,CODCAIXA,DTAMOV,NROMOV,TIPOMOV,VLRMOV,CODEMPUS,CODFILIALUS,IDUSU)
         VALUES (
                :ICODEMP,:ICODFILIAL,:ITERM,:DDTAMOV,
                :ICODMOVCAIXA,'U',:NVALOR,:ICODEMP,:IFILIALUSU,:CIDUSU
         );
  SUSPEND;
END
^

/* Alter (RHLISTACANDVAGASP) */
ALTER PROCEDURE RHLISTACANDVAGASP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODVAGA INTEGER,
ICODFUNC INTEGER)
 RETURNS(CODCAND INTEGER,
NOMECAND CHAR(50),
FONECAND CHAR(12),
PRETENSAOSAL NUMERIC(15,2),
QUALIFICACOES INTEGER,
RESTRICOES INTEGER,
CURSOS INTEGER,
EXPERIENCIA INTEGER,
STVAGACAND CHAR(2),
STCAND CHAR(2))
 AS
begin
    for select cd.codcand, cd.nomecand, cd.fonecand, cd.pretensaosal,cd.stcand,
        (select count(*) from rhcandidatocarac ctq
            where ctq.codemp=cd.codemp and ctq.codfilial=cd.codfilial and ctq.codcand=cd.codcand
                and ctq.codcarac in
                    (select ctvq.codcarac from rhvagacaracquali ctvq
                        where ctvq.codemp=:icodemp and ctvq.codfilial=:scodfilial
                        and ctvq.codvaga=:icodvaga)
        ) as qualificacoes,
        (select count(*) from rhcandidatocarac ctr
            where ctr.codemp=cd.codemp and ctr.codfilial=cd.codfilial and ctr.codcand=cd.codcand
                and ctr.codcarac in
                    (select ctvr.codcarac from rhvagacaracrest ctvr
                        where ctvr.codemp=:icodemp and ctvr.codfilial=:scodfilial
                        and ctvr.codvaga=:icodvaga)
        ) as restricoes,
        (select count(*) from rhcandidatocurso cu
            where cu.codemp=cd.codemp and cu.codfilial=cd.codfilial and cu.codcand=cd.codcand
                and cu.codcurso in
                    (select vc.codcurso from rhvagacurso vc
                        where vc.codemp=:icodemp and vc.codfilial=:scodfilial
                            and vc.codvaga=:icodvaga )
        ) as cursos,
        (select count(*) from rhcandidatofunc fu
            where fu.codemp=cd.codemp and fu.codfilial=cd.codfilial and fu.codcand=cd.codcand
                and fu.codfunc=:icodfunc )
        as experiencia,
        coalesce(
            (select rv.stvagacand from rhvagacandidato rv
                where rv.codemp=:icodemp and rv.codfilial=:scodfilial and rv.codvaga=:icodvaga
                    and rv.codempca=cd.codemp and rv.codfilialca=cd.codfilial and rv.codcand=cd.codcand
            ),'DI'
        )

        from rhcandidato cd

    into :codcand, :nomecand, :fonecand, :pretensaosal, :stcand, :qualificacoes,
         :restricoes, :cursos, :experiencia, :stvagacand
    do
    begin
        suspend;
    end
end
^

SET TERM ; ^

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da vaga'
WHERE RDB$PROCEDURE_NAME = 'RHLISTACANDVAGASP' AND RDB$PARAMETER_NAME = 'ICODVAGA';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Cdigo da funo'
WHERE RDB$PROCEDURE_NAME = 'RHLISTACANDVAGASP' AND RDB$PARAMETER_NAME = 'ICODFUNC';

/* Alter (RHLISTAVAGACANDSP) */
SET TERM ^ ;

ALTER PROCEDURE RHLISTAVAGACANDSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODCAND INTEGER)
 RETURNS(CODVAGA INTEGER,
NOMEEMPR CHAR(60),
CODFUNC INTEGER,
DESCFUNC VARCHAR(100),
FAIXASALINI NUMERIC(15,2),
FAIXASALFIM NUMERIC(15,2),
STVAGA CHAR(2),
QUALIFICACOES INTEGER,
RESTRICOES INTEGER,
CURSOS INTEGER,
STVAGACAND CHAR(2))
 AS
begin
    for select vg.codvaga, empr.nomeempr, vg.codfunc, fu.descfunc, vg.faixasalini, vg.faixasalfim, vg.stvaga,
        (select count(*) from rhvagacaracquali ctq
            where ctq.codemp=vg.codemp and ctq.codfilial=vg.codfilial and ctq.codvaga=vg.codvaga
                and ctq.codcarac in
                    (select ctvq.codcarac from rhcandidatocarac ctvq
                        where ctvq.codemp=:icodemp and ctvq.codfilial=:scodfilial
                        and ctvq.codcand=:icodcand)
        ) as qualificacoes,
        (select count(*) from rhvagacaracrest ctr
            where ctr.codemp=vg.codemp and ctr.codfilial=vg.codfilial and ctr.codvaga=vg.codvaga
                and ctr.codcarac in
                    (select ctvr.codcarac from rhcandidatocarac ctvr
                        where ctvr.codemp=:icodemp and ctvr.codfilial=:scodfilial
                        and ctvr.codcand=:icodcand)
        ) as restricoes,
        (select count(*) from rhvagacurso cu
            where cu.codemp=vg.codemp and cu.codfilial=vg.codfilial and cu.codvaga=vg.codvaga
                and cu.codcurso in
                    (select cc.codcurso from rhcandidatocurso cc
                        where cc.codemp=:icodemp and cc.codfilial=:scodfilial
                            and cc.codcand=:icodcand )
        ) as cursos,
        coalesce(
            (select rv.stvagacand from rhvagacandidato rv
                where rv.codemp=:icodemp and rv.codfilial=:scodfilial and rv.codcand=:icodcand
                    and rv.codemp=vg.codemp and rv.codfilial=vg.codfilial and rv.codvaga=vg.codvaga
            ),'DI'
        )

        from rhvaga vg, rhempregador empr, rhfuncao fu
            where
            empr.codemp=vg.codempem and empr.codfilial=vg.codfilialem and empr.codempr=vg.codempr
            and fu.codemp=vg.codempfc and fu.codfilial=vg.codfilialfc and fu.codfunc=vg.codfunc
            
    into :codvaga, :nomeempr, :codfunc, :descfunc, :faixasalini, :faixasalfim, :stvaga,
         :qualificacoes, :restricoes, :cursos, :stvagacand
    do
    begin
        suspend;
    end
end
^

/* empty dependent procedure body */
/* Clear: SGATUALIZABDSP for: SGDADOSINISP */
ALTER PROCEDURE SGATUALIZABDSP(ICODEMP INTEGER)
 AS
 BEGIN EXIT; END
^

/* Alter (SGDADOSINISP) */
ALTER PROCEDURE SGDADOSINISP(ICODEMP INTEGER)
 AS
declare variable crole_name char(31);
declare variable inumemp integer;
declare variable cidgrpusu char(8);
declare variable cidusu char(8);
declare variable csql varchar(256);
begin
  /*CTEMP = printLog('Entrou em dados ini '||cast(ICODEMP AS CHAR(10)));*/
  select codemp from sgempresa where codemp=:icodemp into :inumemp;
  if (inumemp is null) then
  begin
   /* CTEMP = printLog('Empresa  nulo '||cast(ICODEMP AS CHAR(10))); */
     insert into sgempresa (codemp,razemp)
        values (:icodemp,'EMPRESA '||cast(:icodemp as char(10) ));
     insert into SGFILIAL (codemp, codfilial, razfilial,
        nomefilial, mzfilial, simplesfilial)
       values (:icodemp,1,'EMPRESA'||cast(:icodemp as char(10) )||' - MATRIZ',
        'EMPRESA'||cast(:icodemp as char(10) )||' - MATRIZ' ,'S', 'S');
    /*CTEMP = printLog('Inseriu empresa e filial '||cast(ICODEMP AS CHAR(10)));*/
  end
  select rdb$role_name from rdb$roles
     where rdb$role_name='ADM'
       into :crole_name;
  if (crole_name is null) then
  begin
     csql = 'CREATE ROLE ADM';
     execute statement csql;
  end
  /* CTEMP = printLog('cadastrou roles'); */
  for select codemp from sgempresa where codemp=:icodemp into :inumemp do
  begin
  /* CTEMP = printLog('LOOP DE EMPRESA PARA CADASTRAR GRUPO'||cast(inumemp as char(10)));*/
     select idgrpusu from sggrpusu
       where codemp=:inumemp and idgrpusu='ADM'
         into :cidgrpusu;
     if (cidgrpusu is null) then
        insert into sggrpusu ( codemp, codfilial, idgrpusu, nomegrpusu)
          values ( :inumemp, 1, 'ADM', 'ADMINISTRADOR' );
     select idusu from sgusuario
       where codemp=:inumemp and idusu='sysdba' and codfilial=1
         into :cidusu;
     if (cidusu is null) then
        insert into sgusuario (codemp, codfilial, idusu, nomeusu, idgrpusu)
          values (:inumemp, 1, 'sysdba', 'ADMINISTRADOR DBA', 'ADM');
  /* CTEMP = printLog('CADASTROU USUARIOS');*/
  end
  suspend;
end
^

/* Alter (SGGERACNFSP) */
ALTER PROCEDURE SGGERACNFSP(TIPO VARCHAR(2),
CODEMP INTEGER,
CODFILIAL SMALLINT,
TIPOVENDA VARCHAR(2),
CODVENDA INTEGER,
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER)
 RETURNS(CNF BIGINT)
 AS
begin
   --execute procedure sgdebugsp 'sggeracnfsp', 'Entrou na procedure geracnf';
   SELECT BISEQ FROM SGSEQUENCE_IDSP('NCF') INTO :CNF;
   suspend;
end
^

/* Alter (SGINICONSP) */
ALTER PROCEDURE SGINICONSP(ICODEMP INTEGER,
CIDUSU CHAR(8),
ICODFILIALSEL SMALLINT,
ICODTERM SMALLINT)
 RETURNS(SRET SMALLINT)
 AS
DECLARE VARIABLE ICONECTADO INTEGER;
DECLARE VARIABLE ICODFILIALSELCX SMALLINT;
DECLARE VARIABLE ICODEMPTMP INTEGER;
DECLARE VARIABLE ICODFILIAL SMALLINT;
begin
  /* Procedure para inicializao da conexo com o banco de dados */
  SRET = 0;
  if (ICODEMP IS NULL) then
     ICODEMP = 99;
  /*CTEMP = printLog('Vai verificar o usurio');*/
  CIDUSU = lower(CIDUSU);
  IF ( CIDUSU='sysdba' ) THEN
  BEGIN
/*     CTEMP = printLog('Usurio sysdba');*/

     SELECT CODEMP FROM SGEMPRESA WHERE CODEMP=:ICODEMP INTO :ICODEMPTMP;
     IF (ICODEMPTMP IS NULL) THEN
        EXECUTE PROCEDURE SGATUALIZABDSP(:ICODEMP);
  END
  SELECT CODFILIAL FROM SGUSUARIO WHERE IDUSU=:cIdUsu AND
      CODEMP=:ICODEMP  INTO :iCodFilial;
/*  CTEMP = printLog('O usurio  = '||cIdUsu); */

/*  CTEMP = printLog('Contador de usurios '||cIdUsu); */

  if (iCodFilial is null) then
    EXCEPTION SGCONEXAOEX02;

  if (iCodFilialSel is not null) then
  begin
      SRET = 1;
      SELECT CONECTADO, CODFILIALSEL FROM SGCONEXAO
        WHERE NRCONEXAO=CURRENT_CONNECTION INTO :iConectado, iCodFilialSelCX;
      if (iConectado is null) then
          INSERT INTO SGCONEXAO (NRCONEXAO, CODEMP,CODFILIAL,IDUSU,CODFILIALSEL,CONECTADO,CODTERM)
            VALUES (CURRENT_CONNECTION, :iCodemp, :iCodfilial, :cIdusu, :iCodfilialSel, 1, :iCodTerm);
      else
      begin
          if (iConectado<=0) then
             UPDATE SGCONEXAO SET CONECTADO=1, CODFILIALSEL=:iCodfilialSel, CODTERM = :iCodTerm,
               CODEMP=:iCodemp, CODFILIAL=:iCodfilial , IDUSU=:cIdUsu
               WHERE NRCONEXAO=CURRENT_CONNECTION;
          else
          begin
             if (not (iCodfilialSelCX=iCodfilialSel) ) then
                EXCEPTION SGCONEXAOEX01;
             else
                UPDATE SGCONEXAO SET CONECTADO=CONECTADO+1, CODTERM = :iCodTerm,
                   CODEMP=:iCodemp, CODFILIAL=:iCodfilial, IDUSU=:cIdUsu
                WHERE NRCONEXAO=CURRENT_CONNECTION;
          end
      end
      -- Implementao de atualizao de verso do aplicativo emissor de NFe, quando emisso prpria.
      update sgprefere1 set verprocnfe='1.3.4.9' where proceminfe=0 and verprocnfe<>'1.3.4.9';
  end
  suspend;
end
^

/* Alter (SGRETVERSAO) */
ALTER PROCEDURE SGRETVERSAO RETURNS(VERSAO VARCHAR(30))
 AS
begin
    versao = '1.3.4.9 (13/06/2016)';
    suspend;
end
^

/* empty dependent procedure body */
/* Clear: ATADICATENDIMENTOCLISP for: SPGERANUM */
ALTER PROCEDURE ATADICATENDIMENTOCLISP(ICODTIPOATENDO INTEGER,
ICODATEND INTEGER,
ICODSETOR INTEGER,
ICODEMP INTEGER,
ICODFILIAL INTEGER,
IDOC INTEGER,
DATAATENDO DATE,
DATAATENDOFIN DATE,
HORAATENDO TIME,
HORAATENDOFIN TIME,
OBSATENDO VARCHAR(10000),
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
CODEMPCT INTEGER,
CODFILIALCT INTEGER,
CODCONTR INTEGER,
CODITCONTR INTEGER,
CODREC INTEGER,
NPARCITREC INTEGER,
CODEMPCH INTEGER,
CODFILIALCH SMALLINT,
CODCHAMADO INTEGER,
OBSINTERNO VARCHAR(10000),
CONCLUICHAMADO CHAR,
CODEMPEA INTEGER,
CODFILIALEA SMALLINT,
CODESPEC INTEGER)
 AS
 BEGIN EXIT; END
^

/* empty dependent procedure body */
/* Clear: ATATENDIMENTOIUSP for: SPGERANUM */
ALTER PROCEDURE ATATENDIMENTOIUSP(IU CHAR,
CODEMP INTEGER,
CODFILIAL SMALLINT,
CODATENDO INTEGER,
CODEMPTO INTEGER,
CODFILIALTO SMALLINT,
CODTPATENDO INTEGER,
CODEMPAE INTEGER,
CODFILIALAE SMALLINT,
CODATEND INTEGER,
CODEMPSA INTEGER,
CODFILIALSA SMALLINT,
CODSETOR INTEGER,
DOCATENDO INTEGER,
DATAATENDO DATE,
DATAATENDOFIN DATE,
HORAATENDO TIME,
HORAATENDOFIN TIME,
OBSATENDO VARCHAR(10000),
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
CODCONTR INTEGER,
CODITCONTR SMALLINT,
CODEMPIR INTEGER,
CODFILIALIR SMALLINT,
CODREC INTEGER,
NPARCITREC INTEGER,
CODEMPCH INTEGER,
CODFILIALCH SMALLINT,
CODCHAMADO INTEGER,
OBSINTERNO VARCHAR(10000),
CONCLUICHAMADO CHAR,
CODEMPEA INTEGER,
CODFILIALEA SMALLINT,
CODESPEC INTEGER,
CODEMPUS INTEGER,
CODFILIALUS SMALLINT,
IDUSU VARCHAR(128),
STATUSATENDO CHAR(2),
CODEMPTA INTEGER,
CODFILIALTA SMALLINT,
CODTAREFA INTEGER,
CODEMPOC INTEGER,
CODFILIALOC INTEGER,
TIPOORC CHAR,
CODORC INTEGER,
SITATENDO CHAR(2),
CODEMPAG INTEGER,
CODFILIALAG SMALLINT,
TIPOAGE CHAR(5),
CODAGE INTEGER,
CODAGD INTEGER)
 AS
 BEGIN EXIT; END
^

/* empty dependent procedure body */
/* Clear: CRTOTAL01ISP for: SPGERANUM */
ALTER PROCEDURE CRTOTAL01ISP(CODEMP INTEGER,
CODFILIAL INTEGER)
 RETURNS(SEQTOT INTEGER)
 AS
 BEGIN SUSPEND; END
^

/* empty dependent procedure body */
/* Clear: EQMOVPRODSEQSP for: SPGERANUM */
ALTER PROCEDURE EQMOVPRODSEQSP(ICODEMP INTEGER)
 RETURNS(SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER)
 AS
 BEGIN SUSPEND; END
^

/* empty dependent procedure body */
/* Clear: SGLOGSP01 for: SPGERANUM */
ALTER PROCEDURE SGLOGSP01(CLASLOG CHAR(2),
TIPOLOG CHAR(3),
DESCLOG CHAR(60),
OBSLOG VARCHAR(1000))
 RETURNS(CODFILIAL SMALLINT,
CODLOG INTEGER)
 AS
 BEGIN SUSPEND; END
^

/* empty dependent procedure body */
/* Clear: SGSETAGENDASP for: SPGERANUM */
ALTER PROCEDURE SGSETAGENDASP(CODAGD INTEGER,
CODEMP INTEGER,
DTAINIAGD DATE,
HRINIAGD TIME,
DTAFIMAGD DATE,
HRFIMAGD TIME,
ASSUNTOAGD CHAR(50),
DESCAGD VARCHAR(10000),
CODFILIALTA SMALLINT,
CODTIPOAGD INTEGER,
PRIORAGD SMALLINT,
CODAGE INTEGER,
TIPOAGE CHAR(5),
CODFILIALAE SMALLINT,
CODAGEEMIT INTEGER,
TIPOAGEEMIT CHAR(5),
CAAGD CHAR(2),
SITAGD CHAR(2),
RESOLUCAOMOTIVO VARCHAR(10000),
CODAGDAR INTEGER,
DIATODO CHAR)
 RETURNS(IRET INTEGER)
 AS
 BEGIN SUSPEND; END
^

/* empty dependent procedure body */
/* Clear: TKGERACAMPANHACTO for: SPGERANUM */
ALTER PROCEDURE TKGERACAMPANHACTO(TIPOCTO CHAR,
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
CODCAMP CHAR(13),
CODEMPCO INTEGER,
CODFILIALCO SMALLINT,
CODCTO INTEGER,
CODEMPAT INTEGER,
CODFILIALAT SMALLINT,
CODATIV INTEGER,
SITHISTTK CHAR(2),
DESCHISTTK VARCHAR(1000))
 AS
 BEGIN EXIT; END
^

/* empty dependent procedure body */
/* Clear: TKSETHISTSP for: SPGERANUM */
ALTER PROCEDURE TKSETHISTSP(CODHISTTK INTEGER,
CODEMP INTEGER,
CODFILIALCO INTEGER,
CODCTO INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER,
DESCHISTTK VARCHAR(10000),
CODFILIALAE INTEGER,
CODATEND INTEGER,
SITHISTTK CHAR(2),
DATAHISTTK DATE,
TIPOHISTTK CHAR)
 RETURNS(IRET INTEGER)
 AS
 BEGIN SUSPEND; END
^

/* empty dependent procedure body */
/* Clear: VDCOPIACLIENTE for: SPGERANUM */
ALTER PROCEDURE VDCOPIACLIENTE(ICODCLI INTEGER,
IDOCUMENTO VARCHAR(14),
ICODEMP INTEGER,
ICODFILIAL INTEGER)
 RETURNS(ICOD INTEGER)
 AS
 BEGIN SUSPEND; END
^

/* Alter (SPGERANUM) */
ALTER PROCEDURE SPGERANUM(ICODEMP INTEGER,
ICODFILIAL INTEGER,
STAB CHAR(2))
 RETURNS(ISEQ INTEGER)
 AS
begin
  iseq = null;
  select nroseq from sgsequencia
    where codemp=:icodemp and
      codfilial=:icodfilial and
      sgtab=:stab into :iseq;
   if (iseq is null) then
   begin
     insert into sgsequencia (codemp,codfilial,sgtab,nroseq)
            values (:icodemp,:icodfilial,:stab,0);
     iseq = 1;
   end
   update sgsequencia set nroseq=:iseq+1 where
          codemp=:icodemp and codfilial=:icodfilial
          and sgtab=:stab;
  suspend;
end
^

/* Alter (TKCONTCLISP) */
ALTER PROCEDURE TKCONTCLISP(CODEMP INTEGER,
CODFILIAL INTEGER,
CODCTO INTEGER,
CODFILIALTI INTEGER,
CODTIPOCLI INTEGER,
CODFILIALCC INTEGER,
CODCLASCLI INTEGER,
CODFILIALSR INTEGER,
CODSETOR INTEGER)
 RETURNS(IRET INTEGER)
 AS
declare variable icodcli integer;
declare variable codfilialpf integer;
declare variable usuativcli char(1);
declare variable ifilialcli integer;
BEGIN
  SELECT MAX(CODCLI)+1 FROM VDCLIENTE WHERE CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL INTO ICODCLI;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP, 'VDCLIENTE') INTO IFILIALCLI;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP, 'SGPREFERE1') INTO :CODFILIALPF;
  SELECT PF.USUATIVCLI FROM SGPREFERE1 PF WHERE CODEMP=:CODEMP AND CODFILIAL=:CODFILIALPF
    INTO :USUATIVCLI;
  
  INSERT INTO VDCLIENTE (CODEMP,CODFILIAL,CODCLI,RAZCLI,CODEMPCC,CODFILIALCC,CODCLASCLI,
  CODEMPVD,CODFILIALVD,CODVEND,CODEMPSR,CODFILIALSR,CODSETOR,NOMECLI,CODEMPTI,CODFILIALTI,
  CODTIPOCLI,DATACLI,PESSOACLI,ATIVOCLI,CNPJCLI,INSCCLI,CPFCLI,RGCLI,ENDCLI,NUMCLI,
  COMPLCLI,BAIRCLI,CIDCLI,UFCLI,CEPCLI,FONECLI,FAXCLI,EMAILCLI,CONTCLI,CTOCLI,
  CODPAIS, SIGLAUF, CODMUNIC, EDIFICIOCLI)
    SELECT :CODEMP,:IFILIALCLI,:ICODCLI,RAZCTO,:CODEMP,:CODFILIALCC,:CODCLASCLI,
    CODEMPVD,CODFILIALVD,CODVEND,:CODEMP,:CODFILIALSR,:CODSETOR,NOMECTO,:CODEMP,:CODFILIALTI,
    :CODTIPOCLI,DATACTO,PESSOACTO,(CASE WHEN COALESCE(:USUATIVCLI,'N')='S' THEN 'N' ELSE 'S' END),
    CNPJCTO,INSCCTO,CPFCTO,RGCTO,ENDCTO,NUMCTO,
    COMPLCTO,BAIRCTO,CIDCTO,UFCTO,CEPCTO,FONECTO,FAXCTO,EMAILCTO,CONTCTO,'O',
    CODPAIS, SIGLAUF, CODMUNIC, EDIFICIOCTO
  FROM TKCONTATO WHERE
    CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL AND CODCTO=:CODCTO;
    
  INSERT INTO TKCONTCLI (CODEMPCTO, CODFILIALCTO, CODCTO, CODEMPCLI, CODFILIALCLI, CODCLI)
    VALUES (:CODEMP, :CODFILIAL, :CODCTO, :CODEMP, :IFILIALCLI, :ICODCLI);
  IRET = ICODCLI;
  
  SUSPEND;
END
^

/* Alter (TKGERACAMPANHACTO) */
ALTER PROCEDURE TKGERACAMPANHACTO(TIPOCTO CHAR,
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
CODCAMP CHAR(13),
CODEMPCO INTEGER,
CODFILIALCO SMALLINT,
CODCTO INTEGER,
CODEMPAT INTEGER,
CODFILIALAT SMALLINT,
CODATIV INTEGER,
SITHISTTK CHAR(2),
DESCHISTTK VARCHAR(1000))
 AS
declare variable seqcampcto integer; /* Cdigo do contato pra validao. */
declare variable seqsitcamp integer;
declare variable codfilialhi smallint;
declare variable codhisttk integer;
declare variable codempae integer;
declare variable codfilialae smallint;
declare variable codatend integer; /* Cdigo do atendente. */
declare variable codempus integer;
declare variable codfilialus smallint;
declare variable idusu char(8); /* Id do usurio */
begin

    select icodfilial from sgretfilial(:codempca,'TKHISTORICO') into codfilialhi;
    select iseq from spgeranum(:codempca,:codfilialhi,'HI') into codhisttk;
    select codempusu, codfilialusu, idusus from sgretinfousu(:codempca, user) where codempusu=:codempca into
            :codempus, :codfilialus, :idusu;

    select first 1 codemp, codfilial, codatend from atatendente
            where codempus=:codempus and codfilialus=:codfilialus and idusu=:idusu
    into codempae, codfilialae, codatend;

    if(:codatend is null) then
    begin
        exception TKGERACAMANHACTO01 ' - ID: ' || idusu || ' - User: '|| user ;
    end

    -- Verifica se o contato j foi vinculado  campanha

    if ( tipocto = 'O' ) then
    begin
       select max(seqcampcto) from tkcampanhacto cc
           where cc.codemp=:codempca and cc.codfilial=:codfilialca and cc.codcamp=:codcamp
           and cc.codempco=:codempco and cc.codfilialco=:codfilialco and cc.codcto=:codcto
           into :seqcampcto;
    end
    else
    begin
       select max(seqcampcto) from tkcampanhacto cc
           where cc.codemp=:codempca and cc.codfilial=:codfilialca and cc.codcamp=:codcamp
           and cc.codempcl=:codempco and cc.codfilialcl=:codfilialco and cc.codcli=:codcto
           into :seqcampcto;
    end

    if ( (:seqcampcto is null) or (:seqcampcto=0) ) then
    begin
       select max(coalesce(seqcampcto,0)+1) seqcampcto from tkcampanhacto cc
           where cc.codemp=:codempca and cc.codfilial=:codfilialca and cc.codcamp=:codcamp
           into :seqcampcto;
        if (seqcampcto is null) then
        begin
           seqcampcto = 1;
        end
        if ( tipocto = 'O' ) then
        begin
            insert into tkcampanhacto (codemp, codfilial, codcamp, seqcampcto, codempco, codfilialco, codcto)
                values(:codempca, :codfilialca, :codcamp, :seqcampcto, :codempco, :codfilialco, :codcto);
        end
        else 
        begin
            insert into tkcampanhacto (codemp, codfilial, codcamp, seqcampcto, codempcl, codfilialcl, codcli)
                values(:codempca, :codfilialca, :codcamp, :seqcampcto, :codempco, :codfilialco, :codcto);
               -- exception TKGERACAMANHACTO01 'teste';
        end

    end

    seqsitcamp = 0;
    select max(sc.seqsitcamp) from tksitcamp sc
            where sc.codemp=:codempca and sc.codfilial=:codfilialca and
                sc.codcamp=:codcamp and sc.tipocto=:tipocto
                into :seqsitcamp;

    if(:seqsitcamp is null) then
    begin
        seqsitcamp = 0;
    end

    seqsitcamp = seqsitcamp + 1;

    if ( tipocto = 'O' ) then
    begin
        insert into tksitcamp (codemp,codfilial,codcamp,codempco,codfilialco,codcto,seqsitcamp,
                codempav,codfilialav,codativ, tipocto)
            values (:codempca,:codfilialca,:codcamp,:codempco,:codfilialco,:codcto,:seqsitcamp,
                :codempat,:codfilialat ,:codativ, :tipocto );
    end
    else
    begin
        insert into tksitcamp (codemp,codfilial,codcamp,codempcl,codfilialcl,codcli,seqsitcamp,
                codempav,codfilialav,codativ, tipocto)
            values (:codempca,:codfilialca,:codcamp,:codempco,:codfilialco,:codcto,:seqsitcamp,
                :codempat,:codfilialat ,:codativ, :tipocto );
    end

    -- Inserindo histrico
    
    if ( tipocto = 'O' ) then 
    begin 
        insert into tkhistorico (codemp, codfilial,codhisttk,horahisttk,datahisttk,
                         codempco,codfilialco,codcto,deschisttk,codempae,codfilialae,codatend,
                         sithisttk,tipohisttk, tipocto)
            values (:codempca,:codfilialhi,:codhisttk,cast('now' as time),cast('now' as date),
                      :codempco,:codfilialco,:codcto,:deschisttk,:codempae,:codfilialae,:codatend,
                          :sithisttk,'C', :tipocto);
    end
    else
    begin
        insert into tkhistorico (codemp, codfilial,codhisttk,horahisttk,datahisttk,
                         codempcl,codfilialcl,codcli,deschisttk,codempae,codfilialae,codatend,
                         sithisttk,tipohisttk, tipocto)
            values (:codempca,:codfilialhi,:codhisttk,cast('now' as time),cast('now' as date),
                      :codempco,:codfilialco,:codcto,:deschisttk,:codempae,:codfilialae,:codatend,
                          :sithisttk,'C', :tipocto);
    end
   

end
^

/* Alter (TKSETHISTSP) */
ALTER PROCEDURE TKSETHISTSP(CODHISTTK INTEGER,
CODEMP INTEGER,
CODFILIALCO INTEGER,
CODCTO INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER,
DESCHISTTK VARCHAR(10000),
CODFILIALAE INTEGER,
CODATEND INTEGER,
SITHISTTK CHAR(2),
DATAHISTTK DATE,
TIPOHISTTK CHAR)
 RETURNS(IRET INTEGER)
 AS
DECLARE VARIABLE IFILIALHIST INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'TKHISTORICO') INTO IFILIALHIST;
  IF (TIPOHISTTK = '') THEN
  BEGIN
    TIPOHISTTK = 'H';
  END
  IF (CODHISTTK = 0) THEN
  BEGIN
    SELECT ISEQ FROM SPGERANUM(:CODEMP,:IFILIALHIST,'HI') INTO CODHISTTK;
    INSERT INTO TKHISTORICO(CODEMP,CODFILIAL,CODHISTTK,DATAHISTTK,HORAHISTTK,CODEMPCO,CODFILIALCO,
      CODCTO,CODEMPCL,CODFILIALCL,CODCLI,DESCHISTTK,CODEMPAE,CODFILIALAE,CODATEND,SITHISTTK,TIPOHISTTK)
      VALUES (:CODEMP,:IFILIALHIST,:CODHISTTK,:DATAHISTTK,CAST('now' AS TIME),:CODEMP,:CODFILIALCO,
      :CODCTO,:CODEMP,:CODFILIALCL,:CODCLI,:DESCHISTTK,:CODEMP,:CODFILIALAE,:CODATEND,:SITHISTTK,:TIPOHISTTK);
  END
  ELSE
  BEGIN
    UPDATE TKHISTORICO SET DATAHISTTK=:DATAHISTTK,CODEMPCO=:CODEMP,CODFILIALCO=:CODFILIALCO,
      CODCTO=:CODCTO,CODEMPCL=:CODEMP,CODFILIALCL=:CODFILIALCL,
      CODCLI=:CODCLI,DESCHISTTK=:DESCHISTTK,CODEMPAE=:CODEMP,
      CODFILIALAE=:CODFILIALAE,CODATEND=:CODATEND,SITHISTTK=:SITHISTTK,TIPOHISTTK=:TIPOHISTTK
      WHERE CODEMP=:CODEMP AND CODFILIAL=:IFILIALHIST AND CODHISTTK=:CODHISTTK;
    /*IF (NOT SITHISTTK IN ('AG')) THEN
      DELETE FROM SGAGENDA WHERE OBJORIGAGD='HISTO' AND CODEMPCH=:CODEMP AND
        CODFILIALCH=:IFILIALHIST AND CODCHAVE=:CODHISTTK; */
  END
  SUSPEND;
END
^

/* Alter (VDADICCOMISSAOSP) */
ALTER PROCEDURE VDADICCOMISSAOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRVENDACOMI NUMERIC(15,5),
NVLRCOMI NUMERIC(15,5),
DDATACOMI DATE,
DDTCOMPCOMI DATE,
DDTVENCCOMI DATE,
CTIPOCOMI CHAR,
CODEMPVD INTEGER,
CODFILIALVD SMALLINT,
CODVEND INTEGER)
 AS
declare variable scodfilialcs smallint;
declare variable icodcomi integer;
declare variable cstatuscomi char(2);
begin

    -- Se o valor for nulo ou 0 deve deletar a comisso j gerada
    if ( (nvlrcomi is null) or  (nvlrcomi=0) ) then
    begin

        delete from vdcomissao co
        where co.codemprc=:icodemp and co.codfilialrc=:scodfilial and co.codrec=:icodrec and co.nparcitrec=:inparcitrec and
        co.tipocomi=:ctipocomi and codempvd=:codempvd and codfilialvd=:codfilialvd and codvend=:codvend;

    end
    -- Caso seja um estorno de comisso
    else if (nvlrcomi<0) then
    begin

        -- Buscando a filial da tabela de comisses
        select icodfilial from sgretfilial(:icodemp,'VDCOMISSAO') into :scodfilialcs;

        -- Buscando novo numero para
        select max(codcomi) from vdcomissao where codemp=:icodemp and codfilialvd = :scodfilialcs into icodcomi;

        if (:icodcomi is null) then
            icodcomi = 1;
        else
            icodcomi = icodcomi + 1;

        -- Inserindo na tabela de comisses
        insert into vdcomissao (
            codemp, codfilial, codcomi, codempRc, codfilialrc, codrec, nparcitrec, vlrvendacomi, vlrcomi, datacomi,
            dtcompcomi, dtvenccomi, statuscomi, tipocomi, codempvd, codfilialvd, codvend )
        values (
            :icodemp, :scodfilialcs, :icodcomi, :icodemp, :scodfilial, :icodrec, :inparcitrec, :nvlrvendacomi, :nvlrcomi, :ddatacomi,
            :ddtcompcomi, :ddtvenccomi, 'CE', :ctipocomi, :codempvd, :codfilialvd,:codvend
            );

        -- Transforma o valor da comisso em positivo e programa para o proximo pagto.
        nvlrcomi = nvlrcomi * -1;

        icodcomi = icodcomi + 1;

        insert into vdcomissao (
            codemp, codfilial, codcomi, codemprc, codfilialrc, codrec, nparcitrec,
            vlrvendacomi, vlrcomi, datacomi, dtcompcomi,  dtvenccomi, statuscomi, tipocomi, codempvd, codfilialvd, codvend )
        values (
            :icodemp, :scodfilialcs, :icodcomi, :icodemp, :scodfilial, :icodrec, :inparcitrec,
            :nvlrvendacomi, :nvlrcomi, :ddatacomi, :ddtcompcomi, :ddtvenccomi, 'C1', :ctipocomi, :codempvd,:codfilialvd,:codvend
            );

    end
    else
    begin

        if (ctipocomi='F') then
            cstatuscomi = 'C2';
        else
            cstatuscomi = 'C1';

        -- Buscando a filial da tabela de comisses
        select icodfilial from sgretfilial( :icodemp, 'VDCOMISSAO') into :scodfilialcs;

        -- Buscando o cdigo da comisso j existente
        select codcomi from vdcomissao
        where codemp=:icodemp and codfilialrc=:scodfilial and codrec=:icodrec and nparcitrec=:inparcitrec and
        tipocomi=:ctipocomi and codempvd=:codempvd and codfilialvd=:codfilialvd and codvend=:codvend
        into :icodcomi;

        -- Caso j no exista a comisso deve inserir
        if (icodcomi is null) then
        begin
            --Buscando um novo cdigo
            select max(codcomi) from vdcomissao where codemp=:icodemp and codfilial = :scodfilialcs into icodcomi;

            if (:icodcomi is null) then
                icodcomi = 1;
            else
                icodcomi = icodcomi + 1;

            -- Inserindo na tabela de comisses
            insert into vdcomissao( codemp, codfilial, codcomi, codemprc, codfilialrc, codrec, nparcitrec,
            vlrvendacomi, vlrcomi, datacomi, dtcompcomi, dtvenccomi, statuscomi, tipocomi, codempvd, codfilialvd, codvend)
            values (
                :icodemp, :scodfilialcs, :icodcomi, :icodemp, :scodfilial, :icodrec, :inparcitrec,
                :nvlrvendacomi, :nvlrcomi, :ddatacomi, :ddtcompcomi, :ddtvenccomi, :cstatuscomi, :ctipocomi, :codempvd, :codfilialvd, :codvend
            );

        end
        -- Se encontrou a comisso atualiza
        else
        begin

            update vdcomissao set vlrvendacomi=:nvlrvendacomi, vlrcomi=:nvlrcomi, datacomi=:ddatacomi,
            dtvenccomi=:ddtvenccomi, statuscomi=:cstatuscomi
            where codemp=:icodemp and codfilial=:scodfilialcs and codcomi=:icodcomi and codempvd=:codempvd and
            codfilialvd=:codfilialvd and codvend=:codvend and statuscomi!='CP' ;

        end

    end
    suspend;
end
^

/* Alter (VDADICITEMPDVSP) */
ALTER PROCEDURE VDADICITEMPDVSP(CODVENDA INTEGER,
CODEMP INTEGER,
CODFILIAL SMALLINT,
CODPROD INTEGER,
CODEMPPD INTEGER,
CODFILIALPD INTEGER,
QTDITVENDA NUMERIC(9,5),
VLRPRECOITVENDA NUMERIC(18,5),
VLRDESCITVENDA NUMERIC(18,5),
PERCDESCITVENDA NUMERIC(15,5),
VLRCOMISITVENDA NUMERIC(15,5),
PERCCOMISITVENDA NUMERIC(15,5),
SCODLOTE VARCHAR(20),
CODEMPLE INTEGER,
CODFILIALLE SMALLINT,
CODFILIALCV SMALLINT,
CODCONV INTEGER)
 RETURNS(CODITVENDA INTEGER,
PERCICMSITVENDA NUMERIC(9,2),
VLRBASEICMSITVENDA NUMERIC(18,3),
VLRICMSITVENDA NUMERIC(18,3),
VLRLIQITVENDA NUMERIC(18,3),
TIPOFISC CHAR(2))
 AS
declare variable icodfilialnt smallint;
declare variable icodcli integer;
declare variable icodfilialcl integer;
declare variable icodtipomov integer;
declare variable icodfilialtm integer;
declare variable scodnat char(4);
declare variable sorigfisc char(1);
declare variable scodtrattrib char(2);
declare variable icodfilialtt smallint;
declare variable icodfilialme smallint;
declare variable icodmens smallint;
declare variable percipiitvenda numeric(9,2);
declare variable vlrbaseipiitvenda numeric(15,5);
declare variable vlripiitvenda numeric(15,5);
declare variable vlrproditvenda numeric(15,5);
declare variable srefprod varchar(20);
declare variable obsitorc varchar(500);
declare variable ufcli char(2);
declare variable ufflag char(1);
declare variable percred numeric(9,2);
begin
  select max(coditvenda)+1 from vditvenda where codvenda=:codvenda
    and codfilial=:codfilial and codemp=:codemp into coditvenda;
  if (coditvenda is null) then
    coditvenda = 1;
/*Informaes da Venda.:*/

  select v.codcli,v.codfilialcl,c.ufcli,v.codtipomov,v.codfilialtm from vdvenda v, vdcliente c
    where v.codemp=:codemp and v.codfilial=:codfilial
    and v.codvenda=:codvenda and v.tipovenda='E' and
    c.codcli=v.codcli and c.codemp=v.codempcl and
    c.codfilial=v.codfilialcl into icodcli,icodfilialcl,ufcli,icodtipomov,icodfilialtm;
  UFFLAG = 'N';
  SELECT 'S' FROM SGFILIAL  WHERE CODEMP=:CODEMP
    AND CODFILIAL=:CODFILIAL AND UFFILIAL=:UFCLI INTO UFFLAG;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'LFNATOPER') INTO ICODFILIALNT;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'LFTRATTRIB') INTO ICODFILIALTT;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'LFMENSAGEM') INTO ICODFILIALME;
  select c.aliqipifisc
      from eqproduto p, lfitclfiscal c
      inner join sgfilial fi
      on fi.codemp=c.codemp and fi.codfilial=c.codfilial
      where p.codprod=:codprod and p.codfilial=:codfilialpd
      and p.codemp=:codemppd and c.codfisc=p.codfisc and c.codfilial=p.codfilialfc and
      c.geralfisc='S' and c.simplesfilial=fi.simplesfilial
      and c.codemp=p.codempfc 
      and c.ativoitfisc='S'
      into percipiitvenda;

  SELECT CODNAT FROM
      LFBUSCANATSP(:CODFILIAL,:CODEMP,:CODFILIALPD,
                   :CODPROD,:CODEMP,:ICODFILIALCL,
                   :ICODCLI,NULL,NULL,NULL,:ICODFILIALTM,:ICODTIPOMOV,null)
      INTO SCODNAT;

  IF (SCODNAT IS NULL) THEN
      EXCEPTION VDITVENDAEX03;

  select tipofisc,redfisc,codtrattrib,origfisc,codmens,aliqfisc from
      lfbuscafiscalsp(:codemp, :codfilial, :codfilialpd,:codprod,
                      :codemp,:icodfilialcl,:icodcli,
                      :codemp,:icodtipomov,:icodfilialtm, 'VD',:scodnat,null,null,null,null)
      into tipofisc,percred,scodtrattrib,sorigfisc,icodmens,percicmsitvenda;

  VLRPRODITVENDA = (QTDITVENDA*VLRPRECOITVENDA);
  VLRBASEIPIITVENDA = 0;
  VLRBASEICMSITVENDA = 0;
  VLRICMSITVENDA = 0;
  VLRIPIITVENDA = 0;
  IF (PERCIPIITVENDA IS NULL) THEN
     PERCIPIITVENDA = 0;

  IF ( TIPOFISC = 'II') THEN
  BEGIN
    PERCICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    PERCIPIITVENDA = 0;
    VLRIPIITVENDA = 0;
    VLRBASEIPIITVENDA = 0;
  END
  ELSE IF ( TIPOFISC = 'FF') THEN
  BEGIN
    PERCICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    PERCIPIITVENDA = 0;
    VLRIPIITVENDA = 0;
    VLRBASEIPIITVENDA = 0;
  END
  ELSE IF ( TIPOFISC = 'NN') THEN
  BEGIN
    PERCICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    PERCIPIITVENDA = 0;
    VLRIPIITVENDA = 0;
    VLRBASEIPIITVENDA = 0;
  END
  ELSE IF ( TIPOFISC = 'TT') THEN
  BEGIN
    IF (PERCICMSITVENDA = 0 OR PERCICMSITVENDA IS NULL) THEN
      SELECT PERCICMS FROM LFBUSCAICMSSP (:SCODNAT,:UFCLI,:CODEMP,:CODFILIAL) INTO PERCICMSITVENDA;
    IF (PERCRED IS NULL) THEN
      PERCRED = 0;
    VLRBASEICMSITVENDA = (VLRPRODITVENDA-VLRDESCITVENDA) - ((VLRPRODITVENDA-VLRDESCITVENDA)*(PERCRED/100));
    VLRBASEIPIITVENDA = VLRPRODITVENDA-VLRDESCITVENDA;
    VLRICMSITVENDA = VLRBASEICMSITVENDA*(PERCICMSITVENDA/100);
    VLRIPIITVENDA = VLRBASEIPIITVENDA*(PERCIPIITVENDA/100);
  END
  VLRLIQITVENDA= VLRPRODITVENDA+VLRIPIITVENDA-VLRDESCITVENDA;
  INSERT INTO VDITVENDA (
     CODEMP,CODFILIAL,TIPOVENDA,CODVENDA,CODITVENDA,
     CODEMPNT,CODFILIALNT,CODNAT,
     CODEMPPD,CODFILIALPD,CODPROD,
     CODEMPLE,CODFILIALLE,CODLOTE,
     QTDITVENDA,PRECOITVENDA,PERCDESCITVENDA,VLRDESCITVENDA,
     VLRCOMISITVENDA,PERCCOMISITVENDA,
     PERCICMSITVENDA,VLRBASEICMSITVENDA,VLRICMSITVENDA,
     PERCIPIITVENDA,VLRBASEIPIITVENDA,VLRIPIITVENDA,VLRLIQITVENDA,
     VLRPRODITVENDA,REFPROD,ORIGFISC,
     CODEMPTT,CODFILIALTT,CODTRATTRIB,TIPOFISC,
     CODEMPME,CODFILIALME,CODMENS,OBSITVENDA,
     CODEMPCV,CODFILIALCV,CODCONV) VALUES (
     :CODEMP,:CODFILIAL,'E',:CODVENDA,:CODITVENDA,
     :CODEMP,:ICODFILIALNT,:SCODNAT,
     :CODEMPPD,:CODFILIALPD,:CODPROD,
     :CODEMPLE,:CODFILIALLE,:SCODLOTE,
     :QTDITVENDA,:VLRPRECOITVENDA,:PERCDESCITVENDA,:VLRDESCITVENDA,
     :VLRCOMISITVENDA,:PERCCOMISITVENDA,
     :PERCICMSITVENDA,:VLRBASEICMSITVENDA,:VLRICMSITVENDA,
     :PERCIPIITVENDA,:VLRBASEIPIITVENDA,:VLRIPIITVENDA,:VLRLIQITVENDA,
     :VLRPRODITVENDA,:SREFPROD,:SORIGFISC,
     :CODEMP,:ICODFILIALTT,:SCODTRATTRIB,:TIPOFISC,
     :CODEMP,:ICODFILIALME,:ICODMENS,:OBSITORC,
     :CODEMP, :CODFILIALCV,:CODCONV);
  SUSPEND;
END
^

/* Alter (VDADICITORCRECMERCSP) */
ALTER PROCEDURE VDADICITORCRECMERCSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
TICKET INTEGER,
CODEMPOC INTEGER,
CODFILIALOC SMALLINT,
CODORC INTEGER,
COMPONENTES CHAR,
SERVICOS CHAR,
NOVOS CHAR)
 AS
declare variable codemppd integer;
declare variable codfilialpd integer;
declare variable codprod integer;
declare variable coditos integer;
declare variable coditorc integer;
declare variable codprodant integer;
declare variable coditrecmerc integer;
declare variable refprod varchar(20);
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable precoitorc numeric(15,5);
declare variable qtditorc numeric(15,5);
declare variable codempcl integer;
declare variable codfilialcl smallint;
declare variable codcli integer;
declare variable codemppg integer;
declare variable codfilialpg smallint;
declare variable codplanopag integer;
declare variable gerachamado char(1);
declare variable obsitorc varchar(10000);
declare variable descprod char(100);
declare variable vlrliqitorc numeric(15,5);
declare variable vlrproditorc numeric(15,5);
declare variable usaprecopecaserv char(1);
declare variable codprodpeca integer;
declare variable garantia char(1);
declare variable codprodir integer;
declare variable refprodir varchar(20);
declare variable perccomisitorc numeric(9,2);
declare variable vlrcomisitorc numeric(15,5);
declare variable perccomvend numeric(9,2);
begin
    
    -- Buscando preferencias do GMS
    select coalesce(p8.usaprecopecaserv,'N') from sgprefere8 p8
    where p8.codemp=:codemp and p8.codfilial=:codfilial
    into :usaprecopecaserv;

    -- Buscando informaes do oramento
    select o.codempcl, o.codfilialcl, o.codcli, o.codemppg, o.codfilialpg, o.codplanopag, o.codemptm, o.codfilialtm, o.codtipomov, v.perccomvend
    from vdorcamento o
    left outer join vdvendedor v
    on v.codemp=o.codempvd and v.codfilial=o.codfilialvd and v.codvend=o.codvend
    where o.codemp=:codempoc and o.codfilial=:codfilialoc and o.codorc=:codorc and o.tipoorc='O'
    into :codempcl, :codfilialcl, :codcli, :codemppg, :codfilialpg, :codplanopag, :codemptm, :codfilialtm, :codtipomov, :perccomvend;

    -- Sendo um oramento para peas e mo-de-obra
    -- Deve gerar oramento dos tens de suplemento
    for select ir.codemppd, ir.codfilialpd, ir.codprodpd, ir.refprodpd, ir.coditrecmerc, ir.coditos, ir.qtditos,
        ir.gerachamado, pd.descprod, irm.codprod, irm.garantia, irm.codprod codprodir, irm.refprod refprodir, pd.comisprod
        from eqitrecmercitos ir, eqitrecmerc irm, eqproduto pd
        where
        irm.codemp=ir.codemp and irm.codfilial=ir.codfilial and irm.ticket=ir.ticket and irm.coditrecmerc=ir.coditrecmerc
        and pd.codemp=irm.codemppd and pd.codfilial=irm.codfilialpd and irm.codprod=pd.codprod
        and ir.codemp=:codemp and ir.codfilial=:codfilial and ir.ticket=:ticket and
        -- Filtrando componentes e servios
        (
           (ir.gerarma=:componentes and ir.gerarma='S') or
           (ir.gerachamado=:servicos and ir.gerachamado='S') or
           (ir.geranovo=:novos and ir.geranovo='S')
        )

        into :codemppd, :codfilialpd, :codprod, :refprod, :coditrecmerc, :coditos, :qtditorc,
             :gerachamado, :descprod, :codprodpeca, :garantia, :codprodir, :refprodir, :perccomisitorc
        do
        begin

--            if(:codprod <> :codprodant or :codprodant is null) then
--            begin

                -- Verifica se  servio, sendo servio insere a descriao do produto
                -- consertado na descrio auxiliar do item de oramento
                if(:gerachamado=:servicos and :gerachamado='S') then
                begin
                    if( 'N' = :garantia ) then
                    begin
                        obsitorc = :refprodir || ' - ' || :descprod;
                    end
                    else
                    begin
                        obsitorc = :refprodir || ' - ' || :descprod || '[G]';
                    end

                end

                --Buscando cdigo do item de oramento
                select coalesce(max(coditorc)+1,1) from vditorcamento io
                where io.codemp=:codempoc and io.codfilial=:codfilialoc and io.codorc=:codorc and io.tipoorc='O'
                into :coditorc;

                -- Buscando preo de venda
                -- Se no est em garantia...

                if('N' = :garantia) then
                begin
                    -- Se o preo  basedo na peca, deve buscar o preo da pea
                    if(usaprecopecaserv='S') then
                    begin
                        select preco from vdbuscaprecosp(:codprodpeca,:codcli,:codempcl,:codfilialcl,
                        :codplanopag,:codemppg,:codfilialpg,:codtipomov,:codemptm,:codfilialtm,:codemp,:codfilial)
                        into :precoitorc;
                    end
                    else
                    begin
                        select preco from vdbuscaprecosp(:codprod,:codcli,:codempcl,:codfilialcl,
                        :codplanopag,:codemppg,:codfilialpg,:codtipomov,:codemptm,:codfilialtm,:codemp,:codfilial)
                        into :precoitorc;
                    end
                end
                else
                begin
                    precoitorc = 0.00;
                end

                -- Buscando informaes do produto
                select pd.codempax, pd.codfilialax, pd.codalmox, pd.refprod from eqproduto pd
                where pd.codemp=:codemppd and pd.codfilial=:codfilialpd and pd.codprod=:codprod
                into :codempax, :codfilialax, :codalmox, :refprod;

                vlrproditorc = :qtditorc * :precoitorc;
                vlrliqitorc = vlrproditorc;
                
                vlrcomisitorc = cast(cast(vlrliqitorc * perccomvend / 100 as decimal(15,5)) * perccomisitorc / 100 as decimal(15,5));

                -- Inserir itens
                insert into vditorcamento (
                codemp, codfilial, codorc, tipoorc, coditorc,
                codemppd, codfilialpd, codprod, refprod,
                qtditorc, precoitorc, codempax, codfilialax, codalmox, obsitorc, vlrproditorc
                , vlrliqitorc, sitproditorc, perccomisitorc, vlrcomisitorc)
                values (:codempoc, :codfilialoc, :codorc, 'O', :coditorc,
                :codemppd, :codfilialpd, :codprod, :refprod,
                :qtditorc, :precoitorc, :codempax, :codfilialax, :codalmox, :obsitorc, :vlrproditorc
                , :vlrliqitorc, 'PE', :perccomisitorc, :vlrcomisitorc) ;

                -- Inserindo vnculo entre item de oramento e ordem de servio

                insert into eqitrecmercitositorc(codemp, codfilial, ticket, coditrecmerc, coditos, codempoc, codfilialoc, codorc, coditorc, tipoorc)
                values(:codemp,:codfilial,:ticket,:coditrecmerc,:coditos, :codempoc,:codfilialoc,:codorc,:coditorc,'O');

                codprodant = codprod;

--            end
        end

        -- Atualizando o status da ordem de servio
        update eqrecmerc rm set rm.status = 'EO'
        where rm.codemp=:codemp and rm.codfilial=:codfilial and rm.ticket=:ticket;

end
^

/* Alter (VDADICITVENDAORCSP) */
ALTER PROCEDURE VDADICITVENDAORCSP(FILIALATUAL INTEGER,
ICODVENDA INTEGER,
ICODORC INTEGER,
ICODITORC INTEGER,
ICODFILIAL SMALLINT,
ICODEMP INTEGER,
STIPOVENDA CHAR(10),
TPAGRUP CHAR,
IQTDITVENDA NUMERIC(15,5),
VLRDESCITVENDA NUMERIC(15,5))
 AS
declare variable icoditvenda integer;
declare variable icodfilialnt smallint;
declare variable codempax integer;
declare variable codfilialax integer;
declare variable codalmox integer;
declare variable icodcli integer;
declare variable icodfilialtm integer;
declare variable icodtipomov integer;
declare variable icodfilialcl integer;
declare variable scodnat char(4);
declare variable icodfilialle smallint;
declare variable scodlote varchar(20);
declare variable tipofisc char(2);
declare variable sorigfisc char(1);
declare variable scodtrattrib char(2);
declare variable icodfilialtt smallint;
declare variable icodfilialme smallint;
declare variable icodmens smallint;
declare variable percicmsitvenda numeric(15,5);
declare variable vlrbaseicmsitvenda numeric(15,5);
declare variable vlricmsitvenda numeric(15,5);
declare variable percipiitvenda numeric(15,5);
declare variable vlrbaseipiitvenda numeric(15,5);
declare variable vlripiitvenda numeric(15,5);
declare variable icodprod integer;
declare variable icodfilialpd integer;
declare variable vlrprecoitvenda numeric(15,5);
declare variable percdescitvenda numeric(15,5);
declare variable vlrliqitvenda numeric(15,5);
declare variable vlrproditvenda numeric(15,5);
declare variable obsitorc varchar(500);
declare variable ufcli char(2);
declare variable ufflag char(1);
declare variable percred numeric(15,5);
declare variable cloteprod char(1);
declare variable perccomisitvenda numeric(15,5);
declare variable geracomis char(1);
declare variable vlrcomisitvenda numeric(15,5);
declare variable codempif integer;
declare variable codfilialif smallint;
declare variable codfisc char(13);
declare variable coditfisc integer;
declare variable percissitvenda numeric(15,5);
declare variable vlrbaseissitvenda numeric(15,5);
declare variable vlrissitvenda numeric(15,5);
declare variable vlrisentasitvenda numeric(15,5);
declare variable vlroutrasitvenda numeric(15,5);
declare variable tipost char(2);
declare variable vlrbaseicmsstitvenda numeric(15,5);
declare variable vlricmsstitvenda numeric(15,5);
declare variable margemvlagritvenda numeric(15,5);
declare variable srefprod varchar(20);
declare variable stipoprod varchar(2);
declare variable percicmsst numeric(15,5);
declare variable vlrbaseicmsbrutitvenda numeric(15,5);
declare variable tpredicms char(1);
declare variable redbaseicmsst char(1);
declare variable qtditorc numeric(15,5);
declare variable calcstcm char(1);
declare variable aliqicmsstcm numeric(9,2);
declare variable vlricmsstcalc numeric(15,5);
declare variable aliqlfisc numeric(9,2);
declare variable vlricmsdiferido numeric(15,5);
declare variable vlricmsdevido numeric(15,5);
begin
-- Inicializao de variaveis
    CALCSTCM = 'N';
    UFFLAG = 'N';

    select icodfilial from sgretfilial(:ICODEMP,'LFNATOPER') into ICODFILIALNT;
    select icodfilial from sgretfilial(:ICODEMP,'LFTRATTRIB') into ICODFILIALTT;
    select icodfilial from sgretfilial(:ICODEMP,'LFMENSAGEM') into ICODFILIALME;

    select vd.codfilialtm,vd.codtipomov from vdvenda vd where codvenda=:ICODVENDA and codfilial=:ICODFILIAL and codemp=:ICODEMP and tipovenda=:STIPOVENDA
    into ICODFILIALTM,ICODTIPOMOV;

-- Verifica se deve gerar comisso para a venda

    select geracomisvendaorc from sgprefere1 where codemp=:ICODEMP and codfilial=:ICODFILIAL into GERACOMIS;

-- Busca sequencia de numerao do tem de venda

    select coalesce(max(coditvenda),0)+1 from vditvenda where codvenda=:ICODVENDA and codfilial=:ICODFILIAL and codemp=:ICODEMP and tipovenda=:STIPOVENDA
    into ICODITVENDA;

-- Informaes do Orcamento

    select codcli,codfilialcl from vdorcamento where codemp=:ICODEMP and codfilial=:ICODFILIAL and codorc=:ICODORC into ICODCLI,ICODFILIALCL;

-- Informaes do item de oramento

    select it.codemppd, it.codfilialpd,it.codprod,it.precoitorc,it.percdescitorc,it.vlrliqitorc,it.vlrproditorc,it.refprod,it.obsitorc,
    it.codempax,it.codfilialax,it.codalmox,it.codlote,pd.cloteprod,pd.comisprod,pd.tipoprod, it.perccomisitorc, it.vlrcomisitorc, it.qtditorc
    from vditorcamento it, eqproduto pd
    where it.coditorc=:ICODITORC and it.codorc=:ICODORC and it.codfilial=:ICODFILIAL and it.codemp=:ICODEMP and
    pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and pd.codprod=it.codprod
    into ICODEMP,ICODFILIALPD,ICODPROD,VLRPRECOITVENDA,PERCDESCITVENDA,VLRLIQITVENDA,VLRPRODITVENDA,SREFPROD,OBSITORC,
    CODEMPAX,CODFILIALAX,CODALMOX,SCODLOTE,CLOTEPROD,perccomisitvenda,STIPOPROD,perccomisitvenda,vlrcomisitvenda, :qtditorc;

    -- Informaes fiscais para a venda

    select coalesce(c.siglauf,c.ufcli)
    from vdorcamento o, vdcliente c
    where o.codorc=:ICODORC and o.codfilial=:ICODFILIAL and o.codemp=:ICODEMP and
    c.codcli=o.codcli and c.codfilial=o.codfilialcl and c.codemp=o.codempcl
    into ufcli;

    -- Busca informaes fiscais para o tem de venda (sem natureza da operao deve retornar apenas o coditfisc)

    select codempif,codfilialif,codfisc,coditfisc
    from lfbuscafiscalsp(:icodemp,:filialatual, :icodfilialpd,:icodprod,:icodemp,:icodfilialcl,:icodcli,:icodemp,:icodfilialtm,
    :icodtipomov, 'VD',null,null,null,null,null)
    into codempif,codfilialif,codfisc,coditfisc;


-- Verifica se a venda  para outro estado

    select codnat from lfbuscanatsp(:FILIALATUAL,:ICODEMP,:ICODFILIALPD,:ICODPROD,:ICODEMP,:ICODFILIALCL,
    :ICODCLI,NULL,NULL,NULL,:ICODFILIALTM,:ICODTIPOMOV,:coditfisc)
    into SCODNAT;
    
    if (SCODNAT IS NULL) then
    begin
        exception vditvendaex03 :SREFPROD; -- NO FOI POSSVEL ENCONTRAR A NATUREZA DA OPERAO PARA O TEM
    end

-- Busca informaes fiscais para o tem de venda (j sabe o coditfisc)

    select tipofisc,redfisc,codtrattrib,origfisc,codmens,aliqfisc,coalesce(aliqlfisc,0),codempif,codfilialif,codfisc,coditfisc,tipost,
    margemvlagr,aliqipifisc,aliqfiscintra,tpredicmsfisc,redbasest,aliqiss,coalesce(calcstcm,'N'),aliqicmsstcm
    from lfbuscafiscalsp(:icodemp,:filialatual,:icodfilialpd,:icodprod,:icodemp,:icodfilialcl,:icodcli,:icodemp,:icodfilialtm,
    :ICODTIPOMOV, 'VD',:scodnat,:codempif,:codfilialif,:codfisc,:coditfisc)
    into :tipofisc, :percred, :scodtrattrib, :sorigfisc, :icodmens, :percicmsitvenda, :aliqlfisc
    , :codempif, :codfilialif, :codfisc, :coditfisc, :tipost, :margemvlagritvenda
    , :percipiitvenda, :percicmsst, :tpredicms, :redbaseicmsst, :percissitvenda, :calcstcm, :aliqicmsstcm;
   
-- Busca lote, caso seja necessrio

    if (CLOTEPROD = 'S' and SCODLOTE is null) then
    begin
        select first 1 l.codlote from eqlote l
        where l.codprod=:icodprod and l.codfilial=:icodfilialpd and l.codemp=:icodemp 
        and l.venctolote>cast('now' as date) and l.sldliqlote>=:iqtditvenda
        order by l.venctolote
        into :scodlote;

        ICODFILIALLE = ICODFILIALPD;
    end
    
-- Inicializando valores

    VLRPRODITVENDA = VLRPRECOITVENDA * :IQTDITVENDA;
     if (:iqtditvenda<>:qtditorc) then
    begin
       VLRDESCITVENDA = (:VLRDESCITVENDA/:QTDITORC*:IQTDITVENDA);
    end
    VLRLIQITVENDA = VLRPRODITVENDA - :VLRDESCITVENDA;
    VLRBASEIPIITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRIPIITVENDA = 0;

    if (PERCICMSITVENDA = 0 or PERCICMSITVENDA is null) then
    begin
        select coalesce(PERCICMS,0) from lfbuscaicmssp (:SCODNAT,:UFCLI,:ICODEMP,:ICODFILIAL) into PERCICMSST;
    end

    if (PERCRED is null) then
    begin
        PERCRED = 0;
    end

    if(percred>0) then
    begin
        if(:tpredicms='B') then
        begin
            VLRBASEICMSITVENDA = (:VLRPRODITVENDA - :VLRDESCITVENDA) - ( (VLRPRODITVENDA - :VLRDESCITVENDA) * ( PERCRED / 100 ) );
            VLRICMSITVENDA = VLRBASEICMSITVENDA * ( PERCICMSITVENDA / 100 );
        end
        else if(:tpredicms='V') then
        begin
            VLRBASEICMSITVENDA = (:VLRPRODITVENDA - :VLRDESCITVENDA);
            VLRICMSITVENDA = (VLRBASEICMSITVENDA * ( PERCICMSITVENDA / 100 )) -  ( (VLRBASEICMSITVENDA * ( PERCICMSITVENDA / 100 ) * ( PERCRED / 100 ) )) ;
        end
    end
    else
    begin
        VLRBASEICMSITVENDA = :VLRPRODITVENDA - :VLRDESCITVENDA;
        VLRICMSITVENDA = VLRBASEICMSITVENDA * ( PERCICMSITVENDA / 100 );
    end
    VLRBASEIPIITVENDA = cast(:VLRPRODITVENDA - :VLRDESCITVENDA as decimal(15,2));
    VLRBASEICMSBRUTITVENDA = cast(:VLRPRODITVENDA - :VLRDESCITVENDA as decimal(15,2));
    VLRIPIITVENDA =  cast(VLRBASEIPIITVENDA * ( PERCIPIITVENDA / 100 ) as decimal(15,2));
-- **** Calculo dos tributos ***
-- Verifica se  um servio (Calculo do ISS);
    if (:STIPOPROD = 'S') then
    begin
    -- Carregando aliquota do ISS
    -- Bloco comentado, pois j buscou o percentual do iss atravs da procedure.
   --     select percissfilial from sgfilial where codemp=:ICODEMP and codfilial=:ICODFILIAL
   --     into PERCISSITVENDA;

    -- Calculando e computando base e valor do ISS;
        if (:PERCISSITVENDA != 0) then
        begin
            VLRBASEISSITVENDA = :VLRLIQITVENDA;
            VLRISSITVENDA = :VLRBASEISSITVENDA * (:PERCISSITVENDA/100);
        end
    end
    else -- Se o item vendido no for SERVIO zera ISS
        VLRBASEISSITVENDA = 0;
    -- Se produto for isento de ICMS
    if (:TIPOFISC = 'II') then
    begin
        VLRISENTASITVENDA = :VLRLIQITVENDA;
        VLRBASEICMSITVENDA = 0;
        PERCICMSITVENDA = 0;
        VLRICMSITVENDA = 0;
        VLROUTRASITVENDA = 0;
    end
    -- Se produto for de Substituio Tributria
    else if (:TIPOFISC = 'FF') then
    begin
        if (:TIPOST = 'SI' ) then -- Contribuinte Substitudo
        begin
            VLROUTRASITVENDA = :VLRLIQITVENDA;
            VLRBASEICMSITVENDA = 0;
            PERCICMSITVENDA = 0;
            VLRICMSITVENDA = 0;
            VLRISENTASITVENDA = 0;
        end
        else if (:TIPOST = 'SU' ) then -- Contribuinte Substituto
        begin
            if( (:PERCICMSST is null) or (:PERCICMSST=0) ) then
            begin
                select coalesce(PERCICMSINTRA,0) from lfbuscaicmssp (:SCODNAT,:UFCLI,:ICODEMP,:ICODFILIAL)
                into PERCICMSST;
            end
            --Calculo do ICMS ST para fora de mato grosso.
            if(calcstcm = 'N') then
            begin
                if(percred>0 and redbaseicmsst='S') then
                begin
                -- Quando h reduo na base do icms st , deve usar o valor da base do icms proprio como parametro
                   vlrbaseicmsstitvenda = cast((  (coalesce(margemvlagritvenda,0) + 100) / 100 )  * (  (coalesce(vlrbaseicmsitvenda,0) ) + (coalesce(vlripiitvenda,0)) ) as decimal(15,2));
                end
                else
                begin
                    -- Quando no h reduo na base do icms st deve usar o valor da base bruto (rem reduo)
                    vlrbaseicmsstitvenda = cast((  (coalesce(margemvlagritvenda,0) + 100) / 100 )  * (  (coalesce(vlrbaseicmsbrutitvenda,0) ) + (coalesce(vlripiitvenda,0)) ) as decimal(15,2));
                end
                VLROUTRASITVENDA = 0;
                VLRISENTASITVENDA = 0;
                VLRICMSSTITVENDA = cast(( (:VLRBASEICMSSTITVENDA * :PERCICMSST) / 100 ) - (:VLRICMSITVENDA) as decimal(15,2));
            end
            --Calculo do ICMS ST para o mato grosso.
            else
            begin
                if(percred>0 and redbaseicmsst='S') then
                begin
                   vlricmsstcalc=0;
                -- Quando h reduo na base do icms st , deve usar o valor da base do icms proprio como parametro
                   vlricmsstcalc = cast(( (coalesce(vlrbaseicmsitvenda,0) + coalesce(vlripiitvenda,0) ) * (coalesce(aliqicmsstcm,0)/100) ) as decimal(15,2));
                   vlrbaseicmsstitvenda =   cast((vlricmsitvenda + vlricmsstcalc)/(PERCICMSST/100) as decimal(15,2));
                end
                else
                begin
                    -- Quando no h reduo na base do icms st deve usar o valor da base bruto (rem reduo)
                    vlricmsstcalc = cast(( (coalesce(vlrbaseicmsbrutitvenda,0) + coalesce(vlripiitvenda,0) ) * (coalesce(aliqicmsstcm,0)/100)  ) as decimal(15,2));
                    vlrbaseicmsstitvenda = cast(((vlricmsitvenda  + vlricmsstcalc )/(:PERCICMSST/100)) as decimal(15,2));
                end
                VLROUTRASITVENDA = 0;
                VLRISENTASITVENDA = 0;
                VLRICMSSTITVENDA = cast(( (coalesce(vlrbaseicmsitvenda,0) + coalesce(vlripiitvenda,0) ) * (coalesce(aliqicmsstcm,0)/100)  ) as decimal(15,2));
            end 
        end
    end
    -- Se produto no for tributado e no isento
    else if (:TIPOFISC = 'NN') then
    begin
        VLROUTRASITVENDA = :VLRLIQITVENDA;
        VLRBASEICMSITVENDA = 0;
        PERCICMSITVENDA = 0;
        VLRICMSITVENDA = 0;
        VLRISENTASITVENDA = 0;
    end
    -- Se produto for tributado integralmente
    else if (:TIPOFISC = 'TT') then
    begin
        VLROUTRASITVENDA = 0;
        VLRISENTASITVENDA = 0;
    end
    if (aliqlfisc is null or aliqlfisc=0) then 
    begin
       aliqlfisc = percicmsitvenda;
    end 
    vlricmsdevido = vlrbaseicmsitvenda * aliqlfisc / 100;
    vlricmsdiferido = vlricmsdevido-vlricmsitvenda;
    -- Inserindo dados na tabela de tens de venda
    if ( TPAGRUP <> 'F' ) then
    begin
        insert into vditvenda (codemp,codfilial,codvenda,tipovenda,coditvenda,codempnt,codfilialnt,codnat,codemppd,
        codfilialpd,codprod,codemple,codfilialle,codlote,qtditvenda,precoitvenda,percdescitvenda,vlrdescitvenda,
        percicmsitvenda,vlrbaseicmsitvenda,vlricmsitvenda,percipiitvenda,vlrbaseipiitvenda,vlripiitvenda,vlrliqitvenda,
        vlrproditvenda,refprod,origfisc,codemptt,codfilialtt,codtrattrib,tipofisc,codempme,codfilialme,codmens,obsitvenda,
        codempax,codfilialax,codalmox,perccomisitvenda,vlrcomisitvenda,codempif,codfilialif,codfisc,coditfisc,percissitvenda,
        vlrbaseissitvenda,vlrissitvenda,vlrisentasitvenda,vlroutrasitvenda,tipost,vlrbaseicmsstitvenda,vlricmsstitvenda,
        margemvlagritvenda,vlrbaseicmsbrutitvenda, calcstcm, vlricmsdevido, vlricmsdiferido)
        values (:icodemp,:icodfilial,:icodvenda,:stipovenda,:icoditvenda,:icodemp,
        :icodfilialnt,:scodnat,:icodemp,:icodfilialpd,:icodprod,:icodemp,:icodfilialpd,:scodlote,:iqtditvenda,
        :vlrprecoitvenda,:percdescitvenda,:vlrdescitvenda,:percicmsitvenda,:vlrbaseicmsitvenda,:vlricmsitvenda,
        :percipiitvenda,:vlrbaseipiitvenda,:vlripiitvenda,:vlrliqitvenda,:vlrproditvenda,:srefprod,:sorigfisc,
        :icodemp,:icodfilialtt,:scodtrattrib,:tipofisc,:icodemp,:icodfilialme,:icodmens,:obsitorc,
        :codempax,:codfilialax,:codalmox,:perccomisitvenda,:vlrcomisitvenda,:codempif,:codfilialif,:codfisc,:coditfisc,
        :percissitvenda,:vlrbaseissitvenda,:vlrissitvenda,:vlrisentasitvenda,:vlroutrasitvenda,:tipost,
        :vlrbaseicmsstitvenda,:vlricmsstitvenda,:margemvlagritvenda,:vlrbaseicmsbrutitvenda, :calcstcm, :vlricmsdevido, :vlricmsdiferido);
    end
-- Atualizando informaes de vnculo
    execute procedure vdupvendaorcsp(:ICODEMP,:ICODFILIAL,:ICODORC,:ICODITORC,:ICODFILIAL,:ICODVENDA,:ICODITVENDA,:STIPOVENDA);

end
^

/* Alter (VDADICVENDAORCSP) */
ALTER PROCEDURE VDADICVENDAORCSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODORC INTEGER,
CODFILIALVD INTEGER,
TIPOVENDA CHAR,
CODVENDA INTEGER,
DTSAIDAVENDA DATE)
 RETURNS(IRET INTEGER)
 AS
declare variable icodtipomov integer;
declare variable ifilialtm smallint;
declare variable sserie varchar(5);
declare variable ifilialse smallint;
declare variable sstatusvenda char(2);
declare variable dperccomvend numeric(9,2);
declare variable icodvend integer;
declare variable icodcli integer;
declare variable icodfilialcl integer;
declare variable icodplanopag integer;
declare variable icodfilialpg integer;
declare variable iconta integer;
declare variable icodclcomis integer;
declare variable icodfilialcm integer;
declare variable vlrfreteorc numeric(15,5);
declare variable codemptn integer;
declare variable codfilialtn smallint;
declare variable codtran integer;
declare variable tipofrete char(1);
declare variable adicfrete char(1);
declare variable codfilialpf smallint;
BEGIN

/*Cod. Tipo Mov e Sequencia:*/
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'SGPREFERE1') INTO CODFILIALPF;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'EQTIPOMOV') INTO IFILIALTM;
  SELECT COUNT(P.TIPOPROD) FROM EQPRODUTO P, VDITORCAMENTO I WHERE
    P.CODPROD=I.CODPROD AND P.CODFILIAL=I.CODFILIALPD AND P.CODEMP=I.CODEMPPD
    AND P.TIPOPROD = 'S' AND I.CODORC=:CODORC
    AND I.CODFILIAL=:CODFILIAL AND I.CODEMP=:CODEMP INTO ICONTA;
    
  IF (ICONTA > 0) THEN
    SELECT CODTIPOMOV4 FROM SGPREFERE1
      WHERE CODEMP=:CODEMP AND CODFILIAL=:CODFILIALPF
      INTO ICODTIPOMOV;
  IF (ICODTIPOMOV IS NULL) THEN  /* CASO AINDA O IF DE CIMA NAO TENHA PREECHIDO... */
    SELECT CODTIPOMOV3 FROM SGPREFERE1
      WHERE CODEMP=:CODEMP AND CODFILIAL=:CODFILIALPF
      INTO ICODTIPOMOV;

/*Informaes basicas:*/

/*Serie:*/
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'LFSERIE') INTO IFILIALSE;
  SELECT SERIE FROM EQTIPOMOV WHERE CODEMP=:CODEMP AND CODFILIAL=:IFILIALTM AND CODTIPOMOV=:ICODTIPOMOV INTO SSERIE;

/*Status:*/
  SSTATUSVENDA = 'P1';

/*Busca no oramento:*/
  SELECT O.CODFILIALVD,O.CODVEND,O.CODFILIALCL,O.CODCLI,O.CODFILIALPG,
    O.CODPLANOPAG,VE.PERCCOMVEND,O.CODCLCOMIS,O.CODFILIALCM
    , coalesce(O.VLRFRETEORC,0), O.CODEMPTN, O.CODFILIALTN, O.CODTRAN
    , o.tipofrete, o.adicfrete
    FROM VDORCAMENTO O, VDVENDEDOR VE WHERE O.CODORC=:CODORC
    AND O.CODFILIAL=:CODFILIAL AND O.CODEMP=:CODEMP
    AND VE.CODEMP=O.CODEMP AND VE.CODFILIAL=O.CODFILIALVD
    AND VE.CODVEND=O.CODVEND INTO
           :CODFILIALVD,:ICODVEND,:ICODFILIALCL,:ICODCLI
           ,:ICODFILIALPG,:ICODPLANOPAG,DPERCCOMVEND,:ICODCLCOMIS
           ,:ICODFILIALCM, :VLRFRETEORC
           ,:CODEMPTN, :CODFILIALTN, :CODTRAN
           , :TIPOFRETE, :adicfrete;

  INSERT INTO VDVENDA (
    CODEMP,CODFILIAL,CODVENDA,TIPOVENDA,CODEMPVD,CODFILIALVD,CODVEND,CODEMPCL,CODFILIALCL,CODCLI,
    CODEMPPG,CODFILIALPG,CODPLANOPAG,CODEMPSE,CODFILIALSE,SERIE,CODEMPTM,CODFILIALTM,CODTIPOMOV,
    DTSAIDAVENDA,DTEMITVENDA,STATUSVENDA,PERCCOMISVENDA,CODCLCOMIS,CODFILIALCM,CODEMPCM)
    VALUES (
    :CODEMP,:CODFILIALVD,:CODVENDA,:TIPOVENDA,:CODEMP,:CODFILIALVD,:ICODVEND,:CODEMP,:ICODFILIALCL,:ICODCLI,
    :CODEMP,:ICODFILIALPG,:ICODPLANOPAG,:CODEMP,:IFILIALSE,:SSERIE,:CODEMP,:IFILIALTM,:ICODTIPOMOV,
    :DTSAIDAVENDA,CAST('today' AS DATE),:SSTATUSVENDA,:DPERCCOMVEND,:ICODCLCOMIS,:ICODFILIALCM,:CODEMP
    );

  if ( (:codtran is not null) or (:vlrfreteorc>0) )  then
  begin
     insert into vdfretevd (codemp, codfilial, tipovenda, codvenda, codemptn
        , codfilialtn, codtran, tipofretevd, vlrfretevd, adicfretevd
        , placafretevd, vlrsegfretevd, pesobrutvd, pesoliqvd
        , espfretevd, marcafretevd, qtdfretevd, uffretevd
         )
        values (:codemp, :codfilialvd, :tipovenda, :codvenda, :codemptn
        , :codfilialtn, :codtran, :tipofrete,  :vlrfreteorc, :adicfrete
        , '***-***', 0, 0, 0
        , 'Volume', '*', 0, '**' );

  end

  IRET = CODVENDA;

  SUSPEND;
END
^

/* Alter (VDATUDESCVENDAORCSP) */
ALTER PROCEDURE VDATUDESCVENDAORCSP(CODEMPVD INTEGER,
CODFILIALVD SMALLINT,
TIPOVENDA CHAR,
CODVENDA INTEGER)
 AS
declare variable vlrdescorc numeric(15,5);
declare variable vlrtotdesc numeric(15,5) = 0;
declare variable codorc integer;
declare variable conta1 numeric(15,5);
declare variable statusorc char(2);
declare variable conta2 numeric(15,5);
declare variable codempoc integer;
declare variable codfilialoc smallint;
declare variable tipoorc char(1);
begin
    -- verifica a quantidade total do oramneto vinculado a venda
    select first 1 oc.codemp, oc.codfilial, oc.tipoorc, oc.codorc, oc.statusorc, sum(iv.qtditvenda)
      from vdorcamento oc, vdvendaorc vo, vditorcamento itoc, vditvenda iv
        where vo.codemp=:codempvd and vo.codfilial=:codfilialvd and
          vo.tipovenda=:tipovenda and vo.codvenda=:codvenda and
          oc.codemp=vo.codempor and oc.codfilial=vo.codfilialor and
          oc.tipoorc=vo.tipoorc and oc.codorc=vo.codorc and
          itoc.codemp=oc.codemp and itoc.codfilial=oc.codfilial and
          itoc.tipoorc=oc.tipoorc and itoc.codorc=oc.codorc and
          itoc.coditorc=vo.coditorc and
          iv.codemp=vo.codemp and iv.codfilial=vo.codfilial and
          iv.tipovenda=vo.tipovenda and iv.codvenda=vo.codvenda and
          iv.coditvenda=vo.coditvenda
        group by oc.codemp, oc.codfilial, oc.tipoorc, oc.codorc, oc.statusorc
        into :codempoc, :codfilialoc, :tipoorc, :codorc, :statusorc, :conta1;

    if (:statusorc not in ('FP') ) then
    begin
        -- verifica a quantidade total do oramento
        select sum(qtditorc) from vditorcamento it
          where codemp=:codempoc and codfilial=:codfilialoc and
          tipoorc=:tipoorc and codorc=:codorc
          into :conta2;
        if (conta1=conta2) then
        begin
            -- Buscando desconto nos oramentos dessa venda
            for select vo.codorc, oc.vlrdescorc from vdvendaorc vo, vdorcamento oc
            where
              vo.codemp=:CODEMPVD and vo.codfilial=:CODFILIALVD and vo.tipovenda=:TIPOVENDA and vo.codvenda=:CODVENDA and
              oc.codemp=vo.codempor and oc.codfilial=vo.codfilial and oc.tipoorc=vo.tipoorc and oc.codorc=vo.codorc
            group by 1,2
            into :codorc,:vlrdescorc
            do
            begin
                VLRTOTDESC = :VLRTOTDESC + :VLRDESCORC;
            end
            -- Atualizando desconto na venda
            if(:VLRTOTDESC is not null and :VLRTOTDESC>0) then
            begin
               --update vdvenda set vlrdescvenda = :VLRTOTDESC
               --where codemp=:CODEMPVD and codfilial=:CODFILIALVD and tipovenda=:TIPOVENDA and codvenda=:CODVENDA;
            end
        end
    end
end
^

/* Alter (VDBAIXACOMISSAOSP) */
ALTER PROCEDURE VDBAIXACOMISSAOSP(STIPO CHAR,
DINI DATE,
DFIM DATE,
ICODVEND INTEGER,
ICODEMPVD INTEGER,
ICODFILIALVD SMALLINT,
SCODCONTA CHAR(10),
ICODEMPCA INTEGER,
ICODFILIALCA SMALLINT,
SCODPLAN CHAR(13),
ANOPLAN SMALLINT,
ICODEMPPN INTEGER,
ICODFILIALPN SMALLINT,
DDATA DATE,
IDOC INTEGER,
DVLR NUMERIC(15,5),
SOBS CHAR(50),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 AS
declare variable icodpcomi integer;
declare variable icodcomi integer;
declare variable icodempcomi integer;
declare variable icodfilialcomi integer;
declare variable cflag char(1);
declare variable ifilialpcomi integer;
begin
  select icodfilial from sgretfilial(:icodemp,'FNPAGTOCOMI') into ifilialpcomi;
  select iseq from spgeranum(:icodemp,:ifilialpcomi,'CI') into icodpcomi;
  insert into fnpagtocomi(codemp,codfilial,codpcomi,codempca,codfilialca,numconta,codemppn,codfilialpn,codplan,anoplan,dtcomppcomi,datapcomi,docpcomi,vlrpcomi,obspcomi)
         values (
                :icodemp,:ifilialpcomi,:icodpcomi,:icodempca,:icodfilialca,:scodconta,:icodemppn,:icodfilialpn,:scodplan,:anoplan,:ddata,:ddata,:idoc,:dvlr,:sobs
         );
  for select c.codcomi,c.codemp,c.codfilial,c.flag from vdcomissao c,fnreceber r where r.codvend=:icodvend
               and r.codempvd=:icodempvd and r.codfilialvd=:icodfilialvd
               and c.codrec=r.codrec and c.codemprc=r.codemp and c.codfilialrc=r.codfilial
               and ( (:stipo='E') or  (c.dtvenccomi between :dini and :dfim) )
               and ( (:stipo='V') or  (c.datacomi between :dini and :dfim) )
               and statuscomi='C2'
               and r.codemp=:icodemp and r.codfilial=:icodfilial
               into :icodcomi,:icodempcomi,:icodfilialcomi,:cflag do
  begin
     update vdcomissao set vlrpagocomi=vlrapagcomi, codpcomi=:icodpcomi,codempci=:icodemp,
        codfilialci=:ifilialpcomi,statuscomi='CP',dtpagtocomi=:ddata,flag=:cflag
      where codcomi=:icodcomi and codemp=:icodempcomi and codfilial=:icodfilialcomi;
  end
end
^

/* Alter (VDBUSCACUSTOVENDASP) */
ALTER PROCEDURE VDBUSCACUSTOVENDASP(CODEMPVD INTEGER,
CODFILIALVD SMALLINT,
CODVENDA INTEGER,
TIPOVENDA CHAR,
CODEMPOC INTEGER,
CODFILIALOC INTEGER,
CODORC INTEGER,
TIPOORC CHAR,
CODITORC INTEGER)
 RETURNS(VLRPROD NUMERIC(15,5),
VLRDESC NUMERIC(15,5),
VLRICMS NUMERIC(15,5),
VLROUTRAS NUMERIC(15,5),
VLRCOMIS NUMERIC(15,5),
VLRADIC NUMERIC(15,5),
VLRIPI NUMERIC(15,5),
VLRPIS NUMERIC(15,5),
VLRCOFINS NUMERIC(15,5),
VLRIR NUMERIC(15,5),
VLRCSOCIAL NUMERIC(15,5),
VLRFRETE NUMERIC(15,5),
TIPOFRETE CHAR,
ADICFRETE CHAR,
VLRCUSTOPEPS NUMERIC(15,5),
VLRCUSTOMPM NUMERIC(15,5),
VLRPRECOULTCP NUMERIC(15,5))
 AS
declare variable aliqicms numeric(9,2);
declare variable aliqipi numeric(9,2);
declare variable aliqpis numeric(9,2);
declare variable aliqir numeric(9,2);
declare variable aliqcofins numeric(9,2);
declare variable aliqcsocial numeric(9,2);
declare variable codemppd integer;
declare variable codfilialpd smallint;
declare variable codprod integer;
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codfilialpf smallint;
declare variable codempcl integer;
declare variable codfilialcl smallint;
declare variable codcli integer;
declare variable vlrliq numeric(15,5);
declare variable redbase numeric(9,2);
declare variable base numeric(15,5);
declare variable ufcli char(2);
declare variable codtrattrib char(2);
declare variable comisprod numeric(6,2);
declare variable perccomvend numeric(6,2);
declare variable codnat char(4);
declare variable codregra char(4);
begin

    --Verifica se deve buscar custos para venda .
    if(:CODVENDA is not null) then
    begin

        select
            coalesce(vd.vlrprodvenda,0), coalesce(vd.vlrdescvenda,0), coalesce(vd.vlricmsvenda,0),
            coalesce(vd.vlroutrasvenda,0), coalesce(vd.vlrcomisvenda,0), coalesce(vd.vlradicvenda,0),
            coalesce(vd.vlripivenda,0), coalesce(vd.vlrpisvenda,0), coalesce(vd.vlrcofinsvenda,0),
            coalesce(vd.vlrirvenda,0), coalesce(vd.vlrcsocialvenda,0),
            coalesce(fr.vlrfretevd,0), fr.tipofretevd, fr.adicfretevd,
            
            sum(icv.vlrcustopeps * iv.qtditvenda),
            sum(icv.vlrcustompm * iv.qtditvenda),
            sum(icv.vlrprecoultcp * iv.qtditvenda)
            
            from
            vdvenda vd left outer join vdfretevd fr on
            fr.codemp=vd.codemp and fr.codfilial=vd.codfilial and fr.codvenda=vd.codvenda and fr.tipovenda=vd.tipovenda,
            
            vditvenda iv left outer join vditcustovenda icv on
            icv.codemp=iv.codemp and icv.codfilial=iv.codfilial and icv.codvenda = iv.codvenda
            and icv.tipovenda=iv.tipovenda and icv.coditvenda=iv.coditvenda
            
            where vd.codemp=:CODEMPVD and vd.codfilial=:CODFILIALVD and vd.codvenda=:CODVENDA and vd.tipovenda=:TIPOVENDA and
            iv.codemp=vd.codemp and iv.codfilial=vd.codfilial and iv.tipovenda=vd.tipovenda and iv.codvenda=vd.codvenda
            
            group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14

            into vlrprod,vlrdesc,vlricms,vlroutras,vlrcomis,vlradic,vlripi,vlrpis,vlrcofins,vlrir,vlrcsocial,
                 vlrfrete,tipofrete,adicfrete,vlrcustopeps,vlrcustompm,vlrprecoultcp;

            suspend;

    end
    else
    begin
        --Buscando informaes sobre o produto do item de oramento
        select io.codemppd,io.codfilialpd,io.codprod,pd.comisprod,
        coalesce(io.vlrproditorc,0),coalesce(io.vlrdescitorc,0),coalesce(io.vlrliqitorc,0),
        ico.vlrcustopeps * io.qtditorc, ico.vlrcustompm * io.qtditorc, ico.vlrprecoultcp * io.qtditorc,
        cf.codregra
        from lfclfiscal cf, eqproduto pd, vditorcamento io left outer join vditcustoorc ico on
        ico.codemp=io.codemp and ico.codfilial=io.codfilial and ico.codorc = io.codorc and
        ico.tipoorc=io.tipoorc and ico.coditorc=io.coditorc
        where io.codemp=:CODEMPOC and io.codfilial=:CODFILIALOC and io.codorc=:CODORC and io.tipoorc=:TIPOORC and io.coditorc=:CODITORC and
        pd.codemp=io.codemppd and pd.codfilial=io.codfilial and pd.codprod=io.codprod and
        cf.codemp=pd.codempfc and cf.codfilial=pd.codfilialfc and cf.codfisc=pd.codfisc
        into :CODEMPPD,:CODFILIALPD,:CODPROD,:VLRPROD,:VLRDESC,:VLRLIQ,:COMISPROD,:VLRCUSTOPEPS,:VLRCUSTOMPM,:VLRPRECOULTCP,:CODREGRA;

        -- Buscanco informaes do oramento,cliente,vendedor
        select oc.codempcl,oc.codfilialcl,oc.codcli,coalesce(cl.siglauf,cl.ufcli),vd.perccomvend,
        oc.tipofrete,oc.adicfrete
        from vdorcamento oc, vdcliente cl, vdvendedor vd
        where oc.codemp=:CODEMPOC and oc.codfilial=:CODFILIALOC and oc.tipoorc=:TIPOORC and oc.codorc=:CODORC and
        cl.codemp=oc.codempcl and cl.codfilial=oc.codfilialcl and cl.codcli=oc.codcli and
        vd.codemp=oc.codempvd and vd.codfilial=oc.codfilialvd and vd.codvend=oc.codvend
        into :CODEMPCL,:CODFILIALCL,:CODCLI,:UFCLI,:PERCCOMVEND,:TIPOFRETE,:ADICFRETE;

        --Buscando o tipo de movimento a ser utilizado na venda futura
        select p1.codempt2,p1.codfilialt2,p1.codtipomov2 from sgprefere1 p1
        where p1.codemp=:CODEMPOC and p1.codfilial=:CODFILIALPF
        into :CODEMPTM,:CODFILIALTM,:CODTIPOMOV;

        -- Buscando natureza de operao da venda futura
        select first 1 nt.codnat from lfnatoper nt, lfitregrafiscal irf
        where nt.codemp=irf.codemp and nt.codfilial=irf.codfilial and nt.codnat=irf.codnat
        and (irf.codtipomov=:CODTIPOMOV or irf.codtipomov is null)
        and (irf.codemp=:CODEMPTM or irf.codemp is null)
        and (irf.codfilial=:CODFILIALTM or irf.codfilial is null)
        and irf.codregra=:CODREGRA and irf.noufitrf='N' and irf.cvitrf='V'
        into :CODNAT;

         -- Buscando informaes fiscais
        select codtrattrib,coalesce(aliqfisc,0),coalesce(aliqipifisc,0),coalesce(aliqpis,0),coalesce(aliqcofins,0),coalesce(aliqcsocial,0),
        coalesce(aliqir,0),coalesce(redfisc,0)
        from lfbuscafiscalsp(:codemppd,:codfilialvd,:codfilialpd,:codprod,:codempcl,:codfilialcl,:codcli,:codemptm,:codfilialtm,
        :codtipomov,'VD',:codnat,null,null,null,null)
        into :CODTRATTRIB,:ALIQICMS,:ALIQIPI,:ALIQPIS,:ALIQCOFINS,:ALIQCSOCIAL,:ALIQIR,:REDBASE;

        -- Caso o ICMS no seja definido na classifificao, buscar da tabela de aliquotas.
        if(:ALIQICMS = 0 and :CODTRATTRIB in('00','51','20','70','10') ) then
        begin
            select coalesce(PERCICMS,0) from lfbuscaicmssp (:CODNAT,:UFCLI,:CODEMPOC,:CODFILIALPF)
            into :ALIQICMS;
        end

        -- Buscando custo do tem

        if(:REDBASE >0) then
        begin
            BASE = :VLRLIQ - ((:VLRLIQ * :REDBASE) /100 );
        end

        BASE = :VLRLIQ;

        vlricms = :BASE * :ALIQICMS / 100;

--      vlroutras =
        vlrcomis = :VLRLIQ * ((:COMISPROD * :PERCCOMVEND) / 10000 );

--      vlradic =
        vlripi = cast( :VLRLIQ * :ALIQIPI / 100 as decimal(15,2));
        vlrpis = cast(:VLRLIQ * :ALIQCOFINS / 100 as decimal(15,2));
        vlrcofins = cast(:VLRLIQ * :ALIQCOFINS / 100 as decimal(15,2));
        vlrir = cast(:VLRLIQ * :ALIQIR /100 as decimal(15,2));
        vlrcsocial = cast(:VLRLIQ * :ALIQCSOCIAL / 100 as decimal(15,2));
--      vlrfrete =

    end

end
^

/* Alter (VDCLIENTEATIVOSP) */
ALTER PROCEDURE VDCLIENTEATIVOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODCLI INTEGER)
 AS
DECLARE VARIABLE CATIVOCLI CHAR(1);
DECLARE VARIABLE SITREVCLI CHAR(1);
begin
  SELECT ATIVOCLI, COALESCE(SITREVCLI,'N') FROM VDCLIENTE WHERE CODEMP=:ICODEMP AND
    CODFILIAL=:SCODFILIAL AND CODCLI=:ICODCLI
    INTO :CATIVOCLI, SITREVCLI;
  IF ( (CATIVOCLI IS NOT NULL) AND (CATIVOCLI='N') ) then
     exception vdvendaex01 'CLIENTE INATIVO!';
  IF ( SITREVCLI='O' ) then
     exception vdvendaex01 ' OBRIGATRIA A REVISO CADASTRAL DO CLIENTE !!!';
  suspend;
end
^

/* Alter (VDCONTRATOTOTSP) */
ALTER PROCEDURE VDCONTRATOTOTSP(CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
CODCONTR INTEGER,
CODITCONTR INTEGER,
CODEMPSC INTEGER,
CODFILIALSC SMALLINT,
CODCONTRSC INTEGER,
CODEMPTA INTEGER,
CODFILIALTA SMALLINT,
CODTAREFA INTEGER,
CODEMPST INTEGER,
CODFILIALST SMALLINT,
CODTAREFAST INTEGER,
DATAINI DATE,
DATAFIM DATE)
 RETURNS(TOTALPREVGERAL NUMERIC(15,5),
TOTALPREVPER NUMERIC(15,5),
TOTALGERAL NUMERIC(15,5),
TOTALCOBCLIGERAL NUMERIC(15,5),
TOTALANT NUMERIC(15,5),
TOTALCOBCLIANT NUMERIC(15,5),
TOTALPER NUMERIC(15,5),
TOTALCOBCLIPER NUMERIC(15,5),
SALDOANT NUMERIC(15,5),
SALDOPER NUMERIC(15,5))
 AS
begin
  if (:codcontrsc is not null) then
  begin
     codempct = codempsc;
     codfilialct = codfilialsc;
     codcontr = codcontrsc;
  end
  if (:codtarefast is not null) then
  begin
     codempta = codempst;
     codfilialta = codfilialst;
     codtarefa = codtarefast;
  end
  select sum(a.totalgeral), sum(a.totalcobcli)
   from atatendimentovw02 a
    left outer join crtarefa ta
      on ta.codemp=a.codempta and ta.codfilial=a.codfilialta and ta.codtarefa=a.codtarefa
    left outer join crtarefa st
      on st.codempta=ta.codemp and st.codfilialta=ta.codemp and st.codtarefata=ta.codtarefa
    where a.codempct=:codempct and a.codfilialct=:codfilialct and a.codcontr=:codcontr and
    (:coditcontr is null or a.coditcontr=:coditcontr) and
    (
       (:codtarefa is null) or
       (st.codtarefa is null and ta.codemp=:codempta and ta.codfilial=:codfilialta and ta.codtarefa=:codtarefa ) or
       (st.codtarefa is not null and st.codempta=:codempta and st.codfilialta=:codfilialta and st.codtarefata=:codtarefa )
    )
  into :totalgeral,  :totalcobcligeral;

  select sum(a.totalgeral), sum(a.totalcobcli)
   from atatendimentovw02 a
    left outer join crtarefa ta
      on ta.codemp=a.codempta and ta.codfilial=a.codfilialta and ta.codtarefa=a.codtarefa
    left outer join crtarefa st
      on st.codempta=ta.codemp and st.codfilialta=ta.codemp and st.codtarefata=ta.codtarefa
    where a.codempct=:codempct and a.codfilialct=:codfilialct and a.codcontr=:codcontr and
    (:coditcontr is null or a.coditcontr=:coditcontr) and
      a.dataatendo between :dataini and :datafim and
    (
       (:codtarefa is null) or
       (st.codtarefa is null and ta.codemp=:codempta and ta.codfilial=:codfilialta and ta.codtarefa=:codtarefa ) or
       (st.codtarefa is not null and st.codempta=:codempta and st.codfilialta=:codfilialta and st.codtarefata=:codtarefa )
    )
  into :totalper,  :totalcobcliper;

  select sum(a.totalgeral), sum(a.totalcobcli)
   from atatendimentovw02 a
    left outer join crtarefa ta
     on ta.codemp=a.codempta and ta.codfilial=a.codfilialta and ta.codtarefa=a.codtarefa
    left outer join crtarefa st
      on st.codempta=ta.codemp and st.codfilialta=ta.codemp and st.codtarefata=ta.codtarefa
    where a.codempct=:codempct and a.codfilialct=:codfilialct and a.codcontr=:codcontr and
    (:coditcontr is null or a.coditcontr=:coditcontr) and
     a.dataatendo < :dataini and
    (
       (:codtarefa is null) or
       (st.codtarefa is null and ta.codemp=:codempta and ta.codfilial=:codfilialta and ta.codtarefa=:codtarefa ) or
       (st.codtarefa is not null and st.codempta=:codempta and st.codfilialta=:codfilialta and st.codtarefata=:codtarefa )
    )
  into :totalant,  :totalcobcliant;

  select sum(coalesce(st.tempodectarefa, ta.tempodectarefa) )
    from crtarefa ta
    left outer join crtarefa st
      on st.codempta=ta.codemp and st.codfilialta=ta.codemp and st.codtarefata=ta.codtarefa
    where ta.codempct=:codempct and ta.codfilialct=:codfilialct and ta.codcontr=:codcontr and
    (:coditcontr is null or ta.coditcontr=:coditcontr) and
    (
       (:codtarefa is null) or
       (st.codtarefa is null and ta.codemp=:codempta and ta.codfilial=:codfilialta and ta.codtarefa=:codtarefa ) or
       (st.codtarefa is not null and st.codempta=:codempta and st.codfilialta=:codfilialta and st.codtarefata=:codtarefa )
    )
  into totalprevgeral;

  select sum(tp.tempodectarefa)
   from crtarefa ttp, crtarefaper tp
    left outer join crtarefa ta
      on ta.codemp=ttp.codempta and ta.codfilial=ttp.codfilialta and ta.codtarefa=ttp.codtarefa
    left outer join crtarefa st
      on st.codempta=ta.codemp and st.codfilialta=ta.codemp and st.codtarefata=ta.codtarefa
    where ttp.codemp=tp.codemp and ttp.codfilial=tp.codfilial and ttp.codtarefa=tp.codtarefa and
      ttp.codempct=:codempct and ttp.codfilialct=:codfilialct and ttp.codcontr=:codcontr and
    (:coditcontr is null or ttp.coditcontr=:coditcontr) and
      tp.dtiniper>=:dataini and tp.dtfimper<=:datafim and
    (
       (:codtarefa is null) or
       (st.codtarefa is null and ta.codemp=:codempta and ta.codfilial=:codfilialta and ta.codtarefa=:codtarefa ) or
       (st.codtarefa is not null and st.codempta=:codempta and st.codfilialta=:codfilialta and st.codtarefata=:codtarefa )
    )
  into :totalprevper;

  if (totalgeral is null) then
      totalgeral = 0;
  if (totalcobcligeral is null) then
      totalcobcligeral = 0;
  if (totalant is null) then
      totalant = 0;
  if (totalcobcliant is null) then
      totalcobcliant = 0;
  if (totalper is null) then
      totalper = 0;
  if (totalcobcliper is null) then
      totalcobcliper = 0;
  saldoant = totalprevgeral - totalcobcliant;
  saldoper = totalprevper - totalcobcliper;

  suspend;
end
^

/* Alter (VDCOPIACLIENTE) */
ALTER PROCEDURE VDCOPIACLIENTE(ICODCLI INTEGER,
IDOCUMENTO VARCHAR(14),
ICODEMP INTEGER,
ICODFILIAL INTEGER)
 RETURNS(ICOD INTEGER)
 AS
declare variable inovocod integer;
declare variable usacliseq char(1);
begin
    
  SELECT USACLISEQ FROM SGPREFERE1 WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO :USACLISEQ;
  IF (:USACLISEQ='S') THEN
      select iseq from spgeranum(:ICODEMP,:ICODFILIAL,'CL') into INOVOCOD;
  ELSE
      SELECT MAX(CODCLI)+1 FROM VDCLIENTE WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO INOVOCOD;

    INSERT INTO VDCLIENTE (CODEMP, CODFILIAL, CODCLI, RAZCLI, NOMECLI, CODEMPCC, CODFILIALCC,
        CODCLASCLI, CODEMPVD, CODFILIALVD, CODVEND, CODEMPTC, CODFILIALTC, CODTIPOCOB, CODEMPPG,
        CODFILIALPG, CODPLANOPAG, CODEMPTN, CODFILIALTN, CODTRAN, CODEMPBO, CODFILIALBO, CODBANCO,
        CODEMPSR, CODFILIALSR, CODSETOR, CODEMPTI, CODFILIALTI, CODTIPOCLI, CODTPCRED, CODFILIALTR,
        CODEMPTR, CODFISCCLI, CODEMPFC, CODFILIALFC, CODEMPEC, CODFILIALEC, CODTBEC, CODITTBEC, CODEMPHP,
        CODFILIALHP, CODHIST, CODEMPCB, CODFILIALCB, CODCARTCOB, DATACLI, PESSOACLI, ATIVOCLI, CNPJCLI,
        INSCCLI, CPFCLI, RGCLI, SSPCLI, ENDCLI, NUMCLI, COMPLCLI, BAIRCLI, CIDCLI, UFCLI, CEPCLI, DDDCLI,
        FONECLI, RAMALCLI, DDDFAXCLI, FAXCLI, EMAILCLI, EMAILCOB, EMAILENT, EMAILNFECLI, CONTCLI, ENDCOB,
        NUMCOB, COMPLCOB, BAIRCOB, CIDCOB, UFCOB, CEPCOB, DDDFONECOB, FONECOB, DDDFAXCOB, FAXCOB, ENDENT,
        NUMENT, COMPLENT, BAIRENT, CIDENT, UFENT, CEPENT, DDDFONEENT, FONEENT, DDDFAXENT, FAXENT, OBSCLI,
        AGENCIACLI, CODEMPPQ, CODFILIALPQ, CODPESQ, INCRACLI, DTINITR, DTVENCTOTR, NIRFCLI, SIMPLESCLI, DDDCELCLI,
        CELCLI, NATCLI, UFNATCLI, TEMPORESCLI, APELIDOCLI, SITECLI, CODCONTDEB, CODCONTCRED, CODCLICONTAB,
        FOTOCLI, IMGASSCLI, CODMUNIC, SIGLAUF, CODPAIS, CODMUNICENT, SIGLAUFENT, CODPAISENT, CODMUNICCOB,
        SIGLAUFCOB, CODPAISCOB, CODEMPUC, CODFILIALUC, CODUNIFCOD, SUFRAMACLI, PRODRURALCLI, CTOCLI, CODCNAE,
        INSCMUNCLI, PERCDESCCLI, CONTCLICOB, CONTCLIENT, DESCIPI, DDDCELENT, CELENT)
        SELECT :ICODEMP, :ICODFILIAL, :INOVOCOD, RAZCLI, NOMECLI, CODEMPCC, CODFILIALCC, CODCLASCLI, CODEMPVD,
            CODFILIALVD, CODVEND, CODEMPTC, CODFILIALTC, CODTIPOCOB, CODEMPPG, CODFILIALPG, CODPLANOPAG, CODEMPTN,
            CODFILIALTN, CODTRAN, CODEMPBO, CODFILIALBO, CODBANCO, CODEMPSR, CODFILIALSR, CODSETOR, CODEMPTI,
            CODFILIALTI, CODTIPOCLI, CODTPCRED, CODFILIALTR, CODEMPTR, CODFISCCLI, CODEMPFC, CODFILIALFC, CODEMPEC,
            CODFILIALEC, CODTBEC, CODITTBEC, CODEMPHP, CODFILIALHP, CODHIST, CODEMPCB, CODFILIALCB, CODCARTCOB, DATACLI,
            PESSOACLI, ATIVOCLI,

            CASE PESSOACLI
                WHEN 'J' THEN :IDOCUMENTO
            ELSE NULL
            END,

            INSCCLI,

            CASE PESSOACLI
                WHEN 'F' THEN :IDOCUMENTO
            ELSE NULL
            END,

            RGCLI, SSPCLI, ENDCLI, NUMCLI, COMPLCLI, BAIRCLI, CIDCLI,
            UFCLI, CEPCLI, DDDCLI, FONECLI, RAMALCLI, DDDFAXCLI, FAXCLI, EMAILCLI, EMAILCOB, EMAILENT, EMAILNFECLI,
            CONTCLI, ENDCOB, NUMCOB, COMPLCOB, BAIRCOB, CIDCOB, UFCOB, CEPCOB, DDDFONECOB, FONECOB, DDDFAXCOB, FAXCOB,
            ENDENT, NUMENT, COMPLENT, BAIRENT, CIDENT, UFENT, CEPENT, DDDFONEENT, FONEENT, DDDFAXENT, FAXENT, OBSCLI,
            AGENCIACLI, CODEMPPQ, CODFILIALPQ, CODPESQ, INCRACLI, DTINITR, DTVENCTOTR, NIRFCLI, SIMPLESCLI, DDDCELCLI,
            CELCLI, NATCLI, UFNATCLI, TEMPORESCLI, APELIDOCLI, SITECLI, CODCONTDEB, CODCONTCRED, CODCLICONTAB, FOTOCLI,
            IMGASSCLI, CODMUNIC, SIGLAUF, CODPAIS, CODMUNICENT, SIGLAUFENT, CODPAISENT, CODMUNICCOB, SIGLAUFCOB, CODPAISCOB,
            CODEMPUC, CODFILIALUC, CODUNIFCOD, SUFRAMACLI, PRODRURALCLI, CTOCLI, CODCNAE, INSCMUNCLI, PERCDESCCLI, CONTCLICOB,
            CONTCLIENT, DESCIPI, DDDCELENT, CELENT
            FROM VDCLIENTE  VC WHERE VC.CODEMP=:ICODEMP AND VC.CODFILIAL=:ICODFILIAL AND VC.CODCLI = :ICODCLI ;

     ICOD = INOVOCOD;

  suspend;
end
^

/* Alter (VDCOPIAORCSP) */
ALTER PROCEDURE VDCOPIAORCSP(CODEMP INTEGER,
CODFILIAL INTEGER,
CODORC INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER)
 RETURNS(IRET INTEGER)
 AS
declare variable icodorc integer;
declare variable icodfilialpf integer;
declare variable cusaorcseq char(1);
declare variable vlrprodorc decimal(15,5);
declare variable percdescorc decimal(9,2);
declare variable vlrdescorc decimal(15,5);
declare variable vlradicorc decimal(15,5);
declare variable vlrdescitorc decimal(15,5);
declare variable vlrliqorc decimal(15,5);
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP, 'SGPREFERE1')
    INTO :ICODFILIALPF;
  SELECT USAORCSEQ FROM SGPREFERE1 P
     WHERE P.CODEMP=:CODEMP AND P.CODFILIAL=:ICODFILIALPF
     INTO :CUSAORCSEQ;
  IF (CUSAORCSEQ='S') THEN
  BEGIN
     SELECT ISEQ FROM SPGERANUM(:CODEMP,:CODFILIAL,'OC') INTO ICODORC;
  END
  ELSE
  BEGIN
     SELECT COALESCE(MAX(O.CODORC),0)+1 FROM VDORCAMENTO O
       WHERE O.CODEMP=:CODEMP AND O.CODFILIAL=:CODFILIAL AND
       O.TIPOORC='O' INTO ICODORC;
  END

  INSERT INTO VDORCAMENTO (CODEMP, CODFILIAL, TIPOORC, CODORC,
    CODEMPAE, CODFILIALAE, CODATEND, CODEMPCV, CODFILIALCV, CODCONV,
    DTORC, DTVENCORC, OBSORC, CODPLANOPAG, CODFILIALPG,
    CODEMPPG, TXT01, CODEMPVD, CODFILIALVD, CODVEND, CODEMPCL, CODFILIALCL,
    CODCLI, CODTPCONV, CODFILIALTC, CODEMPTC, PRAZOENTORC, STATUSORC, VLRFRETEORC, ADICFRETE,
    CODEMPTM, CODFILIALTM, CODTRAN

    )
    SELECT CODEMP, CODFILIAL, 'O', :ICODORC, CODEMPAE, CODFILIALAE,
      CODATEND, CODEMPCV, CODFILIALCV, CODCONV, DTORC, DTVENCORC,
      OBSORC, CODPLANOPAG, CODFILIALPG, CODEMPPG, TXT01, CODEMPVD,
      CODFILIALVD, CODVEND, :CODEMP, :CODFILIALCL, :CODCLI, CODTPCONV,
      CODFILIALTC, CODEMPTC, PRAZOENTORC, '*', VLRFRETEORC, ADICFRETE,
      CODEMPTM, CODFILIALTM, CODTRAN

      FROM VDORCAMENTO WHERE
      CODORC=:CODORC AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL;

  INSERT INTO VDITORCAMENTO (CODEMP, CODFILIAL, TIPOORC, CODORC, CODITORC,
    CODEMPPD, CODFILIALPD, CODPROD, QTDITORC, PRECOITORC, PERCDESCITORC,
    VLRDESCITORC, VLRFRETEITORC, VLRPRODITORC, REFPROD, NUMAUTORIZORC, ACEITEITORC,
    APROVITORC, EMITITORC, VENCAUTORIZORC, STRDESCITORC, OBSITORC,
    CODEMPAX, CODFILIALAX, CODALMOX)
    SELECT CODEMP, CODFILIAL, TIPOORC, :ICODORC, CODITORC,
      CODEMPPD, CODFILIALPD, CODPROD, QTDITORC, PRECOITORC, PERCDESCITORC,
      VLRDESCITORC, VLRFRETEITORC, VLRPRODITORC, REFPROD, null, 'N',
      'N', 'N', VENCAUTORIZORC, STRDESCITORC, OBSITORC,
      CODEMPAX, CODFILIALAX, CODALMOX
      FROM VDITORCAMENTO
      WHERE CODORC=:CODORC AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL;

  SELECT VLRPRODORC, PERCDESCORC,VLRDESCORC,VLRADICORC,VLRDESCITORC,VLRLIQORC
      FROM VDORCAMENTO WHERE CODORC=:CODORC AND CODEMP=:CODEMP AND
      CODFILIAL=:CODFILIAL
      INTO :VLRPRODORC, :PERCDESCORC, :VLRDESCORC, :VLRADICORC, :VLRDESCITORC, :VLRLIQORC;

  UPDATE VDORCAMENTO SET VLRPRODORC=:VLRPRODORC, PERCDESCORC=:PERCDESCORC,
     VLRDESCORC=:VLRDESCORC, VLRADICORC=:VLRADICORC,
     VLRDESCITORC=:VLRDESCITORC, VLRLIQORC=:VLRLIQORC
     WHERE CODORC=:ICODORC AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL;

  IRET = ICODORC;
  SUSPEND;
END
^

/* Alter (VDESTORNACOMISSAOSP) */
ALTER PROCEDURE VDESTORNACOMISSAOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
ICODVEND INTEGER,
DINI DATE,
DFIM DATE,
CORDEM CHAR)
 AS
declare variable icodcomi integer;
declare variable icodemprc integer;
declare variable scodfilialrc smallint;
declare variable icodrec integer;
declare variable inparcitrec integer;
declare variable nvlrvendacomi numeric(15,5);
declare variable nvlrcomi numeric(15,5);
declare variable ddatacomi date;
declare variable ddtcompcomi date;
declare variable ddtvenccomi date;
declare variable ctipocomi char(1);
declare variable cstatuscomi char(2);
declare variable datual date;
declare variable cstatusitrec char(2);
declare variable ddtvencitrec date;
begin
  /* Procedure Text */
  DATUAL = CAST( 'now' AS DATE);
  FOR SELECT C.CODCOMI,C.CODEMPRC, C.CODFILIALRC , C.CODREC, C.NPARCITREC,
      C.VLRVENDACOMI, C.VLRCOMI, C.DATACOMI , C.DTCOMPCOMI, C.DTVENCCOMI,
      C.TIPOCOMI, C.STATUSCOMI , IR.STATUSITREC, IR.DTVENCITREC
    FROM VDCOMISSAO C, FNITRECEBER IR, FNRECEBER R
    WHERE C.CODEMP=:ICODEMP AND C.CODFILIAL=:SCODFILIAL AND
       IR.CODEMP=C.CODEMPRC AND IR.CODFILIAL=C.CODFILIALRC AND
       IR.CODREC=C.CODREC AND IR.NPARCITREC=C.NPARCITREC AND
       R.CODEMP=C.CODEMPRC AND R.CODFILIAL=C.CODFILIALRC AND
       R.CODREC=C.CODREC AND R.CODEMPVD=:ICODEMPVD AND
       R.CODFILIALVD=:SCODFILIALVD AND R.CODVEND=:ICODVEND AND
       ( (:CORDEM = 'V')  OR (C.DATACOMI BETWEEN :DINI AND :DFIM) ) AND
       ( (:CORDEM = 'E')  OR (C.DTVENCCOMI BETWEEN :DINI AND :DFIM) ) AND
       C.STATUSCOMI IN ('C2','CP') AND
       IR.STATUSITREC NOT IN ('RP') AND
       NOT EXISTS(SELECT * FROM VDCOMISSAO C2 /* Sub-select para verificar a */
          /* existencia de estorno anterior. */
         WHERE C2.CODEMPRC=C.CODEMPRC AND C2.CODFILIALRC=C.CODFILIALRC AND
         C2.CODREC=C.CODREC AND C2.NPARCITREC=C.NPARCITREC AND
         C2.TIPOCOMI=C.TIPOCOMI AND C2.STATUSCOMI IN ('CE') )
    INTO :ICODCOMI, :ICODEMPRC, :SCODFILIALRC, :ICODREC, :INPARCITREC, :NVLRVENDACOMI,
      :NVLRCOMI, :DDATACOMI, :DDTCOMPCOMI, :DDTVENCCOMI, :CTIPOCOMI, :CSTATUSCOMI, :CSTATUSITREC,
      :DDTVENCITREC
  DO
  BEGIN
     IF ( (DATUAL>DDTVENCITREC) AND (CSTATUSCOMI='C2') ) THEN
     /* Caso a data atual seja maior que a data de vencimento e a */
     /* comisso no esteja paga, passa o status da comisso para no */
     /* liberada. */
     BEGIN
        UPDATE VDCOMISSAO SET STATUSCOMI='C1'
          WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND
            CODCOMI=:ICODCOMI;
     END
     ELSE IF ( (DATUAL>DDTVENCITREC) AND (CSTATUSCOMI='CP') ) THEN
     /* Caso a comisso esteja paga e a parcela esteja vencida, */
     /* gera um estorno da comisso. */
     BEGIN
        NVLRCOMI = NVLRCOMI * -1; /* Transforma o valor da comisso em negativo */
        /* para gerar estorno */
        EXECUTE PROCEDURE vdadiccomissaosp(:ICODEMPRC,:SCODFILIALRC,:ICODREC,
          :INPARCITREC, :NVLRVENDACOMI, :NVLRCOMI, :DDATACOMI , :DDTCOMPCOMI, :DDTVENCITREC,
          :CTIPOCOMI, :icodempvd, :scodfilialvd, : icodvend );
     END
  END
  suspend;
end
^

/* Alter (VDEVOLUVENDAS) */
ALTER PROCEDURE VDEVOLUVENDAS(ICODEMP SMALLINT,
ICODFILIAL SMALLINT,
DATAINI DATE,
DATAFIM DATE,
ICODTIPOCLI SMALLINT,
ICODCLI SMALLINT,
FILTRAVENDAS CHAR,
FATURADO CHAR,
FINANCEIRO CHAR,
EMITIDO CHAR)
 RETURNS(VALOR NUMERIC(15,5),
MES SMALLINT,
ANO SMALLINT)
 AS
declare variable valortmp numeric(15,5);
declare variable datatmp date;
declare variable mestmp smallint;
declare variable anotmp smallint;
declare variable mesant smallint;
declare variable anoant smallint;
declare variable valorant numeric(15,5);
declare variable enviou char(1);
begin
  /* Retorna os valores de vendas por perodo */
  VALOR = 0;
  VALORANT = 0;
  ENVIOU = 'N';

  FOR select sum(v.vlrliqvenda),v.dtemitvenda from vdvenda v, vdcliente c, eqtipomov tm
             where c.codcli=v.codcli and c.codemp=v.codempcl and c.codfilial=v.codfilialcl
             and v.dtemitvenda between :DATAINI and :DATAFIM and v.codemp = :ICODEMP
             and v.codfilial = :ICODFILIAL
             and tm.codemp=v.codemptm and tm.codfilial=v.codfilialtm and tm.codtipomov=v.codtipomov
             and ( (c.codtipocli=:ICODTIPOCLI) or (:ICODTIPOCLI is null) )
             and ( (v.codcli=:ICODCLI) or (:ICODCLI is null) )
             and ( (tm.tipomov in(select tm2.tipomov from eqtipomov tm2 where tm2.codemp=v.codemptm and tm2.codfilial=v.codfilialtm and tm2.somavdtipomov='S')) or (:FILTRAVENDAS='N') )

             and (TM.FISCALTIPOMOV=:faturado or :faturado='A')
             and (TM.SOMAVDTIPOMOV=:financeiro or :financeiro='A')
             and (( (V.STATUSVENDA IN ('V2','V3','P3') and :emitido='S') or :emitido='A' )
             or ( (V.STATUSVENDA NOT IN ('V2','V3','P3') and :emitido='N') or :emitido='A' ))

             group by v.dtemitvenda order by v.dtemitvenda
      into VALORTMP,DATATMP do
      BEGIN
        MESTMP = extract(MONTH from DATATMP);
        ANOTMP = extract(YEAR from DATATMP);
        VALOR=VALOR+VALORANT;
        MES=MESANT;
        ANO=ANOANT;
        if ((not MESANT = MESTMP or not ANOANT = ANOTMP) AND not MESANT is null) then
        begin
          suspend;
          ENVIOU = 'S';
          VALOR = 0;
          MESANT=MESTMP;
          ANOANT=ANOTMP;
          VALORANT=VALORTMP;
        end
        ELSE
        BEGIN
          MESANT=MESTMP;
          ANOANT=ANOTMP;
          VALORANT=VALORTMP;
        END
      END

     VALOR=VALOR+VALORANT;
     MES=MESANT;
     ANO=ANOANT;
     suspend;
end
^

/* Alter (VDGERACOMISSAOSP) */
ALTER PROCEDURE VDGERACOMISSAOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRCOMIITREC NUMERIC(15,5),
DDTVENCITREC DATE)
 AS
declare variable icodempva integer;
declare variable scodfilialva smallint;
declare variable ctipovenda char(3);
declare variable icodvenda integer;
declare variable icodempcm integer;
declare variable scodfilialcm smallint;
declare variable icodclcomis integer;
declare variable nvlrvendacomi numeric(15,5);
declare variable ddatacomi date;
declare variable ddtcompcomi date;
declare variable npercfatclcomis numeric(9,2);
declare variable npercpgtoclcomis numeric(9,2);
declare variable ctipocomi char(1);
declare variable nvlrcomi numeric(15,5);
declare variable i integer;
declare variable icodemptm integer;
declare variable scodfilialtm smallint;
declare variable icodtipomov integer;
declare variable cmulticomis char(1);
declare variable icodempvd integer; /* Cdigo da empresa do comissionado principal */
declare variable scodfilialvd smallint; /* Cdigo da filial do comissionado principal */
declare variable icodvend integer; /* Cdigo do comissionado principal */
declare variable nperccomisvendadic numeric(15,2); /* Percentual de comisso para cada comissionado adicional */
declare variable nvlrcomiadic numeric(15,5); /* Valor total da comisso para os comissionados adicionais. */
declare variable icodempvdadic integer; /* Cdigo da empresa do comissionado adicional */
declare variable scodfilialvdadic smallint; /* Cdigo da filial do comissionado adicional */
declare variable icodvendadic integer; /* Cdigo do comissionado adicional */
declare variable nvlrcomiparc numeric(15,5); /* Valor da comisso por vendedor parcial. */
begin
    /* Gera as comisses a pagar na tabela VDCOMISSAO */


    nvlrcomiadic = 0;

    select r.codempva, r.codfilialva, r.tipovenda, r.codvenda,
        v.codempcm, v.codfilialcm, v.codclcomis, ( v.vlrprodvenda - v.vlrdescvenda ),
        v.dtemitvenda, v.dtcompvenda, cm.percfatclcomis, cm.percpgtoclcomis,
        v.codemptm, v.codfilialtm, v.codtipomov,
        v.codempvd, v.codfilialvd, v.codvend
        from fnreceber r, vdvenda v, vdclcomis cm
        where r.codemp=:icodemp and r.codfilial=:scodfilial and r.codrec=:icodrec
            and v.codemp=r.codempva and v.codfilial=r.codfilialva and v.tipovenda=r.tipovenda
            and v.codvenda=r.codvenda and cm.codemp=v.codempcm and cm.codfilial=v.codfilialcm
            and cm.codclcomis=v.codclcomis
    into :icodempva, :scodfilialva, :ctipovenda, :icodvenda,
         :icodempcm, :scodfilialcm, :icodclcomis, :nvlrvendacomi,
         :ddatacomi, :ddtcompcomi, :npercfatclcomis, :npercpgtoclcomis,
         :icodemptm, :scodfilialtm, :icodtipomov,
         :icodempvd, :scodfilialvd, :icodvend ;

    /*Verifica se deve utilizar mecanismo de multiplos comissionados*/

    select cmulticomis from sgretmulticomissp(:icodemp, :icodemptm, :scodfilialtm, :icodtipomov)
        into cmulticomis;

    if(cmulticomis = 'S') then
    begin

        /*Implementao do mecanismo de multiplos comissionados*/
        
        for select vc.codempvd, vc.codfilialvd, vc.codvend, vc.percvc
            from vdvendacomis vc
            where vc.codemp=:icodempva and vc.codfilial=:scodfilialva and vc.codvenda=:icodvenda
                and vc.tipovenda=:ctipovenda and vc.codvend is not null
        into :icodempvdadic, :scodfilialvdadic, :icodvendadic, :nperccomisvendadic do
        begin

            /* Calcula o valor da comisso proporcional para cada comissionado adicional*/

            nvlrcomi = cast( ( nvlrcomiitrec * nperccomisvendadic / 100 ) as numeric(15,5));
            I = 1;
            while (:I<=2) do
            begin
                if (I=1) then
                    begin
                        ctipocomi='F';
                        nvlrcomiparc = cast( ( nvlrcomi * npercfatclcomis / 100 ) as NUMERIC(15, 5));
                    end
                else
                    begin
                        ctipocomi='R';
                        nvlrcomiparc = cast( (nvlrcomi * npercpgtoclcomis / 100 ) as NUMERIC(15, 5));
                    end
                execute procedure vdadiccomissaosp(:iCodEmp, :sCodFilial, :iCodRec, :iNParcItRec,
                    :nVlrVendaComi, :nvlrcomiparc, :dDataComi, :dDtCompComi, :dDtVencItRec, cTipoComi,:icodempvdadic, :scodfilialvdadic, :icodvendadic );
                I=I+1;
                /*Acumula as comisses adicionais para posteriormente descontar do valor principal*/
                nvlrcomiadic = nvlrcomiadic + nvlrcomiparc;

           /*     exception vdcomissaoex02 'rodou procedure para o vendedor:' || cast(:icodempvdadic as char(2)) || '-' || cast(:scodfilialvdadic as char(2)) || '-' || cast(:icodvendadic as char(2)) || '-' || ' - nvlrcomiadic:' || cast(nvlrcomiadic as char(20));*/

            end

        end

    end

    /*Comissionamento do vendedor principal*/

    I = 1;
    while (:I<=2) do
        begin
            if (I=1) then
                begin
                    ctipocomi='F';
                    nvlrcomi = cast( ( (nvlrcomiitrec - nvlrcomiadic ) * nPercFatClComis / 100 ) as numeric(15, 5) );
                end
            else
                begin
                    ctipocomi='R';
                    nvlrcomi = cast( ( (nvlrcomiitrec - nvlrcomiadic ) * nPercPgtoClComis / 100 ) as numeric(15, 5));
                end
/*
                exception vdcomissaoex01 ''
                || cast(:icodempvd as char(2)) || '-' || cast(:scodfilialvd as char(2)) || '-' || cast(:icodvend as char(2))
                || 'nvlrcomi:' || cast(:nvlrcomi as char(20))
                || 'nvlrvendacomi:' || cast(:nvlrvendacomi as char(20));
  */
            execute procedure vdadiccomissaosp(:icodemp, :scodfilial, :icodrec, :inparcitrec,
                :nvlrvendacomi, :nvlrcomi, :ddatacomi, :ddtcompcomi, :ddtvencitrec, ctipocomi, :icodempvd, :scodfilialvd, :icodvend );


            I=I+1;
        end

        suspend;
end
^

/* Alter (VDRETULTVDCLIPROD) */
ALTER PROCEDURE VDRETULTVDCLIPROD(CODEMP INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER,
CODFILIALVD SMALLINT,
CODVEND INTEGER,
DTINI DATE,
DTFIM DATE,
CODFILIALTIPOCL SMALLINT,
CODTIPOCLI INTEGER,
AGRUPCLI CHAR)
 RETURNS(RAZCLI_RET CHAR(60),
NOMECLI_RET VARCHAR(50),
CODCLI_RET INTEGER,
DESCPROD_RET CHAR(100),
CODPROD_RET INTEGER,
DTEMITVENDA_RET DATE,
DOCVENDA_RET INTEGER,
SERIE_RET VARCHAR(5),
PRECOVENDA_RET NUMERIC(15,4),
OBSITVENDA_RET VARCHAR(500),
REFPROD_RET VARCHAR(20),
QTDPROD_RET NUMERIC(15,5),
QTDTOTAL_RET NUMERIC(15,5),
QTDMEDIA_RET NUMERIC(15,5),
NUMMESES NUMERIC(15,2))
 AS
declare variable codfilial smallint;
declare variable codpesq integer;
declare variable codprod integer;
begin
	nummeses = (:dtfim-:dtini)/30;
    select icodfilial from sgretfilial(:codemp,'VDVENDA') into :codfilial;
    codpesq=:codcli;
    if ( (:agrupcli='S') and (:codpesq is not null)) then
    begin
       select codpesq from vdcliente
       where codemp=:codemp and codfilial=:codfilialcl and codcli=:codcli
       into :codpesq;
    end
    for select v.codcli,iv.codprod
        from vdvenda v, vdcliente cl, vditvenda iv
        where
            iv.codemp=v.codemp and iv.codfilial=v.codfilial
            and iv.tipovenda=v.tipovenda and iv.codvenda=v.codvenda
            and v.codemp=:codemp and v.codfilial=:codfilial
--            and (v.codcli=:codcli or :codcli is null)
            and (v.codvend=:codvend or :codvend is null )
            and v.dtemitvenda between :dtini and :dtfim
            and v.codempcl=cl.codemp and v.codfilialcl=cl.codfilial and v.codcli=cl.codcli
            and cl.codempti=:codemp and cl.codfilialti=:codfilialtipocl
            and (cl.codtipocli=:codtipocli or :codtipocli is null)
            and cl.codemp=:codemp and cl.codfilial=:codfilialcl
            and ( :codpesq is null or (case when :agrupcli='S' then cl.codpesq else cl.codcli end)=:codpesq )
            and substring(v.statusvenda from 1 for 1) not in ('C','N')
        group by v.codcli,iv.codprod into :codcli,:codprod
    do
    begin
        select first 1 c.razcli, c.nomecli, c.codcli, p.descprod, iv.codprod, v.dtemitvenda, v.docvenda, v.serie,
            (iv.vlrliqitvenda/(case when iv.qtditvenda=0 then 1 else iv.qtditvenda end)) precovenda
            , p.desccompprod, p.refprod, iv.qtditvenda
        from vdcliente c, vdvenda v, vditvenda iv, eqproduto p
        where
            c.codemp=v.codempcl and c.codfilial=v.codfilialcl and c.codcli=v.codcli
            and c.codemp=v.codempcl and c.codfilial=v.codfilialcl and iv.codemp=v.codemp
            and iv.codfilial=v.codfilial and iv.tipovenda=v.tipovenda and iv.codvenda=v.codvenda
            and p.codemp=iv.codemppd and p.codfilial=iv.codfilialpd and p.codprod=iv.codprod
            and v.codempvd=:codemp and v.codfilialvd=:codfilialvd and (v.codvend=:codvend or :codvend is null )
            and v.dtemitvenda between :dtini and :dtfim and c.codcli=:codcli and p.codprod=:codprod
            and substring(v.statusvenda from 1 for 1) not in ('C','N')
            order by v.dtemitvenda desc
         into :razcli_ret, :nomecli_ret, :codcli_ret, :descprod_ret, :codprod_ret, :dtemitvenda_ret, :docvenda_ret, :serie_ret,
              :precovenda_ret, :obsitvenda_ret, :refprod_ret, :qtdprod_ret;
        select sum(iv.qtditvenda) qtdtotal 
        from vdcliente c, vdvenda v, vditvenda iv, eqproduto p
        where
            c.codemp=v.codempcl and c.codfilial=v.codfilialcl and c.codcli=v.codcli
            and c.codemp=v.codempcl and c.codfilial=v.codfilialcl and iv.codemp=v.codemp
            and iv.codfilial=v.codfilial and iv.tipovenda=v.tipovenda and iv.codvenda=v.codvenda
            and p.codemp=iv.codemppd and p.codfilial=iv.codfilialpd and p.codprod=iv.codprod
            and v.codempvd=:codemp and v.codfilialvd=:codfilialvd and (v.codvend=:codvend or :codvend is null )
            and v.dtemitvenda between :dtini and :dtfim and c.codcli=:codcli and p.codprod=:codprod
            and substring(v.statusvenda from 1 for 1) not in ('C','N')
         into :qtdtotal_ret;
         if (qtdtotal_ret is not null and qtdtotal_ret>0) then
         begin
            if (nummeses is not null and nummeses<>0) then 
            	qtdmedia_ret = qtdtotal_ret / nummeses;
         end
         suspend;
    end
end
^

/* Alter (VDUPVENDAORCSP) */
ALTER PROCEDURE VDUPVENDAORCSP(ICODEMP INTEGER,
ICODFILIAL INTEGER,
ICODORC INTEGER,
ICODITORC INTEGER,
ICODFILIALVD INTEGER,
ICODVENDA INTEGER,
ICODITVENDA INTEGER,
STIPOVENDA CHAR(10))
 AS
declare variable iconta1 decimal(15,5);
declare variable vlrdescvenda decimal(15,5);
declare variable iconta2 decimal(15,5);
declare variable iconta3 decimal(15,5);
begin
  /* Procedure Text */
  

 -- EXECUTE PROCEDURE sgdebugsp 'vdupvendaorcsp, orc.: '||:icodorc, 'inicio :'|| cast('now' as time);

  INSERT INTO VDVENDAORC (CODEMP,CODFILIAL,TIPOVENDA,CODVENDA,CODITVENDA,
                          CODEMPOR,CODFILIALOR,TIPOORC,CODORC,CODITORC) VALUES
                         (:ICODEMP,:ICODFILIALVD,:STIPOVENDA,:ICODVENDA,:ICODITVENDA,
                          :ICODEMP,:ICODFILIAL,'O',:ICODORC,:ICODITORC);

--  EXECUTE PROCEDURE sgdebugsp 'vdupvendaorcsp, orc.: '||:icodorc, 'fim insert vdvendaorc:'|| cast('now' as time);

  UPDATE VDITORCAMENTO SET EMITITORC='S'
       WHERE CODITORC=:ICODITORC AND CODORC=:ICODORC AND TIPOORC='O'
       AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
       AND EMITITORC<>'S';


--  EXECUTE PROCEDURE sgdebugsp 'vdupvendaorcsp, orc.: '||:icodorc, 'fim update vditorcamento '|| cast('now' as time);
    
  SELECT SUM(QTDITORC), SUM(QTDFATITORC) FROM VDITORCAMENTO WHERE CODORC=:ICODORC AND TIPOORC='O'
    AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
      INTO :ICONTA1, :ICONTA2;
--  SELECT SUM(QTDFATITORC) FROM VDITORCAMENTO WHERE CODORC=:ICODORC AND TIPOORC='O'
--    AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
--      INTO ICONTA2;

--  EXECUTE PROCEDURE sgdebugsp 'vdupvendaorcsp, orc.: '||:icodorc, 'fim select sum(qtditorc) '|| cast('now' as time);

  IF ( ICONTA1 = ICONTA2 ) THEN
  BEGIN
    UPDATE VDORCAMENTO SET STATUSORC='OV'
    WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODORC=:ICODORC
    AND STATUSORC<>'OV';
    SELECT SUM(IV.QTDITVENDA) FROM VDITVENDA IV, VDVENDAORC VO
       WHERE VO.CODEMP=:ICODEMP AND VO.CODFILIAL=:ICODFILIALVD AND
       VO.TIPOVENDA=:STIPOVENDA AND VO.CODVENDA=:ICODVENDA AND
       IV.CODEMP=VO.CODEMP AND IV.CODFILIAL=VO.CODFILIAL AND
       IV.TIPOVENDA=VO.TIPOVENDA AND IV.CODVENDA=VO.CODVENDA AND
       IV.CODITVENDA=VO.CODITVENDA
          INTO ICONTA3;
  --  EXECUTE PROCEDURE sgdebugsp 'vdupvendaorcsp, orc.: '||:icodorc, 'fim update vdorcamento OV = ICONTA1=ICONTA2 '|| cast('now' as time);

    IF ( ICONTA1<>ICONTA3 ) THEN -- Verifica se o oramento foi dividido em vrias vendas
    BEGIN
       UPDATE VDVENDA SET VLRDESCVENDA=0
         WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIALVD AND TIPOVENDA=:STIPOVENDA AND CODVENDA=:ICODVENDA
           AND VLRDESCVENDA<>0;
--        EXECUTE PROCEDURE sgdebugsp 'vdupvendaorcsp, orc.: '||:icodorc, 'fim update vdvenda VRLDESCVENDA=0 / ICONTA1<>ICONTA3 '|| cast('now' as time);

    END
  END
  ELSE IF (ICONTA1 > ICONTA2) THEN
  BEGIN               
    UPDATE VDORCAMENTO SET STATUSORC='FP'
    WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODORC=:ICODORC AND
     STATUSORC<>'FP';
    SELECT SUM(I.VLRDESCITVENDA) FROM VDITVENDA I
       WHERE I.CODEMP=:ICODEMP AND I.CODFILIAL=:ICODFILIALVD AND I.TIPOVENDA=:STIPOVENDA AND I.CODVENDA=:ICODVENDA
       INTO :VLRDESCVENDA;
--    EXECUTE PROCEDURE sgdebugsp 'vdupvendaorcsp, orc.: '||:icodorc, 'fim update vdorcamento STATUSORC=FP ICONTA1 > ICONTA2 '|| cast('now' as time);
    IF (:VLRDESCVENDA<>0) THEN
    BEGIN
       UPDATE VDVENDA SET VLRDESCVENDA=0
         WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIALVD AND TIPOVENDA=:STIPOVENDA AND CODVENDA=:ICODVENDA AND
         VLRDESCVENDA<>0;
--        EXECUTE PROCEDURE sgdebugsp 'vdupvendaorcsp, orc.: '||:icodorc, 'fim update vdvenda VRLDESCVENDA=0 / ICONTA1>ICONTA2 '|| cast('now' as time);
    END 
  END

--  EXECUTE PROCEDURE sgdebugsp 'vdupvendaorcsp, orc.: '||:icodorc, 'fim VDUPVENDAORCSP'|| cast('now' as time);

  --  exception vdvendaex06 'teste de velociadade';

  suspend;
end
^

/* Restore proc. body: ATADICATENDIMENTOCLISP */
ALTER PROCEDURE ATADICATENDIMENTOCLISP(ICODTIPOATENDO INTEGER,
ICODATEND INTEGER,
ICODSETOR INTEGER,
ICODEMP INTEGER,
ICODFILIAL INTEGER,
IDOC INTEGER,
DATAATENDO DATE,
DATAATENDOFIN DATE,
HORAATENDO TIME,
HORAATENDOFIN TIME,
OBSATENDO VARCHAR(10000),
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
CODEMPCT INTEGER,
CODFILIALCT INTEGER,
CODCONTR INTEGER,
CODITCONTR INTEGER,
CODREC INTEGER,
NPARCITREC INTEGER,
CODEMPCH INTEGER,
CODFILIALCH SMALLINT,
CODCHAMADO INTEGER,
OBSINTERNO VARCHAR(10000),
CONCLUICHAMADO CHAR,
CODEMPEA INTEGER,
CODFILIALEA SMALLINT,
CODESPEC INTEGER)
 AS
declare variable icodatendo integer;
declare variable ifilialatendo integer;
declare variable ifilialtipoatendo integer;
declare variable ifilialatend integer;
declare variable ifilialsetor integer;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATATENDIMENTO') INTO IFILIALATENDO;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATTIPOATENDO') INTO IFILIALTIPOATENDO;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATATENDENTE') INTO IFILIALATEND;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATSETOR') INTO IFILIALSETOR;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALATENDO,'AT') INTO ICODATENDO;

  INSERT INTO ATATENDIMENTO (
    CODEMP,CODFILIAL,CODATENDO,CODEMPTO,
    CODFILIALTO,CODTPATENDO,CODEMPAE,
    CODFILIALAE,CODATEND,CODEMPSA,CODFILIALSA,
    CODSETAT,STATUSATENDO,IDUSU,CODEMPUS,CODFILIALUS,DOCATENDO, DATAATENDO,
    DATAATENDOFIN, HORAATENDO, HORAATENDOFIN, OBSATENDO, CODEMPCL, CODFILIALCL, CODCLI, CODEMPCT, CODFILIALCT,
    CODCONTR, CODITCONTR, CODEMPCH, CODFILIALCH, CODCHAMADO, obsinterno, CONCLUICHAMADO,
    CODEMPEA, CODFILIALEA, CODESPEC )

  VALUES
  (
    :ICODEMP,:IFILIALATENDO,:ICODATENDO,:ICODEMP,
    :IFILIALTIPOATENDO,:ICODTIPOATENDO,:ICODEMP,
    :IFILIALATEND,:ICODATEND,:ICODEMP,:IFILIALSETOR,
    :ICODSETOR,'AA',lower(USER),:ICODEMP,:ICODFILIAL,:IDOC,
    :DATAATENDO,:DATAATENDOFIN,:HORAATENDO,:HORAATENDOFIN,:OBSATENDO,:CODEMPCL,
    :CODFILIALCL,:CODCLI, :CODEMPCT, :CODFILIALCT, :CODCONTR, :CODITCONTR, :codempch,
    :codfilialch, :codchamado, :obsinterno, :CONCLUICHAMADO,
    :CODEMPEA, :CODFILIALEA, :CODESPEC
  );

  -- Caso o atendimento tenha vinculo com o contas a receber
  IF(CODREC IS NOT NULL AND NPARCITREC IS NOT NULL) THEN
  BEGIN
    INSERT INTO ATATENDIMENTOITREC (CODEMP,CODFILIAL,CODATENDO,CODEMPIR,CODFILIALIR,CODREC,NPARCITREC) VALUES
        (:ICODEMP,:ICODFILIAL,:ICODATENDO,:ICODEMP,:ICODFILIAL,:CODREC,:NPARCITREC);
  END



END
^

/* Restore proc. body: ATATENDIMENTOIUSP */
ALTER PROCEDURE ATATENDIMENTOIUSP(IU CHAR,
CODEMP INTEGER,
CODFILIAL SMALLINT,
CODATENDO INTEGER,
CODEMPTO INTEGER,
CODFILIALTO SMALLINT,
CODTPATENDO INTEGER,
CODEMPAE INTEGER,
CODFILIALAE SMALLINT,
CODATEND INTEGER,
CODEMPSA INTEGER,
CODFILIALSA SMALLINT,
CODSETOR INTEGER,
DOCATENDO INTEGER,
DATAATENDO DATE,
DATAATENDOFIN DATE,
HORAATENDO TIME,
HORAATENDOFIN TIME,
OBSATENDO VARCHAR(10000),
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
CODCONTR INTEGER,
CODITCONTR SMALLINT,
CODEMPIR INTEGER,
CODFILIALIR SMALLINT,
CODREC INTEGER,
NPARCITREC INTEGER,
CODEMPCH INTEGER,
CODFILIALCH SMALLINT,
CODCHAMADO INTEGER,
OBSINTERNO VARCHAR(10000),
CONCLUICHAMADO CHAR,
CODEMPEA INTEGER,
CODFILIALEA SMALLINT,
CODESPEC INTEGER,
CODEMPUS INTEGER,
CODFILIALUS SMALLINT,
IDUSU VARCHAR(128),
STATUSATENDO CHAR(2),
CODEMPTA INTEGER,
CODFILIALTA SMALLINT,
CODTAREFA INTEGER,
CODEMPOC INTEGER,
CODFILIALOC INTEGER,
TIPOORC CHAR,
CODORC INTEGER,
SITATENDO CHAR(2),
CODEMPAG INTEGER,
CODFILIALAG SMALLINT,
TIPOAGE CHAR(5),
CODAGE INTEGER,
CODAGD INTEGER)
 AS
declare variable horaatendors time;
declare variable horaatendofinrs time;
declare variable dataatendors date;
declare variable contorc integer;
BEGIN

  DATAATENDORS = NULL;

  SELECT FIRST 1 A.DATAATENDO, A.HORAATENDO, A.HORAATENDOFIN
    FROM ATATENDIMENTO A
    WHERE A.CODEMP=:CODEMP AND A.CODFILIAL=:CODFILIAL AND
        A.CODEMPAE=:CODEMPAE AND A.CODFILIALAE=:CODFILIALAE AND
        A.CODATEND=:CODATEND AND A.CODATENDO<>:CODATENDO AND
        A.DATAATENDO=:DATAATENDO AND ( (A.HORAATENDO BETWEEN :HORAATENDO+1 AND :HORAATENDOFIN-1 )
        OR (A.HORAATENDOFIN BETWEEN :HORAATENDO+1 AND :HORAATENDOFIN-1 ) )
    INTO :DATAATENDORS, :HORAATENDORS, :HORAATENDOFINRS ;

  if (DATAATENDORS IS NOT NULL) then
  begin
     exception atatendimentoex02 'Jah existe(m) lancamento(s) em '||:dataatendors||' - h.: '||
        :horaatendors||' - '||:horaatendofinrs;
  end

  if (IU = 'I') then
  begin
     SELECT ISEQ FROM SPGERANUM(:CODEMP,:CODFILIAL,'AT') INTO :CODATENDO;
     STATUSATENDO = 'AA';
     INSERT INTO ATATENDIMENTO (
        CODEMP,CODFILIAL,CODATENDO,CODEMPTO,
        CODFILIALTO,CODTPATENDO,CODEMPAE,
        CODFILIALAE,CODATEND,CODEMPSA,CODFILIALSA,
        CODSETAT,STATUSATENDO,
        CODEMPUS,CODFILIALUS, IDUSU,
        DOCATENDO, DATAATENDO,
        DATAATENDOFIN, HORAATENDO, HORAATENDOFIN, OBSATENDO, CODEMPCL, CODFILIALCL, CODCLI, CODEMPCT, CODFILIALCT,
        CODCONTR, CODITCONTR, CODEMPCH, CODFILIALCH, CODCHAMADO, obsinterno, CONCLUICHAMADO,
        CODEMPEA, CODFILIALEA, CODESPEC , CODEMPTA, CODFILIALTA, CODTAREFA, SITATENDO )

     VALUES (
        :CODEMP, :CODFILIAL, :CODATENDO,
        :CODEMPTO, :CODFILIALTO, :CODTPATENDO,
        :CODEMPAE, :CODFILIALAE,:CODATEND,
        :CODEMPSA,:CODFILIALSA, :CODSETOR,
        :STATUSATENDO ,
        :CODEMPUS, :CODFILIALUS, lower(:IDUSU),
        :DOCATENDO, :DATAATENDO, :DATAATENDOFIN, :HORAATENDO,
        :HORAATENDOFIN, :OBSATENDO,
        :CODEMPCL, :CODFILIALCL, :CODCLI,
        :CODEMPCT, :CODFILIALCT, :CODCONTR, :CODITCONTR,
        :CODEMPCH, :CODFILIALCH, :CODCHAMADO,
        :OBSINTERNO, :CONCLUICHAMADO,
        :CODEMPEA, :CODFILIALEA, :CODESPEC , :CODEMPTA, :CODFILIALTA, :CODTAREFA, :SITATENDO
     );
  -- Caso o atendimento tenha vinculo com o contas a receber
     if (CODREC IS NOT NULL AND NPARCITREC IS NOT NULL) then
     begin
        INSERT INTO ATATENDIMENTOITREC (CODEMP,CODFILIAL,CODATENDO,CODEMPIR,CODFILIALIR,CODREC,NPARCITREC) VALUES
                (:CODEMP,:CODFILIAL,:CODATENDO,:CODEMPIR,:CODFILIALIR,:CODREC,:NPARCITREC);
     end

       -- Caso o atendimento tenha vinculo com o contas a receber
     if ( CODORC IS NOT NULL AND TIPOORC IS NOT NULL) then
     begin
        INSERT INTO atatendimentoorc (CODEMP,CODFILIAL,CODATENDO,CODEMPOC,CODFILIALOC,TIPOORC,CODORC) VALUES
                (:CODEMP,:CODFILIAL,:CODATENDO,:CODEMPOC,:CODFILIALOC,:TIPOORC,:CODORC);
     end

     -- Caso o atendimento tenha vinculo com um agendamento
     if ( CODAGD IS NOT NULL AND TIPOAGE IS NOT NULL) then
     begin
       
        INSERT INTO ATATENDOAGENDA (CODEMP, CODFILIAL, CODATENDO, CODEMPAG, CODFILIALAG, TIPOAGE, CODAGE, CODAGD)
                 VALUES (:CODEMP, :CODFILIAL, :CODATENDO, :CODEMPAG, :CODFILIALAG, :TIPOAGE, :CODAGE, :CODAGD);
     end

  end
  else if (IU = 'U') then
  begin
        UPDATE ATATENDIMENTO SET
            CODATEND=:CODATEND, DATAATENDO=:DATAATENDO, HORAATENDO=:HORAATENDO, DATAATENDOFIN=:DATAATENDOFIN,
            HORAATENDOFIN=:HORAATENDOFIN, OBSATENDO=:OBSATENDO,CODEMPTO=:CODEMPTO, CODFILIALTO=:CODFILIALTO,
            CODTPATENDO=:CODTPATENDO,CODEMPSA=:CODEMPSA, CODFILIALSA=:CODFILIALSA, CODSETAT=:CODSETOR, CODEMPCH=:CODEMPCH,
            CODFILIALCH=:CODFILIALCH, CODCHAMADO=:CODCHAMADO, CODEMPCT=:CODEMPCT, CODFILIALCT=:CODFILIALCT,
            CODCONTR=:CODCONTR, CODITCONTR=:CODITCONTR, STATUSATENDO=:STATUSATENDO, OBSINTERNO=:OBSINTERNO,
            CONCLUICHAMADO=:CONCLUICHAMADO, CODEMPEA=:CODEMPEA, CODFILIALEA=:CODFILIALEA, CODESPEC=:CODESPEC,
            CODEMPTA=:CODEMPTA, CODFILIALTA=:CODFILIALTA, CODTAREFA=:CODTAREFA,
            CODEMPCL=:CODEMPCL, CODFILIALCL=:CODFILIALCL, CODCLI=:CODCLI, SITATENDO=:SITATENDO
        WHERE
            CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL AND CODATENDO=:CODATENDO;

        SELECT COUNT(*) FROM ATATENDIMENTOORC WHERE CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL AND CODATENDO=:CODATENDO
        INTO :CONTORC;

        if ( :CONTORC = 0 AND CODORC IS NOT NULL AND TIPOORC IS NOT NULL) then
        begin
           INSERT INTO atatendimentoorc (CODEMP,CODFILIAL,CODATENDO,CODEMPOC,CODFILIALOC,TIPOORC,CODORC) VALUES
                    (:CODEMP,:CODFILIAL,:CODATENDO,:CODEMPOC,:CODFILIALOC,:TIPOORC,:CODORC);
        end

                 -- Caso o atendimento tenha vinculo com um agendamento
         if ( CODAGD IS NOT NULL AND TIPOAGE IS NOT NULL) then
         begin
           
            INSERT INTO ATATENDOAGENDA (CODEMP, CODFILIAL, CODATENDO, CODEMPAG, CODFILIALAG, TIPOAGE, CODAGE, CODAGD)
                     VALUES (:CODEMP, :CODFILIAL, :CODATENDO, :CODEMPAG, :CODFILIALAG, :TIPOAGE, :CODAGE, :CODAGD);
         end
  end
END
^

/* Restore proc. body: CPRETULTCPFORPROD */
ALTER PROCEDURE CPRETULTCPFORPROD(CODEMP INTEGER,
CODFOR INTEGER,
CODFILIALCP SMALLINT,
DTINI DATE,
DTFIM DATE,
CODEMPTIPOFR INTEGER,
CODFILIALTIPOFR SMALLINT,
CODTIPOFOR INTEGER)
 RETURNS(RAZFOR_RET CHAR(60),
CODFOR_RET INTEGER,
DESCPROD_RET CHAR(100),
CODPROD_RET INTEGER,
DTEMITCOMPRA_RET DATE,
DTENTCOMPRA_RET DATE,
DOCCOMPRA_RET INTEGER,
SERIE_RET VARCHAR(5),
PRECOCOMPRA_RET NUMERIC(15,4),
OBSITCOMPRA_RET VARCHAR(10000),
REFPROD_RET VARCHAR(20),
QTDPROD_RET NUMERIC(15,5))
 AS
declare variable codfilial smallint;
declare variable codprod integer;
begin
    select icodfilial from sgretfilial(:codemp,'VDVENDA') into :codfilial;
    for select c.codfor, ic.codprod
        from cpcompra c, cpforneced fr, cpitcompra ic
        where
            ic.codemp=c.codemp and ic.codfilial=c.codfilial
            and ic.codcompra=c.codcompra
            and c.codemp=:codemp and c.codfilial=:codfilial
            and (c.codfor=:codfor or :codfor is null)
            and c.dtentcompra between :dtini and :dtfim
            and fr.codemp=c.codempfr and fr.codfilial=c.codfilialfr and fr.codfor=c.codfor
            and (fr.codtipofor=:codtipofor or :codtipofor is null)
        group by c.codfor,ic.codprod into :codfor,:codprod
    do
    begin
        select first 1 f.razfor, f.codfor, p.descprod, ic.codprod, c.dtemitcompra, c.dtentcompra, c.doccompra, c.serie,
            (ic.vlrliqitcompra/(case when ic.qtditcompra=0 then 1 else ic.qtditcompra end)) precocompra, p.desccompprod, p.refprod, ic.qtditcompra
        from cpforneced f, cpcompra c, cpitcompra ic, eqproduto p
        where
            f.codemp=c.codempfr and f.codfilial=c.codfilialfr and f.codfor=c.codfor
            and ic.codemp=c.codemp and ic.codfilial=c.codfilial and ic.codcompra=c.codcompra
            and p.codemp=ic.codemppd and p.codfilial=ic.codfilialpd and p.codprod=ic.codprod
            and c.dtemitcompra between :dtini and :dtfim and f.codfor=:codfor and p.codprod=:codprod
            order by c.dtemitcompra desc
            into :razfor_ret, :codfor_ret, :descprod_ret, :codprod_ret, :dtemitcompra_ret, :dtentcompra_ret
                 , :doccompra_ret, :serie_ret
                 , :precocompra_ret, :obsitcompra_ret, :refprod_ret, :qtdprod_ret;
            suspend;
    end
end
^

/* Restore proc. body: CRTOTAL01ISP */
ALTER PROCEDURE CRTOTAL01ISP(CODEMP INTEGER,
CODFILIAL INTEGER)
 RETURNS(SEQTOT INTEGER)
 AS
declare variable codfilialtt smallint;
begin
  select icodfilial from sgretfilial(:codemp, 'CRTOTAL')
    into :codfilialtt;
  select iseq from spgeranum(:codemp, :codfilialtt, 'TT')
    into :seqtot;
  insert into crtotal (codemp, codfilial, seqtot)
    values(:codemp, :codfilialtt, :seqtot);
  suspend;
end
^

/* Restore proc. body: EQESTOQUELOTESP */
ALTER PROCEDURE EQESTOQUELOTESP(CODEMP INTEGER,
CODFILIAL SMALLINT,
DATAINI DATE,
DATAFIN DATE,
TIPOPROD VARCHAR(2))
 RETURNS(CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD VARCHAR(100),
CODLOTE VARCHAR(20),
SLDLOTEATUAL NUMERIC(15,5),
QTDMOVPROD NUMERIC(15,5),
CUSTOMPMPROD NUMERIC(15,5),
SLDLOTEPERIODO NUMERIC(15,5),
DTENTCOMPRA DATE,
SERIECOMPRA VARCHAR(5),
DOCCOMPRA INTEGER,
VLRLIQITCOMPRA NUMERIC(15,5))
 AS
begin
  for select pd.codprod, pd.refprod, pd.descprod, lt.codlote, coalesce(lt.sldliqlote,0)
     , coalesce(sum(mp.qtdmovprod * case when mp.tipomovprod='S' then -1 else 1 end ),0)
  from eqproduto pd
  inner join eqlote lt
  on lt.codemp=pd.codemp and lt.codfilial=pd.codfilial and lt.codprod=pd.codprod
  left outer join eqmovprod mp
  on mp.codemppd=pd.codemp and mp.codfilial=pd.codfilial and mp.codprod=pd.codprod
  and mp.codemple=lt.codemp and mp.codfilialle=lt.codfilial and mp.codlote=lt.codlote
  and mp.estoqmovprod='S' and mp.dtmovprod>:datafin
  where pd.codemp=:codemp and pd.codfilial=:codfilial
     and (pd.tipoprod=:tipoprod or :tipoprod is null)
     and pd.ativoprod='S'
  group by 1, 2, 3, 4, 5
  into :codprod, :refprod, :descprod, :codlote, :sldloteatual, :qtdmovprod
  do
  begin
     custompmprod = 0;
     dtentcompra = null;
     seriecompra = null;
     doccompra = null;
     vlrliqitcompra = null;
     sldloteperiodo = :sldloteatual - :qtdmovprod;
     select first 1 mp.custompmmovprod
     from  eqmovprod mp
     where mp.codemppd=:codemp and mp.codfilialpd=:codfilial and mp.codprod=:codprod
     and mp.dtmovprod between :dataini and :datafin
     order by mp.dtmovprod desc, mp.codmovprod desc
     into :custompmprod;

     select first 1 cp.dtentcompra, cp.serie, cp.doccompra, ic.vlrliqitcompra
     from cpitcompra ic
     inner join cpcompra cp
     on cp.codemp=ic.codemp and cp.codfilial=ic.codfilial and cp.codcompra=ic.codcompra
     where ic.codemppd=:codemp and ic.codfilialpd=:codfilial and ic.codprod=:codprod
     and cp.dtentcompra between :dataini and :datafin
     order by cp.dtentcompra desc, ic.codcompra desc, ic.coditcompra desc
     into :dtentcompra, :seriecompra, :doccompra, :vlrliqitcompra;
     suspend;
  end
end
^

/* Restore proc. body: EQMOVPRODDSP */
ALTER PROCEDURE EQMOVPRODDSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
DDTMOVPROD DATE,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
SEQSUBPROD SMALLINT,
TIPONF CHAR)
 AS
declare variable icodemp integer;
declare variable scodfilial smallint;
declare variable icodmovprod integer;
declare variable nsldmovprod numeric(15,5);
declare variable ncustompmmovprod numeric(15,5);
declare variable nsldmovprodax numeric(15,5);
declare variable ncustompmmovprodax numeric(15,5);
begin
  /* Procedure de deleo da tabela eqmovprod */
  SELECT ICODEMP, SCODFILIAL, ICODMOVPROD
  FROM EQMOVPRODRETCODSP(:ICODEMPIV, :SCODFILIALIV, :ICODINVPROD, :ICODEMPCP,
    :SCODFILIALCP, :ICODCOMPRA, :SCODITCOMPRA, :ICODEMPVD, :SCODFILIALVD,
    :CTIPOVENDA, :ICODVENDA, :SCODITVENDA, :ICODEMPRM, :SCODFILIALRM, :ICODRMA,
    :SCODITRMA, :ICODEMPOP,  :SCODFILIALOP,  :ICODOP, :SSEQOP, :sseqentop, :seqsubprod)
    INTO :ICODEMP, :SCODFILIAL, :ICODMOVPROD;

  SELECT NSALDO, NCUSTOMPM, NSALDOAX, NCUSTOMPMAX
  FROM EQMOVPRODSLDSP(:ICODEMP, :SCODFILIAL, :ICODMOVPROD,
   :ICODEMPPD, :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, 0, 0,
   :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX)
     INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX  ;

  /* DELETAR EQMOVPROD */
  DELETE FROM EQMOVPROD WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL
    AND CODMOVPROD=:ICODMOVPROD;

  /* REPROCESSAR ESTOQUE */
  SELECT NSLDPRC, NCUSTOMPMPRC, NSLDPRCAX, NCUSTOMPMPRCAX
    FROM EQMOVPRODPRCSLDSP( :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
      :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, null, :NSLDMOVPROD, :NCUSTOMPMMOVPROD,
      :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX, :ICODEMPAX, :SCODFILIALAX, :ICODALMOX,
      :CMULTIALMOX, :TIPONF)
    INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX;

  /* ATUALIZA CUSTO NO CADASTRO DE PRODUTOS
   OPERADOR 1 PARA EFETUAR A ATUALIZAO SEMPRE
  EXECUTE PROCEDURE EQMOVPRODATCUSTSP( 1, :ICODEMP, :SCODFILIAL,
   :ICODMOVPROD,  :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, 0);
   */

  suspend;
end
^

/* Restore proc. body: EQMOVPRODSEQSP */
ALTER PROCEDURE EQMOVPRODSEQSP(ICODEMP INTEGER)
 RETURNS(SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER)
 AS
begin
  /* Busca o cdigo sequencial da tabela eqmovprod */
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP, 'EQMOVPROD') INTO :SCODFILIAL ;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP, :SCODFILIAL, 'MP' ) INTO :ICODMOVPROD ;
  suspend;
end
^

/* Restore proc. body: SGATUALIZABDSP */
ALTER PROCEDURE SGATUALIZABDSP(ICODEMP INTEGER)
 AS
DECLARE VARIABLE ICODEMPTMP INTEGER;
begin
  if (ICODEMP IS NULL) then
     ICODEMP = 99;
  /*CTEMP = printLog('Entrou no atualizabdsp '||cast(ICODEMP AS CHAR(10)));*/

  EXECUTE PROCEDURE SGDADOSINISP(:ICODEMP);
  EXECUTE PROCEDURE SGGRANTUSERSP ;
  FOR SELECT CODEMP FROM SGEMPRESA INTO :ICODEMPTMP DO
  BEGIN
     EXECUTE PROCEDURE SGOBJETOINSTBSP(:ICODEMPTMP);
     EXECUTE PROCEDURE SGGRANTADMSP(:ICODEMPTMP);
  END
  suspend;
end
^

/* Restore proc. body: SGLOGSP01 */
ALTER PROCEDURE SGLOGSP01(CLASLOG CHAR(2),
TIPOLOG CHAR(3),
DESCLOG CHAR(60),
OBSLOG VARCHAR(1000))
 RETURNS(CODFILIAL SMALLINT,
CODLOG INTEGER)
 AS
DECLARE VARIABLE IDUSU CHAR(8);
DECLARE VARIABLE CODEMP INTEGER;
DECLARE VARIABLE CODCAIXA INTEGER;
BEGIN
  SELECT CODEMP,CODFILIALSEL,CODTERM, IDUSU FROM SGCONEXAO WHERE NRCONEXAO=CURRENT_CONNECTION AND
    CONECTADO > 0 INTO CODEMP, CODFILIAL, CODCAIXA, IDUSU;
  SELECT ISEQ FROM SPGERANUM(:CODEMP,:CODFILIAL,'LG') INTO CODLOG;
  INSERT INTO SGLOG(CODEMP,CODFILIAL,CODLOG,CODEMPUS,CODFILIALUS,IDUSU,
               CLASLOG,TIPOLOG,CODEMPCX,CODFILIALCX,CODCAIXA,
        DESCLOG,OBSLOG) VALUES
              (:CODEMP,:CODFILIAL,:CODLOG,:CODEMP,:CODFILIAL,:IDUSU,
               :CLASLOG,:TIPOLOG,:CODEMP,:CODFILIAL,:CODCAIXA,
               :DESCLOG,:OBSLOG);
  SUSPEND;
END
^

/* Restore proc. body: SGSETAGENDASP */
ALTER PROCEDURE SGSETAGENDASP(CODAGD INTEGER,
CODEMP INTEGER,
DTAINIAGD DATE,
HRINIAGD TIME,
DTAFIMAGD DATE,
HRFIMAGD TIME,
ASSUNTOAGD CHAR(50),
DESCAGD VARCHAR(10000),
CODFILIALTA SMALLINT,
CODTIPOAGD INTEGER,
PRIORAGD SMALLINT,
CODAGE INTEGER,
TIPOAGE CHAR(5),
CODFILIALAE SMALLINT,
CODAGEEMIT INTEGER,
TIPOAGEEMIT CHAR(5),
CAAGD CHAR(2),
SITAGD CHAR(2),
RESOLUCAOMOTIVO VARCHAR(10000),
CODAGDAR INTEGER,
DIATODO CHAR)
 RETURNS(IRET INTEGER)
 AS
DECLARE VARIABLE IFILIALAGD INTEGER;
begin
  select ICODFILIAL from SGRETFILIAL(:CODEMP,'SGAGENDA') INTO IFILIALAGD;
  IF (CODAGD = 0) THEN
  BEGIN

    SELECT ISEQ FROM SPGERANUM(:CODEMP,:IFILIALAGD,'AG') INTO CODAGD;

    if(codagdar is not null ) then  -- Agendamento vinculado (repetio)
    begin
        insert into sgagenda (
            codemp, codfilial, codage, tipoage, codagd,
            dataagd, dtainiagd, hriniagd, dtafimagd, hrfimagd,
            assuntoagd, descagd, codempta, codfilialta, codtipoagd, prioragd, sitagd,
            codempae, codfilialae, codageemit, tipoageemit, caagd, resolucaomotivo,
            codempar,codfilialar,codagear,tipoagear,codagdar,diatodo)
        values (
            :codemp, :ifilialagd, :codage, :tipoage, :codagd,
            cast('today' as date), :dtainiagd, :hriniagd, :dtafimagd, :hrfimagd,
            :assuntoagd, :descagd, :codemp, :codfilialta, :codtipoagd, :prioragd, :sitagd,
            :codemp, :codfilialae, :codageemit, :tipoageemit, :caagd, :resolucaomotivo,
            :codemp,:ifilialagd,:codage,:tipoage,:codagdar,:diatodo
        );
    end
    else -- Agendamento simples, sem vnvulo (repetio)
    begin
        insert into sgagenda (
            CODEMP,CODFILIAL,CODAGE,TIPOAGE,CODAGD,
            DATAAGD,DTAINIAGD,HRINIAGD,DTAFIMAGD,HRFIMAGD,
            ASSUNTOAGD,DESCAGD,CODEMPTA,CODFILIALTA,CODTIPOAGD,PRIORAGD,SITAGD,
            CODEMPAE,CODFILIALAE,CODAGEEMIT,TIPOAGEEMIT,CAAGD, RESOLUCAOMOTIVO, DIATODO)
        values (
            :CODEMP,:IFILIALAGD,:CODAGE,:TIPOAGE,:CODAGD,
            CAST('today' AS DATE),:DTAINIAGD,:HRINIAGD,:DTAFIMAGD,:HRFIMAGD,
            :ASSUNTOAGD,:DESCAGD,:CODEMP,:CODFILIALTA,:CODTIPOAGD,:PRIORAGD,:SITAGD,
            :CODEMP,:CODFILIALAE,:CODAGEEMIT,:TIPOAGEEMIT,:CAAGD, :RESOLUCAOMOTIVO,:DIATODO

        );
    end
  end
  else
    update sgagenda set
      DTAINIAGD=:DTAINIAGD,HRINIAGD=:HRINIAGD,
      DTAFIMAGD=:DTAFIMAGD,HRFIMAGD=:HRFIMAGD,
      ASSUNTOAGD=:ASSUNTOAGD,DESCAGD=:DESCAGD,
      CODEMPTA=:CODEMP,CODFILIALTA=:CODFILIALTA,CODTIPOAGD=:CODTIPOAGD,
      PRIORAGD=:PRIORAGD,CAAGD=:CAAGD,
      SITAGD=:SITAGD,
      RESOLUCAOMOTIVO=:RESOLUCAOMOTIVO,
      codage=:codage, diatodo=:diatodo
      WHERE CODEMP=:CODEMP AND CODFILIAL=:IFILIALAGD
      AND CODAGD=:CODAGD AND TIPOAGE=:TIPOAGE;
  IRET = CODAGD;
  SUSPEND;
END
^

/* Restore proc. body: VDBUSCAPRECOSP01 */
ALTER PROCEDURE VDBUSCAPRECOSP01(CODPROD INTEGER,
CODCLI INTEGER,
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODPLANOPAG INTEGER,
CODEMPPG INTEGER,
CODFILIALPG SMALLINT,
CODTIPOMOV INTEGER,
CODEMPTM INTEGER,
CODFILIALTM SMALLINT,
CODEMP INTEGER,
CODFILIAL SMALLINT,
CODEMPTB INTEGER,
CODFILIALTB SMALLINT,
CODTAB INTEGER)
 RETURNS(PRECO NUMERIC(14,5),
CODCLASCLIP INTEGER,
CODPLANOPAGP INTEGER,
CODPRECOPRODP INTEGER,
CODTABP INTEGER)
 AS
declare variable codclascli integer;
declare variable codempclascli integer;
declare variable codfilialclascli smallint;
declare variable percdesccli numeric(3,2);
declare variable desccli char(1);
declare variable arredpreco smallint;
declare variable codfilialpf integer;
declare variable centavos decimal(2,2);
declare variable precobase decimal(15,5);
begin
    -- Buscando cdigo da filial de preferencias
    select icodfilial from sgretfilial(:codemp,'SGFILIAL') into :codfilialpf;
    -- Buscando preferencias de arredondamento;
    select coalesce(arredpreco, 0)
    from sgprefere1 p1
    where p1.codemp=:codemp and p1.codfilial=:codfilialpf
    into :arredpreco;
    -- Buscando tabela de preos do tipo de movimento;
    if (codtab is null and codtipomov is not null) then
    begin
        select codtab, codemptb, codfilialtb
        from eqtipomov
        where codtipomov=:codtipomov and codemp=:codemptm and codfilial=:codfilialtm
        into :codtab, :codemptb, :codfilialtb;
    end
    -- Buscando informaes do produto
    select coalesce(pd.desccli,'N'), coalesce(precobaseprod,0) from eqproduto pd
        where pd.codprod=:codprod and pd.codemp=:codemp and pd.codfilial=:codfilial
        into :desccli, :precobase;
    -- Buscando informaes do cliente
    if (codclascli is null and codcli is not null) then
    begin
       select codclascli, codempcc, codfilialcc, coalesce(percdesccli,0) percdesccli
       from vdcliente
       where codcli=:codcli and codemp=:codempcl and codfilial=:codfilialcl
       into :codclascli, :codempclascli, :codfilialclascli, :percdesccli;
    end
  -- Buscando preo da tabela de preos utilizando todos os filtros inclusive tabela de preos
    for select pp.codclascli, pp.codplanopag, pp.codtab, pp.codprecoprod, pp.precoprod
    from vdprecoprod pp
    where pp.codemp=:codemp and pp.codfilial=:codfilial and pp.codprod=:codprod
    and pp.ativoprecoprod='S'
    and ( ( :codtab is null ) or (pp.codemptb=:codemptb and pp.codfilialtb=:codfilialtb and pp.codtab=:codtab ) )
    and ( ( pp.codplanopag is null ) or (pp.codemppg=:codemppg and pp.codfilialpg=:codfilialpg and pp.codplanopag=:codplanopag ) )
    and ( ( pp.codclascli is null) or (pp.codempcc=:codempclascli and pp.codfilialcc=:codfilialclascli and pp.codclascli=:codclascli ) )
    order by coalesce(pp.codclascli,0) desc, coalesce(pp.codplanopag,0) desc, coalesce(pp.codtab,0), pp.codprecoprod
    into :codclasclip, :codplanopagp, :codtabp, :codprecoprodp, :preco do
    begin
        if ( (:preco is not null) or (:preco <> 0) ) then
        begin
            break;
        end
    end
    -- Buscando preo da tabela de preo sem considerar a tabela do tipo de movimento
    if ( (:preco is null) or (:preco = 0) ) then
    begin
        for select pp.codclascli, pp.codplanopag, pp.codtab, pp.codprecoprod, pp.precoprod
        from vdprecoprod pp
        where pp.codemp=:codemp and pp.codfilial=:codfilial and pp.codprod=:codprod
        and pp.ativoprecoprod='S'
        and ( ( pp.codplanopag is null ) or (pp.codemppg=:codemppg and pp.codfilialpg=:codfilialpg and pp.codplanopag=:codplanopag ) )
        and ( ( pp.codclascli is null) or (pp.codempcc=:codempclascli and pp.codfilialcc=:codfilialclascli and pp.codclascli=:codclascli ) )
        order by coalesce(pp.codclascli,0) desc, coalesce(pp.codplanopag,0) desc, coalesce(pp.codtab,0), pp.codprecoprod
        into :codclasclip, :codplanopagp, :codtabp, :codprecoprodp, :preco do
        begin
            if ( (:preco is not null) or (:preco <> 0) ) then
            begin
                break;
            end
        end
    end
    -- Buscando preo da tabela de preos especfica
    if ( (:preco is null) or (:preco = 0) ) then
    begin
        for select pp.codclascli, pp.codplanopag, pp.codtab, pp.codprecoprod, pp.precoprod
        from vdprecoprod pp
        where pp.codemp=:codemp and pp.codfilial=:codfilial and pp.codprod=:codprod
        and pp.ativoprecoprod='S'
        and pp.codemptb=:codemptb and pp.codfilialtb=:codfilialtb and pp.codtab=:codtab
        order by coalesce(pp.codclascli,0), coalesce(pp.codplanopag,0), coalesce(pp.codtab,0), pp.codprecoprod
        into :codclasclip, :codplanopagp, :codtabp, :codprecoprodp, :preco do
        begin
            if ( (:preco is not null) or (:preco <> 0) ) then
            begin
               break;
            end
        end
    end
    --Se ainda no conseguiu pagar o preco, deve utilizar o preo base do produto aplicando o desconto especial do cliente se houver
    if ((preco is null) or (preco = 0)) then
    begin
         preco = precobase;
    end
    -- Verifica se o cliente possui desconto especial e o produto permite este desconto...
    if( percdesccli >0 and 'S' = :desccli ) then
    begin
         preco = :preco - (:preco * (:percdesccli / 100)) ;
    end
    if( :arredpreco > 0 ) then
    begin
        -- capturando valor dos centavos
        centavos = ( cast(:preco as decimal(15,2)) - truncate(preco) ) * 10;
        -- se o valor em centavos  maior ou igual ao parametro de arredondamento (arredondar para cima)
        if(:centavos >= :arredpreco) then
        begin
            preco = truncate(preco) + 1;
        end
        else
        begin
            preco = truncate(preco);
        end
    end
    suspend;
end
^

/* Restore proc. body: VDCOPIAPEDSP */
ALTER PROCEDURE VDCOPIAPEDSP(CODEMP INTEGER,
CODFILIAL INTEGER,
CODCLI INTEGER,
CODEMPCL INTEGER,
CODFILIALCL INTEGER,
CODPED INTEGER)
 RETURNS(IRET INTEGER)
 AS
DECLARE VARIABLE ICODPED INTEGER;
BEGIN

  SELECT COALESCE( MAX(R.CODPED),0) + 1 FROM RPPEDIDO R
  WHERE R.CODEMP=:CODEMP AND R.CODFILIAL=:CODFILIAL INTO ICODPED;

  INSERT INTO RPPEDIDO ( CODEMP, CODFILIAL, CODPED, DATAPED, CODCLI, CODFILIALCL,
                         CODEMPCL, CODVEND, CODFILIALVD, CODEMPVD, CODPLANOPAG,
                         CODFILIALPG, CODEMPPG, CODMOEDA, CODFILIALMO, CODEMPMO,
                         CODFOR, CODFILIALFO, CODEMPFO, CODTRAN, CODFILIALTP,
                         CODEMPTP, TIPOFRETEPED, TIPOREMPED, NUMPEDCLI, NUMPEDFOR,
                         VLRTOTPED, QTDTOTPED, VLRLIQPED, VLRIPIPED, VLRDESCPED,
                         VLRADICPED, VLRRECPED, VLRPAGPED, OBSPED )
  SELECT  CODEMP, CODFILIAL, :ICODPED, DATAPED, :CODCLI, CODFILIALCL,
                         CODEMPCL, CODVEND, CODFILIALVD, CODEMPVD, CODPLANOPAG,
                         CODFILIALPG, CODEMPPG, CODMOEDA, CODFILIALMO, CODEMPMO,
                         CODFOR, CODFILIALFO, CODEMPFO, CODTRAN, CODFILIALTP,
                         CODEMPTP, TIPOFRETEPED, TIPOREMPED, NUMPEDCLI, NUMPEDFOR,
                         0, 0, 0, 0, 0,
                         0, 0, 0, OBSPED
                         FROM RPPEDIDO WHERE  CODPED=:CODPED AND CODEMP=:CODEMP
                         AND CODFILIAL=:CODFILIAL;

  INSERT INTO RPITPEDIDO ( CODEMP, CODFILIAL, CODPED, CODITPED, CODPROD, CODFILIALPD, CODEMPPD,
                          QTDITPED, PRECOITPED, VLRITPED, VLRLIQITPED, PERCIPIITPED, VLRIPIITPED,
                          PERCDESCITPED, VLRDESCITPED, PERCADICITPED, VLRADICITPED, PERCRECITPED,
                          VLRRECITPED, PERCPAGITPED, VLRPAGITPED, REFPROD )
  SELECT  CODEMP, CODFILIAL, :ICODPED, CODITPED, CODPROD, CODFILIALPD, CODEMPPD,
                          QTDITPED, PRECOITPED, VLRITPED, VLRLIQITPED, PERCIPIITPED, VLRIPIITPED,
                          PERCDESCITPED, VLRDESCITPED, PERCADICITPED, VLRADICITPED, PERCRECITPED,
                          VLRRECITPED, PERCPAGITPED, VLRPAGITPED, REFPROD
                          FROM RPITPEDIDO WHERE CODPED=:CODPED AND CODEMP=:CODEMP
                          AND CODFILIAL=:CODFILIAL;
                          IRET = ICODPED;
  SUSPEND;

END
^

/* Restore proc. body: VDRETLISTAPRODSP */
ALTER PROCEDURE VDRETLISTAPRODSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
DTINI DATE,
DTFIM DATE,
CODFORNECEDOR INTEGER)
 RETURNS(CODFOR INTEGER,
REFPROD CHAR(13),
DESCPROD CHAR(60),
COMPRA NUMERIC(15,2),
PRECOPROD1 NUMERIC(15,2),
VENDA NUMERIC(15,2))
 AS
begin
    for select pr.codfor, pr.refprod,pr.descprod, pr.saldoprod as compra, pr.precoprod1,
    sum((select coalesce(sum(it.qtditped),0) from rpitpedido it ,rppedido pd
    where pd.codemp=it.codemp and pd.codfilial=it.codfilial and pd.codped=it.codped
    and pd.codemp=:CODEMP and pd.codfilial=:CODFILIAL and pd.dataped between :DTINI and :DTFIM
    and it.codemppd=pr.codemp and it.codfilialpd=pr.codfilial and it.codprod=pr.codprod )) as venda
    from rpproduto pr where (pr.codfor=:CODFORNECEDOR or :CODFORNECEDOR is null )
    group by 1,2,3,4,5 order by pr.descprod
    INTO :CODFOR, :REFPROD, :DESCPROD, :COMPRA, :PRECOPROD1, :VENDA do
    begin
        suspend;
    end


end
^

/* Create trigger... */
CREATE TRIGGER RPCOMISSAOTGBU FOR RPCOMISSAO
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  IF (new.VLRPAGO IS NULL) THEN
    new.VLRPAGO=0;
  IF (new.VLRPAGO > 0) THEN
  BEGIN
    IF (new.VLRPAGO >= old.VLRCOMISS) THEN
    BEGIN
      new.VLRPAGO=old.VLRCOMISS;
      new.STATUSCOMISS='CF';
    END
    ELSE IF (new.VLRPAGO < old.VLRCOMISS) THEN
      new.STATUSCOMISS='PP';
  END
  ELSE
    new.STATUSCOMISS='PE';
end
^

CREATE TRIGGER RPITPEDIDOAD FOR RPITPEDIDO
ACTIVE AFTER DELETE POSITION 0 
AS
begin
  UPDATE RPPEDIDO SET                    
    VLRLIQPED = VLRLIQPED - OLD.VLRLIQITPED,
    VLRTOTPED = VLRTOTPED - OLD.VLRITPED,
    QTDTOTPED = QTDTOTPED - OLD.QTDITPED,
    VLRIPIPED = VLRIPIPED - OLD.VLRIPIITPED,
    VLRDESCPED = VLRDESCPED - OLD.VLRDESCITPED,
    VLRADICPED = VLRADICPED - OLD.VLRADICITPED,
    VLRRECPED = VLRRECPED - OLD.VLRRECITPED,
    VLRPAGPED = VLRPAGPED - OLD.VLRPAGITPED
    WHERE CODPED=OLD.CODPED AND CODFILIAL=OLD.CODFILIAL AND CODEMP=OLD.CODEMP;
end
^

CREATE TRIGGER RPITPEDIDOAU FOR RPITPEDIDO
ACTIVE AFTER UPDATE POSITION 0 
AS
begin
  UPDATE RPPEDIDO SET
    VLRTOTPED = VLRTOTPED - OLD.VLRITPED + NEW.VLRITPED,
    VLRLIQPED = VLRLIQPED - OLD.VLRLIQITPED + NEW.VLRLIQITPED,
    QTDTOTPED = QTDTOTPED - OLD.QTDITPED + NEW.QTDITPED,
    VLRIPIPED = VLRIPIPED - OLD.VLRIPIITPED + NEW.VLRIPIITPED,
    VLRDESCPED = VLRDESCPED - OLD.VLRDESCITPED + NEW.VLRDESCITPED,
    VLRADICPED = VLRADICPED - OLD.VLRADICITPED + NEW.VLRADICITPED,
    VLRRECPED = VLRRECPED - OLD.VLRRECITPED + NEW.VLRRECITPED,
    VLRPAGPED = VLRPAGPED - OLD.VLRPAGITPED + NEW.VLRPAGITPED
    WHERE CODPED=OLD.CODPED AND CODFILIAL=OLD.CODFILIAL AND CODEMP=OLD.CODEMP;
end
^

CREATE TRIGGER RPITPEDIDOBI FOR RPITPEDIDO
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  IF (NEW.VLRLIQITPED IS NULL) THEN NEW.VLRLIQITPED = 0; -- VALOR LIQUIDO
  IF (NEW.PERCIPIITPED IS NULL) THEN NEW.PERCIPIITPED = 0; -- PERCENTAGEM IPI
  IF (NEW.VLRIPIITPED IS NULL) THEN NEW.VLRIPIITPED = 0; -- VALOR IPI
  IF (NEW.PERCDESCITPED IS NULL) THEN NEW.PERCDESCITPED = 0; -- PERCENTAGEM DESCONTO
  IF (NEW.VLRDESCITPED IS NULL) THEN NEW.VLRDESCITPED = 0; -- VALOR DESCONTO
  IF (NEW.PERCADICITPED IS NULL) THEN NEW.PERCADICITPED = 0; -- PERCENTAGEM ADICIONAL
  IF (NEW.VLRADICITPED IS NULL) THEN NEW.VLRADICITPED = 0; -- VALOR ADICIONAL
  IF (NEW.PERCRECITPED IS NULL) THEN NEW.PERCRECITPED = 0; -- PERCETAGEM RECEBIMENTO
  IF (NEW.VLRRECITPED IS NULL) THEN NEW.VLRRECITPED = 0; -- VALOR A RECEBER
  IF (NEW.PERCPAGITPED IS NULL) THEN NEW.PERCPAGITPED = 0; -- PERCENTAGEM PAGAMENTO
  IF (NEW.VLRPAGITPED IS NULL) THEN NEW.VLRPAGITPED = 0; -- VALOR A PAGAR

  UPDATE RPPEDIDO SET
    VLRLIQPED = VLRLIQPED + NEW.VLRLIQITPED,
    VLRTOTPED = VLRTOTPED + NEW.VLRITPED,
    QTDTOTPED = QTDTOTPED + NEW.QTDITPED,
    VLRIPIPED = VLRIPIPED + NEW.VLRIPIITPED,
    VLRDESCPED = VLRDESCPED + NEW.VLRDESCITPED,
    VLRADICPED = VLRADICPED + NEW.VLRADICITPED,
    VLRRECPED = VLRRECPED + NEW.VLRRECITPED,
    VLRPAGPED = VLRPAGPED + NEW.VLRPAGITPED
    WHERE CODPED=NEW.CODPED AND CODFILIAL=NEW.CODFILIAL AND CODEMP=NEW.CODEMP;
end
^

CREATE TRIGGER RPPEDIDOBI FOR RPPEDIDO
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  IF (NEW.VLRLIQPED IS NULL) THEN NEW.VLRLIQPED = 0;
  IF (NEW.VLRTOTPED IS NULL) THEN NEW.VLRTOTPED = 0;
  IF (NEW.QTDTOTPED IS NULL) THEN NEW.QTDTOTPED = 0;
  IF (NEW.VLRIPIPED IS NULL) THEN NEW.VLRIPIPED = 0;
  IF (NEW.VLRDESCPED IS NULL) THEN NEW.VLRDESCPED = 0;
  IF (NEW.VLRADICPED IS NULL) THEN NEW.VLRADICPED = 0;
  IF (NEW.VLRRECPED IS NULL) THEN NEW.VLRRECPED = 0;
  IF (NEW.VLRPAGPED IS NULL) THEN NEW.VLRPAGPED = 0;
end
^

CREATE TRIGGER RPPLANOPAGTGAI FOR RPPLANOPAG
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE i Integer;
DECLARE VARIABLE iDias Integer;
DECLARE VARIABLE dPerc NUMERIC(10,6);
DECLARE VARIABLE dTotPerc NUMERIC(10,6);
BEGIN
   IF (new.PARCPLANOPAG>0) THEN
   BEGIN
     i = 1;
     dTotPerc = 0;
     dPerc = 100.000000/new.PARCPLANOPAG;
     WHILE (i<=new.PARCPLANOPAG) DO
     BEGIN
        iDias = (i-1)*30;
        IF (i = new.PARCPLANOPAG) THEN
          dPerc = 100.000000-dTotPerc;
        INSERT INTO RPPARCPLANOPAG (CODEMP,CODFILIAL,CODPLANOPAG,NROPARCPAG,PERCPAG,DIASPAG)
               VALUES (new.CODEMP,new.CODFILIAL,new.CODPLANOPAG,:i,:dPerc,:iDias);
        dTotPerc = dTotPerc + dPerc;
        i = i + 1;
     END
   END
END
^

CREATE TRIGGER RPPLANOPAGTGBD FOR RPPLANOPAG
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  DELETE FROM RPPARCPLANOPAG WHERE CODPLANOPAG=old.CODPLANOPAG
         AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
END
^


/* Create Views... */

/* Alter exist trigger... */
ALTER TRIGGER ATATENDIMENTOTGBU
as
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  IF (new.BLOQATENDO IS NULL) THEN
     new.BLOQATENDO='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      if ( ( (old.BLOQATENDO IS  NULL) OR (old.BLOQATENDO='N') ) AND (new.BLOQATENDO='S') )  then
      begin
          new.DTALT=cast('now' AS DATE);
          new.IDUSUALT=user;
          new.HALT=cast('now' AS TIME);
      end
      if ( (new.BLOQATENDO='S') and (old.BLOQATENDO='S') ) then
         EXCEPTION ATATENDIMENTOEX01;
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPCOMPRATGAU
AS
  DECLARE VARIABLE iCodPag INTEGER;
  DECLARE VARIABLE dVLR NUMERIC(15, 5);
  DECLARE VARIABLE IFILIALPAG INTEGER;
  DECLARE VARIABLE TIPOMOV CHAR(2);        
  DECLARE VARIABLE ICODITEM SMALLINT;
  DECLARE VARIABLE VLRITEM NUMERIC(15, 5);  
  DECLARE VARIABLE QTDITEM NUMERIC(15, 5);
  DECLARE VARIABLE PERCITFRETE NUMERIC(15, 5);
  DECLARE VARIABLE VLRITFRETE NUMERIC(15, 5);
  DECLARE VARIABLE PERCITADIC NUMERIC(15, 5);
  DECLARE VARIABLE VLRITADIC NUMERIC(15, 5);
  DECLARE VARIABLE SCODFILIALP1 SMALLINT;
  DECLARE VARIABLE GERAPAGEMIS CHAR(1);
  DECLARE VARIABLE DTBASE DATE;
  --DECLARE VARIABLE ICODMODNOTA INTEGER;
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) )) ) THEN
  BEGIN
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO :SCODFILIALP1;
      SELECT P1.GERAPAGEMIS FROM SGPREFERE1 P1 WHERE  P1.CODEMP=new.CODEMP AND
         P1.CODFILIAL=:SCODFILIALP1 INTO :GERAPAGEMIS;
      IF (GERAPAGEMIS IS NULL) THEN
      BEGIN
        GERAPAGEMIS = 'N';
      END
      IF (GERAPAGEMIS='S') THEN
      BEGIN
        DTBASE = new.DTEMITCOMPRA;
      END
      ELSE
      BEGIN
        DTBASE = new.DTENTCOMPRA;
      END
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPAGAR') INTO IFILIALPAG;
      SELECT CODPAG FROM FNPAGAR WHERE CODCOMPRA=new.CODCOMPRA
             AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALPAG INTO iCodPag;
      SELECT TIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
             AND CODEMP=new.CODEMPTM AND CODFILIAL=new.CODFILIALTM INTO TIPOMOV;
      IF ((NOT TIPOMOV IN ('DV','TR')) AND (
         (iCodPag IS NULL) OR (
         (new.CODPLANOPAG != old.CODPLANOPAG) OR
         (new.CODFOR != old.CODFOR) OR
         (new.VLRLIQCOMPRA != old.VLRLIQCOMPRA) OR
         (new.DTENTCOMPRA != old.DTENTCOMPRA) OR
         (new.DTEMITCOMPRA != old.DTEMITCOMPRA) OR
         (new.DOCCOMPRA != old.DOCCOMPRA) OR
         (new.CODBANCO != old.CODBANCO)))) THEN
      BEGIN
        dVLR = new.VLRLIQCOMPRA;
        IF ((new.STATUSCOMPRA IN ('P2','C2')) AND (old.STATUSCOMPRA IN ('P1','C1'))) THEN
        BEGIN
          DELETE FROM FNPAGAR WHERE CODCOMPRA=old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALPAG;
          IF (dVlr > 0) THEN
            EXECUTE PROCEDURE FNADICPAGARSP01(new.CODCOMPRA,new.CODEMPPG,new.CODFILIALPG,
               new.CODPLANOPAG,new.CODEMPFR,new.CODFILIALFR,new.CODFOR,:dVLR,
               :DTBASE, new.DTCOMPCOMPRA, new.DOCCOMPRA,new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,
               new.FLAG,new.CODEMP,new.CODFILIAL, new.CODEMPTC, new.CODFILIALTC, new.CODTIPOCOB,
               new.codempct, new.codfilialct, new.numconta, new.codempcc,  new.codfilialcc, new.anocc, new.codcc, new.codemppn, new.codfilialpn, new.codplan, new.anoplan, new.obspag );
               
          --SELECT CODMODNOTA FROM EQTIPOMOV m WHERE m.codemp=new.codemptm and m.codfilial=new.codfilialtm and m.codtipomov=new.codtipomov INTO ICODMODNOTA;
          --execute procedure sgdebugsp 'cpcompratgbu', 'PEGOU O MODELO DE NOTA:'||:ICODMODNOTA;
          --IF(:ICODMODNOTA=55) THEN
         -- BEGIN
              --execute procedure sgdebugsp 'cpcompratgbu', 'ENTROU O MODELO DA NOTA  IGUAL A 55:';
           --   execute procedure sggeracnfsp('CP', null,null,null,null,new.codemp, new.codfilial,new.codcompra);
          --END
        END
        ELSE IF ((new.STATUSCOMPRA IN ('P2','C2')) AND (old.STATUSCOMPRA IN ('P2','C2'))) THEN
        BEGIN
          DELETE FROM FNPAGAR WHERE CODCOMPRA=old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
          IF (dVlr > 0) THEN
            EXECUTE PROCEDURE FNADICPAGARSP01(new.CODCOMPRA,new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,
               new.CODEMPFR,new.CODFILIALFR,new.CODFOR,:dVLR,:DTBASE , new.DTCOMPCOMPRA, new.DOCCOMPRA,
               new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,new.FLAG,new.CODEMP,new.CODFILIAL,
               new.CODEMPTC, new.CODFILIALTC, new.CODTIPOCOB,
               new.codempct, new.codfilialct, new.numconta, new.codempcc,  new.codfilialcc, new.anocc, new.codcc, new.codemppn, new.codfilialpn, new.codplan, new.anoplan, new.obspag );
        END
        ELSE IF ((new.STATUSCOMPRA IN ('P3','C3')) AND (old.STATUSCOMPRA IN ('P3','C3'))) THEN
        BEGIN
          DELETE FROM FNPAGAR WHERE CODCOMPRA=old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL = :IFILIALPAG;
          IF (dVlr > 0) THEN
            EXECUTE PROCEDURE FNADICPAGARSP01(new.CODCOMPRA, new.CODEMPPG, new.CODFILIALPG, new.CODPLANOPAG,
               new.CODEMPFR, new.CODFILIALFR, new.CODFOR, :dVLR, :DTBASE, new.DTCOMPCOMPRA, new.DOCCOMPRA,
               new.CODEMPBO, new.CODFILIALBO, new.CODBANCO, new.FLAG, new.CODEMP, new.CODFILIAL,
               new.CODEMPTC, new.CODFILIALTC, new.CODTIPOCOB,
               new.codempct, new.codfilialct, new.numconta, new.codempcc,  new.codfilialcc, new.anocc, new.codcc, new.codemppn, new.codfilialpn, new.codplan, new.anoplan, new.obspag);
        END
      END
    /**
     Movimento do estoque
    **/
    /* Avisa os itens que a data de saida foi alterada */
      IF ( (new.DTENTCOMPRA != old.DTENTCOMPRA) OR
           (new.DTEMITCOMPRA != old.DTEMITCOMPRA) OR
           (new.DOCCOMPRA != old.DOCCOMPRA) OR
           (new.CODTIPOMOV != old.CODTIPOMOV) )  THEN
        UPDATE CPITCOMPRA SET CODITCOMPRA=CODITCOMPRA WHERE
             CODCOMPRA = old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;

      IF ( new.codimp is null and (((new.VLRFRETECOMPRA > 0) AND ( NOT new.VLRFRETECOMPRA = old.VLRFRETECOMPRA)) or ((new.vlradiccompra > 0) AND ( NOT new.vlradiccompra = old.vlradiccompra)))  ) THEN
      BEGIN
          FOR SELECT IT.CODITCOMPRA, IT.VLRLIQITCOMPRA, IT.QTDITCOMPRA FROM CPITCOMPRA IT
              WHERE IT.CODEMP=new.CODEMP AND IT.CODFILIAL=new.CODFILIAL AND IT.CODCOMPRA=new.CODCOMPRA
              INTO :ICODITEM, :VLRITEM, :QTDITEM
              DO
              BEGIN

                  IF ( (new.vlrfretecompra > 0) AND ( NOT new.vlrfretecompra = old.vlrfretecompra)  ) THEN
                  begin
                      PERCITFRETE = :VLRITEM / (old.VLRLIQCOMPRA / 100);
                      VLRITFRETE =  cast((:PERCITFRETE * (new.VLRFRETECOMPRA / 100)) / COALESCE(:QTDITEM, 1) as decimal(15,2));

                      UPDATE CPITCOMPRA CIT
                          SET VLRFRETEITCOMPRA=:VLRITFRETE
                            WHERE CIT.CODEMP=new.CODEMP AND CIT.CODFILIAL=new.CODFILIAL
                                AND CIT.CODCOMPRA=new.CODCOMPRA AND CIT.CODITCOMPRA=:ICODITEM;
                  end
                  IF ( (new.vlradiccompra > 0) AND ( NOT new.vlradiccompra = old.vlradiccompra)  ) THEN
                  begin
                      PERCITADIC = :VLRITEM / (old.VLRLIQCOMPRA / 100);
                      VLRITADIC =  (:PERCITADIC * (new.VLRADICCOMPRA / 100)) / COALESCE(:QTDITEM, 1);
                      UPDATE CPITCOMPRA CIT
                          SET VLRADICITCOMPRA=:VLRITADIC
                            WHERE CIT.CODEMP=new.CODEMP AND CIT.CODFILIAL=new.CODFILIAL
                                AND CIT.CODCOMPRA=new.CODCOMPRA AND CIT.CODITCOMPRA=:ICODITEM;

                  end


              END
        END
          IF ((substr(new.STATUSCOMPRA,1,1) IN ('X','N')) AND (substr(old.STATUSCOMPRA,1,1) IN ('P','C'))) THEN
          BEGIN
              UPDATE CPITCOMPRA SET QTDITCOMPRACANC=QTDITCOMPRA, QTDITCOMPRA=0 WHERE CODCOMPRA=new.CODCOMPRA AND CODEMP=new.CODEMP
              AND CODFILIAL=new.CODFILIAL;
              DELETE FROM FNPAGAR WHERE CODCOMPRA=new.CODCOMPRA AND CODEMP=new.CODEMP
              AND CODFILIAL=new.CODFILIAL;
          END

        -- Atualizao do status do recebimento da mercadoria quando a nota for emitida.
        if( old.statuscompra!='ET' and new.statuscompra='ET') then
        begin
            
           update eqrecmerc rm set rm.status='NE'
           where rm.codemp=new.codemp and rm.codfilial=new.codfilial
           and rm.ticket in
           (
            select ticket
            from eqitrecmercitcp rm
            where rm.codempcp=new.codemp and rm.codfilialcp=new.codfilial
            and rm.codcompra=new.codcompra
           );

        end

    END
END
^

/* Alter exist trigger... */
ALTER TRIGGER CPCOMPRATGBI
AS
  DECLARE VARIABLE IFILIALTIPOMOV INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'EQTIPOMOV') INTO IFILIALTIPOMOV;
  SELECT T.FISCALTIPOMOV FROM EQTIPOMOV T WHERE T.CODTIPOMOV=new.CODTIPOMOV
         AND T.CODEMP=new.CODEMP AND T.CODFILIAL=:IFILIALTIPOMOV INTO new.FLAG;
  IF ( new.FLAG <> 'S') THEN
  BEGIN
    new.FLAG = 'N';
  END
  new.STATUSCOMPRA = 'P1';
  if (new.vlrprodcompra is null) then new.vlrprodcompra = 0;
  if (new.vlrdesccompra is null) then new.vlrdesccompra = 0;
  if (new.vlrdescitcompra is null) then new.vlrdescitcompra = 0;
  if (new.vlrcompra is null) then new.vlrcompra = 0;
  if (new.vlrbaseicmscompra is null) then new.vlrbaseicmscompra = 0;
  if (new.vlricmscompra is null) then new.vlricmscompra = 0;
  if (new.vlrisentascompra is null) then new.vlrisentascompra = 0;
  if (new.vlroutrascompra is null) then new.vlroutrascompra = 0;
  if (new.vlrbaseipicompra is null) then new.vlrbaseipicompra = 0;
  if (new.vlripicompra is null) then new.vlripicompra = 0;
  if (new.vlrliqcompra is null) then new.vlrliqcompra = 0;
  if (new.vlrfretecompra is null) then new.vlrfretecompra = 0;
  if (new.vlradiccompra is null) then new.vlradiccompra = 0;
  if (new.vlrbasepiscompra is null) then new.vlrbasepiscompra = 0;
  if (new.vlrbasecofinscompra is null) then new.vlrbasecofinscompra = 0;
  if (new.vlrpiscompra is null) then new.vlrpiscompra = 0;
  if (new.vlrcofinscompra is null) then new.vlrcofinscompra = 0;
  if (new.vlrfunruralcompra is null) then new.vlrfunruralcompra = 0;
  if (new.vlrbaseiicompra is null) then new.vlrbaseiicompra = 0;
  if (new.vlriicompra is null) then new.vlriicompra = 0;
  if (new.vlricmsdiferido is null) then new.vlricmsdiferido = 0;
  if (new.vlricmscredor is null) then new.vlricmscredor = 0;
  if (new.vlricmscredpresum is null) then new.vlricmscredpresum = 0;
  if (new.sitdoc is null) then new.sitdoc='00';
  if (new.dtcompcompra is null) then new.dtcompcompra = new.dtemitcompra;

END
^

/* Alter exist trigger... */
ALTER TRIGGER CPCOMPRATGBU
AS
  DECLARE VARIABLE dVlrPagar NUMERIC(15, 5);
  DECLARE VARIABLE sStatusPag CHAR(2);
  DECLARE VARIABLE IFILIALTIPOMOV INTEGER;
  DECLARE VARIABLE IFILIALPAG INTEGER;
  DECLARE VARIABLE CSEQNFTIPOMOV CHAR(1);
  DECLARE VARIABLE TIPOMODNOTA CHAR(1);
BEGIN
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  if (new.BLOQCOMPRA IS NULL) then
     new.BLOQCOMPRA='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      if ( (old.BLOQCOMPRA IS NOT NULL AND old.BLOQCOMPRA='S') or (new.BLOQCOMPRA='S') ) then
         EXCEPTION CPCOMPRAEX04 'ESTA COMPRA EST BLOQUEADA!!!';
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
      if ( (new.DTCOMPCOMPRA IS NULL) OR (new.DTEMITCOMPRA<>old.DTEMITCOMPRA) )  then
         new.DTCOMPCOMPRA = new.DTEMITCOMPRA;
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'EQTIPOMOV') INTO IFILIALTIPOMOV;
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPAGAR') INTO IFILIALPAG;
      SELECT T.FISCALTIPOMOV, T.SEQNFTIPOMOV FROM EQTIPOMOV T WHERE T.CODTIPOMOV=new.CODTIPOMOV
             AND T.CODEMP=new.CODEMP AND T.CODFILIAL = :IFILIALTIPOMOV INTO new.FLAG, :CSEQNFTIPOMOV;
      IF (old.IMPNOTACOMPRA IS NULL) THEN
         new.IMPNOTACOMPRA = 'N';
      IF ( (CSEQNFTIPOMOV IS NOT NULL) AND (CSEQNFTIPOMOV='S') ) THEN
      BEGIN
         IF  (new.IMPNOTACOMPRA='N') THEN
         BEGIN
            SELECT DOC FROM LFNOVODOCSP(new.Serie,new.CODEMPSE,new.CODFILIALSE) INTO new.DocCompra;
            new.IMPNOTACOMPRA = 'S';
         END
         ELSE IF (old.DOCCOMPRA != new.DOCCOMPRA) THEN
         BEGIN
            new.DOCCOMPRA = old.DOCCOMPRA;
         END
      END

      IF ( new.FLAG <> 'S') THEN
      BEGIN
        new.FLAG = 'N';
      END
      IF (new.VLRDESCCOMPRA IS NULL) THEN
        new.VLRDESCCOMPRA = 0;
      IF (new.VLRADICCOMPRA IS NULL) THEN
        new.VLRADICCOMPRA = 0;
      IF (new.VLRFRETECOMPRA IS NULL) THEN
        new.VLRFRETECOMPRA = 0;
      IF (old.STATUSCOMPRA = 'P1')  THEN
      BEGIN
        IF (new.STATUSCOMPRA = 'C1') THEN
        BEGIN
          new.STATUSCOMPRA = 'C2';
        END
      END
      ELSE IF ((old.STATUSCOMPRA IN ('P4','C4')) AND (new.STATUSCOMPRA IN ('P4','C4'))) THEN
      BEGIN
        EXCEPTION CPCOMPRAEX03;
      END
      ELSE IF ((old.STATUSCOMPRA IN ('P2','C2')) AND (new.STATUSCOMPRA IN ('P3','C3'))) THEN
      BEGIN
        SELECT STATUSPAG,VLRPARCPAG FROM FNPAGAR WHERE CODCOMPRA=new.CODCOMPRA
             AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALPAG INTO :sStatusPag,:dVlrPagar;
        IF ((sStatusPag = 'PD') AND (new.VLRLIQCOMPRA != :dVlrPagar)) THEN
          EXCEPTION CPCOMPRAEX04;
      END
       IF ((substr(old.STATUSCOMPRA,1,1) IN ('P','C')) AND (substr(new.STATUSCOMPRA,1,1) IN ('X','N') )) THEN
      BEGIN
           new.vlrdescitcompra = 0;
           new.vlrprodcompra = 0;
           new.vlrbaseicmscompra = 0;
           new.vlricmscompra = 0;
           new.vlrisentascompra = 0;
           new.vlroutrascompra = 0;
           new.vlrbaseipicompra = 0;
           new.vlripicompra = 0;
           new.vlrliqcompra = 0;
           new.vlripicompra = 0;
      END
      if (coalesce(new.cnf,0)=0) then
      begin
         select mn.tipomodnota from eqtipomov tm, lfmodnota mn
            where mn.codemp=tm.codempmn and mn.codfilial=tm.codfilialmn and mn.codmodnota=tm.codmodnota
            and tm.codemp=new.codemptm and tm.codfilial=new.codfilialtm and tm.codtipomov=new.codtipomov
            into :tipomodnota;
         if (coalesce(tipomodnota,'')='E') then
         begin 
             select cnf from sggeracnfsp('CP', null,null,null,null,new.codemp, new.codfilial,new.codcompra) into new.cnf;
         end
      end

  END
    -- Atualizando o status do documento fiscal para 02 - Documento cancelado, quando nota for cancelado pelo sistema.
  IF (substr(new.statuscompra,1,1) in ('X','N') and new.sitdoc!='02') THEN
  begin
    new.sitdoc = '02';
  end

  if(old.chavenfecompra is null and new.chavenfecompra is not null) then
  begin
    new.emmanut = 'N';
  end

END
^

/* Alter exist trigger... */
ALTER TRIGGER CPCOTACAOTGAIAU001
AS
DECLARE VARIABLE NUMITENS INTEGER;
DECLARE VARIABLE NUMITENSAF INTEGER;
DECLARE VARIABLE NUMITENSAP INTEGER;
DECLARE VARIABLE NUMITENSNA INTEGER;
DECLARE VARIABLE NUMITENSAT INTEGER;
DECLARE VARIABLE NUMITENSEF INTEGER;
DECLARE VARIABLE NUMITENSCA INTEGER;
begin
  if (old.sititsol!='AF') then
  begin
      select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol into :numitens;
      select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitcompitsol='EF' into :numitensef;
      select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and new.sititsol='CA' into :numitensca;
      if (:numitens=:numitensef) then
      begin
        update cpitsolicitacao set sititsol='EF' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sititsol!='EF';
      end
      else if (:numitens=:numitensca) then
      begin
        update cpitsolicitacao set sititsol='CA' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sititsol!='CA';
      end
      if (new.qtdaprovcot!=old.qtdaprovcot) then
      begin
          if (new.qtdaprovcot>0) then
          begin
              update cpitsolicitacao set sititsol='EA' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sititsol='PE';
              select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitaprovitsol='AP' into :numitensap;
              select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitaprovitsol='NA' into :numitensna;
              select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitaprovitsol='AT' into :numitensat;
              if(:numitens!=:numitensaf) then
              begin
                if(:numitens=:numitensat) then
                begin
                   update cpitsolicitacao set sitcompitsol='CT' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitcompitsol!='CT';
                end
                else if((:numitensap>0) or (:numitensna>0)) then
                begin
                   update cpitsolicitacao set sitcompitsol='CP' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitcompitsol!='CP';
                end
                if(:numitens=:numitensna) then
                begin
                   update cpitsolicitacao set sitcompitsol='NA' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitcompitsol!='NA';
                end
              end
          end
      end
  end
  else if (old.sititsol!='EF') then
  begin
      select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol into :numitens;
      select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sititsol='EF' into :numitensef;
      if (:numitens=:numitensef) then
      begin
        update cpitsolicitacao set sititsol='EF' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sititsol!='EF';
      end
  end
  -- Implementao intil pois no  possivel atribuir falor em atributo "new"
/*  SELECT sititsol FROM cpitsolicitacao
      WHERE CODEMP=new.codemp AND CODFILIAL=new.codfilial and coditsol=new.coditsol and codsol=new.codsol
      INTO new.sititsol;*/
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPCOTTGBIBU
AS
  declare variable statusitem char(2);
begin
  if (old.sititsol!='AF') then
  begin
      if (new.qtdaprovcot!=old.qtdaprovcot or (NEW.sitaprovitsol='AT') ) then
      begin
          if ((new.sitaprovitsol='AT') and (new.qtdaprovcot=0) and (old.sitaprovitsol!='AT')) then
          begin
            new.qtdaprovcot=new.qtdcot;
          end
          if (new.qtdaprovcot>0) then
          begin
            if (new.qtdaprovcot<new.qtdcot) then
            begin
                statusitem = 'AP';
            end
            else
            begin
                statusitem = 'AT';
            end
          new.sitaprovitsol=:statusitem;
          if(new.sititsol='PE') then
          begin
              new.sititsol='EA';
          end
        end
      end
  end
  if(new.sititsol='CA') then
  begin
    new.qtdaprovcot=0;
    new.sitaprovitsol='NA';
  end

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPFORNECEDTGBU
as
  declare variable nomemunicfor CHAR(30);
begin
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT = cast('now' AS TIME);

    /*Atualizao do campo cidade e estado (temporrio para retro-compatibilidade)*/

    if(old.codmunic != new.codmunic) then
    begin
        select substr(mun.nomemunic,1,30) from sgmunicipio mun
            where mun.codpais=new.codpais and mun.siglauf=new.siglauf and mun.codmunic=new.codmunic
                into :nomemunicfor;
        if (nomemunicfor is not null) then new.cidfor = nomemunicfor;
    end

    if(new.siglauf is not null) then
    begin
        new.uffor=new.siglauf;
    end

    /* Fim da atualizao do campo cidade */

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPFRETECPTGAI
as

declare variable vlrliqcompra numeric(9,2);

begin

    select vlrliqcompra from cpcompra
    where codcompra=new.codcompra and codemp=new.codemp and codfilial=new.codfilial
    into vlrliqcompra;

    if (not vlrliqcompra is null and vlrliqcompra > 0 and not new.perccomprafretecp > 0) then
    begin
        new.perccomprafretecp = (new.vlrfretecp/:vlrliqcompra) * 100;
    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPFRETECPTGBU
as

declare variable vlrliqcompra numeric(9,2);

begin

    new.dtalt = cast('now' as date);
    new.idusualt = user;
    new.halt = cast('now' as time);

    select vlrliqcompra from cpcompra
    where codcompra=new.codcompra and codemp=new.codemp and codfilial=new.codfilial
    into vlrliqcompra;

    if (not vlrliqcompra is null and vlrliqcompra > 0 and not new.perccomprafretecp > 0) then
    begin
        new.perccomprafretecp = (new.vlrfretecp/:vlrliqcompra)*100;
    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPIMPORTACAOTGBI
AS
begin

    -- Convertendo valores em moeda corrente / estrangeira
  if ( ( new.emmanut is null ) or ( new.emmanut='N' ) ) then
  begin
    new.vlrfrete    =   cast(new.vlrfretemi      *   new.cotacaomoeda as decimal(15,2));
    new.vlrseguro   =   cast(new.vlrseguromi     *   new.cotacaomoeda as decimal(15,2));
    new.vlrthcmi    =   cast(new.vlrthc          /   new.cotacaomoeda as decimal(15,2));
  end


end
^

/* Alter exist trigger... */
ALTER TRIGGER CPIMPORTACAOTGBU
as
begin
  if (new.emmanut is null) then
     new.emmanut='N';
  if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null)) ) ) then
  begin

    new.dtalt=cast('now' as date);
    new.idusualt=user;
    new.halt = cast('now' as time);

    -- No permitindo valores negativos
    if (new.pesobruto       < 0) then new.pesobruto     = 0;
    if (new.pesoliquido     < 0) then new.pesoliquido   = 0;
    if (new.vmlemi          < 0) then new.pesobruto     = 0;
    if (new.vmldmi          < 0) then new.pesobruto     = 0;
    if (new.vlrii           < 0) then new.pesobruto     = 0;
    if (new.vlripi          < 0) then new.pesobruto     = 0;
    if (new.vlrpis          < 0) then new.pesobruto     = 0;
    if (new.vlrcofins       < 0) then new.pesobruto     = 0;
    if (new.vlrtxsiscomex   < 0) then new.pesobruto     = 0;

    -- Convertendo valores em moeda corrente / estrangeira
    if( (old.cotacaomoeda != new.cotacaomoeda) or (old.vlrfretemi != new.vlrfretemi) or (old.vlrseguromi != new.vlrseguromi) or (old.vlrthc != new.vlrthc) ) then
    begin
        new.vlrfrete    =  cast( new.vlrfretemi      *   new.cotacaomoeda as decimal(15,2));
        new.vlrseguro   =   cast(new.vlrseguromi     *   new.cotacaomoeda as decimal(15,2));
        new.vlrthcmi    =   cast(new.vlrthc          /   new.cotacaomoeda as decimal(15,2));
    end

  end
  
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITCOMPRASERIETGBU
as
    declare variable temserie smallint;
begin
    -- Atualizando log
    new.DTALT=cast('now' as date);
    new.IDUSUALT=USER;
    new.HALT = cast('now' as time);

    -- Verificando se foi inserido um numero de srie
    if(old.numserie is null and new.numserie is not null) then
    begin
        -- Verificando se o nmero de srie informado, j existe.
        select count(*) from eqserie sr
        where sr.codemp = new.codemppd and sr.codfilial = new.codfilialpd and sr.codprod = new.codprod and sr.numserie = new.numserie
        into :temserie;

        -- se o nmero de srie informado no existe, deve inseri-lo;
        if (temserie = 0) then
        begin
            insert into eqserie (codemp, codfilial, codprod, numserie)
            values(new.codemppd, new.codfilialpd, new.codprod, new.numserie);
        end

    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITCOMPRATGAD
as

declare variable ddtcompra date;
declare variable cflag char(1);
declare variable idoccompra integer;
declare variable icodemptm integer;
declare variable scodfilialtm smallint;
declare variable icodtipomov integer;
begin
    -- Se no estifver em manuteno...
    if ( not ( (old.emmanut='S') and (old.emmanut is not null) ) ) then
    begin
        -- Atualizando cabealho da compra
        update cpcompra cp set
            cp.vlrdescitcompra = cp.vlrdescitcompra - old.vlrdescitcompra,
            cp.vlrprodcompra = cp.vlrprodcompra - old.vlrproditcompra,
            cp.vlrbaseicmscompra = cp.vlrbaseicmscompra - old.vlrbaseicmsitcompra,
            cp.vlricmscompra = cp.vlricmscompra - old.vlricmsitcompra,
            -- Icms substituio tributria
            cp.vlrbaseicmsstcompra = coalesce(cp.vlrbaseicmsstcompra,0) - coalesce(old.vlrbaseicmsstitcompra,0),
            cp.vlricmsstcompra = coalesce(cp.vlricmsstcompra,0) - coalesce(old.vlricmsstitcompra,0),

            cp.vlrisentascompra = cp.vlrisentascompra - old.vlrisentasitcompra,
            cp.vlroutrascompra = cp.vlroutrascompra - old.vlroutrasitcompra,
            cp.vlrbaseipicompra = cp.vlrbaseipicompra - old.vlrbaseipiitcompra,
            cp.vlripicompra = cp.vlripicompra - old.vlripiitcompra,
            cp.vlrliqcompra = cp.vlrliqcompra - old.vlrliqitcompra,
            cp.vlrfunruralcompra = cp.vlrfunruralcompra - old.vlrfunruralitcompra,
            cp.vlrfretecompra = cp.vlrfretecompra - old.vlrfreteitcompra,
            cp.vlradiccompra = cp.vlradiccompra - old.vlradicitcompra,
            cp.vlricmsdiferido = cp.vlricmsdiferido - old.vlricmsdiferido,
            cp.vlricmscredor = cp.vlricmscredor - old.vlricmscredor
        where codcompra=old.codcompra and codemp=old.codemp and codfilial=old.codfilial;
        -- Buscando informaes do cabeaho da compra
        select c.dtentcompra, c.flag, c.doccompra, c.codemptm, c.codfilialtm, c.codtipomov
        from cpcompra c
        where c.codcompra=old.codcompra and c.codemp=old.codemp and c.codfilial=old.codfilial
        into :ddtcompra, :cflag, :idoccompra, :icodemptm, :scodfilialtm, :icodtipomov;
        -- Atualizando movimentao de estoque
        execute procedure eqmovprodiudsp('D', old.codemppd, old.codfilialpd, old.codprod,
        old.codemple, old.codfilialle, old.codlote, :icodemptm, :scodfilialtm, :icodtipomov,
        null, null, null, old.codemp, old.codfilial, old.codcompra, old.coditcompra,
        null, null, null, null, null, null, null, null, null, null, null, null, null, null, old.codempnt,
        old.codfilialnt, old.codnat, :ddtcompra, :idoccompra, :cflag, old.qtditcompra, old.custoitcompra,
        old.codempax, old.codfilialax, old.codalmox, null, 'S', old.tiponfitcompra);
    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITCOMPRATGAI
as
    declare variable dtcompra date;
    declare variable flag char(1);
    declare variable doccompra integer;
    declare variable codemptm integer;
    declare variable codfilialtm smallint;
    declare variable codtipomov integer;
    declare variable calctrib char(1);

begin
    -- Buscando informaes do cabealho da compra
    select c.dtentcompra, c.flag, c.doccompra, c.codemptm, c.codfilialtm, c.codtipomov
    , (case when tm.calcimpcp='S' or c.calctrib='S' then 'S' else 'N' end) calctrib
    from cpcompra c
    inner join eqtipomov tm
    on tm.codemp=c.codemptm and tm.codfilial=c.codfilialtm and tm.codtipomov=c.codtipomov
    where c.codcompra = new.codcompra and c.codemp = new.codemp and c.codfilial = new.codfilial
    into :dtcompra, :flag, :doccompra, :codemptm, :codfilialtm, :codtipomov, :calctrib;
    -- Executando procedure para movimentao de produto
    execute procedure eqmovprodiudsp (
        'I', new.codemppd, new.codfilialpd, new.codprod, new.codemple, new.codfilialle, new.codlote,
        :codemptm, :codfilialtm, :codtipomov, null, null, null, new.codemp, new.codfilial, new.codcompra, new.coditcompra,
        null, null, null, null, null, null, null, null, null, null, null, null, null, null, new.codempnt, new.codfilialnt, new.codnat,
        :dtcompra, :doccompra, :flag, new.qtditcompra, new.custoitcompra, new.codempax, new.codfilialax, new.codalmox, null, 'S', new.tiponfitcompra
    );
    -- Executa procedure de gerao de tabela de vinculo para numeros de serie
    execute procedure cpitcompraseriesp('I', new.codemp, new.codfilial, new.codcompra, new.coditcompra, new.codemppd, new.codfilialpd, new.codprod, new.numserietmp, new.qtditcompra);
    -- Gerando tabela de informaes fiscais adicionais (lfitcompra)
    if(calctrib='S') then
    begin
       -- Inserindo registros na tabela de informaes fiscais complementares (LFITCOMPRA)
        execute procedure lfgeralfitcomprasp(new.codemp, new.codfilial, new.codcompra, new.coditcompra);
    end
    -- Atualizando cabealho da compra
    update cpcompra cp set
    cp.vlrfretecompra = cp.vlrfretecompra + new.vlrfreteitcompra,
    cp.vlradiccompra = cp.vlradiccompra + new.vlradicitcompra,
    cp.vlricmsdiferido = cp.vlricmsdiferido + new.vlricmsdiferido,
    cp.vlricmscredor = cp.vlricmscredor + new.vlricmscredor
    where cp.codcompra=new.codcompra and cp.codemp=new.codemp and cp.codfilial=new.codfilial;
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITCOMPRATGAU
as

declare variable ddtcompra date;
declare variable cflag char(1);
declare variable idoccompra integer;
declare variable icodemptm integer;
declare variable scodfilialtm smallint;
declare variable icodtipomov integer;
declare variable calctrib char(1);
declare variable codimp integer;
begin
    -- Se no estiver em manuteno...
    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) ) ) ) then
    begin
        -- Buscando informaes da compra
        select c.dtentcompra, c.flag, c.doccompra, c.codemptm, c.codfilialtm, c.codtipomov
        , (case when tm.calcimpcp='S' or c.calctrib='S' then 'S' else 'N' end) calctrib
        , c.codimp
        from cpcompra c
        inner join eqtipomov tm
        on tm.codemp=c.codemptm and tm.codfilial=c.codfilialtm and tm.codtipomov=c.codtipomov
        where c.codcompra = new.codcompra and c.codemp=new.codemp and c.codfilial = new.codfilial
        into :ddtcompra, :cflag, :idoccompra, :icodemptm, :scodfilialtm, :icodtipomov, :calctrib, :codimp;
        if(:codimp is null) then
        begin
            -- Atualizando cabealho da compra (no atualiza frete para no entrar em loop);
            update cpcompra cp set
                cp.vlrdescitcompra = cp.vlrdescitcompra -old.vlrdescitcompra + new.vlrdescitcompra,
                cp.vlrprodcompra = cp.vlrprodcompra - old.vlrproditcompra + new.vlrproditcompra,
                cp.vlrbaseicmscompra = cp.vlrbaseicmscompra - old.vlrbaseicmsitcompra + new.vlrbaseicmsitcompra,
                cp.vlricmscompra = cp.vlricmscompra -old.vlricmsitcompra + new.vlricmsitcompra,
                -- Icms substituio tributria
                cp.vlrbaseicmsstcompra = cp.vlrbaseicmsstcompra - old.vlrbaseicmsstitcompra + new.vlrbaseicmsstitcompra,
                cp.vlricmsstcompra = cp.vlricmsstcompra -old.vlricmsstitcompra + new.vlricmsstitcompra,
                cp.vlrisentascompra = cp.vlrisentascompra - old.vlrisentasitcompra + new.vlrisentasitcompra,
                cp.vlroutrascompra = cp.vlroutrascompra - old.vlroutrasitcompra + new.vlroutrasitcompra,
                cp.vlrbaseipicompra = cp.vlrbaseipicompra - old.vlrbaseipiitcompra + new.vlrbaseipiitcompra,
                cp.vlripicompra = cp.vlripicompra - old.vlripiitcompra + new.vlripiitcompra,
                cp.vlrliqcompra = cp.vlrliqcompra - old.vlrliqitcompra + new.vlrliqitcompra,
                cp.vlrfunruralcompra = cp.vlrfunruralcompra - old.vlrfunruralitcompra + new.vlrfunruralitcompra,
                cp.vlricmsdiferido = cp.vlricmsdiferido - old.vlricmsdiferido + new.vlricmsdiferido,
                cp.vlricmscredor = cp.vlricmscredor - old.vlricmscredor + new.vlricmscredor
            where cp.codcompra=new.codcompra and cp.codemp=new.codemp and cp.codfilial=new.codfilial and cp.codimp is null;
        end
        else
        begin
            -- Atualizando cabealho da compra (atualiza o frete);
            update cpcompra cp set
                cp.vlrdescitcompra = cp.vlrdescitcompra -old.vlrdescitcompra + new.vlrdescitcompra,
                cp.vlrprodcompra = cp.vlrprodcompra - old.vlrproditcompra + new.vlrproditcompra,
                cp.vlrbaseicmscompra = cp.vlrbaseicmscompra - old.vlrbaseicmsitcompra + new.vlrbaseicmsitcompra,
                cp.vlricmscompra = cp.vlricmscompra -old.vlricmsitcompra + new.vlricmsitcompra,
                -- Icms substituio tributria
                cp.vlrbaseicmsstcompra = cp.vlrbaseicmsstcompra - old.vlrbaseicmsstitcompra + new.vlrbaseicmsstitcompra,
                cp.vlricmsstcompra = cp.vlricmsstcompra -old.vlricmsstitcompra + new.vlricmsstitcompra,
                cp.vlrisentascompra = cp.vlrisentascompra - old.vlrisentasitcompra + new.vlrisentasitcompra,
                cp.vlroutrascompra = cp.vlroutrascompra - old.vlroutrasitcompra + new.vlroutrasitcompra,
                cp.vlrbaseipicompra = cp.vlrbaseipicompra - old.vlrbaseipiitcompra + new.vlrbaseipiitcompra,
                cp.vlripicompra = cp.vlripicompra - old.vlripiitcompra + new.vlripiitcompra,
                cp.vlrliqcompra = cp.vlrliqcompra - old.vlrliqitcompra + new.vlrliqitcompra,
                cp.vlrfunruralcompra = cp.vlrfunruralcompra - old.vlrfunruralitcompra + new.vlrfunruralitcompra,
                cp.vlrfretecompra = cp.vlrfretecompra - old.vlrfreteitcompra + new.vlrfreteitcompra,
                cp.vlradiccompra = cp.vlradiccompra - old.vlradicitcompra + new.vlradicitcompra,
                cp.vlricmsdiferido = cp.vlricmsdiferido - old.vlricmsdiferido + new.vlricmsdiferido,
                cp.vlricmscredor = cp.vlricmscredor - old.vlricmscredor + new.vlricmscredor
            where cp.codcompra=new.codcompra and cp.codemp=new.codemp and cp.codfilial=new.codfilial and cp.codimp is not null;
        end
        -- Atualizando movimentao de estoque
        execute procedure eqmovprodiudsp('U', new.codemppd, new.codfilialpd, new.codprod,
        new.codemple, new.codfilialle, new.codlote, :icodemptm, :scodfilialtm, :icodtipomov, null, null, null,
        new.codemp, new.codfilial, new.codcompra, new.coditcompra, null, null, null, null, null, null, null, null,
        null, null, null, null, null, null, new.codempnt, new.codfilialnt, new.codnat, :ddtcompra, :idoccompra, :cflag,
        new.qtditcompra, new.custoitcompra, new.codempax, new.codfilialax, new.codalmox, null, 'S', new.tiponfitcompra);
        -- Executa procedure para atualizao de tabela de vinculo para numeros de serie
        execute procedure cpitcompraseriesp('U', old.codemp, old.codfilial, old.codcompra, old.coditcompra, old.codemppd, old.codfilialpd, old.codprod, new.numserietmp, new.qtditcompra);
        -- Gerando tabela de informaes fiscais adicionais (lfitcompra)
        if(calctrib='S') then
        begin
           -- Inserindo registros na tabela de informaes fiscais complementares (LFITCOMPRA)
            execute procedure lfgeralfitcomprasp(new.codemp, new.codfilial, new.codcompra, new.coditcompra);
        end
    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITCOMPRATGBD
AS
declare variable habconvcp char(1);
begin
    -- Buscando preferncias
    select p5.habconvcp from sgprefere5 p5
    where codemp=old.codemp and codfilial=old.codfilial
    into habconvcp;

    if(habconvcp='S') then
    begin
        update ppop op set op.sitop='CA', op.justificcanc='OP de converso: Item de compra excludo'
        where op.codempcp=old.codemp and op.codfilialcp=old.codfilial and op.codcompra=old.codcompra
        and op.coditcompra=old.coditcompra;
    end

    -- Executa procedure para excluso de tabela de vinculo para numeros de serie
    execute procedure cpitcompraseriesp('D', old.codemp, old.codfilial, old.codcompra, old.coditcompra, old.codemppd, old.codfilialpd, old.codprod, null, old.qtditcompra);

    -- Deleta vinculos com tabela de compra de compra
    delete from cpcompraped cp where cp.codemp=old.codemp and cp.codfilial=old.codfilial
    and cp.codcompra = old.codcompra and cp.coditcompra=old.coditcompra;


end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITCOMPRATGBI
as

declare variable srefprod varchar(20);
declare variable habcustocompra char(1);
declare variable calctrib char(1);
declare variable utilizatbcalcca char(1) ;
declare variable codempcc integer;
declare variable codfilialcc smallint;
declare variable codcalc integer;
declare variable codempcf integer;
declare variable codfilialcf smallint;
declare variable codcf integer;
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;



begin

    if (new.calccusto is null) then 
       new.calccusto = 'S';
    -- Buscando preferncias
    select p.custocompra, p.utilizatbcalcca from sgprefere1 p
    where p.codemp=new.codemp and p.codfilial=new.codfilial
    into :habCustoCompra, :utilizatbcalcca;
    if (utilizatbcalcca is null) then
       utilizatbcalcca = 'N';

    --Buscando informaes da compra
    select cp.calctrib from cpcompra cp
    where cp.codemp=new.codemp and cp.codfilial=new.codfilial and cp.codcompra=new.codcompra
    into :calctrib;

    -- Buscando referncia do produto
    select refprod from eqproduto
    where codprod=new.codprod and codemp=new.codemppd and codfilial=new.codfilialpd
    into srefprod;

    -- Carregando valores padro
    if (new.refprod is null) then new.refprod = srefprod;
    if (new.vlrdescitcompra is null) then new.vlrdescitcompra = 0;
    if (new.vlrbaseicmsitcompra is null) then new.vlrbaseicmsitcompra = 0;
    if (new.vlricmsitcompra is null) then new.vlricmsitcompra = 0;
    if (new.vlrbaseipiitcompra is null) then new.vlrbaseipiitcompra = 0;
    if (new.vlripiitcompra is null) then new.vlripiitcompra = 0;
    if (new.vlrliqitcompra is null) then new.vlrliqitcompra = 0;
    if (new.vlradicitcompra is null) then new.vlradicitcompra = 0;
    if (new.vlrfreteitcompra is null) then new.vlrfreteitcompra = 0;
    if (new.vlrbaseicmsstitcompra is null) then new.vlrbaseicmsstitcompra = 0;
    if (new.vlricmsstitcompra is null) then new.vlricmsstitcompra = 0;
    

    if(new.vlrliqitcompra=0) then
    begin
       new.vlrliqitcompra = (new.qtditcompra * new.precoitcompra) - new.vlrdescitcompra + new.vlradicitcompra;
    end

    -- Buscando e carregando almoxarifado do produto
    if (new.codalmox is null) then
    begin
        select codempax, codfilialax, codalmox from eqproduto
        where codemp=new.codemppd and codfilial=new.codfilialpd and codprod=new.codprod
        into new.codempax, new.codfilialax, new.codalmox;
    end

       -- Buscando e carregando reteno de tributos
    if(calctrib='S') then
    begin
        select coalesce(bc.vlrbasefunrural,0), coalesce(bc.aliqfunrural,0), coalesce(bc.vlrfunrural,0), bc.codempif, bc.codfilialif, bc.codfisc, bc.coditfisc
        from lfbuscatribcompra(new.codemp, new.codfilial, new.codcompra, new.codemppd, new.codfilialpd, new.codprod, new.vlrliqitcompra) bc
        into new.vlrbasefunruralitcompra, new.aliqfunruralitcompra, new.vlrfunruralitcompra,
        new.codempif, new.codfilialif, new.codfisc, new.coditfisc;
    end
    
    
    -- Descontando o valor do funrual do valor liquido do tem
    if( new.vlrfunruralitcompra > 0 ) then
    begin
        new.vlrliqitcompra = new.vlrliqitcompra - new.vlrfunruralitcompra;
    end
    
    
    -- Buscando e carregando custo do produto
    if ( ( ('N' = habCustoCompra) or (new.custoitcompra is null) ) and (new.calccusto='S') ) then
    begin
        if (utilizatbcalcca='N') then
        begin
            select nvlrcusto
            from cpcomprasp01(new.codemp, new.codfilial, new.qtditcompra, new.vlrliqitcompra
            , new.vlricmsitcompra,'N',0,'N',0)
            into new.custoitcompra;
        end
        else
        begin

            if (new.coditfisc is null) then
            begin
               select codempfr, codfilialfr, codfor, codemptm, codfilialtm, codtipomov
                  from cpcompra
                  where codemp=new.codemp and codfilial=new.codfilial and codcompra=new.codcompra
                  into :codempcf, :codfilialcf, :codcf, :codemptm, :codfilialtm, :codtipomov;

               select itfisc.codempif, itfisc.codfilialif, itfisc.codfisc, itfisc.coditfisc
                from lfbuscafiscalsp(new.codemppd, new.codfilial, new.codfilialpd, new.codprod, :codempcf, :codfilialcf, :codcf
                 , :codemptm, :codfilialtm, :codtipomov, 'CP', new.codnat, null, null, null, null) itfisc
               into new.codempif, new.codfilialif, new.codfisc, new.coditfisc;
            end

            select codempcc, codfilialcc, codcalc from lfitclfiscal itcl
              where itcl.codemp=new.codempif and itcl.codfilial=new.codfilialif and itcl.codfisc=new.codfisc and itcl.coditfisc=new.coditfisc
            into :codempcc, :codfilialcc, :codcalc ;

            select vlrcusto from lfcalccustosp01( :codempcc, :codfilialcc, :codcalc, new.qtditcompra, new.vlrproditcompra*new.qtditcompra
             , new.vlricmsitcompra, new.vlripiitcompra, 0, 0, new.vlrissitcompra, new.vlrfunruralitcompra
             , new.vlriiitcompra, 0, 0, 0, 0, 0 )
            into new.custoitcompra;

        end
    end

    new.calccusto = 'S';
    
    --Atualizando totais da compra
    update cpcompra cp set cp.vlrdescitcompra=cp.vlrdescitcompra + new.vlrdescitcompra,
    cp.vlrprodcompra = cp.vlrprodcompra + new.vlrproditcompra,
    cp.vlrbaseicmscompra = cp.vlrbaseicmscompra + new.vlrbaseicmsitcompra,
    cp.vlricmscompra = cp.vlricmscompra + new.vlricmsitcompra,
    -- Icms subtituio tributria
    cp.vlrbaseicmsstcompra = cp.vlrbaseicmsstcompra + new.vlrbaseicmsstitcompra,
    cp.vlricmsstcompra = cp.vlricmsstcompra + new.vlricmsstitcompra,
    -- 
    cp.vlrisentascompra = cp.vlrisentascompra + new.vlrisentasitcompra,
    cp.vlroutrascompra = cp.vlroutrascompra + new.vlroutrasitcompra,
    cp.vlrbaseipicompra = cp.vlrbaseipicompra + new.vlrbaseipiitcompra,
    cp.vlripicompra = cp.vlripicompra + new.vlripiitcompra,
    cp.vlrliqcompra = cp.vlrliqcompra + new.vlrliqitcompra,
    cp.vlrfunruralcompra = coalesce(cp.vlrfunruralcompra,0) + coalesce(new.vlrfunruralitcompra,0)
    where cp.codcompra=new.codcompra and cp.codemp=new.codemp and cp.codfilial=new.codfilial;

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITCOMPRATGBU
as
	declare variable srefprod varchar(20);
	declare variable sadicfrete char(1);
	declare variable sadicadic char(1);
	declare variable habcustocompra char(1);
	declare variable vlritcusto numeric(15, 5);
	declare variable statuscompra char(2);
	declare variable calctrib char(1);
	declare variable utilizatbcalcca char(1);
	declare variable codempcc integer;
	declare variable codfilialcc smallint;
	declare variable codcalc integer;
begin

    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
    begin

        if ( new.vlrbaseicmsstitcompra is null ) then new.vlrbaseicmsstitcompra=0;
        if (new.vlricmsstitcompra is null ) then new.vlricmsstitcompra=0;
        
        
        -- Atulizando log de alterao
        new.dtalt = cast('today' as date);
        new.idusualt = user;
        new.halt = cast('now' as time);

        -- No permite a alterao do produto
        if (new.codprod != old.codprod) then
        begin
            exception cpitcompraex01;
        end

        -- No permite a alterao do lote
        if (new.codlote != old.codlote) then
        begin
            exception cpitcompraex02;
        end

        -- Se o cdigo do almoxarifado estiver nulo, preenche como almoxarifado padro do produto
        if (new.codalmox is null) then
        begin
            select codempax, codfilialax, codalmox from eqproduto
            where codemp=new.codemppd and codfilial=new.codfilialpd and codprod=new.codprod
            into new.codempax, new.codfilialax, new.codalmox;
        end

        -- No permite a troca de almoxarifado
        if ( old.codalmox is not null and old.codalmox != new.codalmox ) then
        begin
            exception eqalmox01;
        end

        -- Busca referncia do produto
        select refprod from eqproduto
        where codprod=new.codprod and codemp=new.codemppd and codfilial=new.codfilialpd
        into srefprod;

        -- Busca informaes no cabealho da compra
        select adicfretecompra, adicadiccompra, statuscompra
        from cpcompra where
        codemp=new.codemp and codfilial=new.codfilial and codcompra=new.codcompra
        into :sadicfrete, :sadicadic, :statuscompra;

        /* Caso a nota no seja cancelada */
        if ((substr(:statuscompra,1,1) not in ('X','N'))) then
        begin
            vlritcusto = (new.vlrliqitcompra + coalesce(new.vlritoutrasdespitcompra,0))/(case when new.qtditcompra=0 then 1 else new.qtditcompra end);
            -- Buscando informaes das preferencias gerais
            select p.custocompra, p.utilizatbcalcca from sgprefere1 p
            where p.codemp=new.codemp and p.codfilial=new.codfilial
            into :habcustocompra, :utilizatbcalcca;
            --Buscando informaes da compra
            select cp.calctrib from cpcompra cp
            where cp.codemp=new.codemp and cp.codfilial=new.codfilial and cp.codcompra=new.codcompra
            into :calctrib;
            --  Atualizado a referencia do produto
            if (new.refprod is null) then
            begin
                new.refprod = srefprod;
            end
            -- Adicionando o frete ao valor de custo do item
            if (:sadicfrete = 'S' ) then
            begin
               vlritcusto = vlritcusto + new.vlrfreteitcompra;
            end
            -- Adiconando valores adicionais ao custo do item
            if (:sadicadic = 'S') then
            begin
                vlritcusto = vlritcusto + new.vlradicitcompra;
            end
            new.custoitcompra=:vlritcusto;
            -- Buscando e carregando reteno de tributos
            if(calctrib='S') then
            begin
                select coalesce(bc.vlrbasefunrural,0), coalesce(bc.aliqfunrural,0), coalesce(bc.vlrfunrural,0), bc.codempif, bc.codfilialif, bc.codfisc, bc.coditfisc
                from lfbuscatribcompra(new.codemp, new.codfilial, new.codcompra, new.codemppd, new.codfilialpd, new.codprod, new.vlrliqitcompra) bc
                into new.vlrbasefunruralitcompra, new.aliqfunruralitcompra, new.vlrfunruralitcompra,
                new.codempif, new.codfilialif, new.codfisc, new.coditfisc;
            end
            -- Descontando o valor do funrual do valor liquido do tem
            if( new.vlrfunruralitcompra > 0 ) then
            begin
                new.vlrliqitcompra = new.vlrliqitcompra - new.vlrfunruralitcompra;
            end
            -- Buscando e carregando custo do produto
            if ( ('N' = habCustoCompra) or (new.custoitcompra is null)) then
            begin
                if (utilizatbcalcca='N') then
                begin
                    select nvlrcusto+(coalesce(new.vlritoutrasdespitcompra,0)/(case when new.qtditcompra=0 then 1 else new.qtditcompra end)) 
                    from cpcomprasp01(new.codemp, new.codfilial, new.qtditcompra, new.vlrliqitcompra, new.vlricmsitcompra
                    , :sadicfrete, new.vlrfreteitcompra, :sadicadic, new.vlradicitcompra)
                    into new.custoitcompra;
                end
                else
                begin
                    select codempcc, codfilialcc, codcalc from lfitclfiscal itcl
                      where itcl.codemp=new.codempif and itcl.codfilial=new.codfilialif and itcl.codfisc=new.codfisc and itcl.coditfisc=new.coditfisc
                    into :codempcc, :codfilialcc, :codcalc ;
                    select vlrcusto+(coalesce(new.vlritoutrasdespitcompra,0)/(case when new.qtditcompra=0 then 1 else new.qtditcompra end))
                     from lfcalccustosp01( :codempcc, :codfilialcc, :codcalc, new.qtditcompra, new.vlrproditcompra*new.qtditcompra
                     , new.vlricmsitcompra, new.vlripiitcompra, 0, 0, new.vlrissitcompra, new.vlrfunruralitcompra
                     , new.vlriiitcompra, 0, 0, 0, 0, 0 )
                    into new.custoitcompra;
                end
            end
        end
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITIMPORTACAOTGAD
AS
begin

    -- Atualizando totais da importao

    update cpimportacao set

    pesobruto           =   pesobruto           -   old.pesobruto,
    pesoliquido         =   pesoliquido         -   old.pesoliquido,
    vmlemi              =   vmlemi              -   old.vmlemi,
    vmldmi              =   vmldmi              -   old.vmldmi,
    vmle                =   vmle                -   old.vmle,
    vmld                =   vmld                -   old.vmld,
    vlradmi             =   vlradmi             -   old.vlradmi,
    vlrad               =   vlrad               -   old.vlrad,
    vlrbaseicms         =   vlrbaseicms         -   old.vlrbaseicms,

    -- Tributos

    vlrii               =   vlrii               -   old.vlrii,
    vlripi              =   vlripi              -   old.vlripi,
    vlrpis              =   vlrpis              -   old.vlrpis,
    vlrcofins           =   vlrcofins           -   old.vlrcofins,
    vlrtxsiscomex       =   vlrtxsiscomex       -   old.vlrtxsiscomex,
    vlricms             =   vlricms             -   old.vlricms,
    vlricmsdiferido     =   vlricmsdiferido     -   old.vlricmsdiferido,
    vlricmsdevido       =   vlricmsdevido       -   old.vlricmsdevido,
    vlricmscredpresum   =   vlricmscredpresum   -   old.vlricmscredpresum,
    vlricmsrecolhimento =   vlricmsrecolhimento -   old.vlricmsrecolhimento


    where codemp=old.codemp and codfilial=old.codfilial and codimp=old.codimp;

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITIMPORTACAOTGAI
AS
begin
  if ( ( new.emmanut is null ) or ( new.emmanut='N' ) ) then
  begin
    -- Atualizando totais da importao
    update cpimportacao set
    pesobruto           =   pesobruto           +   new.pesobruto, 
    pesoliquido         =   pesoliquido         +   new.pesoliquido,
    vmlemi              =   vmlemi              +   new.vmlemi,
    vmldmi              =   vmldmi              +   new.vmldmi,
    vmle                =   vmle                +   new.vmle,
    vmld                =   vmld                +   new.vmld,
    vlradmi             =   vlradmi             +   new.vlradmi,
    vlrad               =   vlrad               +   new.vlrad,
    vlrbaseicms         =   vlrbaseicms         +   new.vlrbaseicms,
    -- Tributos
    vlrii               =   vlrii               +   new.vlrii,
    vlripi              =   vlripi              +   new.vlripi,
    vlrpis              =   vlrpis              +   new.vlrpis,
    vlrcofins           =   vlrcofins           +   new.vlrcofins,
    vlrtxsiscomex       =   vlrtxsiscomex       +   new.vlrtxsiscomex,
    vlricms             =   vlricms             +   new.vlricms,
    vlricmsdiferido     =   vlricmsdiferido     +   new.vlricmsdiferido,
    vlricmsdevido       =   vlricmsdevido       +   new.vlricmsdevido,
    vlricmscredpresum   =   vlricmscredpresum   +   new.vlricmscredpresum,
    vlricmsrecolhimento =   vlricmsrecolhimento +   new.vlricmsrecolhimento
    where codemp=new.codemp and codfilial=new.codfilial and codimp=new.codimp;
  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITIMPORTACAOTGAU
AS
begin

    -- Atualizando totais da importao
  if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null)) ) ) then
  begin

    update cpimportacao set

    pesobruto           = pesobruto         - old.pesobruto                 + new.pesobruto,
    pesoliquido         = pesoliquido       - old.pesoliquido               + new.pesoliquido,
    vmlemi              = vmlemi            - old.vmlemi                    + new.vmlemi,
    vmldmi              = vmldmi            - old.vmldmi                    + new.vmldmi,
    vmle                = vmle              - old.vmle                      + new.vmle,
    vmld                = vmld              - old.vmld                      + new.vmld,
    vlrad               = vlrad             - old.vlrad                     + new.vlrad,
    vlradmi             = vlradmi           - old.vlradmi                   + new.vlradmi,
    vlrbaseicms         = vlrbaseicms       - old.vlrbaseicms               + new.vlrbaseicms,

    -- Tributos

    vlrii               =   vlrii               -   old.vlrii               +   new.vlrii,
    vlripi              =   vlripi              -   old.vlripi              +   new.vlripi,
    vlrpis              =   vlrpis              -   old.vlrpis              +   new.vlrpis,
    vlrcofins           =   vlrcofins           -   old.vlrcofins           +   new.vlrcofins,
    vlrtxsiscomex       =   vlrtxsiscomex       -   old.vlrtxsiscomex       +   new.vlrtxsiscomex,
    vlricms             =   vlricms             -   old.vlricms             +   new.vlricms,
    vlricmsdiferido     =   vlricmsdiferido     -   old.vlricmsdiferido     +   new.vlricmsdiferido,
    vlricmsdevido       =   vlricmsdevido       -   old.vlricmsdevido       +   new.vlricmsdevido,
    vlricmscredpresum   =   vlricmscredpresum   -   old.vlricmscredpresum   +   new.vlricmscredpresum,
    vlricmsrecolhimento =   vlricmsrecolhimento -   old.vlricmsrecolhimento +   new.vlricmsrecolhimento

    where codemp=new.codemp and codfilial=new.codfilial and codimp=new.codimp;
    
 end

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITIMPORTACAOTGBI
AS
    declare variable cotacao numeric(15,5);
begin
    
  if ( ( new.emmanut is null ) or ( new.emmanut='N' ) ) then
  begin
    
    -- Buscando cotao da moeda de importao
    select imp.cotacaomoeda from cpimportacao imp where imp.codemp=new.codemp and imp.codfilial=new.codfilial and imp.codimp=new.codimp
    into :cotacao;

    -- Calculando VMLE , VMLD e VLRAD

    new.vmlemi      =   new.qtd         *       new.precomi;
    new.vmldmi      =   new.vmlemi      +       new.vlrfretemi;
    new.vlradmi     =   new.vmldmi      +       new.vlrthcmi;


    -- Calculando valores em moeda corrente
    new.preco       =   new.precomi     *       :cotacao;
    new.vmle        =   new.vmlemi      *       :cotacao;
    new.vmld        =   new.vmldmi      *       :cotacao;
    new.vlrfrete    =   new.vlrfretemi  *       :cotacao;
    new.vlrseguro   =   new.vlrseguromi *       :cotacao;
    new.vlrthc      =   new.vlrthcmi    *       :cotacao;
    new.vlrad       =   new.vlradmi     *       :cotacao;

    -- Calculando II

    new.vlrii       =   new.vlrad       *       new.aliqii  /   100.00;

    -- Gerando o nmero do sequencial de adio.
    select coalesce(count(*),0) + 1
    from cpitimportacao
    where codemp=new.codemp and codfilial=new.codfilial and codimp=new.codimp and codncm=new.codncm
    into new.seqadic;
    
  end
  
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITIMPORTACAOTGBU
as
    declare variable cotacao        decimal(15,5);

begin

  if (new.emmanut is null) then
     new.emmanut='N';
  if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null)) ) ) then
  begin

    -- Atualizando log
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT = cast('now' AS TIME);

    -- Buscando informaes do cabealho
    select imp.cotacaomoeda
    from cpimportacao imp where imp.codemp=new.codemp and imp.codfilial=new.codfilial and imp.codimp=new.codimp
    into :cotacao;

    -- Calculando VMLE e VMLD

    new.vmlemi      =  ( new.qtd         *       new.precomi ) + new.vlrthcmi ;
    new.vmldmi      =   new.vmlemi       +       new.vlrfretemi;
    new.vlradmi     =   new.vmldmi       ;
    new.vlrvmcv     =  ( new.qtd         *       new.precomi ) + new.vlrfretemi ;

    -- Calculando valores em moeda corrente
    new.preco       =   new.precomi     *       :cotacao;
    new.vmle        =   new.vmlemi      *       :cotacao;
    new.vmld        =   new.vmldmi      *       :cotacao;
    new.vlrfrete    =   new.vlrfretemi  *       :cotacao;
    new.vlrseguro   =   new.vlrseguromi *       :cotacao;
    new.vlrthc      =   new.vlrthcmi    *       :cotacao;
    new.vlrad       =   new.vlradmi     *       :cotacao;

    -- Calculando II

    new.vlrii       =   new.vlrad       *       new.aliqii  /   100.00;

    -- Calculando IPI

    new.vlripi      = cast(( new.vlrad       +       new.vlrii ) *  ( new.aliqipi /   100.00) as decimal(15,2));

    -- Calculando o ICMS

    new.vlrbaseicms         =  cast ( ( new.vlrad      +       new.vlrcofins      +   new.vlrpis   +     new.vlripi   + new.vlrii + new.vlrtxsiscomex + new.vlritdespad ) / (  cast(1.00 as decimal(15,5)) - (new.aliqicmsuf / 100.00) ) as decimal(15,2));

    new.vlricms             =   cast( new.vlrbaseicms *   cast( ( new.aliqicmsuf     / cast(100.00 as decimal(15,5)) ) as decimal(15,5)) as decimal(15,2));

    if(new.percdifericms > 0) then
        new.vlricmsdiferido     =   new.vlricms     *    cast(  ( new.percdifericms  / cast(100.00 as decimal(15,5)) ) as decimal(15,2));
    else
        new.vlricmsdiferido     =   0.00;

    new.vlricmsdevido       =   cast(new.vlricms     -       new.vlricmsdiferido as decimal(15,2));

    new.vlricmscredpresum   =   cast( new.vlrbaseicms *   cast( ( new.aliqicmsuf  / cast(100.00 as numeric(15,5) ) ) as decimal(15,5) ) as decimal(15,2)) ;
    
    new.vlricmscredpresum   =   cast(new.vlricmscredpresum - new.vlricmsdiferido as decimal(15,2));

    if (new.perccredpresimp<100) then
    begin
       new.vlricmscredpresum = new.vlricmscredpresum * cast(( new.perccredpresimp / cast(100.00 as numeric(15,5) ) ) as decimal(15,2)) ; 
    end

    new.vlricmsrecolhimento =   cast(new.vlricmsdevido   -   new.vlricmscredpresum as decimal(15,2));

    -- Gerando o nmero do sequencial de adio.
    if(old.codncm <> new.codncm) then
    begin
        select coalesce(count(*),0) + 1
        from cpitimportacao
        where codemp=new.codemp and codfilial=new.codfilial and codimp=new.codimp and codncm=new.codncm
        into new.seqadic;
    end
    
  end

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITSOLICITACAOTGBU
AS
     declare variable sRefProd VARChar(20);
     DECLARE VARIABLE ICODEMPUSU INT;
     declare variable ICODFILIALUSU smallint;
     declare variable IDUSU char(8);
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      new.IDUSUALT = USER;
      new.HALT = cast('now' AS TIME);
      IF (new.CODALMOX IS NULL) THEN
           SELECT CODEMPAX,CODFILIALAX,CODALMOX FROM EQPRODUTO WHERE
              CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD AND
              CODPROD=new.CODPROD
           INTO new.codempam, new.codfilialam,new.CODALMOX;
    
      IF (old.CODALMOX IS NOT NULL) THEN
      BEGIN
         IF (old.CODALMOX!=new.CODALMOX) THEN
             EXCEPTION EQALMOX01;
      END
      IF (new.CODPROD != old.CODPROD) THEN
         EXCEPTION CPITSOLICITACAOEX01;
      IF (new.REFPROD IS NULL) THEN
      BEGIN
           SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
                AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO sRefProd;
           new.REFPROD = sRefProd;
      END
      if((new.idusuaprovitsol is null) and (new.sititsol!=old.sititsol) and ((new.sititsol= 'AP') or (new.sititsol= 'AT') )) then
      begin
        SELECT CODEMPUSU,CODFILIALUSU,IDUSUS FROM sgretinfousu(new.CODEMP, USER) into :ICODEMPUSU,:ICODFILIALUSU,:IDUSU;
        new.codempua = :ICODEMPUSU;
        new.codfilialua = :ICODFILIALUSU;
        new.idusuaprovitsol = :IDUSU;
        new.dtaprovitsol = cast('now' AS DATE);
      end
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITSOLSTSOL
AS
  declare variable numitens int;
  declare variable numitensaf int;
  declare variable numitensap int;
  declare variable numitensna int;
  declare variable numitensat int;
  declare variable numitensef int;
  declare variable numitensca int;
  declare variable numitensep int;
  declare variable numitensne int;
  declare variable numitenset int;

begin

  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN

      if (old.sititsol!='AF') then
      begin
          select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol into :numitens;
          select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sititsol='AF' into :numitensaf;
          select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sititsol='EF' into :numitensef;
          select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sititsol='CA' into :numitensca;
          if(:numitens=:numitensaf) then
          begin
            update cpsolicitacao set sitsol='AF' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol!='AF';
          end
          else if (:numitens=:numitensef) then
          begin
            update cpsolicitacao set sitsol='EF' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol!='EF';
          end
          else if (:numitens=:numitensca) then
          begin
            update cpsolicitacao set sitsol='CA' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol!='CA';
          end
          if (new.qtdaprovitsol!=old.qtdaprovitsol) then
          begin
              if (new.qtdaprovitsol>0) then
              begin
                  update cpsolicitacao set sitsol='EA' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol='PE';
                  select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitaprovitsol='AP' into :numitensap;
                  select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitaprovitsol='NA' into :numitensna;
                  select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitaprovitsol='AT' into :numitensat;
                  if(:numitens!=:numitensaf) then
                  begin
                    if(:numitens=:numitensat) then
                    begin
                       update cpsolicitacao set sitsol='AT' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol!='AT';
                    end
                    else if((:numitensap>0) or (:numitensna>0)) then
                    begin
                       update cpsolicitacao set sitsol='AP' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol!='AP';
                    end
                    if(:numitens=:numitensna) then
                    begin
                       update cpsolicitacao set sitsol='NA' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol  and sitsol!='NA';
                    end
                  end
              end
          end
      end
      else if (old.sititsol!='EF') then
      begin
          select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol into :numitens;
          select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sititsol='EF' into :numitensef;
          if (:numitens=:numitensef) then
          begin
            update cpsolicitacao set sitsol='EF' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol!='EF';
          end
      end
        if(new.sititsol='EF')  then
        begin
          update cpcotacao set sititsol = 'EF' where codemp=new.codemp and codfilial=new.codfilial and codsol=new.codsol and coditsol=new.coditsol and sititsol!='EF';
        end
        if(new.sititsol='ET')  then
        begin
          update cpcotacao set sititsol = 'ET' where codemp=new.codemp and codfilial=new.codfilial and codsol=new.codsol and coditsol=new.coditsol and sitcompitsol!='ET';
        end
    END
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITSOLTGBI
AS
begin
  IF (new.CODALMOX IS NULL) THEN
       SELECT CODEMPAX,CODFILIALAX,CODALMOX FROM EQPRODUTO WHERE
          CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD AND CODPROD=new.CODPROD
       INTO new.codempam, new.codfilialam,new.codalmox;
  if (new.qtdaprovitsol>new.qtditsol) then
     exception cpitsolicitacao;
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITSOLTGBU02
AS
  declare variable statusitem char(2);
begin
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      if (old.sititsol!='AF') then
      begin
          if (new.qtdaprovitsol!=old.qtdaprovitsol or (NEW.sitaprovitsol='AT') ) then
          begin
              if ((new.sitaprovitsol='AT') and (new.qtdaprovitsol=0) and (old.sitaprovitsol!='AT')) then
              begin
                new.qtdaprovitsol=new.qtditsol;
              end
              if (new.qtdaprovitsol>0) then
              begin
                if (new.qtdaprovitsol<new.qtditsol) then
                begin
                    statusitem = 'AP';
                end
                else
                begin
                    statusitem = 'AT';
                end
              new.sitaprovitsol=:statusitem;
              if(new.sititsol='PE') then
              begin
                  new.sititsol='EA';
              end
            end
          end
      end
      if(new.sititsol='CA') then
      begin
        new.qtdaprovitsol=0;
        new.sitaprovitsol='NA';
      end
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPORDCOMPRATGBU
AS
begin
    
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT = cast('now' AS TIME);
    
    -- Na aprovao total mudar status para aguardando recebimento
    if(old.statusapoc='PE' and new.statusapoc='AT') then
    begin
        new.statusoc='AR';
    
        -- Gerando contas a pagar de empenho
        execute procedure fnadicpagarsp02(
            new.codemp, new.codfilial, new.codordcp,
            new.codemppg, new.codfilialpg, new.codplanopag,
            new.codempfr, new.codfilialfr, new.codfor, 
            substring(new.obsordcp from 1 for 250) );

    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPSOLICITACAOTGBU
as
  DECLARE VARIABLE ICODEMPUSU INT;
  declare variable ICODFILIALUSU smallint;
  declare variable IDUSU char(8);
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if((new.idusuaprov is null) and (new.sitsol!=old.sitsol) and ((new.sitsol= 'AP') or (new.sitsol= 'AT') )) then
  begin
    SELECT CODEMPUSU,CODFILIALUSU,IDUSUS FROM sgretinfousu(new.CODEMP, USER) into :ICODEMPUSU,:ICODFILIALUSU,:IDUSU;
    new.codempua = :ICODEMPUSU;
    new.codfilialua = :ICODFILIALUSU;
    new.idusuaprov = :IDUSU;
    new.dtaaprovsol = cast('now' AS DATE);
  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPSUMSOLTGBI
AS
begin
  new.dtins=cast('now' AS DATE);
  new.idusuins=USER;
  new.hins = cast('now' AS TIME);

  IF (new.REFPROD IS NULL) THEN
       SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
            AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO new.REFPROD;
END
^

/* Alter exist trigger... */
ALTER TRIGGER CPSUMSOLTGBU
AS
     declare variable sRefProd VARChar(20);
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
    
      IF (new.CODPROD != old.CODPROD) THEN
         EXCEPTION CPITSOLICITACAOEX01;
      IF (new.REFPROD IS NULL) THEN
      BEGIN
           SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
                AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO sRefProd;
           new.REFPROD = sRefProd;
      END
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQCODALTPRODBU
AS
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN    
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
      SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP and CODFILIAL=new.CODFILIAL
         AND CODPROD=new.CODPROD INTO new.REFPROD;
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQEXPEDAMOSTRAGEMTGAU
AS
declare variable tipoproc char(2);
begin
    if(new.pesoamost != old.pesoamost) then
    begin

        select coalesce(pe.tipoprocexped,'PI') from eqitexpedicao ix, eqprocexped pe where
        ix.codemp=new.codemp and ix.codfilial=new.codfilial and ix.ticket=new.ticket and ix.coditexped=new.coditexped
        and pe.codemp=ix.codempte and pe.codfilial=ix.codfilialte and pe.codtipoexped=ix.codtipoexped and pe.codprocexped=ix.codprocexped
        into tipoproc;

        if('PI' = tipoproc) then
        begin

            update eqexpedicao ex set ex.pesoentrada=new.pesoamost
            where ex.codemp=new.codemp and ex.codfilial=new.codfilial and ex.ticket=new.ticket;

        end
        else  if('PF' = tipoproc) then
        begin

            update eqexpedicao ex set ex.pesosaida=new.pesoamost
            where ex.codemp=new.codemp and ex.codfilial=new.codfilial and ex.ticket=new.ticket;

        end

    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQEXPEDICAOTGBU
as
begin

    -- Atualizando log de atualizao do registro
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT=cast('now'AS TIME);

    -- Verifica se um romaneio foi vinculado e atualizao o status.
    if(old.codroma is null and new.codroma is not null) then
    begin
    
        new.status='RE';

    end


end
^

/* Alter exist trigger... */
ALTER TRIGGER EQGRUPOTGBU
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if (new.ESTNEGGRUP IS NULL) then
     new.ESTNEGGRUP = 'N';
  if (new.ESTLOTNEGGRUP IS NULL) then
     new.ESTLOTNEGGRUP = 'N';
  if ( (old.ESTNEGGRUP IS NULL) OR (old.ESTNEGGRUP!=new.ESTNEGGRUP) ) then
     UPDATE EQGRUPO SET ESTNEGGRUP=new.ESTNEGGRUP
         WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND
           CODGRUP!=new.CODGRUP AND CODGRUP LIKE RTRIM(new.CODGRUP)||'%';
  if ( (old.ESTLOTNEGGRUP IS NULL) OR (old.ESTLOTNEGGRUP!=new.ESTLOTNEGGRUP) ) then
     UPDATE EQGRUPO SET ESTLOTNEGGRUP=new.ESTLOTNEGGRUP
         WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND
           CODGRUP!=new.CODGRUP AND CODGRUP LIKE RTRIM(new.CODGRUP)||'%';
  /* Trigger Text */
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQINVPRODTGAD
AS
begin
  /* Apos a excluso do inventrio */
  EXECUTE PROCEDURE EQMOVPRODIUDSP('D', old.CODEMPPD, old.CODFILIALPD,
     old.CODPROD, old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
     old.CODEMPTM, old.CODFILIALTM, old.CODTIPOMOV, old.CODEMP,
     old.CODFILIAL, old.CODINVPROD, null, null, null, null,null,
     null, null, null, null, null, null, null, null, null, null, null,
     null, null, null,null,
     null, old.DATAINVP, old.CODINVPROD, 'S', old.QTDINVP, old.PRECOINVP,
     old.CODEMPAX, old.CODFILIALAX, old.CODALMOX, null, 'S', 'N');
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQINVPRODTGAI
AS
BEGIN
  EXECUTE PROCEDURE EQMOVPRODIUDSP('I', new.CODEMPPD, new.CODFILIALPD,
     new.CODPROD, new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
     new.CODEMPTM, new.CODFILIALTM, new.CODTIPOMOV, new.CODEMP,
     new.CODFILIAL, new.CODINVPROD,  null, null, null, null,
     null, null, null, null, null, null, null, null, null,null,
     null,null,null,null,
     null, null, null, new.DATAINVP, new.CODINVPROD, 'S',
     new.QTDINVP, new.PRECOINVP,
     new.CODEMPAX, new.CODFILIALAX, new.CODALMOX, null, 'S', 'N');
END
^

/* Alter exist trigger... */
ALTER TRIGGER EQINVPRODTGAU
AS
BEGIN
  if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
  begin
      EXECUTE PROCEDURE EQMOVPRODIUDSP('U', new.CODEMPPD, new.CODFILIALPD,
         new.CODPROD, new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
         new.CODEMPTM, new.CODFILIALTM, new.CODTIPOMOV, new.CODEMP,
         new.CODFILIAL, new.CODINVPROD,  null, null, null, null,
         null, null, null, null, null, null, null, null, null,null,null,null,
         null, null, null, null, null, new.DATAINVP, new.CODINVPROD, 'S',
         new.QTDINVP, new.PRECOINVP,
         new.CODEMPAX, new.CODFILIALAX, new.CODALMOX, null, 'S', 'N');
  end
END
^

/* Alter exist trigger... */
ALTER TRIGGER EQINVPRODTGBI
AS
  DECLARE VARIABLE CLOTEPROD CHAR;
BEGIN
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  SELECT CLOTEPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
    AND CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD INTO CLOTEPROD;
  IF (CLOTEPROD = 'S' AND new.CODLOTE IS NULL) THEN
    EXCEPTION EQINVPRODEX05;
  if (new.SLDATUALINVP is null) then new.SLDATUALINVP = 0;
  if (new.SLDDIGINVP is null) then new.SLDDIGINVP = 0;
/*  new.QTDINVP = new.SLDATUALINVP - new.SLDDIGINVP; */
  SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO new.REFPROD;
END
^

/* Alter exist trigger... */
ALTER TRIGGER EQINVPRODTGBU
AS
  DECLARE VARIABLE CLOTEPROD CHAR;
BEGIN
    -- Verifica se tabela est em manuteno // caso no esteja inicia procedimentos
  if ( new.emmanut is null) then
      new.emmanut='N';

  if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
  begin

      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
      SELECT CLOTEPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
        AND CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD INTO CLOTEPROD;
      IF (new.CODPROD != old.CODPROD) THEN
        EXCEPTION EQINVPRODEX01;
      IF (new.CODLOTE != old.CODLOTE) THEN
        EXCEPTION EQINVPRODEX02;
      IF (new.DATAINVP != old.DATAINVP) THEN
        EXCEPTION EQINVPRODEX03;
      IF (new.CODALMOX != old.CODALMOX) THEN
        EXCEPTION EQINVPRODEX04;
      IF (CLOTEPROD = 'S' AND new.CODLOTE IS NULL) THEN
        EXCEPTION EQINVPRODEX05;
  end
  
END
^

/* Alter exist trigger... */
ALTER TRIGGER EQITEXPEDICAOTGAU
as
    declare variable tipoprocexped char(2);
    declare variable peso decimal(15,5);

begin

  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  begin
  -- buscando tipo de amostragem

    select pr.tipoprocexped,

        (select first 1 ea.pesoamost from eqexpedamostragem ea
         where ea.codemp=ie.codemp and ea.codfilial=ie.codfilial and ea.ticket=ie.ticket and ea.coditexped=ie.coditexped
         order by ea.coditexped desc
        ) peso

    from eqprocexped pr, eqitexpedicao ie
    where ie.codemp=new.codemp and ie.codfilial=new.codfilial and ie.ticket=new.ticket and ie.coditexped=new.coditexped
    and pr.codemp=ie.codempte and pr.codfilial=ie.codfilialte and pr.codtipoexped=ie.codtipoexped and pr.codprocexped=ie.codprocexped
    into :tipoprocexped, :peso;

    if(new.statusitexped='FN') then
    begin

        if (tipoprocexped='PI') then
        begin
            update eqexpedicao ex set ex.status='PI', ex.pesoentrada=:peso
            where ex.codemp=new.codemp and ex.codfilial=new.codfilial and ex.ticket=new.ticket;
        end
        else if (tipoprocexped='PF') then
        begin
            update eqexpedicao ex set ex.status='PS', ex.pesosaida=:peso
            where ex.codemp=new.codemp and ex.codfilial=new.codfilial and ex.ticket=new.ticket;
        end
        else if (tipoprocexped='RO') then
        begin
            update eqexpedicao ex set ex.status='FN'
            where ex.codemp=new.codemp and ex.codfilial=new.codfilial and ex.ticket=new.ticket;
        end
    end
  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRECMERCSERIETGAI
AS
   declare variable docrecmerc integer;
   declare variable qtd integer;
begin
    if(new.numserie is not null)then
        begin
            select docrecmerc from eqrecmerc where codemp=new.codemp and 
               codfilial=new.codfilial and ticket=new.ticket 
               into :docrecmerc; 
            select count(*) from eqmovserie ms
            where ms.codemp=new.codemp and ms.codfilial=new.codfilial
                and ms.codemprc=new.codemp and ms.codfilialrc=new.codfilial
                and ms.ticket=new.ticket and ms.coditrecmerc=new.coditrecmerc
                into :qtd;
            if (qtd is null or qtd=0 ) then
            begin
                insert into eqmovserie (codemp, codfilial, codemppd, codfilialpd, codprod,
                    codemprc, codfilialrc, ticket, coditrecmerc,
                    numserie, dtmovserie, tipomovserie, docmovserie )
                values(new.codemp, new.codfilial, new.codemppd, new.codfilialpd, new.codprod,
                       new.codemp, new.codfilial, new.ticket, new.coditrecmerc,
                       new.numserie,  current_timestamp , 1, :docrecmerc );
            end
            else
            begin
                update eqmovserie ms
                set ms.numserie=new.numserie, ms.codprod=new.codprod, ms.docmovserie=:docrecmerc, ms.dtmovserie=current_timestamp
                    where ms.codemp=new.codemp and ms.codfilial=new.codfilial
                        and ms.codemprc=new.codemp and ms.codfilialrc=new.codfilial
                        and ms.ticket=new.ticket and ms.coditrecmerc=new.coditrecmerc
                        and (ms.codprod<>new.codprod or ms.numserie<>new.numserie or ms.docmovserie<>:docrecmerc);
            end
        end
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRECMERCSERIETGBU
as
    declare variable temserie smallint;
begin
    -- Atualizando log
    new.DTALT=cast('now' as date);
    new.IDUSUALT=USER;
    new.HALT = cast('now' as time);

    -- Verificando se foi inserido um numero de srie
    if(old.numserie is null and new.numserie is not null) then
    begin
        -- Verificando se o nmero de srie informado, j existe.
        select count(*) from eqserie sr
        where sr.codemp = new.codemppd and sr.codfilial = new.codfilialpd and sr.codprod = new.codprod and sr.numserie = new.numserie
        into :temserie;

        -- se o nmero de srie informado no existe, deve inseri-lo;
        if (temserie = 0) then
        begin
            insert into eqserie (codemp, codfilial, codprod, numserie)
            values(new.codemppd, new.codfilialpd, new.codprod, new.numserie);
        end

    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRECMERCTGAI
AS
begin
    -- Executa procedure de gerao de tabela de vinculo para numeros de serie

    execute procedure eqitrecmercseriesp('I', new.codemp, new.codfilial, new.ticket, new.coditrecmerc, new.codemppd, new.codfilialpd, new.codprod, new.numserie, new.qtditrecmerc);

end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRECMERCTGAU
as
    declare variable tipoprocrecmerc char(2);

begin

  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
  -- buscando tipo de amostragem

    select pr.tipoprocrecmerc
    from eqprocrecmerc pr, eqitrecmerc ir
    where ir.codemp=new.codemp and ir.codfilial=new.codfilial and ir.ticket=new.ticket and ir.coditrecmerc=new.coditrecmerc
    and pr.codemp=ir.codemptp and pr.codfilial=ir.codfilialtp and pr.codtiporecmerc=ir.codtiporecmerc and pr.codprocrecmerc=ir.codprocrecmerc
    into :tipoprocrecmerc;

    if( ( coalesce(new.mediaamostragem,0) > 0 )  and ( coalesce(new.rendaamostragem,0) > 0 ) ) then
    begin

        update eqrecmerc rm set
        rm.mediaamostragem = ( coalesce(rm.mediaamostragem,new.mediaamostragem) + new.mediaamostragem ) / 2,
        rm.rendaamostragem = ( coalesce(rm.rendaamostragem,new.rendaamostragem) + new.rendaamostragem ) / 2
        where
        rm.codemp=new.codemp and rm.codfilial=new.codfilial and rm.ticket=new.ticket;

    end

    if(new.statusitrecmerc='FN') then
    begin

        if (tipoprocrecmerc='PI') then
        begin
            update eqrecmerc rm set rm.status='E1'
            where rm.codemp=new.codemp and rm.codfilial=new.codfilial and rm.ticket=new.ticket;
        end
        else if (tipoprocrecmerc='TR') then
        begin
            update eqrecmerc rm set
            rm.status='E2',
            rm.rendaamostragem=new.rendaamostragem
            where rm.codemp=new.codemp and rm.codfilial=new.codfilial and rm.ticket=new.ticket;
        end
        else if (tipoprocrecmerc='PF') then
        begin
            update eqrecmerc rm set rm.status='FN'
            where rm.codemp=new.codemp and rm.codfilial=new.codfilial and rm.ticket=new.ticket;
        end
    end


    -- Executa procedure para atualizao de tabela de vinculo para numeros de serie
    execute procedure eqitrecmercseriesp('U', old.codemp, old.codfilial, old.ticket, old.coditrecmerc, old.codemppd, old.codfilialpd, old.codprod, new.numserie, new.qtditrecmerc);

    -- Atualiza registros de ticket com nmero de srie da tabela eqmovserie
    if (old.codprod <> new.codprod) then
    begin
        update eqmovserie eq set eq.codprod=new.codprod where
        eq.ticket=old.ticket and eq.coditrecmerc=old.coditrecmerc and
        eq.codfilialrc=old.codfilial and eq.codemprc=old.codemp and
        eq.codprod<>new.codprod;
    end

    if (old.numserie <> new.numserie) then
    begin
        update eqmovserie eq set eq.numserie=new.numserie where
        eq.ticket=old.ticket and eq.coditrecmerc=old.coditrecmerc and
        eq.codfilialrc=old.codfilial and eq.codemprc=old.codemp and
        eq.numserie<>new.numserie;
    end
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRECMERCTGBD
AS
begin

    -- Executa procedure para excluso de tabela de vinculo para numeros de serie
    execute procedure eqitrecmercseriesp('D', old.codemp, old.codfilial, old.ticket, old.coditrecmerc, old.codemppd, old.codfilialpd, old.codprod, null, old.qtditrecmerc);


end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRMASTRMA
AS
  declare variable numitens int;
  declare variable numitensaf int;
  declare variable numitensap int;
  declare variable numitensna int;
  declare variable numitensat int;
  declare variable numitensef int;
  declare variable numitensca int;
  declare variable numitensep int;
  declare variable numitensne int;
  declare variable numitenset int;

begin

  if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
  begin

      if (old.sititrma!='AF') then
      begin
          select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma into :numitens;
          select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sititrma='AF' into :numitensaf;
          select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sititrma='EF' into :numitensef;
          select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sititrma='CA' into :numitensca;
          if(:numitens=:numitensaf) then
          begin
            update eqrma set sitrma='AF' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitrma!='AF';
          end
          else if (:numitens=:numitensef) then
          begin
            update eqrma set sitrma='EF' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitrma!='EF';
          end
          else if (:numitens=:numitensca) then
          begin
            update eqrma set sitrma='CA' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitrma!='CA';
          end
          if (new.qtdaprovitrma!=old.qtdaprovitrma) then
          begin
              if (new.qtdaprovitrma>0) then
              begin
                  update eqrma set sitrma='EA' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitrma='PE';
                  select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitaprovitrma='AP' into :numitensap;
                  select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitaprovitrma='NA' into :numitensna;
                  select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitaprovitrma='AT' into :numitensat;
                  if(:numitens!=:numitensaf) then
                  begin
                    if(:numitens=:numitensat) then
                    begin
                       update eqrma set sitaprovrma='AT' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitaprovrma!='AT';
                    end
                    else if((:numitensap>0) or (:numitensna>0)) then
                    begin
                       update eqrma set sitaprovrma='AP' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitaprovrma!='AP';
                    end
                    if(:numitens=:numitensna) then
                    begin
                       update eqrma set sitaprovrma='NA' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma  and sitaprovrma!='NA';
                    end
                  end
              end
          end
      end
      else if (old.sititrma!='EF') then
      begin
          select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma into :numitens;
          select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sititrma='EF' into :numitensef;
          if (:numitens=:numitensef) then
          begin
            update eqrma set sitrma='EF' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitrma!='EF';
          end
          if (new.qtdexpitrma!=old.qtdexpitrma) then
          begin
              if (new.qtdexpitrma>0) then
              begin
                  select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitexpitrma='EP' into :numitensep;
                  select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitexpitrma='NE' into :numitensne;
                  select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitexpitrma='ET' into :numitenset;
                  if(:numitens!=:numitensef) then
                  begin
                    if(:numitens=:numitenset) then
                    begin
                       update eqrma set sitexprma='ET' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitexprma!='ET';
                    end
                    else if((:numitensep>0) or (:numitensne>0)) then
                    begin
                       update eqrma set sitexprma='EP' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitexprma!='EP';
                    end
                    if(:numitens=:numitensne) then
                    begin
                       update eqrma set sitaprovrma='NE' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma  and sitexprma!='NE';
                    end
                  end
              end
          end
      end
  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRMATGAD
AS
  DECLARE VARIABLE DDTRMA DATE;
  DECLARE VARIABLE ICODEMPTM INT;
  DECLARE VARIABLE ICODFILIALTM SMALLINT;
  declare VARIABLE ICODTIPOMOV INT ;

  begin
  
      SELECT R.DTAREQRMA,R.codemptm,R.codfilialtm,R.codtipomov
        FROM EQRMA R
        WHERE R.CODRMA = OLD.CODRMA AND R.CODEMP=OLD.CODEMP AND R.CODFILIAL = OLD.CODFILIAL
        INTO :DDTRMA,:ICODEMPTM,:ICODFILIALTM,:ICODTIPOMOV;

      EXECUTE PROCEDURE EQMOVPRODIUDSP('D',OLD.CODEMPPD, OLD.CODFILIALPD, OLD.CODPROD,
        OLD.CODEMPLE, OLD.CODFILIALLE, OLD.codlote, :ICODEMPTM,
        :ICODFILIALTM, :ICODTIPOMOV, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, OLD.CODEMP, OLD.CODFILIAL, OLD.codrma, OLD.coditrma, null, null, null,null,
        null,null,null,null, :DDTRMA, OLD.codrma, 'N', OLD.qtdexpitrma, OLD.precoitrma,
        OLD.CODEMPAX, OLD.CODFILIALAX, OLD.CODALMOX, null, 'S', 'N');
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRMATGAI
AS
    declare variable DDTRMA date;
    declare variable ICODEMPTM int;
    declare variable ICODFILIALTM smallint;
    declare variable ICODTIPOMOV int;
    declare variable ICODOP int;
    declare variable QTD decimal(15,5);
    declare variable CBAIXARMAAPROV char(1);

    begin

        select r.dtareqrma,r.codemptm,r.codfilialtm,r.codtipomov,r.codop
            from eqrma r
                where r.codrma=new.codrma and r.codemp=new.codemp and r.codfilial=new.codfilial
        into :DDTRMA,:ICODEMPTM,:ICODFILIALTM,:ICODTIPOMOV,:ICODOP;

        select baixarmaaprov from sgprefere5
            where codemp=new.codemp and codfilial=new.codfilial
        into :CBAIXARMAAPROV;

        if(:CBAIXARMAAPROV='S' AND :ICODOP IS NOT NULL) THEN
        begin
            QTD = new.qtdaprovitrma;
        end
        else
            QTD = new.qtdexpitrma;

        execute procedure eqmovprodiudsp('I',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
            new.CODEMPLE, new.CODFILIALLE, new.codlote, :ICODEMPTM,:ICODFILIALTM,:ICODTIPOMOV,
            null, null, null ,null, null, null, null, null, null, null, null, null, new.CODEMP,
            new.CODFILIAL, new.codrma, new.coditrma, null, null, null, null,null,null,null,null,
            :DDTRMA, new.codrma, 'N', :QTD, new.precoitrma, new.CODEMPAX,
            new.CODFILIALAX, new.CODALMOX, null, 'S', 'N');
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRMATGAU
as
    declare variable icodemptm int;
    declare variable icodfilialtm smallint;
    declare variable icodtipomov int;
    declare variable ddtrma date;
    declare variable baixarmaaprov char(1);
    declare variable estoque char(1);
    declare variable qtdmov numeric(15,5);

begin
    -- Verifica se tabela est em manuteno // caso no esteja inicia procedimentos
    -- if ( new.emmanut is null) then
    --     new.emmanut='N';

    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
    begin


        -- Carregando preferncias
        select baixarmaaprov from sgprefere5
        where codemp=new.codemp and codfilial=new.codfilial
        into :baixarmaaprov;
    
        qtdmov = new.qtdexpitrma;
    
        if(:baixarmaaprov='S' and new.sitaprovitrma in ('AT','AP')) then
        begin
            estoque = 'S';
            qtdmov = new.qtdaprovitrma;
        end
        else
        begin
            estoque = 'N';
        end
    
    
        -- Carregando informaes do cabealho (RMA)
        select r.dtareqrma,r.codemptm,r.codfilialtm,r.codtipomov
        from eqrma r
        where r.codrma = new.codrma and r.codemp=new.codemp and r.codfilial = new.codfilial
        into :ddtrma,:icodemptm,:icodfilialtm,:icodtipomov;
    
        -- Movimentao de estoque
        execute procedure eqmovprodiudsp('U',new.codemppd, new.codfilialpd, new.codprod,
            new.codemple, new.codfilialle, new.codlote, :icodemptm,:icodfilialtm, :icodtipomov,
            null, null, null ,null, null,null, null, null, null, null, null, null,
            new.codemp, new.codfilial, new.codrma, new.coditrma, null, null, null, null,
            null, null, null, null, :ddtrma, new.codrma, :estoque, :qtdmov, new.precoitrma,
            new.codempax, new.codfilialax, new.codalmox, null, 'S', 'N' );
    
   end
   
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRMATGBI
AS
begin
  IF (new.CODALMOX IS NULL) THEN
       SELECT CODEMPAX,CODFILIALAX,CODALMOX FROM EQPRODUTO WHERE
          CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD AND CODPROD=new.CODPROD
       INTO new.CODEMPAX, new.CODFILIALAX,new.CODALMOX;
  if (new.QTDAPROVITRMA>new.QTDITRMA) then
     exception eqitrma;

end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRMATGBU
AS
    declare variable statusitem char(2);

begin


    -- Verifica se tabela est em manuteno // caso no esteja inicia procedimentos
    if ( new.emmanut is null) then
        new.emmanut='N';

    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
    begin

       -- Atualizando log.
       new.dtalt = cast('now' AS DATE);
       new.idusualt = USER;
       new.halt = cast('now' AS TIME);

       -- Acertando almoxarifado (quando no informado)
       if (new.codalmox is null) then
           select CODEMPAX,CODFILIALAX,CODALMOX from eqproduto where
               codemp=new.codemppd and codfilial=new.codfilialpd and codprod=new.codprod
           into new.codempax, new.codfilialax,new.codalmox;

       -- Acertando os status.
       if (old.sititrma!='AF') then
       begin
           if (new.qtdaprovitrma!=old.qtdaprovitrma or (NEW.sitaprovitrma='AT') ) then
           begin
               if ((new.sitaprovitrma='AT') and (new.qtdaprovitrma=0) and (old.sitaprovitrma!='AT')) then
               begin
                   new.qtdaprovitrma=new.qtditrma;
               end
               if (new.qtdaprovitrma>0) then
               begin
                   if (new.qtdaprovitrma<new.qtditrma) then
                   begin
                       statusitem = 'AP'; -- Aprovao parcial
                   end
                   else
                   begin
                       statusitem = 'AT'; -- Aprovao total
                   end

                   -- atualizando status e data da aprovao
                   new.sitaprovitrma=:statusitem;
                   new.dtaprovitrma=cast('today' as date);

                   if(new.sititrma='PE') then
                   begin
                       new.sititrma='EA';
                   end
               end
           end
       end
       else if (old.sititrma!='EF') then
       begin
           if (new.qtdexpitrma!=old.qtdexpitrma or (NEW.sitexpitrma='ET') ) then
           begin
               if ((new.sitexpitrma='ET') and (new.qtdexpitrma=0) and (old.sitexpitrma!='ET')) then
               begin
                   new.qtdexpitrma=new.qtdaprovitrma;
               end
               if (new.qtdexpitrma>0) then
               begin
                   if (new.qtdexpitrma<new.qtdaprovitrma) then
                   begin
                       statusitem = 'EP'; -- Expedio parcial
                   end
                   else
                   begin
                       statusitem = 'ET'; -- Expedio total
                   end

                   -- Atualizando status e data da expedio
                   new.sitexpitrma=:statusitem;
                   new.dtaexpitrma=cast('today' as date);

                   -- Atualizando custo do produto no momento da expedio.
                   select ncustompmax from eqprodutosp01(new.codemppd,new.codfilialpd,new.codprod,new.codempax
                   ,new.codfilialax,new.codalmox, new.dtaexpitrma)
                   into new.precoitrma;

               end
           end
       end
       if(new.sititrma='CA') then
       begin
           new.qtdaprovitrma=0;
           new.qtdexpitrma=0;
           new.sitaprovitrma='NA';
           new.sitexpitrma='NA';
       end
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITSIMILARBU
AS
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN  
      SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMPPD and CODFILIAL=new.CODFILIALPD
         AND CODPROD=new.CODPROD INTO new.REFPROD;
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQLOTETGBI
as
begin
  if (new.SLDLOTE is null) then
     new.SLDLOTE = 0;
  if (new.SLDRESLOTE is null) then
     new.SLDRESLOTE = 0;
  if (new.SLDCONSIGLOTE is null) then
     new.SLDCONSIGLOTE = 0;
  new.SLDLIQLOTE = new.SLDLOTE-new.SLDRESLOTE-new.SLDCONSIGLOTE;
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQLOTETGBU
as
  DECLARE VARIABLE ICODFILIAL INTEGER;
  DECLARE VARIABLE CESTLOTNEG CHAR(1);
  DECLARE VARIABLE CESTNEGGRUP CHAR(1);
  DECLARE VARIABLE CESTLOTNEGGRUP CHAR(1);
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO :iCodFilial;
      SELECT ESTLOTNEG,ESTNEGGRUP FROM SGPREFERE1 WHERE CODEMP=new.CODEMP AND CODFILIAL=:iCodFilial
         INTO :cEstLotNeg, :cEstNegGrup;
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
      if (new.SLDLOTE is null) then
         new.SLDLOTE = 0;
      if (new.SLDRESLOTE is null) then
         new.SLDRESLOTE = 0;
      if (new.SLDCONSIGLOTE is null) then
         new.SLDCONSIGLOTE = 0;
      new.SLDLIQLOTE = new.SLDLOTE-new.SLDRESLOTE-new.SLDCONSIGLOTE;
      if (cEstNegGrup is null) then
          cEstNegGrup ='N';
      if (cEstLotNeg Is null) then
          cEstLotNeg = 'N';
      if ( new.SLDLOTE < 0) then
      begin
         if (cEstNegGrup = 'S') then
         begin
            SELECT G.ESTLOTNEGGRUP FROM EQGRUPO G, EQPRODUTO P
              WHERE P.CODEMP=new.CODEMP AND P.CODFILIAL=new.CODFILIAL AND
                P.CODPROD=new.CODPROD AND G.CODEMP=P.CODEMPGP AND
                G.CODFILIAL=P.CODFILIALGP AND G.CODGRUP=P.CODGRUP
              INTO :cEstLotNegGrup;
            if (cEstLotNegGrup is null) then
               cEstLotNegGrup = 'N';
            if (cEstLotNegGrup='N') then
               EXCEPTION EQLOTEEX01 'O LOTE '||rtrim(new.CODLOTE)||
                  ' NO POSSUI SALDO P/COMPL. A OPERAO';
         end
         else if (cEstLotNeg='N') then
               EXCEPTION EQLOTEEX01 'O LOTE '||rtrim(new.CODLOTE)||
                  ' NO POSSUI SALDO P/COMPL. A OPERAO';
      end
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQMOVPRODTGAD
AS
  DECLARE VARIABLE SOPERADOR SMALLINT;
BEGIN
  
  IF ( not ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) THEN
  BEGIN
      IF (old.ESTOQMOVPROD = 'S') THEN
      BEGIN
          IF (old.TIPOMOVPROD = 'S') THEN
            SOPERADOR = -1;
          ELSE
            SOPERADOR = 1;
          EXECUTE PROCEDURE EQMOVPRODATEQSP(old.CODEMPPD, old.CODFILIALPD, old.CODPROD,
            old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
            old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
            :SOPERADOR, old.QTDMOVPROD, 0,
            old.CODEMPAX, old.CODFILIALAX, old.CODALMOX,
            old.CODEMPAX, old.CODFILIALAX, old.CODALMOX);
       END
   END
 /* EXECUTE PROCEDURE EQMOVPRODATCUSTSP(old.CODEMPPD, old.CODFILIALPD, old.CODPROD, SOPERADOR); */
END
^

/* Alter exist trigger... */
ALTER TRIGGER EQMOVPRODTGAI
AS
DECLARE VARIABLE SOPERADOR SMALLINT;
BEGIN
  IF (new.ESTOQMOVPROD='S') THEN
  BEGIN
      IF (new.TIPOMOVPROD = 'S') THEN
         SOPERADOR = -1;
      ELSE
         SOPERADOR = 1;
      EXECUTE PROCEDURE EQMOVPRODATEQSP(new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
        null, null, null,
        new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
        :SOPERADOR, 0, new.QTDMOVPROD,
        null, null, null,
        new.CODEMPAX, new.CODFILIALAX, new.CODALMOX);
  END
END
^

/* Alter exist trigger... */
ALTER TRIGGER EQMOVPRODTGAU
AS
DECLARE VARIABLE SOPERADOR SMALLINT;
DECLARE VARIABLE NQTDMOVPRODOLD NUMERIC(15, 5);
DECLARE VARIABLE NQTDMOVPRODNEW NUMERIC(15, 5);
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) ) THEN
  BEGIN

      IF ( ( old.ESTOQMOVPROD='S' ) OR (new.ESTOQMOVPROD='S') ) THEN
      BEGIN
          NQTDMOVPRODOLD = old.QTDMOVPROD;
          NQTDMOVPRODNEW = new.QTDMOVPROD;
          IF (new.TIPOMOVPROD = 'S') THEN /* Se for sada tem que diminuir do estoque */
            SOPERADOR = -1;
          ELSE
            SOPERADOR = 1;
          /* Caso o flag de controle de estoque tenha mudado */
          IF ( (old.ESTOQMOVPROD='S') AND (new.ESTOQMOVPROD='N') ) THEN
              NQTDMOVPRODNEW = 0;
          ELSE IF ( (old.ESTOQMOVPROD='N') AND (new.ESTOQMOVPROD='S') ) THEN
              NQTDMOVPRODOLD = 0;
          EXECUTE PROCEDURE EQMOVPRODATEQSP(new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
            old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
            new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
            :SOPERADOR, NQTDMOVPRODOLD, NQTDMOVPRODNEW,
            old.CODEMPAX, old.CODFILIALAX, old.CODALMOX,
            new.CODEMPAX, new.CODFILIALAX, new.CODALMOX);
      END
   END
END
^

/* Alter exist trigger... */
ALTER TRIGGER EQMOVPRODTGBU
AS
BEGIN
  IF ( new.EMMANUT IS NULL) THEN
      new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) )) ) THEN
  BEGIN
     new.DTALT=cast('now' AS DATE);
     new.IDUSUALT=USER;
     new.HALT = cast('now' AS TIME);
  END
END
^

/* Alter exist trigger... */
ALTER TRIGGER EQPRODUTOTGAI
AS
begin
    -- Inserindo registro na tabela de log do produto (para permitir processamento de preos
    insert into eqprodutolog(codemp, codfilial, codprod, seqlog, precobaseprodant, precobaseprodnovo)
    values (new.codemp, new.codfilial, new.codprod, 1, 0.00, new.precobaseprod);
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQPRODUTOTGAU
AS
    declare variable seqlog integer;
begin
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN  
    --Verifica se o preo foi realmente alterado;
    if(new.precobaseprod != old.precobaseprod) then
    begin
    
      select coalesce(max(seqlog),0) + 1 from eqprodutolog
      where codemp=new.codemp and codfilial=new.codfilial and codprod=new.codprod
      into :seqlog;

      insert into eqprodutolog(codemp, codfilial, codprod, seqlog, precobaseprodant, precobaseprodnovo)
      values (new.codemp, new.codfilial, new.codprod, coalesce(:seqlog,1), old.precobaseprod, new.precobaseprod);

    end
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQPRODUTOTGBI
as
begin
  if (new.SLDPROD is null) then
     new.SLDPROD = 0;
  if (new.SLDRESPROD is null) then
     new.SLDRESPROD = 0;
  if (new.SLDCONSIGPROD is null) then
     new.SLDCONSIGPROD = 0;
  new.SLDLIQPROD = new.SLDPROD-new.SLDRESPROD-new.SLDCONSIGPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQPRODUTOTGBU
as
  DECLARE VARIABLE ICODFILIAL INTEGER;
  DECLARE VARIABLE CESTNEG CHAR(1);
  DECLARE VARIABLE CESTNEGGRUPPREF CHAR(1);
  DECLARE VARIABLE CESTNEGGRUP CHAR(1);
  DECLARE VARIABLE ICODPROD INTEGER;
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO :iCodFilial;
      SELECT ESTNEG, ESTNEGGRUP FROM SGPREFERE1
         WHERE CODEMP=new.CODEMP AND CODFILIAL=:iCodFilial
         INTO :cEstNeg, :cEstNegGrupPref;
      if (new.SLDPROD is null) then
         new.SLDPROD = 0;
      if (new.SLDRESPROD is null) then
         new.SLDRESPROD = 0;
      if (new.SLDCONSIGPROD is null) then
         new.SLDCONSIGPROD = 0;
      new.SLDLIQPROD = new.SLDPROD-new.SLDRESPROD-new.SLDCONSIGPROD;
      if (cEstNeg Is null) then
          cEstNeg = 'N';
      if (cEstNegGrupPref is null) then
          cEstNegGrupPref = 'N';
      if ((new.SLDPROD < 0) AND (new.TIPOPROD='P') ) THEN
      begin
        if (cEstNegGrupPref = 'S') then
        begin
           SELECT ESTNEGGRUP FROM EQGRUPO
             WHERE CODEMP=new.CODEMPGP AND CODFILIAL=new.CODFILIALGP AND
                CODGRUP=new.CODGRUP INTO :CESTNEGGRUP;
           if (cEstNegGrup is null) then
              cEstNegGrup = 'N';
           if (cEstNegGrup='N') then
              EXCEPTION EQPRODUTOEX01 'O PROD. '||rtrim(cast(new.CODPROD as char(10)))
                ||'-'||substring(new.DESCPROD from 1 for 20)||
              ' NO POSSUI SALDO P/COMPL. A OPERAO';
        end
        else if (cEstNeg='N') then
              EXCEPTION EQPRODUTOEX01 'O PROD. '||rtrim(cast(new.CODPROD as char(10)))
                ||'-'||substring(new.DESCPROD from 1 for 20)||
              ' NO POSSUI SALDO P/COMPL. A OPERAO';
      end
      if ( new.REFPROD != old.REFPROD ) then
      begin
         SELECT FIRST 1 CODPROD FROM EQMOVPROD WHERE CODEMPPD=new.CODEMP AND
            CODFILIALPD=new.CODFILIAL AND CODPROD=new.CODPROD
              INTO :ICODPROD;
         if ( (ICODPROD IS NOT NULL) AND (ICODPROD=new.CODPROD) ) then
            EXCEPTION EQPRODUTOEX01 'REFERNCIA NO PODE SER ALTERADA. PRODUTO POSSUI MOVIMENTO!';
         else
            UPDATE EQCODALTPROD SET REFPROD=new.REFPROD WHERE CODEMP=new.CODEMP AND
              CODFILIAL=new.CODFILIAL AND CODPROD=new.CODPROD;
      end
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQRMATGAU
AS
begin
    if(new.sitrma='AF')  then
    begin
      update eqitrma set sititrma = 'AF' where codemp=new.codemp and codfilial=new.codfilial and codrma=new.codrma and sititrma!='AF';
    end
    else if (new.sitrma='CA')  then
    begin
      update eqitrma set sititrma = 'CA' where codemp=new.codemp and codfilial=new.codfilial and codrma=new.codrma and sititrma!='CA';
    end
    else if(new.sitaprovrma='AT')  then
    begin
      update eqitrma set sitaprovitrma = 'AT' where codemp=new.codemp and codfilial=new.codfilial and codrma=new.codrma and sitaprovitrma!='AT';
    end
    if(new.sitrma='EF')  then
    begin
      update eqitrma it set sititrma = 'EF',precoitrma=
      (select ncustompm from eqprodutosp01(it.codemppd,it.codfilialpd,it.codprod,null,null,null,cast('today' as date)))
       where codemp=new.codemp and codfilial=new.codfilial and codrma=new.codrma and sititrma!='EF';
    end
    if(new.sitexprma='ET')  then
    begin
      update eqitrma set sitexpitrma = 'ET' where codemp=new.codemp and codfilial=new.codfilial and codrma=new.codrma and sitexpitrma!='ET';
    end
    if(new.codtipomov!=old.codtipomov) then
    begin
        update eqitrma it set precoitrma=
            (select ncustompm from eqprodutosp01(it.codemppd,it.codfilialpd,it.codprod,null,null,null, cast('today' as date)))
            where codemp=new.codemp and codfilial=new.codfilial and codrma=new.codrma;
    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER EQRMATGBI
AS
begin
    new.DTINS=cast('now' AS DATE);
    new.IDUSUINS=user;
    new.HINS=cast('now' AS TIME);
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQRMATGBU
as
  DECLARE VARIABLE ICODEMPUSU INT;
  declare variable ICODFILIALUSU smallint;
  declare variable IDUSU char(8);
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if((new.idusuaprov is null) and (new.sitaprovrma!=old.sitaprovrma)) then
  begin
    SELECT CODEMPUSU,CODFILIALUSU,IDUSUS FROM sgretinfousu(new.CODEMP, USER) into :ICODEMPUSU,:ICODFILIALUSU,:IDUSU;
    new.codempua = :ICODEMPUSU;
    new.codfilialua = :ICODFILIALUSU;
    new.idusuaprov = :IDUSU;
    new.dtaaprovrma = cast('now' AS DATE);
  end
  if((new.idusuexp is null) and (new.sitexprma!=old.sitexprma)) then
  begin
    SELECT CODEMPUSU,CODFILIALUSU,IDUSUS FROM sgretinfousu(new.CODEMP, USER) into :ICODEMPUSU,:ICODFILIALUSU,:IDUSU;
    new.codempue = :ICODEMPUSU;
    new.codfilialue = :ICODFILIALUSU;
    new.idusuexp = :IDUSU;
    new.dtaexprma = cast('now' AS DATE);
  end
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT=cast('now' AS TIME);

end
^

/* Alter exist trigger... */
ALTER TRIGGER EQSALDOLOTETGBI
AS
BEGIN
  if (new.SLDLOTE is null) then
     new.SLDLOTE = 0;
  if (new.SLDRESLOTE is null) then
     new.SLDRESLOTE = 0;
  if (new.SLDCONSIGLOTE is null) then
     new.SLDCONSIGLOTE = 0;
  new.SLDLIQLOTE = new.SLDLOTE-new.SLDRESLOTE-new.SLDCONSIGLOTE;
END
^

/* Alter exist trigger... */
ALTER TRIGGER EQSALDOLOTETGBU
as
declare variable codfilial smallint;
declare variable estneggrup char(1);
declare variable estlotneg char(1);
declare variable estoqalmox char(1);
begin
  select icodfilial from sgretfilial(new.codemp,'SGPREFERE1') into :codfilial;
  select estlotneg, estneggrup, estoqalmox
     from sgprefere1 where codemp=new.codemp and codfilial=:codfilial
     into :estlotneg, :estneggrup, :estoqalmox;
  new.dtalt=cast('now' as date);
  new.idusualt=user;
  new.halt = cast('now' as time);
  if (new.sldlote is null) then
     new.sldlote = 0;
  if (new.sldreslote is null) then
     new.sldreslote = 0;
  if (new.sldconsiglote is null) then
     new.sldconsiglote = 0;
  new.sldliqlote = new.sldlote-new.sldreslote-new.sldconsiglote;
  if (estneggrup is null) then
      estneggrup ='N';
  if (estlotneg is null) then
      estlotneg = 'N';
  if (estoqalmox is null) then
      estoqalmox = 'N';
  if ( ( new.sldliqlote < 0) and ( estoqalmox='S' ) ) then
  begin
     if ( estneggrup = 'S' ) then
     begin
        select g.estlotneggrup from eqgrupo g, eqproduto p
          where p.codemp=new.codemp and p.codfilial=new.codfilial and
            p.codprod=new.codprod and g.codemp=p.codempgp and
            g.codfilial=p.codfilialgp and g.codgrup=p.codgrup
            into :estneggrup;
        if (estneggrup is null) then
           estneggrup = 'N';
        if (estneggrup='N') then
           exception eqloteex01 'O LOTE '||rtrim(new.codlote)
              ||' NO ALMOX. '||new.codalmox
              ||' NO POSSUI SALDO P/COMPL. A OPERAO';
     end
     else if (estlotneg='N') then
           exception eqloteex01 'O LOTE '||rtrim(new.codlote)
              ||' NO ALMOX. '||new.codalmox
              ||' NO POSSUI SALDO P/COMPL. A OPERAO';
  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQSALDOPRODTGBI
AS
BEGIN
  if (new.SLDPROD is null) then
     new.SLDPROD = 0;
  if (new.SLDRESPROD is null) then
     new.SLDRESPROD = 0;
  if (new.SLDCONSIGPROD is null) then
     new.SLDCONSIGPROD = 0;
  new.SLDLIQPROD = new.SLDPROD-new.SLDRESPROD-new.SLDCONSIGPROD;
END
^

/* Alter exist trigger... */
ALTER TRIGGER EQSALDOPRODTGBU
as
  declare variable codfilial smallint;
  declare variable estneggrup char(1);
  declare variable estneg char(1);
  declare variable estoqalmox char(1);
begin
  new.dtalt=cast('now' as date);
  new.idusualt=user;
  new.halt = cast('now' as time);
  if (new.sldprod is null) then
     new.sldprod = 0;
  if (new.sldresprod is null) then
     new.sldresprod = 0;
  if (new.sldconsigprod is null) then
     new.sldconsigprod = 0;
  new.sldliqprod = new.sldprod-new.sldresprod-new.sldconsigprod;
  select icodfilial from sgretfilial(new.codemp,'SGPREFERE1') into :codfilial;
  select p1.estneg, p1.estneggrup, p1.estoqalmox
     from sgprefere1 p1
     where p1.codemp=new.codemp and p1.codfilial=:codfilial
     into :estneg, :estneggrup, :estoqalmox;
  if (estneg is null) then
      estneg = 'N';
  if (estneggrup is null) then
      estneggrup = 'N';
  if (estoqalmox is null) then
      estoqalmox = 'N';
  if ( ( new.sldliqprod < 0) and ( estoqalmox='S' ) ) then
  begin
     if ( estneggrup = 'S' ) then
     begin
        select g.estneggrup from eqgrupo g, eqproduto p
          where p.codemp=new.codemp and p.codfilial=new.codfilial and
            p.codprod=new.codprod and g.codemp=p.codempgp and
            g.codfilial=p.codfilialgp and g.codgrup=p.codgrup
            into :estneggrup;
        if (estneggrup is null) then
           estneggrup = 'N';
        if (estneggrup='N') then
           exception eqprodutoex01 'O ALMOXARIFADO '||new.codalmox
              ||' NO POSSUI SALDO P/COMPL. A OPERAO';
     end
     else if (estneg='N') then
           exception eqprodutoex01 'O ALMOXARIFADO '||new.codalmox||
              ' NO POSSUI SALDO P/COMPL. A OPERAO';
  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQTIPOMOVTGBU
as
begin
  new.DTALT = cast('now' AS DATE);
  new.IDUSUALT = USER;
  new.HALT = cast('now' AS TIME);
  IF ( (new.TIPOMOV='IV') AND (new.ESTIPOMOV!='I') ) THEN
     EXCEPTION EQTIPOMOVEX01 'FLUXO INCOMPATVEL COM O TIPO DE MOVIMENTO';
  ELSE IF (new.ESTIPOMOV = 'E') THEN
  BEGIN
    IF (new.CODTAB IS NOT NULL) THEN
    BEGIN
      EXCEPTION EQTIPOMOVEX01;
    END
  END
  ELSE
  BEGIN
    IF (new.CODTAB IS NULL) THEN
    BEGIN
      EXCEPTION EQTIPOMOVEX02;
    END
  END
  IF (old.ESTOQTIPOMOV != new.ESTOQTIPOMOV) THEN
  BEGIN
    IF ((EXISTS (SELECT CODVENDA FROM VDVENDA WHERE CODTIPOMOV=new.CODTIPOMOV
      AND CODEMPTM=new.CODEMP AND CODFILIALTM=new.CODFILIAL)) OR
        (EXISTS (SELECT CODCOMPRA FROM CPCOMPRA WHERE CODTIPOMOV=new.CODTIPOMOV
      AND CODEMPTM=new.CODEMP AND CODFILIALTM=new.CODFILIAL))) THEN
    BEGIN
      EXCEPTION EQTIPOMOVEX01 'JA EXISTE MOVIMENTOS PARA ESTE TIPO DE MOVIMENTO!';
    END
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNBORDEROTGAU
as                                   
declare variable ifiliallanca integer;
declare variable icodlanca integer;   
declare variable nvalor numeric(15,5); 
declare variable icodempplan integer;
declare variable ifilialplan integer;
declare variable anoplan smallint;
declare variable codplan char(13); 
declare variable icodempplanbor integer;
declare variable ifilialplanbor integer;
declare variable anoplanbor smallint;
declare variable codplanbor char(13);
declare variable icodsublanca integer;  
begin

  if (new.statusbor = 'BC') then
  begin

    select icodfilial from sgretfilial(new.codemp,'FNLANCA') into ifiliallanca;
    select iseq from spgeranum(new.codemp,:ifiliallanca,'LA') into icodlanca;
    select sum(ir.vlritrec) from fnitreceber ir, fnitbordero ib
      where
      ir.codemp=ib.codemprc and ir.codfilial=ib.codfilialrc and
      ir.codrec=ib.codrec and ir.nparcitrec=ib.nparcitrec and
      ib.codemp=new.codemp and ib.codfilial=new.codfilial and ib.codbor=new.codbor
      into nvalor;

    select p.codemp, p.codfilial, p.codplan, p.anoplan from fnplanejamento p, fnconta c
      where p.codemp=c.codemppn and p.codfilial=c.codfilialpn and p.codplan=c.codplan and p.anoplan=c.anoplan and
      c.codemp=new.codempcc and c.codfilial=new.codfilialcc and c.numconta=new.numconta
      into icodempplan, ifilialplan, codplan, anoplan; 

    select p.codemp, p.codfilial, p.codplan, p.anoplan from fnplanejamento p, fnconta c
      where p.codemp=c.codemppn and p.codfilial=c.codfilialpn and p.codplan=c.codplan and p.anoplan=c.anoplan and 
      c.codemp=new.codempcb and c.codfilial=new.codfilialcb and c.numconta=new.numcontabor
      into icodempplanbor, ifilialplanbor, codplanbor, anoplanbor;

    /* Transferencia */
    insert into fnlanca (
      tipolanca,codemp,codfilial,codlanca,
      codemppn,codfilialpn,codplan,anoplan, dtcomplanca,
      datalanca,doclanca,histblanca,transflanca,vlrlanca)
      values (
      'A',new.codemp,:ifiliallanca,:icodlanca,
      :icodempplanbor,:ifilialplanbor,:codplanbor, :anoplanbor, new.dtbor,
      new.dtbor,cast(new.codbor as char(15)),'ADIANTAMENTO DE RECEBIVIS','S',0);       

    icodsublanca=1;

    insert into fnsublanca (
      codemp,codfilial,codlanca,codsublanca,
      codemppn,codfilialpn,codplan,anoplan, dtcompsublanca,
      datasublanca,vlrsublanca,histsublanca)
      values (
      new.codemp,:ifiliallanca,:icodlanca,:icodsublanca,
      :icodempplan,:ifilialplan,:codplan, :anoplan, new.dtbor,
      new.dtbor,:nvalor,'ADIANTAMENTO DE RECEBIVIS');
  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNITPAGARTGAD
AS
BEGIN
  UPDATE FNPAGAR SET VLRPAG = VLRPAG - old.VLRITPAG,
         VLRDESCPAG = VLRDESCPAG - old.VLRDESCITPAG,
         VLRMULTAPAG = VLRMULTAPAG  - old.VLRMULTAITPAG,
         VLRJUROSPAG = VLRJUROSPAG - old.VLRJUROSITPAG,
         VLRDEVPAG = VLRDEVPAG - old.VLRDEVITPAG,
         VLRADICPAG = VLRADICPAG - old.VLRADICITPAG,
         VLRPAGOPAG = VLRPAGOPAG - old.VLRPAGOITPAG,
         VLRPARCPAG = VLRPARCPAG - old.VLRPARCITPAG,
         VLRAPAGPAG = VLRAPAGPAG - old.VLRAPAGITPAG
         WHERE CODPAG=old.CODPAG
         AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNITPAGARTGAU
AS
    DECLARE VARIABLE PERMITBAIXAPARCJDM CHAR(1);
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
     SELECT PERMITBAIXAPARCJDM FROM SGPREFERE1 WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL INTO :PERMITBAIXAPARCJDM;
     UPDATE FNPAGAR SET VLRPAG = VLRPAG - old.VLRITPAG + new.VLRITPAG,
         VLRDESCPAG = VLRDESCPAG - old.VLRDESCITPAG + new.VLRDESCITPAG,
         VLRMULTAPAG = VLRMULTAPAG - old.VLRMULTAITPAG + new.VLRMULTAITPAG,
         VLRJUROSPAG = VLRJUROSPAG - old.VLRJUROSITPAG + new.VLRJUROSITPAG,
         VLRDEVPAG = VLRDEVPAG - old.VLRDEVITPAG + new.VLRDEVITPAG,
         VLRADICPAG = VLRADICPAG - old.VLRADICITPAG + new.VLRADICITPAG,
         VLRPARCPAG = VLRPARCPAG - old.VLRPARCITPAG + new.VLRPARCITPAG,
         VLRPAGOPAG = VLRPAGOPAG - old.VLRPAGOITPAG + new.VLRPAGOITPAG,
         VLRAPAGPAG = VLRAPAGPAG - old.VLRAPAGITPAG + new.VLRAPAGITPAG
         WHERE CODPAG=new.CODPAG
              AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
         IF ( (:PERMITBAIXAPARCJDM='N') AND (new.STATUSITPAG='PL') AND ( (new.VLRDESCITPAG<>0) OR (new.VLRJUROSITPAG<>0) OR (new.VLRMULTAITPAG<>0) ) ) THEN
            EXCEPTION FNITPAGAREX02; 
   END
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNITPAGARTGBU
AS
  DECLARE VARIABLE IFILIALPAG INTEGER;
  DECLARE VARIABLE ICODFOR INTEGER;
  DECLARE VARIABLE ICODEMPFR INTEGER;
  DECLARE VARIABLE ICODFILIALFR INTEGER;
  DECLARE VARIABLE CODEMPLC INTEGER;
  DECLARE VARIABLE CODFILIALLC SMALLINT;
  DECLARE VARIABLE CODLANCA INTEGER;
  DECLARE VARIABLE COUNTLANCA INTEGER;
  DECLARE VARIABLE VLRLANCA NUMERIC(15,5);
BEGIN

  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);

  IF ( new.EMMANUT IS NULL ) THEN
  BEGIN
      new.EMMANUT = 'N';
  END

  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN

     if ( (old.edititpag='S') or (new.edititpag is null) ) then
     begin
         new.edititpag = 'N';
     end

     SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPAGAR') INTO IFILIALPAG;
     IF ((old.STATUSITPAG IN ('PP','PL') )  AND (new.STATUSITPAG='P1') ) THEN
     BEGIN

       IF ( (old.MULTIBAIXA IS NULL) OR (old.MULTIBAIXA='N') ) THEN
       BEGIN        
          DELETE FROM FNSUBLANCA WHERE CODPAG=new.CODPAG AND NPARCPAG=new.NPARCPAG AND 
              CODEMPPG=new.CODEMP AND CODFILIALPG = new.CODFILIAL;
          DELETE FROM FNLANCA WHERE CODPAG=new.CODPAG AND NPARCPAG=new.NPARCPAG AND 
              CODEMPPG=new.CODEMP AND CODFILIALPG = new.CODFILIAL;
       END
       ELSE 
       BEGIN
          FOR SELECT CODEMP, CODFILIAL, CODLANCA FROM FNSUBLANCA
             WHERE CODPAG=new.CODPAG AND NPARCPAG=new.NPARCPAG AND
                CODEMPPG=new.CODEMP AND CODFILIALPG = new.CODFILIAL 
             INTO :CODEMPLC, :CODFILIALLC, :CODLANCA
          DO BEGIN

             DELETE FROM FNSUBLANCA WHERE CODPAG=new.CODPAG AND NPARCPAG=new.NPARCPAG AND
                CODEMPPG=new.CODEMP AND CODFILIALPG = new.CODFILIAL;
             SELECT VLRLANCA FROM FNLANCA
                WHERE CODEMP=:CODEMPLC AND CODFILIAL=:CODFILIALLC AND CODLANCA=:CODLANCA
                INTO :VLRLANCA;
             IF (:VLRLANCA=0) THEN
             BEGIN
                DELETE FROM FNLANCA
                WHERE CODEMP=:CODEMPLC AND CODFILIAL=:CODFILIALLC AND CODLANCA=:CODLANCA;
             END
          END
       END

       new.VLRPAGOITPAG = 0;
       new.DTPAGOITPAG = NULL;

     END
     ELSE IF ( (old.STATUSITPAG='P1') AND ( new.STATUSITPAG='CP' ) ) THEN
     BEGIN
        IF ( (new.OBSITPAG IS NULL) OR (rtrim(new.OBSITPAG)='') ) THEN
        BEGIN
           EXCEPTION FNITPAGAREX01;
        END
        new.VLRCANCITPAG = new.VLRAPAGITPAG;
        new.VLRAPAGITPAG = 0;
        new.VLRDESCITPAG = 0;
        new.VLRJUROSITPAG = 0;
        new.VLRDEVITPAG = 0;
     END

     SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNSUBLANCA') INTO :CODFILIALLC;
     SELECT COUNT (CODLANCA) FROM FNSUBLANCA WHERE CODPAG=new.CODPAG AND NPARCPAG=new.NPARCPAG
           AND CODEMPPG= new.CODEMP AND CODFILIALPG=new.CODFILIAL
           AND CODEMP=new.CODEMP AND CODFILIAL = :CODFILIALLC INTO :COUNTLANCA;

     new.VLRITPAG = new.VLRPARCITPAG - new.VLRDESCITPAG  - coalesce(new.VLRCANCITPAG,0) - new.VLRDEVITPAG + new.VLRJUROSITPAG + new.VLRMULTAITPAG + new.VLRADICITPAG;

     IF ( new.STATUSITPAG = 'P1' ) THEN
     BEGIN
         new.VLRAPAGITPAG = new.VLRITPAG - new.VLRPAGOITPAG;
     END
  
     if( :countlanca <= 1 ) then
     begin
         if (new.VLRAPAGITPAG < 0) then /* se o valor a pagar for menor que zero */
           new.VLRAPAGITPAG = 0;  /* ento valor a pagar ser zero */
         if ( (new.VLRAPAGITPAG=0) AND (new.VLRITPAG>0) ) then /* se o valor a pagar for igual a zero e existir valor na parcela*/
           new.STATUSITPAG = 'PP';  /* ento o status ser PP(pagamento completo) */
         else if ( (new.VLRPAGOITPAG>0) AND (new.VLRITPAG>0) ) then /* caso contrrio e o valor pago maior que zero e existir valor na parcela*/
           new.STATUSITPAG = 'PL'; /*  ento o status ser PL(pagamento parcial) */
     end

     IF ((old.STATUSITPAG='P1' AND new.STATUSITPAG in ('PP','PL')) OR
            (old.STATUSITPAG in ('PL') AND new.STATUSITPAG in ('PP','PL') AND new.VLRPAGOITPAG > 0) ) THEN
     BEGIN
       /* faz o lanamento */
       SELECT CODFOR,CODEMPFR,CODFILIALFR FROM FNPAGAR WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND CODPAG=new.CODPAG
         INTO ICODFOR,ICODEMPFR,ICODFILIALFR;

       if ( (new.multibaixa = 'N') and ((new.edititpag is null) or (new.edititpag='N') ) ) THEN
       BEGIN
           execute procedure fnadiclancasp02(new.codpag,new.nparcpag,new.numconta,new.codempca,new.codfilialca,:icodfor,:icodempfr,:icodfilialfr,
                              new.anoplan, new.codplan, new.codemppn,new.codfilialpn,new.anocc,new.codcc,new.codempcc,new.codfilialcc, new.dtcompitpag,
                              new.dtpagoitpag,new.doclancaitpag,new.obsitpag,new.vlrpagoitpag,new.codemp,new.codfilial,new.vlrjurositpag,new.vlrdescitpag
                              ,new.codempct, new.codfilialct, new.codcontr, new.coditcontr, new.codempem, new.codfilialem, new.matempr);
       END

       /* Altera o valor pago e o valor a pagar */
       if ((new.edititpag is null) or (new.edititpag='N')) then
       begin
           new.VLRPAGOITPAG = new.VLRPAGOITPAG + old.VLRPAGOITPAG;
       end

       new.VLRAPAGITPAG = new.VLRITPAG - new.VLRPAGOITPAG;

       if (new.VLRAPAGITPAG < 0) then /* se o valor a pagar for menor que zero */
         new.VLRAPAGITPAG = 0;  /* ento valor a pagar ser zero */

       if (new.VLRAPAGITPAG=0) then /* se o valor a pagar for igual a zero */
         new.STATUSITPAG = 'PP';  /* ento o status ser PP(pagamento completo) */
       else if (new.VLRPAGOITPAG>0) then /* caso contrrio e o valor pago maior que zero */
         new.STATUSITPAG = 'PL'; /*  ento o status ser PL(pagamento parcial) */

     END
     ELSE IF (new.VLRPAGOITPAG < 0 )THEN
     BEGIN
         new.VLRPAGOITPAG = new.VLRPAGOITPAG * -1;
         new.VLRAPAGITPAG = new.VLRAPAGITPAG + new.VLRPAGOITPAG;
         new.VLRPAGOITPAG = old.VLRPAGOITPAG - new.VLRPAGOITPAG;
     END
     ELSE IF ((old.STATUSITPAG='PP') AND (new.STATUSITPAG='PP')) THEN
     BEGIN
        EXCEPTION FNPAGAREX01;
     END

     if (new.edititpag='S') then
     begin
        new.edititpag='N';
     end

   END
   
   
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNITRECEBERTGAI
AS
BEGIN
  EXECUTE PROCEDURE vdgeracomissaosp(new.CODEMP, new.CODFILIAL, new.CODREC, new.NPARCITREC,
    new.VLRCOMIITREC, new.DTVENCITREC);
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNITRECEBERTGAU
AS
  DECLARE VARIABLE ICODCLI INTEGER;
  DECLARE VARIABLE ICODEMPCL INTEGER;
  DECLARE VARIABLE ICODFILIALCL INTEGER;
  DECLARE VARIABLE SCODFILIALCI SMALLINT;
  DECLARE VARIABLE CODFILIALLC SMALLINT;
  DECLARE VARIABLE CODEMPLC INTEGER;
  DECLARE VARIABLE CODLANCA INTEGER;
  DECLARE VARIABLE VLRLANCA NUMERIC(15,5);
  DECLARE VARIABLE ESTITRECALTDTVENC CHAR(1);
  DECLARE VARIABLE AUTOBAIXAPARC CHAR(1);
  DECLARE VARIABLE PERMITBAIXAPARCJDM CHAR(1);
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN

     SELECT ESTITRECALTDTVENC, PERMITBAIXAPARCJDM FROM SGPREFERE1 WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL INTO :ESTITRECALTDTVENC, :PERMITBAIXAPARCJDM;
     SELECT ITPP.AUTOBAIXAPARC FROM FNPARCPAG ITPP, FNRECEBER R
       WHERE ITPP.CODEMP=R.CODFILIALPG AND ITPP.CODFILIAL=R.CODFILIALPG AND ITPP.CODPLANOPAG=R.CODPLANOPAG AND
         ITPP.NROPARCPAG=new.NPARCITREC AND
          R.CODEMP=new.CODEMP AND R.CODFILIAL=new.CODFILIAL AND R.CODREC=new.CODREC
       INTO :AUTOBAIXAPARC;
     IF  ( ( (old.STATUSITREC IN ('RP','RL') )  AND (new.STATUSITREC='R1') ) OR
           ( (old.STATUSITREC IN ('RP','RL') )  AND (new.STATUSITREC='RR') ) OR
           ( (ESTITRECALTDTVENC='S') AND (AUTOBAIXAPARC='S') AND
             (old.DTVENCITREC<>new.DTVENCITREC) ) ) THEN
     BEGIN
       SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNCOMISSAO') INTO :SCODFILIALCI;
       SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNLANCA') INTO :CODFILIALLC;
       
       execute procedure fnestornacomissaosp new.codemp, new.codfilial, new.codrec, new.nparcitrec;

       --UPDATE VDCOMISSAO SET STATUSCOMI='C1'
--              WHERE CODREC=new.CODREC AND NPARCITREC=new.NPARCITREC
--              AND CODEMPRC = new.CODEMP AND CODFILIALRC=new.CODFILIAL
--              AND CODEMP=new.CODEMP AND CODFILIAL=:SCODFILIALCI
--              AND STATUSCOMI NOT IN ('CE') AND TIPOCOMI='R';
       
       
              
       IF ( (old.MULTIBAIXA IS NULL) OR (old.MULTIBAIXA='N') ) THEN
       BEGIN        
          DELETE FROM FNSUBLANCA WHERE CODREC=new.CODREC AND NPARCITREC=new.NPARCITREC AND 
             CODEMPRC=new.CODEMP AND CODFILIALRC = new.CODFILIAL;
          DELETE FROM FNLANCA WHERE CODREC=new.CODREC AND NPARCITREC=new.NPARCITREC AND 
             CODEMPRC=new.CODEMP AND CODFILIALRC = new.CODFILIAL;
       END
       ELSE 
       BEGIN
          SELECT CODEMP, CODFILIAL, CODLANCA FROM FNSUBLANCA
             WHERE CODREC=new.CODREC AND NPARCITREC=new.NPARCITREC AND 
                CODEMPRC=new.CODEMP AND CODFILIALRC = new.CODFILIAL 
             INTO :CODEMPLC, :CODFILIALLC, :CODLANCA;
          DELETE FROM FNSUBLANCA WHERE CODREC=new.CODREC AND NPARCITREC=new.NPARCITREC AND 
             CODEMPRC=new.CODEMP AND CODFILIALRC = new.CODFILIAL;
          SELECT VLRLANCA FROM FNLANCA
             WHERE CODEMP=:CODEMPLC AND CODFILIAL=:CODFILIALLC AND CODLANCA=:CODLANCA
             INTO :VLRLANCA;
          IF (:VLRLANCA=0) THEN 
          BEGIN
             DELETE FROM FNLANCA 
             WHERE CODEMP=:CODEMPLC AND CODFILIAL=:CODFILIALLC AND CODLANCA=:CODLANCA;
          END 
       END
     END
     ELSE IF ((old.STATUSITREC='R1' AND new.STATUSITREC in ('RP','RL')) OR
              (old.STATUSITREC='RR' AND new.STATUSITREC in ('RP','RL')) OR
              (old.STATUSITREC in ('RP','RL') AND new.STATUSITREC in ('RP','RL') AND new.VLRPAGOITREC > 0) OR
              (old.STATUSITREC = 'RB' AND new.STATUSITREC = 'RP')) THEN
     BEGIN
        SELECT CODCLI,CODEMPCL,CODFILIALCL FROM FNRECEBER WHERE CODEMP=new.CODEMP AND
           CODFILIAL=new.CODFILIAL AND CODREC=new.CODREC
           INTO ICODCLI,ICODEMPCL,ICODFILIALCL;
        IF ((new.VLRPAGOITREC-old.VLRPAGOITREC) > 0) THEN
        BEGIN
          if(new.multibaixa is null or new.multibaixa = 'N')then
          begin
             execute procedure fnadiclancasp01(new.codrec,new.nparcitrec,new.pdvitrec,new.numconta,new.codempca,new.codfilialca,:icodcli,:icodempcl,:icodfilialcl,
                        new.codplan, new.anoplan, new.codemppn,new.codfilialpn,new.anocc,new.codcc,new.codempcc,new.codfilialcc, new.dtcompitrec, new.dtpagoitrec, 
                        new.doclancaitrec, substring(new.obsitrec from 1 for 50),new.vlrpagoitrec-old.vlrpagoitrec,new.codemp,new.codfilial,new.vlrjurositrec,new.vlrdescitrec
                        , new.codempct, new.codfilialct, new.codcontr, new.coditcontr
                        , new.codempem, new.codfilialem, new.matempr, new.tpag, new.codemptc, new.codfilialtc, new.codtipocob);
          end
        END
        IF (new.STATUSITREC = 'RP') THEN
        BEGIN
            UPDATE VDCOMISSAO SET STATUSCOMI='C2'
               WHERE CODREC=old.CODREC
               AND CODEMPRC=old.CODEMP
               AND CODFILIALRC=old.CODFILIAL
               AND NPARCITREC=old.NPARCITREC
               AND NOT STATUSCOMI IN ('CP','C2')
               AND CODEMP=old.CODEMP;
        END
     END
     ELSE IF (old.VLRCOMIITREC != new.VLRCOMIITREC) THEN
     BEGIN
        EXECUTE PROCEDURE vdgeracomissaosp(new.CODEMP, new.CODFILIAL, new.CODREC,
           new.NPARCITREC, new.VLRCOMIITREC, new.DTVENCITREC);
     END

     IF ( (new.ALTUSUITREC='S') AND ( (old.VLRITREC!=new.VLRITREC) OR
          (old.VLRDESCITREC!=new.VLRDESCITREC) OR (old.VLRMULTAITREC!=new.VLRMULTAITREC) OR
          (old.VLRJUROSITREC!=new.VLRJUROSITREC) OR (old.VLRPARCITREC!=new.VLRPARCITREC) OR
          (old.VLRPAGOITREC!=new.VLRPAGOITREC) OR (old.VLRAPAGITREC!=new.VLRAPAGITREC) ) ) THEN
        UPDATE FNRECEBER SET VLRREC = VLRREC - old.VLRITREC + new.VLRITREC,
            VLRDESCREC = VLRDESCREC - old.VLRDESCITREC + new.VLRDESCITREC,
            VLRMULTAREC = VLRMULTAREC - old.VLRMULTAITREC + new.VLRMULTAITREC,
            VLRJUROSREC = VLRJUROSREC - old.VLRJUROSITREC + new.VLRJUROSITREC,
            VLRDEVREC = VLRDEVREC - old.VLRDEVITREC + new.VLRDEVITREC,
            VLRPARCREC = VLRPARCREC - old.VLRPARCITREC + new.VLRPARCITREC,
            VLRPAGOREC = VLRPAGOREC - old.VLRPAGOITREC + new.VLRPAGOITREC,
            ALTUSUREC = 'S' WHERE CODREC=new.CODREC
           AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
      /* Condio para evitar baixa parcial de ttulos com juros, descontos ou multas. */
      IF ( (:PERMITBAIXAPARCJDM='N') AND (new.STATUSITREC='RL') AND ( (new.VLRDESCITREC<>0) OR (new.VLRJUROSITREC<>0) OR (new.VLRMULTAITREC<>0) ) ) THEN
         EXCEPTION FNITRECEBEREX03; 
   END
   
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNITRECEBERTGBI
as

    declare variable seqnossonumero int;

begin

    --Setando valor padro de campos para 0;
    if (new.vlrparcitrec is null) then
        new.vlrparcitrec = 0;

    if (new.vlrdescitrec is null) then
        new.vlrdescitrec = 0;

    if (new.vlrjurositrec is null) then
        new.vlrjurositrec = 0;

    if (new.vlrmultaitrec is null) then
        new.vlrmultaitrec = 0;

    -- Calculando o valor liquido da parcela...
    new.vlritrec = new.vlrparcitrec - new.vlrdescitrec - new.vlrdevitrec + new.vlrjurositrec + new.vlrmultaitrec;
    new.vlrapagitrec = new.vlritrec - new.vlrpagoitrec;

    -- Zerando valores caso fique negativo...
    if (new.vlrapagitrec<0) then
        new.vlrapagitrec = 0;

    if(new.dtprevitrec is null) then
        new.dtprevitrec = new.dtvencitrec;

   -- Buscando informaes da conta (necessrio quando  alterado o plano de pagamento na venda)
    if(new.numconta is null) then
    begin
    
        select vd.codempca, vd.codfilialca, vd.numconta
        from fnreceber rc, vdvenda vd
        where
        rc.codemp=new.codemp and rc.codfilial=new.codfilial and rc.codrec=new.codrec and
        vd.codemp=rc.codempva and vd.codfilial=rc.codfilialva and vd.codvenda=rc.codvenda and vd.tipovenda=rc.tipovenda
        into new.codempca, new.codfilialca, new.numconta;

    end

    --Buscando sequencial caso informaes de banco e carteira j tenham sido informadas...

    if(new.codbanco is not null and new.codcartcob is not null and new.numconta is not null) then
    begin

       select seqnossonumero
       from fngeraseqnossonumero( new.codempbo, new.codfilialbo, new.codbanco, new.codempcb, new.codfilialcb, new.codcartcob, new.codempca, new.codfilialca, new.numconta)
       into :seqnossonumero;

       if (:seqnossonumero is not null and :seqnossonumero >0 ) then
       begin
          new.seqnossonumero = :seqnossonumero;
       end

    end



end
^

/* Alter exist trigger... */
ALTER TRIGGER FNITRECEBERTGBU
AS

  DECLARE VARIABLE SCODFILIALPF SMALLINT;
  DECLARE VARIABLE CCOMISPDUPL CHAR(1);
  DECLARE VARIABLE NVLRPARCREC NUMERIC(15, 5);
  DECLARE VARIABLE NVLRCOMIREC NUMERIC(15, 5);
  DECLARE VARIABLE ESTITRECALTDTVENC CHAR(1);
  DECLARE VARIABLE AUTOBAIXAPARC CHAR(1);
  declare variable seqnossonumero int;
  DECLARE VARIABLE CODFILIALLC SMALLINT;
  DECLARE VARIABLE COUNTLANCA INTEGER;
BEGIN
  IF (new.EMMANUT IS NULL) THEN   /* Evita flag de manuteno nulo */
     new.EMMANUT='N';

  IF ( new.ALTUSUITREC IS NULL ) THEN /* Para no permitir flag de usurio nulo */
     new.ALTUSUITREC = 'S';

  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
     new.DTALT=cast('now' AS DATE);
     new.IDUSUALT=USER;
     new.HALT = cast('now' AS TIME);

     IF ( (new.DTPAGOITREC is not null) AND (new.DTLIQITREC is null) ) THEN
     BEGIN
        new.DTLIQITREC = new.DTPAGOITREC;
     END

     SELECT ESTITRECALTDTVENC FROM SGPREFERE1 WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL INTO :ESTITRECALTDTVENC;
     SELECT ITPP.AUTOBAIXAPARC FROM FNPARCPAG ITPP, FNRECEBER R
       WHERE ITPP.CODEMP=R.CODFILIALPG AND ITPP.CODFILIAL=R.CODFILIALPG AND ITPP.CODPLANOPAG=R.CODPLANOPAG AND
         ITPP.NROPARCPAG=new.NPARCITREC AND
          R.CODEMP=new.CODEMP AND R.CODFILIAL=new.CODFILIAL AND R.CODREC=new.CODREC
       INTO :AUTOBAIXAPARC;

     IF  ( ( (old.STATUSITREC IN ('RP','RL') )  AND (new.STATUSITREC IN ('R1', 'RR')) ) OR
           ( (ESTITRECALTDTVENC='S') AND (AUTOBAIXAPARC='S') AND
             (old.DTVENCITREC<>new.DTVENCITREC) ) ) THEN
     BEGIN
       IF(new.STATUSITREC != 'RR')THEN
       BEGIN
        new.STATUSITREC = 'R1';
       END
       new.VLRPAGOITREC = 0;
     END
     ELSE IF ( (old.STATUSITREC='R1') AND ( new.STATUSITREC='CR' ) ) THEN
     BEGIN
        IF ( (new.OBSITREC IS NULL) OR (rtrim(new.OBSITREC)='') ) THEN
        BEGIN
           EXCEPTION FNITRECEBEREX02;
        END
        new.VLRCANCITREC = new.VLRPARCITREC;
        new.VLRAPAGITREC = 0;
        new.VLRDESCITREC = 0;
        new.VLRJUROSITREC = 0;
        new.VLRDEVITREC = 0;
        new.DTCANCITREC = cast('now' as date);
     END

     SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNSUBLANCA') INTO :CODFILIALLC;
     SELECT COUNT (CODLANCA) FROM FNSUBLANCA WHERE CODREC=new.CODREC AND NPARCITREC=new.NPARCITREC
              AND CODEMPRC= new.CODEMP AND CODFILIALRC=new.CODFILIAL
              AND CODEMP=new.CODEMP AND CODFILIAL = :CODFILIALLC INTO :COUNTLANCA;

     new.VLRITREC = new.VLRPARCITREC - coalesce(new.VLRCANCITREC,0) - new.VLRDESCITREC - new.VLRDEVITREC + new.VLRJUROSITREC + new.VLRMULTAITREC;
     new.VLRAPAGITREC = new.VLRITREC - new.VLRPAGOITREC;
     if (new.VLRAPAGITREC < 0 or new.VLRAPAGITREC is null ) then /* se o valor a pagar for menor que zero */
        new.VLRAPAGITREC = 0;  /* ento valor a pagar ser zero */

     if(:countlanca <= 1)then
     begin
        if ( (new.VLRAPAGITREC=0) AND (new.STATUSITREC<>'CR') ) then /* se o valor a pagar for igual a zero */
            new.STATUSITREC = 'RP';  /* ento o status ser RP(pagamento completo) */
        else if (new.VLRPAGOITREC>0) then /* caso contrrio e o valor pago maior que zero */
            new.STATUSITREC = 'RL'; /*  ento o status ser RL(pagamento parcial) */
     end
     /*
       Esta seo  destinada e ajustar as comisses conforme os valores de parcelas
       caso o preferncias esteja ajustado para isso.
     */
     IF ( (new.VLRPARCITREC!=old.VLRPARCITREC) AND (new.VLRPARCITREC!=0) ) THEN
     BEGIN
        SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO :SCODFILIALPF;
        SELECT P1.COMISPDUPL  FROM SGPREFERE1 P1
            WHERE P1.CODEMP=new.CODEMP AND P1.CODFILIAL=:SCODFILIALPF INTO :CCOMISPDUPL;
        IF (CCOMISPDUPL='S') THEN
        BEGIN
           SELECT V.VLRLIQVENDA, R.VLRCOMIREC FROM FNRECEBER R, VDVENDA V
             WHERE R.CODEMP=new.CODEMP AND R.CODFILIAL=new.CODFILIAL AND
                 R.CODREC=new.CODREC AND V.CODEMP=R.CODEMPVA AND V.CODFILIAL=R.CODFILIALVA AND
                 V.TIPOVENDA=R.TIPOVENDA AND V.CODVENDA=R.CODVENDA INTO :NVLRPARCREC, :NVLRCOMIREC;
           IF (NVLRPARCREC!=0) THEN
             new.VLRCOMIITREC = cast( new.VLRPARCITREC * :NVLRCOMIREC / :NVLRPARCREC as NUMERIC(15, 5) );
        END
     END
     IF ((old.IMPRECIBOITREC='N') AND (new.IMPRECIBOITREC='S') AND (new.RECIBOITREC IS NULL)) THEN
     BEGIN
        SELECT ISEQ FROM SPGERANUM(new.CODEMP,new.CODFILIAL,'RB') INTO new.RECIBOITREC;
     END
     /*Alterao das datas de entrada e saida do estado de 'em cobrana'*/
     IF (new.RECEMCOB='S') THEN
     BEGIN
       new.DTINIEMCOB=CURRENT_DATE;
       new.DTFIMEMCOB=NULL;
     END
     ELSE IF (new.RECEMCOB='N') THEN
     BEGIN
       new.DTFIMEMCOB=CURRENT_DATE;
     END
     if(new.dtprevitrec is null) then
       new.dtprevitrec = new.dtvencitrec;

    --Buscando sequencial caso informaes de banco e carteira tenham sido alteradas...

       if ( (old.codbanco is null or old.codcartcob is null or old.numconta is null )
             or
            (new.codbanco != old.codbanco or new.codcartcob != old.codcartcob or new.numconta != old.numconta)
             and
            (new.codbanco is not null and new.codcartcob is not null and new.numconta is not null ) ) then

       begin

           seqnossonumero = 0;

          select seqnossonumero
          from fngeraseqnossonumero( new.codempbo, new.codfilialbo, new.codbanco, new.codempcb, new.codfilialcb, new.codcartcob, new.codempca, new.codfilialca, new.numconta)
          into :seqnossonumero;

          if (:seqnossonumero is not null and :seqnossonumero >0 ) then
          begin
             new.seqnossonumero = :seqnossonumero;
          end

       end
   end
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNLANCATGAI
as
declare variable ifilialplan integer;
begin
  select icodfilial from sgretfilial(new.codemp,'FNPLANEJAMENTO') into ifilialplan;
  insert into fnsublanca (codemp,codfilial,codlanca,codsublanca,codemppn,codfilialpn,codplan,anoplan,dtprevsublanca,datasublanca,vlrsublanca,origsublanca,flag)
                       values (new.codemp,new.codfilial,new.codlanca,0,new.codemp,:ifilialplan,new.codplan,new.anoplan,new.dtprevlanca,new.datalanca,new.vlrlanca,'S',new.flag);
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNLANCATGAU
AS
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
     UPDATE FNSUBLANCA SET DTCOMPSUBLANCA = new.DTCOMPLANCA,
         DTPREVSUBLANCA=new.DTPREVLANCA,
         DATASUBLANCA=new.DATALANCA,VLRSUBLANCA=new.VLRLANCA,FLAG=new.FLAG
         WHERE CODLANCA=old.CODLANCA AND CODSUBLANCA=0
         AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
  END
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNPAGARTGAI
as
declare variable vlrpag numeric(15, 5);
declare variable percpag numeric(11,6);
declare variable resto numeric(15, 5);
declare variable numparc integer;
declare variable diaspag integer;
declare variable i integer;
declare variable filialpp integer;
declare variable regrvcto char(1);
declare variable rvsab char(1);
declare variable rvdom char(1);
declare variable rvfer char(1);
declare variable rvdia char(1);
declare variable diavcto smallint;
declare variable casasdecfin smallint;
declare variable dtvencto date;

begin

    -- Buscando filial do plano de pagamento
    select icodfilial from sgretfilial(new.codemp, 'FNPLANOPAG') into :filialpp;

    -- Buscando preferencias

    select casasdecfin from sgprefere1 where codemp=new.codemp and codfilial=new.codfilial
    into casasdecfin;

    -- Carregando valor restante de pagamento
    i = 0;
    resto = new.vlrpag;

    -- Buscando informaes do plano de pagamento
    select pp.parcplanopag, pp.regrvctoplanopag, pp.rvsabplanopag, pp.rvdomplanopag,
           pp.rvferplanopag, pp.rvdiaplanopag, pp.diavctoplanopag
    from fnplanopag pp
    where pp.codplanopag=new.codplanopag and pp.codemp=new.codemp and pp.codfilial=:filialpp
    into :numparc, :regrvcto, :rvsab, :rvdom, :rvfer, :rvdia, :diavcto;

    -- Gerando parcelas

    for select pp.percpag, pp.diaspag
        from fnparcpag pp
        where pp.codplanopag=new.codplanopag and pp.codemp=new.codemp and pp.codfilial=:filialpp
        order by pp.diaspag
        into :percpag, :diaspag
    do
    begin
        i = i + 1;
        
        -- Calculando valor da parcela
        vlrpag = cast(cast(new.vlrpag * percpag as numeric(15, 5)) / 100 as numeric(15, 5));

        -- Usando o arredondamento para evitar dzima
        select v.deretorno
        from arreddouble(:vlrpag,:casasdecfin) v
        into :vlrpag;

        -- Valor restante para proximas parcelas
        resto = resto - vlrpag;

        if (i = numparc) then
        begin
            vlrpag = vlrpag + resto;
        end
        
        -- Buscando data de vencimento
        select c.dtvencret
        from sgcalcvencsp( new.codemp , new.datapag, new.datapag + :diaspag, :regrvcto,
                           :rvsab, :rvdom, :rvfer, :rvdia, :diavcto, :diaspag ) c
        into :dtvencto;

        -- Inserindo parcela

        insert into fnitpagar (codemp,codfilial,codpag,nparcpag,vlritpag,vlrdescitpag,vlrmultaitpag,
                           vlrjurositpag,vlrparcitpag,vlrpagoitpag,vlrapagitpag,
                           dtitpag, dtcompitpag, dtvencitpag,statusitpag,vlradicitpag,flag,obsitpag,
                           codemptc,codfilialtc,codtipocob,codempca,codfilialca,numconta,
                           codemppn, codfilialpn, codplan, anoplan, codempcc, codfilialcc, anocc, codcc
                           ) values
                           (new.codemp,new.codfilial,new.codpag,:i,:vlrpag,0,0,0,:vlrpag,0,:vlrpag,
                            new.datapag, new.dtcomppag, :dtvencto,'P1',new.vlradicpag,new.flag,new.obspag,
                            new.codemptc,new.codfilialtc,new.codtipocob, new.codempca, new.codfilialca, new.numconta,
                            new.codemppn, new.codfilialpn, new.codplan, new.anoplan, new.codempcc, new.codfilialcc, new.anocc, new.codcc
                            );
    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER FNPAGARTGBI
AS
BEGIN
  IF (new.VLRDESCPAG IS NULL) THEN new.VLRDESCPAG = 0;
  IF (new.VLRJUROSPAG IS NULL) THEN new.VLRJUROSPAG = 0;
  IF (new.VLRMULTAPAG IS NULL) THEN new.VLRMULTAPAG = 0;
  IF (new.VLRPARCPAG IS NULL) THEN new.VLRPARCPAG = 0;
  IF (new.VLRPAGOPAG IS NULL) THEN new.VLRPAGOPAG = 0;
  IF (new.STATUSPAG IS NULL) THEN new.STATUSPAG = 'P1';
  IF (new.DTCOMPPAG IS NULL) THEN new.DTCOMPPAG = new.DATAPAG;
  new.VLRPAG = new.VLRPARCPAG - new.VLRDESCPAG - new.VLRDEVPAG + new.VLRJUROSPAG + new.VLRADICPAG +
  new.VLRMULTAPAG;
  new.VLRAPAGPAG = new.VLRPAG - new.VLRPAGOPAG;
  if ( ( new.NUMCONTA IS NULL ) AND ( new.CODTIPOCOB IS NOT NULL ) ) then
  begin
     SELECT TC.CODEMPCT, TC.CODFILIALCT, TC.NUMCONTA FROM FNTIPOCOB TC
        WHERE TC.CODEMP=new.CODEMPTC AND TC.CODFILIAL=new.CODFILIALTC AND TC.CODTIPOCOB=new.CODTIPOCOB
        INTO new.CODEMPCA, new.CODFILIALCA, new.NUMCONTA;
  end
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNPAGCHEQTGAU
as
    declare variable codfilialch smallint;
    declare variable contacheq char(10);
    declare variable codempcb int;
    declare variable codfilialcb smallint;
    declare variable contabaixa char(10);
    declare variable codemppn int;
    declare variable codfilialpn smallint;
    declare variable codplan char(13);
    declare variable anoplan smallint;
    declare variable tipocheq char(2);
    declare variable dtvenctocheq date;
    declare variable vlrcheq decimal(15,5);
    declare variable vlrapagitpag decimal(15,5);
    declare variable vlrbaixa decimal(15,5);
    declare variable dtcompitpag date;
    declare variable statusitpagar char(2);
    declare variable codempla int;
    declare variable codfilialla smallint;
    declare variable codlancatransf int;
    declare variable codemppnorig int;
    declare variable codfilialpnorig smallint;
    declare variable codplanorig char(13);
    declare variable anoplanorig smallint;
    declare variable codemppntransf int;
    declare variable codfilialpntransf smallint;
    declare variable codplantransf char(13);
    declare variable anoplantransf smallint;
    declare variable numcheq int;
    declare variable dtcompcheq date;
    declare variable vlrlanca decimal(15,5);
    declare variable icont int;
    declare variable obsitpag varchar(250);
    declare variable histblanca varchar(250);
    declare variable snumcheque varchar(15);
    declare variable sdoccompra varchar(50);
    declare variable nomefavcheq varchar(50);

begin

    -- Busca informaes do cheque
    select ch.tipocheq, ch.contacheq, ch.dtvenctocheq, ch.vlrcheq, ch.numcheq, ch.dtcompcheq, ch.nomefavcheq
    from fncheque ch
    where ch.codemp=new.codempch and ch.codfilial=new.codfilialch and ch.seqcheq=new.seqcheq
    into :tipocheq, :contacheq, :dtvenctocheq, :vlrcheq, :numcheq, :dtcompcheq, :nomefavcheq;

    -- Baixa de ttulo na emisso do cheque
    if(coalesce(old.baixa,'N')='N' and new.baixa='S') then
    begin

        -- Buscando filial da tabela de contas
        select icodfilial from sgretfilial(new.codemp,'FNCONTA') into :codfilialch;

        -- Se o cheque  de pagamento de fornecedores, dever dar baixa no ttulo para a conta de controle de cheques.
        if('PF' = :tipocheq) then
        begin

            -- Busca conta para a baixa
            select cv.codempcv, cv.codfilialcv, cv.numcontacv
            from fncontavinculada cv
            where cv.codemp=new.codempch and cv.codfilial=:codfilialch and cv.numconta=:contacheq
            into :codempcb, :codfilialcb, :contabaixa;

            -- Busca informaes do planejamento
            select ip.vlrapagitpag, coalesce(ip.codemppn,p1.codemppc), coalesce(ip.codfilialpn,p1.codfilialpc),
            coalesce(ip.codplan,p1.codplanpc), coalesce(ip.anoplan,p1.anoplanpc),coalesce(ip.obsitpag,'')
            from fnitpagar ip, fnpagar pg, sgprefere1 p1
            where ip.codemp=new.codemp and ip.codfilial=new.codfilial and ip.codpag=new.codpag and ip.nparcpag=new.nparcpag
            and p1.codemp=new.codemp and p1.codfilial=new.codfilial
            and pg.codemp=ip.codemp and pg.codfilial=ip.codfilial and pg.codpag=ip.codpag
            into :vlrapagitpag, :codemppn, :codfilialpn, :codplan, :anoplan, :obsitpag;

            -- Calculando valor e status da baixa de acordo com o valor do cheque.
            if(:vlrcheq >= :vlrapagitpag) then
            begin
                vlrbaixa = :vlrapagitpag;
                statusitpagar = 'PP';

            end
            else
            begin
                vlrbaixa = :vlrcheq;
                statusitpagar = 'PL';
            end


            if(:obsitpag='') then
            begin
                obsitpag = 'PGTO C/CHEQUE NRO:' || :numcheq;
            end
            else
            begin
                obsitpag = rtrim(obsitpag) || ' / ' || 'PGTO C/CHEQUE NRO:' || :numcheq;
            end

            -- Realizando a baixa
            update fnitpagar ip set
            ip.numconta=:contabaixa, ip.codempca=:codempcb, ip.codfilialca=:codfilialcb,
            ip.codplan=:codplan, ip.anoplan=:anoplan, ip.codemppn=:codemppn, ip.codfilialpn=:codfilialpn,
            ip.dtpagoitpag=:dtvenctocheq, ip.vlrpagoitpag=:vlrbaixa,
            ip.statusitpag=:statusitpagar, obsitpag=:obsitpag, multibaixa='N'
            where ip.codpag=new.codpag and ip.nparcpag=new.nparcpag and ip.codemp=new.codemp and ip.codfilial=new.codfilial;
        end
   end

    -- Transferencia de baixa na compensao do cheque
    if(coalesce(old.transfere,'N')='N' and new.transfere='S') then
    begin
        icont = 0;
        for
            select
            la.codemp, la.codfilial, la.codemppn, la.codfilialpn, la.codplan, la.anoplan, la.vlrlanca, pg.dtcompitpag, coalesce(p.docpag,'') || '/' || coalesce(pg.nparcpag,'')
            from fnlanca la, fnitpagar pg, fnpagcheq pc, fnpagar p
            where pc.codemp=pg.codemp and pc.codfilial=pg.codfilial and pc.codpag=pg.codpag and pc.nparcpag=pg.nparcpag and
            la.codemppg=pg.codemp and la.codfilialpg=pg.codfilial and la.codpag=pg.codpag and la.nparcpag=pg.nparcpag
            and pc.codemp=new.codemp and pc.codfilial=new.codfilial and pc.codpag=new.codpag and pc.nparcpag=new.nparcpag
            and p.codemp=pg.codemp and p.codfilial=pg.codfilial and p.codpag=pg.codpag
            into :codempla, :codfilialla, :codemppnorig, :codfilialpnorig, :codplanorig, :anoplanorig, :vlrlanca, :dtcompitpag, :sdoccompra


        do
        begin

             icont = :icont + 1;

            -- Buscando cdigo do novo lanamento
            select iseq from spgeranum(:codempla, :codfilialla, 'LA' ) into :codlancatransf;

            -- Buscando conta planejamento da compensao.
            select ct.codemppn, ct.codfilialpn, ct.codplan, ct.anoplan
            from fncontavinculada cv, fnconta ct, fnconta ctv
            where ct.codemp=cv.codemp and ct.codfilial=cv.codfilial and ct.numconta=cv.numconta
            and ctv.codemppn=:codemppnorig and ctv.codfilialpn=:codfilialpnorig and ctv.codplan=:codplanorig and ctv.anoplan=:anoplanorig
            and cv.codempcv=ctv.codemp and cv.codfilialcv=ctv.codfilial and cv.numcontacv=ctv.numconta and cv.contacheque='S'
            into :codemppntransf, :codfilialpntransf, codplantransf, :anoplantransf;

            -- Montando histrico...
            snumcheque = rtrim(coalesce(cast(:numcheq as char(15)),'0'));
            histblanca = 'CH CP [' || :snumcheque || '] NF ' || :sdoccompra || ' ' || coalesce(:nomefavcheq,'');

            -- Inserir lanamento na primeira passada....

            if(:icont=1) then
            begin

                -- Inserindo lanamento de transferncia...
                insert into fnlanca (
                    tipolanca, codemp, codfilial, codlanca,
                    codemppn, codfilialpn, codplan, anoplan, dtcomplanca,
                    datalanca, doclanca, histblanca, transflanca, vlrlanca )
                values (
                      'A', :codempla, :codfilialla, :codlancatransf,
                  :codemppntransf, :codfilialpntransf, :codplantransf, :anoplantransf, :dtcompitpag, 
                  :dtcompcheq, :snumcheque, :histblanca, 'S', 0);

            end

            -- Inserindo sub-lanamento de transferncia...

            insert into fnsublanca (
                codemp, codfilial, codlanca, codsublanca,
                codemppn, codfilialpn, codplan, anoplan, dtcompsublanca,
                datasublanca, vlrsublanca, histsublanca)
            values (
                :codempla, :codfilialla, :codlancatransf, :icont,
                :codemppnorig, :codfilialpnorig, :codplanorig, :anoplanorig, :dtcompitpag,
                :dtcompcheq, :vlrlanca * -1 , :histblanca );

        end

    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNPAGTOCOMITGAI
as
  declare variable icodlanca integer;
  declare variable scodplanconta char(13);
  declare variable anoplanconta smallint;
  declare variable iplanemp integer;
  declare variable iplanfilial integer;
  declare variable ifiliallanca integer;
  declare variable sobspcomi varchar(100);
begin
  if (new.obspcomi is null) then
  begin
     sobspcomi = '';
  end
  else
  begin
     sobspcomi = substring(new.obspcomi from 1 for 100);
  end
  select icodfilial from sgretfilial(new.codemp,'FNLANCA') into ifiliallanca;
  select codplan,anoplan,codemp,codfilial from fnconta where numconta=new.numconta
         and codemp=new.codempca and codfilial = new.codfilialca into :scodplanconta, anoplanconta, :iplanemp,:iplanfilial;
  select iseq from spgeranum(new.codemp,new.codfilial,'LA') into :icodlanca;
  insert into fnlanca (codemp,codfilial,codlanca,codempci,codfilialci,codpcomi,codemppn,codfilialpn,codplan, anoplan, dtcomplanca,datalanca,doclanca,
                     histblanca,dtprevlanca,vlrlanca,flag)
            values (new.codemp,new.codfilial,:icodlanca,new.codemp,new.codfilial,new.codpcomi,:iplanemp,:iplanfilial,:scodplanconta, :anoplanconta, new.dtcomppcomi, new.datapcomi,
                   new.docpcomi,:sobspcomi,new.datapcomi,0,new.flag);
  insert into fnsublanca (codemp,codfilial,codlanca,codsublanca,codemppn,codfilialpn,codplan, anoplan, origsublanca,dtcompsublanca,datasublanca,dtprevsublanca,vlrsublanca,flag)
            values (new.codemp,new.codfilial,:icodlanca,1,new.codemppn,new.codfilialpn,new.codplan, new.anoplan, 'S',new.dtcomppcomi, new.datapcomi,new.datapcomi,new.vlrpcomi,new.flag);
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNPLANEJAMENTOTGBU
as
declare variable codredplan integer;
begin
    new.dtalt=cast('now' as date);
    new.idusualt=user;
    new.halt = cast('now' as time);
     -- Se  de nvel analtico deve gerar cdigo reduzido
    if (new.nivelplan=6 and new.codredplan is null) then
    begin
        select coalesce(max(codredplan),0) from fnplanejamento where codemp=new.codemp and codfilial = new.codfilial
        into :codredplan;
        if (codredplan is null) then
        begin
           codredplan = 0;
        end
        new.codredplan = codredplan + 1;
    end
    if ( (old.codredplan is null and new.codredplan is not null) or (new.codredplan <> old.codredplan) ) then
    begin
        codredplan = null;
        select first 1 codredplan from fnplanejamento 
        where codemp=new.codemp and codfilial=new.codfilial and codplan<>old.codplan and codredplan=new.codredplan
        into :codredplan;
        if(:codredplan is not null) then
        begin
            exception fnplanejamento01;
        end
     end
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNPLANOPAGTGAI
as
declare variable i integer;
declare variable idias integer;
declare variable dperc numeric(10,6);
declare variable dtotperc numeric(10,6);
begin
   if (new.parcplanopag>0) then
   begin
     i = 1;
     dtotperc = 0;
     dperc = 100.000000/new.parcplanopag;
     while (i<=new.parcplanopag) do
     begin
        idias = (i-1)*30;
        if (i = new.parcplanopag) then
          dperc = 100.000000-dtotperc;
        insert into fnparcpag (codemp,codfilial,codplanopag,nroparcpag,percpag,diaspag)
               values (new.codemp,new.codfilial,new.codplanopag,:i,:dperc,:idias);
        dtotperc = dtotperc + dperc;
        i = i + 1;
     end
   end
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNRECEBERTGAI
as
  declare variable nparcrec integer;
  declare variable codfilialpp smallint;
  declare variable codfilialpn smallint;
  declare variable codplan char(13);
  declare variable anoplan smallint;
  declare variable codcc char(19);
  declare variable anocc smallint;
  declare variable codfilialcc smallint;
  declare variable codfilialir smallint;
  declare variable codfilialcl smallint;
  declare variable ativocli char(1);
  declare variable numrestr integer;
  declare variable codfilialca smallint;
  declare variable codempca integer;
  declare variable numconta char(10);
  declare variable docvenda integer;
  declare variable serievenda varchar(5);

begin
  select icodfilial from sgretfilial(new.codemp,'VDCLIENTE') into codfilialcl;
  select c.ativocli  from vdcliente c where c.codemp=new.codemp and
     c.codfilial=:codfilialcl and c.codcli=new.codcli into :ativocli;
  if (ativocli<>'S') then
  begin
     exception fnreceberex01;
  end
  select count(*) from fnrestricao r, fntiporestr tr
    where r.codemp=new.codemp and r.codfilial=:codfilialcl and
      r.codcli=new.codcli and r.sitrestr in ('I') and
      tr.codemp=r.codemptr and tr.codfilial=r.codfilialtr and
      tr.codtprestr=r.codtprestr and tr.bloqtprestr='S'
      into :numrestr;
  if ( (numrestr is not null) and (numrestr>0) ) then
  begin
     if (numrestr=1) then
     begin
        exception fnreceberex02 'Cliente possui '||rtrim(cast(numrestr as char(10)))||' restrio!';
     end
     else
     begin
        exception fnreceberex02 'Cliente possui '||rtrim(cast(numrestr as char(10)))||' restries!';
     end
  end
  select icodfilial from sgretfilial(new.codemp,'FNPLANOPAG') into codfilialpp;
  select icodfilial from sgretfilial(new.codemp,'FNPLANEJAMENTO') into codfilialpn;
  select icodfilial from sgretfilial(new.codemp,'FNCENTROCUSTO') into codfilialcc;
  select icodfilial from sgretfilial(new.codemp,'FNITRECEBER') into codfilialir;

  if(new.codvenda is not null and new.numconta is null) then
  begin
    select codempca,codfilialca,numconta, vd.docvenda, vd.serie from vdvenda vd
    where codemp=new.codempva and codfilial=new.codfilialva and codvenda=new.codvenda and tipovenda=new.tipovenda
    into :codempca, :codfilialca, :numconta, :docvenda, :serievenda;
  end
  else
  begin
    codempca = new.codempca;
    codfilialca = new.codfilialca;
    numconta = new.numconta;
  end

  if (new.codvenda is not null and :docvenda is null) then
  begin
    select vd.docvenda, vd.serie from vdvenda vd
    where codemp=new.codempva and codfilial=new.codfilialva and codvenda=new.codvenda and tipovenda=new.tipovenda
    into :docvenda, :serievenda;
  end
  
  select i from fngeraitrecebersp01('S',new.codemp,
    new.codfilial, new.codrec, new.codemppg, new.codfilialpg, new.codplanopag,
    new.vlrrec, new.datarec, new.dtcomprec, new.flag, new.codempbo, new.codfilialbo,
    new.codbanco, new.codemptc, new.codfilialtc, new.codtipocob,
    new.codempcb, new.codfilialcb, new.codcartcob,
    new.vlrcomirec, new.obsrec, :codempca, :codfilialca, :numconta,
    new.codemppn, new.codfilialpn, new.codplan, new.anoplan, new.codempcc,  new.codfilialcc, new.anocc, new.codcc, new.vlrbasecomis
    ) into :nparcrec;

/* Se a parcela do plano de pagamento tiver marcado para autobaixa, ento  realizada a baixa automtica. */
  for select pp.numconta,pp.codfilialca,pp.codempca, pp.codplan, pp.anoplan, pp.codfilialpn,pp.codcc,pp.anocc,pp.codfilialcc,pc.nroparcpag
      from fnparcpag pc, fnplanopag pp
      where
        pp.codemp=new.codemp and pp.codfilial=:codfilialpp and pp.codplanopag=new.codplanopag and
        pc.codemp=pp.codemp and pc.codfilial=pp.codfilial and pc.codplanopag=pp.codplanopag and
        pc.autobaixaparc='S'
      into numconta,codfilialca,codempca, codplan, anoplan, codfilialpn,codcc,anocc,codfilialcc,nparcrec
  do
  begin
    update fnitreceber set
      numconta=:numconta,
      codempca=:codempca,
      codfilialca=:codfilialca,
      -- numconta=:numconta,
      codplan=:codplan,
      anoplan=:anoplan,
      codemppn=new.codemp,
      codfilialpn=:codfilialpn,
      anocc=:anocc,
      codcc=:codcc,
      codempcc=new.codemp,
      codfilialcc=:codfilialcc,
      doclancaitrec= :docvenda || '/' || :nparcrec,
--      doclancaitrec='auto',
      dtpagoitrec=new.datarec,
      vlrpagoitrec=vlrparcitrec - coalesce(vlrdescitrec,0),
--      vlrdescitrec=0,
      vlrjurositrec=0,
      obsitrec='BAIXA AUTOMTICA' || ' REF. DOC: ' || :serievenda || '-' || :docvenda,
      statusitrec='RP'
      where codrec=new.codrec and codemp=new.codemp and codfilial=:codfilialir and
      nparcitrec=:nparcrec;
  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNRECEBERTGAU
as
    declare variable inparcold integer;
    declare variable inparcnew integer;
    declare variable caltvlr char(1);
    declare variable regrvcto char(1);
    declare variable rvsab char(1);
    declare variable rvdom char(1);
    declare variable rvfer char(1);
    declare variable rvdia char(1);
    declare variable diavcto smallint;
    declare variable diaspag smallint;
    declare variable dtvencto date;
    declare variable nroparcrec smallint;
    begin
      if ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) then
      begin
        -- Se houver alteraes relevantes...
        if ( (
                (old.codplanopag<>new.codplanopag) or
                (old.flag<>new.flag) or
                (old.vlrrec<>new.vlrrec) or
                (old.datarec<>new.datarec) or
                (coalesce(old.obsrec,'')<>coalesce(new.obsrec,''))
            )
            and (new.altusurec != 'S')
        ) then
        begin
            -- Se foi alterado o plano de pagamento            
            if (old.codplanopag <> new.codplanopag) then
            begin
                -- Buscando informaes do plano de pagamento antigo
                select pp.parcplanopag from fnplanopag pp
                where codemp=old.codemppg and pp.codfilial=old.codfilialpg and pp.codplanopag=old.codplanopag
                into :inparcold;
                -- Buscando informaes do novo plano de pagamento
                select pp.parcplanopag, pp.regrvctoplanopag, pp.rvsabplanopag, pp.rvdomplanopag,
                pp.rvferplanopag, pp.rvdiaplanopag, pp.diavctoplanopag
                from fnplanopag pp
                where pp.codemp=new.codemppg and pp.codfilial=new.codfilialpg and pp.codplanopag = new.codplanopag
                into :inparcnew, :regrvcto, :rvsab, :rvdom, :rvfer, :rvdia, :diavcto;
                -- Se o numero de parcelas entre os planos de pagamento so diferentes.
                if (inparcnew != inparcold) then
                begin
                    -- exclui os itens de contas a receber, para recria-los.
                    delete from fnitreceber where codrec=new.codrec and codemp=new.codemp and codfilial=new.codfilial;
                end
                -- Caso possua apenas uma parcela deve apenas atualizar a data do vencimento.
                else if (inparcnew=1) then
                begin
                    -- Buscando informao do item do plano de pagamento
                    select diaspag from fnparcpag
                    where codplanopag=new.codplanopag and codemp=new.codemppg and codfilial=new.codfilialpg
                    into :diaspag;
                    -- Calculando o vencimento da parcela.
                    select c.dtvencret from sgcalcvencsp( new.codemppg, new.datarec, new.datarec + :diaspag,
                    :regrvcto, :rvsab, :rvdom, :rvfer, :rvdia, :diavcto, :diaspag ) c
                    into :dtvencto;
                    -- Atualizando item do contas a receber
                    update fnitreceber set dtvencitrec=:dtvencto
                    where codemp=new.codemp and codfilial=new.codfilial and codrec=new.codrec and
                    statusitrec not in ('RP','RL');

                end
            end
            -- Se o valor foi alterado
            if (new.vlrrec!=old.vlrrec) then
                caltvlr = 'S';
            else
                caltvlr = 'N';
            select i from fngeraitrecebersp01(:caltvlr,  new.codemp, new.codfilial, new.codrec, new.codemppg,
            new.codfilialpg, new.codplanopag, new.vlrrec, new.datarec, new.dtcomprec, new.flag, new.codempbo, new.codfilialbo,
            new.codbanco, new.codemptc, new.codfilialtc, new.codtipocob, new.codempcb, new.codfilialcb, new.codcartcob,
            new.vlrcomirec, new.obsrec, null, null, null, new.codemppn, new.codfilialpn,new.codplan, new.anoplan, new.codempcc,
            new.codfilialcc, new.anocc, new.codcc, new.vlrbasecomis)
            into :nroparcrec;

        end
        -- Atualiza os itens para eles atualizarem a comissao de forma distribuida.
        if (old.vlrcomirec != new.vlrcomirec) then
        begin
            if (old.codvend!=new.codvend) then
            begin
               delete from vdcomissao cm
               where cm.codemprc=old.codemp and cm.codfilialrc=old.codfilial and cm.codrec=old.codrec 
               and cm.codvend=old.codvend;
            end
            execute procedure fnitrecebersp01(new.codemp, new.codfilial, new.codrec, new.vlrparcrec,
            new.vlrcomirec, new.nroparcrec, 'N');
        end
      end
	end
^

/* Alter exist trigger... */
ALTER TRIGGER FNRECEBERTGBI
AS
BEGIN
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  IF (new.VLRREC IS NULL) THEN new.VLRREC = 0;
  IF (new.VLRDESCREC IS NULL) THEN new.VLRDESCREC = 0;
  IF (new.VLRJUROSREC IS NULL) THEN new.VLRJUROSREC = 0;
  IF (new.VLRMULTAREC IS NULL) THEN new.VLRMULTAREC = 0;
  IF (new.VLRPARCREC IS NULL) THEN new.VLRPARCREC = 0;
  IF (new.VLRAPAGREC IS NULL) THEN new.VLRAPAGREC = 0;
  IF (new.VLRPAGOREC IS NULL) THEN new.VLRPAGOREC = 0;
  IF (new.DTCOMPREC IS NULL) THEN new.DTCOMPREC = new.DATAREC;
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNRECEBERTGBU
as
begin
  IF (new.EMMANUT IS NULL) then
     new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
      IF ( (new.DTCOMPREC IS NULL) or (new.DATAREC<>old.DATAREC) ) THEN
         new.DTCOMPREC = new.DATAREC;
      new.VLRAPAGREC = new.VLRREC - new.VLRPAGOREC;
      if ( (new.VLRAPAGREC<0 ) or ( new.VLRAPAGREC is null ) ) then
         new.VLRAPAGREC = 0;  
  END
  /* Trigger Text */
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNSALDOLANCATGAI
AS
    declare variable fechacaixa char(1);
    declare variable fechacaixaauto char(1);
begin

    -- buscando preferncias para fechamento de caixas

    select coalesce(p1.fechacaixa,'N'),  coalesce(p1.fechacaixaauto,'N') from sgprefere1 p1
    where p1.codemp=new.codemp and p1.codfilial=new.codfilial
    into :fechacaixa, :fechacaixaauto;

    -- carregando valores para saldo...
    -- if (new.SALDOSL is null) then
    --     new.SALDOSL = 0;
    -- if (new.PREVSL is null) then
    --     new.PREVSL = 0;

    -- Fechando todos os caixas anteriors...

    if('S' = :fechacaixa and 'S' = :fechacaixaauto) then
    begin
        update fnsaldolanca sl
        set sl.fechado='S'
        where coalesce(sl.fechado,'N')='N'
        and sl.codemp=new.codemp and sl.codfilial=new.codfilial
        and sl.codemppn=new.codemppn and sl.codfilialpn=new.codfilialpn
        and sl.codplan=new.codplan
        and sl.anoplan=new.anoplan
        and sl.datasl < new.datasl;
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNSALDOLANCATGBI
AS
begin

    -- carregando valores para saldo...
    if (new.SALDOSL is null) then
        new.SALDOSL = 0;
    if (new.PREVSL is null) then
        new.PREVSL = 0;

end
^

/* Alter exist trigger... */
ALTER TRIGGER FNSALDOLANCATGBU
as
    declare variable fechacaixa char(1);
 --   declare variable fechacaixaauto char(1);
    declare variable fechado char(1);
    declare variable numconta char(10);

begin

    -- buscando preferncias para fechamento de caixas

    select coalesce(p1.fechacaixa,'N') from sgprefere1 p1
    where p1.codemp=new.codemp and p1.codfilial=new.codfilial
    into :fechacaixa;

    -- Verifica se a conta  de caixa, pois deve bloquear apenas contas caixa...
    select ct.numconta from fnconta ct
    where ct.codemppn=new.codemppn and ct.codfilialpn=new.codfilialpn
    and ct.codplan=new.codplan and ct.anoplan=new.anoplan
    into :numconta;

    -- Verifica se deve verificar o fechamento de caixas...
    if('S' = :fechacaixa and :numconta is not null) then
    begin

        if(new.fechado is null) then
        begin
           new.fechado = 'N';
        end

        -- Verifica se o caixa est fechado antes de permitir a atualizao

        if( new.fechado='N' ) then
        begin
            --Verifica se os caixas futuros esto fechados.

            select first 1 sl.fechado from fnsaldolanca sl
            where
            sl.codemp=new.codemp and sl.codfilial=new.codfilial
            and sl.codemppn=new.codemppn and sl.codfilialpn=new.codfilialpn and sl.codplan=new.codplan and sl.anoplan=new.anoplan
            and coalesce(sl.fechado,'N')='S' and sl.datasl>new.datasl
            into :fechado;

            if( (new.fechado='S' or :fechado='S' ) and old.saldosl<>new.saldosl) then
            begin
                exception FNSALDOLANCAEX01;
            end
        end
        else if(old.saldosl<>new.saldosl) then
        begin
            exception FNSALDOLANCAEX01;
        end
    end

    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT = cast('now' AS TIME);

end
^

/* Alter exist trigger... */
ALTER TRIGGER FNSUBLANCATGAD
as
declare variable ddatasl date;
declare variable dsaldosl numeric(15, 5);
declare variable scodplan char(13);
declare anoplan smallint;
declare variable dsaldoant numeric(15, 5);
declare variable ifilialsaldo integer;
begin
  select icodfilial from sgretfilial(old.codemppn,'FNSALDOLANCA') into ifilialsaldo;
   select codplan, anoplan, datasl,saldosl from fnsaldolanca where codplan=old.codplan and anoplan=old.anoplan
          and datasl=old.datasublanca and codemp=old.codemp and codfilial=:ifilialsaldo
          into :scodplan, :anoplan, :ddatasl,:dsaldosl;
   if (:scodplan is null ) then
   begin
      select saldosl from fnsaldolanca sl1 where sl1.codplan=old.codplan and sl1.anoplan=old.anoplan
             and sl1.datasl=(
                            select max(sl2.datasl) from fnsaldolanca sl2 where
                                   sl2.codplan=sl1.codplan and sl2.anoplan=sl1.anoplan and sl2.datasl<old.datasublanca
                                   and sl2.codemp=old.codemp and sl2.codfilial=:ifilialsaldo
                            )
             and sl1.codemp=old.codemp and sl1.codfilial=:ifilialsaldo into :dsaldoant;
      if (:dsaldoant is null) then
         dsaldoant = 0;
      insert into fnsaldolanca (codemp,codfilial,codemppn,codfilialpn,codplan, anoplan, datasl,saldosl)
             values (old.codemppn,old.codfilialpn,old.codemppn,old.codfilialpn,old.codplan, old.anoplan, old.datasublanca,:dsaldoant);
      update fnsaldolanca set saldosl = saldosl - old.vlrsublanca
             where codplan=old.codplan and anoplan=old.anoplan and datasl>old.datasublanca
             and codemp=old.codemp and codfilial=:ifilialsaldo;
   end
   else
   begin
      update fnsaldolanca set saldosl = saldosl - old.vlrsublanca
             where codplan=old.codplan and anoplan=old.anoplan and datasl>=old.datasublanca
             and codemp=old.codemp and codfilial=:ifilialsaldo;
   end
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNSUBLANCATGAI
as
declare variable scodplan char(13);
declare variable anoplan smallint;
declare variable dsaldoant numeric(15, 5);
declare variable ifilialsaldo integer;
declare variable codfilialpn smallint;
begin
  select icodfilial from sgretfilial(new.codemp,'FNSALDOLANCA') into ifilialsaldo;
  select icodfilial from sgretfilial(new.CODEMP,'FNPLANEJAMENTO') into :codfilialpn;
  select codplan,anoplan from fnsaldolanca
  where codplan=new.codplan and anoplan=new.anoplan and datasl=new.datasublanca and codemp=new.codemp and codfilial = :ifilialsaldo
  into :scodplan, :anoplan;
  if (:scodplan is null ) then
  begin
      select saldosl from fnsaldolanca sl1 where sl1.codplan=new.codplan and sl1.anoplan=new.anoplan and sl1.codemppn=new.codemp and sl1.codfilialpn=:codfilialpn
             and sl1.datasl=(
                            select max(sl2.datasl) from fnsaldolanca sl2 where
                                   sl2.codplan=sl1.codplan and sl2.anoplan=sl1.anoplan and sl2.datasl<new.datasublanca
                                   and sl2.codemp=new.codemp and sl2.codfilial=:ifilialsaldo
                            )
              and sl1.codemp=new.codemp and sl1.codfilial = :ifilialsaldo into :dsaldoant;
      if (:dsaldoant is null) then
         dsaldoant = 0;
      insert into fnsaldolanca (codemp,codfilial,codplan,anoplan, codemppn,codfilialpn,datasl,saldosl)
             values (new.codemppn,:ifilialsaldo,new.codplan,new.anoplan,new.codemppn,new.codfilialpn,new.datasublanca,:dsaldoant+new.vlrsublanca);
      update fnsaldolanca set saldosl = saldosl + new.vlrsublanca
             where codplan=new.codplan and anoplan=new.anoplan and datasl>new.datasublanca
             and codemp=new.codemp and codfilial=:ifilialsaldo;
   end
   else
   begin
      update fnsaldolanca set saldosl = saldosl + new.vlrsublanca
             where codplan=new.codplan and anoplan=new.anoplan and datasl>=new.datasublanca
             and codemp=new.codemp and codfilial=:ifilialsaldo;

   end
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNSUBLANCATGAU
as
declare variable ddatasl date;
declare variable dsaldosl numeric(15, 5);
declare variable scodplan char(13);
declare variable anoplan smallint;
declare variable dsaldoant numeric(15, 5);
declare variable ifilialsaldo integer;
declare variable codfilialpn smallint;
begin
   if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null)) ) ) then
   begin
      select icodfilial from sgretfilial(new.codemp,'FNSALDOLANCA') into ifilialsaldo;
      select icodfilial from sgretfilial(new.CODEMP,'FNPLANEJAMENTO') into :codfilialpn;
      if ( (old.datasublanca <> new.datasublanca) or (old.vlrsublanca<>new.vlrsublanca) ) then
      begin
   /*Verifica se j existe saldo no dia da nova data:*/
        select codplan,anoplan, datasl,saldosl from fnsaldolanca where codplan=new.codplan and anoplan=new.anoplan
               and datasl=new.datasublanca and codemp=new.codemppn and codfilial=:ifilialsaldo
               into :scodplan,:anoplan, :ddatasl,:dsaldosl;
   /*Se no existir, cria um saldo para o nova data:*/
        if (scodplan is null ) then
        begin
   /*Pega o ultimo saldo anterior a data do lanamento:*/
           select saldosl from fnsaldolanca sl1 where sl1.codplan=new.codplan and sl1.anoplan=new.anoplan and sl1.codemppn=new.codemp and sl1.codfilialpn=:codfilialpn
                  and sl1.datasl=(
                                 select max(sl2.datasl) from fnsaldolanca sl2 where
                                        sl2.codplan=sl1.codplan and sl2.anoplan=sl1.anoplan and sl2.datasl<new.datasublanca
                                        and sl2.codemp=new.codemppn and sl2.codfilial=:ifilialsaldo
                                 )
                  and sl1.codemp=new.codemppn and sl1.codfilial=:ifilialsaldo into :dsaldoant;
       /*cria um saldo para este dia e atualiza saldos possveis que tiverem na frente:*/
           if (:dsaldoant is null) then
              dsaldoant = 0;
           insert into fnsaldolanca (codemp,codfilial,codplan,anoplan, codemppn,codfilialpn,datasl,saldosl)
                  values (new.codemp,:ifilialsaldo,new.codplan,new.anoplan,new.codemppn,new.codfilialpn,new.datasublanca,:dsaldoant + new.vlrsublanca);
           update fnsaldolanca set saldosl = saldosl + new.vlrsublanca
                  where codplan=new.codplan and anoplan=new.anoplan and datasl>new.datasublanca
                  and codemp=new.codemp and codfilial=:ifilialsaldo;
        end
       /*caso contrrio s atualiza o saldo:*/
        else
        begin
           update fnsaldolanca set saldosl = saldosl + new.vlrsublanca
                  where codplan=new.codplan and anoplan=new.anoplan and datasl>=new.datasublanca
                  and codemp=new.codemp and codfilial=:ifilialsaldo;
        end
      end
   end
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNSUBLANCATGBD
AS
BEGIN
  IF (old.CODSUBLANCA > 0) THEN
    UPDATE FNLANCA SET VLRLANCA = VLRLANCA - (old.VLRSUBLANCA*-1) WHERE
      CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL AND
      CODLANCA=old.CODLANCA;
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNSUBLANCATGBI
AS
  DECLARE VARIABLE sEhTransf CHAR(1);
  DECLARE VARIABLE sTipoPlan CHAR(1);
  DECLARE VARIABLE dDataLanca DATE;
  DECLARE VARIABLE dDtPrevLanca DATE;
  DECLARE VARIABLE sHistSubLanc VARCHAR(250);
BEGIN
  /*IF ( new.VLRSUBLANCA = 0 ) THEN
     EXCEPTION FNSUBLANCAEX04;         */
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT = 'N';
  SELECT HISTBLANCA FROM FNLANCA WHERE CODLANCA = new.CODLANCA AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL
  INTO sHistSubLanc;

  IF (new.HISTSUBLANCA IS NULL) THEN
      new.HISTSUBLANCA = sHistSubLanc;

  IF (new.CODSUBLANCA IS NULL) THEN
    SELECT MAX(CODSUBLANCA) FROM FNSUBLANCA
    WHERE CODLANCA = new.CODLANCA AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL
    INTO new.CODSUBLANCA;

  new.STATUSSUBLANCA = 'S1';

  SELECT TRANSFLANCA,DATALANCA,DTPREVLANCA FROM FNLANCA
  WHERE CODLANCA = new.CODLANCA AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL
  INTO sEhTransf,dDataLanca,dDtPrevLanca;

  select tipoplan from fnplanejamento where codplan = new.codplan and anoplan = new.anoplan and codemp=new.codemppn and codfilial = new.codfilialpn
  into stipoplan;

  new.DATASUBLANCA = dDataLanca;

  IF (new.DTCOMPSUBLANCA IS NULL) THEN
     new.DTCOMPSUBLANCA = new.DATASUBLANCA;

  IF (new.CODSUBLANCA > 0) THEN
  BEGIN
    new.ORIGSUBLANCA = 'N';
  END

  new.STATUSSUBLANCA = 'S1';
  new.DTPREVSUBLANCA = dDtPrevLanca;

  IF (sEhTransf = 'S') THEN
  BEGIN
   IF (new.CODSUBLANCA = 2) THEN
     EXCEPTION FNSUBLANCAEX01;
   ELSE IF (sTipoPlan IN ('D','R')) THEN
     EXCEPTION FNSUBLANCAEX02;
  END
  ELSE
    IF ((new.CODSUBLANCA != 0) AND (sTipoPlan IN ('C','B'))) THEN
      EXCEPTION FNSUBLANCAEX03;
  UPDATE FNLANCA SET STATUSLANCA = 'L2', VLRLANCA=(VLRLANCA-new.VLRSUBLANCA)
         WHERE CODLANCA = new.CODLANCA AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNSUBLANCATGBU
as
  declare variable sehtransf char(1);
  declare variable stipoplan char(1);
  declare variable ifilialsaldo integer;
begin
  if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null)) ) ) then
  begin
     new.dtalt=cast('now' as date);
     new.idusualt=user;
     new.halt = cast('now' as time);
     /*if ( new.vlrsublanca = 0 ) then
        exception fnsublancaex04;   */
     select icodfilial from sgretfilial(new.codemp,'FNSALDOLANCA') into ifilialsaldo;
     select tipoplan from fnplanejamento where codplan = new.codplan and anoplan=new.anoplan
            and codemp=new.codemppn and codfilial = new.codfilialpn into stipoplan;
     select transflanca from fnlanca where codlanca = new.codlanca
            and codemp=new.codemp and codfilial = new.codfilial into sehtransf;
     if (sehtransf = 'S') then
     begin
         if (new.codsublanca = 2) then
        exception fnsublancaex01;
      else if (stipoplan in ('D','R')) then
        exception fnsublancaex02;
     end
     else
       if ((new.codsublanca != 0) and (stipoplan in ('C','B'))) then
         exception fnsublancaex03;
     if ((new.codsublanca != 0) and (old.vlrsublanca <> new.vlrsublanca)) then
       update fnlanca set vlrlanca = ((vlrlanca+old.vlrsublanca)-new.vlrsublanca)
              where codlanca = new.codlanca and codemp=new.codemp and codfilial=new.codfilial;
     if ( (old.datasublanca <> new.datasublanca) or (old.vlrsublanca<>new.vlrsublanca) or (old.codplan<>new.codplan) or (old.anoplan<>new.anoplan) ) then
       update fnsaldolanca set saldosl = saldosl - old.vlrsublanca
              where codplan=old.codplan and anoplan=old.anoplan and datasl>=old.datasublanca
              and codemp=old.codemp and codfilial=:ifilialsaldo;
   end
end
^

/* Alter exist trigger... */
ALTER TRIGGER LFFRETETGBU
AS
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  begin

      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);

       -- Atualizando data do pagamento

      if(old.codpag is null and new.codpag is not null) then
      begin

          select pg.datapag from fnpagar pg  where pg.codemp=new.codemppa and pg.codfilial=new.codfilialpa and pg.codpag=new.codpag
          into new.dtpagfrete;

      end
  end

end
^

/* Alter exist trigger... */
ALTER TRIGGER LFITCLFISCALTGAI
as
begin
    -- Se esta for a regra geral, desabilita demais regras que estejam como geral.
    if(new.geralfisc='S') then
    begin
       update lfitclfiscal set geralfisc='N'
       where codemp=new.codemp and codfilial=new.codfilial and codfisc=new.codfisc and
             coditfisc!=new.coditfisc and geralfisc='S' and ativoitfisc='S' 
             and simplesfilial=new.simplesfilial;
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER LFITCOMPRATGAD
AS

    declare variable ovlrbasepis numeric(15, 5);
    declare variable ovlrbasecofins numeric(15, 5);
    declare variable ovlrpis numeric(15, 5);
    declare variable ovlrcofins numeric(15, 5);
    declare variable vlricmsdiferido numeric(15, 5);
    declare variable vlricmsdevido numeric(15, 5);
    declare variable vlricmscredpresum numeric(15, 5);

begin
    -- Inicializao de variveis (old)
    if (old.vlrbasepis is null) then ovlrbasepis = 0; else ovlrbasepis = old.vlrbasepis;
    if (old.vlrbasecofins is null) then ovlrbasecofins = 0; else ovlrbasecofins = old.vlrbasepis;
    if (old.vlrpis is null) then ovlrpis = 0; else ovlrpis = old.vlrpis;
    if (old.vlrcofins is null) then ovlrcofins = 0; else ovlrcofins = old.vlrcofins;
    if (old.vlricmsdiferido is null) then vlricmsdiferido = 0; else vlricmsdiferido = old.vlricmsdiferido;
    if (old.vlricmsdevido is null) then vlricmsdevido = 0; else vlricmsdevido = old.vlricmsdevido;
    if (old.vlricmscredpresum is null) then vlricmscredpresum = 0; else vlricmscredpresum = old.vlricmscredpresum;

    update cpcompra cp set
        cp.vlrbasepiscompra = cp.vlrbasepiscompra - :ovlrbasepis,
        cp.vlrpiscompra = cp.vlrpiscompra - :ovlrpis,
        cp.vlrbasecofinscompra = cp.vlrbasecofinscompra - :ovlrbasecofins ,
        cp.vlrcofinscompra = cp.vlrcofinscompra - :ovlrcofins,
        cp.vlrbaseiicompra = cp.vlrbaseiicompra - old.vlrbaseii,
        cp.vlriicompra = cp.vlriicompra - old.vlrii,
        cp.vlricmsdiferido = cp.vlricmsdiferido - :vlricmsdiferido,
        cp.vlricmscredor = cp.vlricmscredor - :vlricmsdevido,
        cp.vlricmscredpresum = cp.vlricmscredpresum - :vlricmscredpresum
    where codcompra=old.codcompra and codemp=old.codemp and codfilial=old.codfilial;

end
^

/* Alter exist trigger... */
ALTER TRIGGER LFITCOMPRATGAI
as
    declare variable vlrbasepis numeric(15, 5);
    declare variable vlrbasecofins numeric(15, 5);
    declare variable vlrpis numeric(15, 5);
    declare variable vlrcofins numeric(15, 5);
    declare variable vlrbaseii numeric(15, 5);
    declare variable vlrii numeric(15, 5);
    declare variable vlricmsdiferido numeric(15, 5);
    declare variable vlricmsdevido numeric(15, 5);
    declare variable vlricmscredpresum numeric(15, 5);

begin
    -- Inicializao de variveis
    if (new.vlrbasepis is null) then vlrbasepis = 0; else vlrbasepis = new.vlrbasepis;
    if (new.vlrbasecofins is null) then vlrbasecofins = 0; else vlrbasecofins = new.vlrbasepis;
    if (new.vlrpis is null) then vlrpis = 0; else vlrpis = new.vlrpis;
    if (new.vlrcofins is null) then vlrcofins = 0; else vlrcofins = new.vlrcofins;
    if (new.vlrbaseii is null) then vlrbaseii = 0; else vlrbaseii = new.vlrbaseii;
    if (new.vlrii is null) then vlrii = 0; else vlrii = new.vlrii;
    if (new.vlricmsdiferido is null) then vlricmsdiferido = 0; else vlricmsdiferido = new.vlricmsdiferido;
    if (new.vlricmsdevido is null) then vlricmsdevido = 0; else vlricmsdevido = new.vlricmsdevido;
    if (new.vlricmscredpresum is null) then vlricmscredpresum = 0; else vlricmscredpresum = new.vlricmscredpresum;

    -- Atualizando campos de totais na tabela de compra;
    if ( (new.emmanut is null) or (new.emmanut='N') ) then
    begin
       update cpcompra cp set
        cp.vlrbasepiscompra = cp.vlrbasepiscompra + :vlrbasepis ,
        cp.vlrpiscompra =  cp.vlrpiscompra + :vlrpis ,
        cp.vlrbasecofinscompra = cp.vlrbasecofinscompra + :vlrbasecofins ,
        cp.vlrcofinscompra =  cp.vlrcofinscompra + :vlrcofins,
        cp.vlrbaseiicompra = cp.vlrbaseiicompra + :vlrbaseii,
        cp.vlriicompra = cp.vlriicompra + :vlrii,
        cp.vlricmsdiferido = cp.vlricmsdiferido + :vlricmsdiferido,
        cp.vlricmscredor = cp.vlricmscredor + :vlricmsdevido,
        cp.vlricmscredpresum = cp.vlricmscredpresum + :vlricmscredpresum
       where codcompra=new.codcompra and codemp=new.codemp and codfilial=new.codfilial
       and coalesce(bloqcompra,'N')='N' ;
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER LFITCOMPRATGAU
as
    declare variable cstatus char (2);
    declare variable nvlrbasepis numeric(15, 5);
    declare variable nvlrbasecofins numeric(15, 5);
    declare variable nvlrpis numeric(15, 5);
    declare variable nvlrcofins numeric(15, 5);
    declare variable ovlrbasepis numeric(15, 5);
    declare variable ovlrbasecofins numeric(15, 5);
    declare variable ovlrpis numeric(15, 5);
    declare variable ovlrcofins numeric(15, 5);
    declare variable ovlrbaseii numeric(15, 5);
    declare variable ovlrii numeric(15, 5);
    declare variable vlricmsdiferido numeric(15, 5);
    declare variable vlricmsdevido numeric(15, 5);
    declare variable vlricmscredpresum numeric(15, 5);
begin
    -- Inicializao de variveis (new)
    if (new.vlrbasepis is null) then nvlrbasepis = 0; else nvlrbasepis = new.vlrbasepis;
    if (new.vlrbasecofins is null) then nvlrbasecofins = 0; else nvlrbasecofins = new.vlrbasepis;
    if (new.vlrpis is null) then nvlrpis = 0; else nvlrpis = new.vlrpis;
    if (new.vlrcofins is null) then nvlrcofins = 0; else nvlrcofins = new.vlrcofins;
    -- Inicializao de variveis (old)
    if (old.vlrbasepis is null) then ovlrbasepis = 0; else ovlrbasepis = old.vlrbasepis;
    if (old.vlrbasecofins is null) then ovlrbasecofins = 0; else ovlrbasecofins = old.vlrbasepis;
    if (old.vlrpis is null) then ovlrpis = 0; else ovlrpis = old.vlrpis;
    if (old.vlrcofins is null) then ovlrcofins = 0; else ovlrcofins = old.vlrcofins;
    if (old.vlrbaseii is null) then ovlrbaseii = 0; else ovlrbaseii = old.vlrbaseii;
    if (old.vlrii is null) then ovlrii = 0; else ovlrii = old.vlrii;
    if (old.vlricmsdiferido is null) then vlricmsdiferido = 0; else vlricmsdiferido = old.vlricmsdiferido;
    if (old.vlricmsdevido is null) then vlricmsdevido = 0; else vlricmsdevido = old.vlricmsdevido;
    if (old.vlricmscredpresum is null) then vlricmscredpresum = 0; else vlricmscredpresum = old.vlricmscredpresum;
    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) ) ) ) then
    begin
        select cp.statuscompra from cpcompra cp
        where cp.codcompra = new.codcompra and cp.codemp=new.codemp and cp.codfilial = new.codfilial
        into :cstatus;
        if (substr(:cstatus,1,1) not in ('X','N') ) then
        begin
            update cpcompra cp set
            cp.vlrbasepiscompra = cp.vlrbasepiscompra - :ovlrbasepis + :nvlrbasepis,
            cp.vlrpiscompra = vlrpiscompra - :ovlrpis + :nvlrpis,
            cp.vlrbasecofinscompra = vlrbasecofinscompra - :ovlrbasecofins + :nvlrbasecofins,
            cp.vlrcofinscompra= vlrcofinscompra - :ovlrcofins + :nvlrcofins,
            cp.vlrbaseiicompra= vlrbaseiicompra - :ovlrbaseii + new.vlrbaseii,
            cp.vlriicompra= vlriicompra - :ovlrii + new.vlrii,
            cp.vlricmsdiferido= vlricmsdiferido - :vlricmsdiferido + new.vlricmsdiferido,
            cp.vlricmscredor = vlricmscredor - :vlricmsdevido + new.vlricmsdevido,
            cp.vlricmscredpresum = vlricmscredpresum - :vlricmscredpresum + new.vlricmscredpresum
            where codcompra=new.codcompra and codemp=new.codemp and codfilial=new.codfilial;
        end
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER LFITVENDATGAD
AS

    declare variable ovlrbasepis numeric(15, 5);
    declare variable ovlrbasecofins numeric(15, 5);
    declare variable ovlrpis numeric(15, 5);
    declare variable ovlrcofins numeric(15, 5);

begin
    -- Inicializao de variveis (old)
    if (old.vlrbasepis is null) then ovlrbasepis = 0; else ovlrbasepis = old.vlrbasepis;
    if (old.vlrbasecofins is null) then ovlrbasecofins = 0; else ovlrbasecofins = old.vlrbasepis;
    if (old.vlrpis is null) then ovlrpis = 0; else ovlrpis = old.vlrpis;
    if (old.vlrcofins is null) then ovlrcofins = 0; else ovlrcofins = old.vlrcofins;

    update vdvenda vd set
        vd.vlrbasepisvenda = vd.vlrbasepisvenda - :ovlrbasepis,
        vd.vlrpisvenda = vd.vlrpisvenda - :ovlrpis,
        vd.vlrbasecofinsvenda = vd.vlrbasecofinsvenda - :ovlrbasecofins ,
        vd.vlrcofinsvenda = vd.vlrcofinsvenda - :ovlrcofins
    where codvenda=old.codvenda and tipovenda=old.tipovenda and codemp=old.codemp and codfilial=old.codfilial;

end
^

/* Alter exist trigger... */
ALTER TRIGGER LFITVENDATGAI
as
    declare variable vlrbasepis numeric(15, 5);
    declare variable vlrbasecofins numeric(15, 5);
    declare variable vlrpis numeric(15, 5);
    declare variable vlrcofins numeric(15, 5);

    begin

    -- Inicializao de variveis
    if (new.vlrbasepis is null) then vlrbasepis = 0; else vlrbasepis = new.vlrbasepis;
    if (new.vlrbasecofins is null) then vlrbasecofins = 0; else vlrbasecofins = new.vlrbasepis;
    if (new.vlrpis is null) then vlrpis = 0; else vlrpis = new.vlrpis;
    if (new.vlrcofins is null) then vlrcofins = 0; else vlrcofins = new.vlrcofins;

    -- Atualizando campos de totais na tabela de venda;
    update vdvenda vd set
        vd.vlrbasepisvenda = vd.vlrbasepisvenda + :vlrbasepis ,
        vd.vlrpisvenda =  vd.vlrpisvenda + :vlrpis ,
        vd.vlrbasecofinsvenda = vd.vlrbasecofinsvenda + :vlrbasecofins ,
        vd.vlrcofinsvenda =  vd.vlrcofinsvenda + :vlrcofins
    where codvenda=new.codvenda and tipovenda=new.tipovenda and codemp=new.codemp and codfilial=new.codfilial;

end
^

/* Alter exist trigger... */
ALTER TRIGGER LFITVENDATGAU
as
    declare variable cstatus char (2);
    declare variable nvlrbasepis numeric(15, 5);
    declare variable nvlrbasecofins numeric(15, 5);
    declare variable nvlrpis numeric(15, 5);
    declare variable nvlrcofins numeric(15, 5);

    declare variable ovlrbasepis numeric(15, 5);
    declare variable ovlrbasecofins numeric(15, 5);
    declare variable ovlrpis numeric(15, 5);
    declare variable ovlrcofins numeric(15, 5);

begin
    -- Inicializao de variveis (new)
    if (new.vlrbasepis is null) then nvlrbasepis = 0; else nvlrbasepis = new.vlrbasepis;
    if (new.vlrbasecofins is null) then nvlrbasecofins = 0; else nvlrbasecofins = new.vlrbasepis;
    if (new.vlrpis is null) then nvlrpis = 0; else nvlrpis = new.vlrpis;
    if (new.vlrcofins is null) then nvlrcofins = 0; else nvlrcofins = new.vlrcofins;

    -- Inicializao de variveis (old)
    if (old.vlrbasepis is null) then ovlrbasepis = 0; else ovlrbasepis = old.vlrbasepis;
    if (old.vlrbasecofins is null) then ovlrbasecofins = 0; else ovlrbasecofins = old.vlrbasepis;
    if (old.vlrpis is null) then ovlrpis = 0; else ovlrpis = old.vlrpis;
    if (old.vlrcofins is null) then ovlrcofins = 0; else ovlrcofins = old.vlrcofins;

    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) ) ) ) then
    begin
        select vd.statusvenda from vdvenda vd
        where vd.codvenda = new.codvenda and VD.tipovenda = new.tipovenda
        and vd.codemp=new.codemp and vd.codfilial = new.codfilial
        into :cstatus;

        if (substr(:cstatus,1,1) not in ('C','N')) then
        begin
            update vdvenda vd set
            vd.vlrbasepisvenda = vd.vlrbasepisvenda - :ovlrbasepis + :nvlrbasepis,
            vd.vlrpisvenda = vlrpisvenda - :ovlrpis + :nvlrpis,
            vd.vlrbasecofinsvenda = vlrbasecofinsvenda - :ovlrbasecofins + :nvlrbasecofins,
            vd.vlrcofinsvenda= vlrcofinsvenda - :ovlrcofins + :nvlrcofins
            where codvenda=new.codvenda and tipovenda=new.tipovenda and codemp=new.codemp and codfilial=new.codfilial;
        end
    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER PPESTRUTURATGBU
as
declare variable iFinaliza smallint;
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      if (new.REFPROD IS NULL) then
         SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
             AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.REFPROD;
      IF(NEW.ativoest='S' AND NEW.ativoest!=OLD.ativoest) THEN
      BEGIN
        select count(1) from ppestrufase ef
            where ef.codemp=new.codemp and ef.codfilial=new.codfilial and
            ef.codprod=new.codprod and ef.seqest=new.seqest and ef.finalizaop='S'
            into :iFinaliza;
        if ((:iFinaliza is null) or (:iFinaliza<1) ) then
        begin
          exception ppestruturaex01;
        end
      END
 END

end
^

/* Alter exist trigger... */
ALTER TRIGGER PPITESTRUTURASUBPRODTGBI
as
begin
  new.DTINS=cast('now' AS DATE);
  new.idusuins=USER;
  new.hins = cast('now' AS TIME);
  if (new.REFPROD IS NULL) then
    SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPITESTRUTURASUBPRODTGBU
as
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
    if (new.REFPROD IS NULL) then
      SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.REFPROD;
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPITESTRUTURATGBI
as
begin
  new.DTINS=cast('now' AS DATE);
  new.idusuins=USER;
  new.hins = cast('now' AS TIME);
  if (new.REFPROD IS NULL) then
    SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPITESTRUTURATGBU
as
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      if (new.REFPROD IS NULL) then
        SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.REFPROD;
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPITOPTGAU
as
declare variable codemprma integer;
declare variable codfilialrma smallint;
declare variable codrma integer;
declare variable coditrma smallint;
declare variable sititrma char(2);
declare variable qtditrma numeric(15,5);
declare variable qtdaprovitrma numeric(15,5);
declare variable qtdexpitrma numeric(15,5);

begin
    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
    begin

        if(new.qtdcopiaitop is not null) then
        begin
            if( (new.qtdcopiaitop>0) and (old.qtdcopiaitop is null) ) then
            begin
                insert into ppitop (codemp,codfilial,codop,seqop,seqitop,
                                    codemppd, codfilialpd,codprod,refprod,
                                    qtditop, codempfs,codfilialfs, codfase,
                                    codemple,codfilialle,codlote,gerarma,SEQITOPCP)
                                    values
                                    (new.codemp,new.codfilial,new.codop,new.seqop,
                                    (select (max(op.seqitop)+1) from ppitop op
                                    where op.codemp=new.codemp and op.codfilial=new.codfilial
                                    and op.codop=new.codop and op.seqop=new.seqop),
                                    new.codemppd,new.codfilialpd,new.codprod,new.refprod,
                                    new.qtdcopiaitop,new.codempfs,new.codfilialfs,new.codfase,
                                    new.codemple, new.codfilialle,new.codloterat,new.gerarma,new.seqitop);
            end
        end
        -- Atualizando as requisies de material, caso as quantidades na OP sejam alteradas
        if(old.qtditop <> new.qtditop) then
        begin
            -- Buscando RMA Gerada para o produto de entrada
            select first 1 ir.codemp, ir.codfilial, ir.codrma, ir.coditrma, ir.sititrma,
            ir.qtditrma, ir.qtdaprovitrma, ir.qtdexpitrma
            from eqrma rm, eqitrma ir
            where rm.codemp=ir.codemp and rm.codfilial=ir.codfilial and rm.codrma=ir.codrma
            and ir.codemppd=new.codemppd and ir.codfilialpd=new.codfilialpd and ir.codprod=new.codprod
            and rm.codop=new.codop and rm.seqop=new.seqop
            into codemprma, codfilialrma, codrma, coditrma, sititrma, qtditrma, qtdaprovitrma, qtdexpitrma ;
    
            -- Atualizando item de rma
            if(sititrma='PE') then
            begin
                update eqitrma ir set ir.qtditrma=new.qtditop
                where ir.codemp=:codemprma and ir.codfilial=:codfilialrma and ir.codrma=:codrma
                and ir.coditrma=:coditrma;
            end
            else if (sititrma = 'AF' and :qtditrma=:qtdaprovitrma) then
            begin
                update eqitrma ir set ir.qtditrma=new.qtditop,ir.qtdaprovitrma=new.qtditop
                where ir.codemp=:codemprma and ir.codfilial=:codfilialrma and ir.codrma=:codrma
                and ir.coditrma=:coditrma;
            end
            else if(sititrma = 'EF' and :qtditrma=:qtdexpitrma) then
            begin
                update eqitrma ir set ir.qtditrma=new.qtditop,ir.qtdaprovitrma=new.qtditop,ir.qtdexpitrma=new.qtditop
                where ir.codemp=:codemprma and ir.codfilial=:codfilialrma and ir.codrma=:codrma
                and ir.coditrma=:coditrma;
            end
        end
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPITOPTGBI02
AS
   DECLARE VARIABLE CSALDO CHAR(1);
BEGIN
   IF (new.SEQOP=0) THEN
     CSALDO = 'S';
   ELSE
   BEGIN
     FOR SELECT OP.CODEMPLE, OP.CODFILIALLE, OP.CODLOTE
        FROM PPOP OP, PPOP OD
        WHERE
          OD.CODEMP=new.CODEMP AND OD.CODFILIAL=new.CODFILIAL AND
          OD.CODOP=new.CODOP AND OD.SEQOP=new.SEQOP AND
          OP.CODEMP=OD.CODEMPOPM AND OP.CODFILIAL=OD.CODFILIALOPM AND
          OP.CODOP=OD.CODOPM AND OP.SEQOP=OD.SEQOPM AND
          OP.CODEMPPD=new.CODEMPPD AND OP.CODFILIALPD=new.CODFILIALPD AND OP.CODPROD=new.CODPROD
        INTO new.CODEMPLE, new.CODFILIALLE, new.CODLOTE DO
        BEGIN
          CSALDO='N';
        END
   END
   IF (((CSALDO='S') OR (CSALDO IS NULL)) AND (new.CODLOTE IS NULL)) THEN
   BEGIN
     SELECT FIRST 1 L.CODEMP, L.CODFILIAL, L.CODLOTE
        FROM EQLOTE L
        WHERE L.CODPROD=NEW.codprod AND L.CODFILIAL=NEW.codfilialpd AND L.SLDLIQLOTE>0
        AND L.CODEMP=NEW.codemppd  AND L.VENCTOLOTE>=cast('today' as date)
        ORDER BY L.VENCTOLOTE, L.CODLOTE
        INTO new.CODEMPLE, new.CODFILIALLE, new.CODLOTE;
   END
END
^

/* Alter exist trigger... */
ALTER TRIGGER PPITOPTGBU
as
begin
    -- Verifica se tabela est em manuteno // caso no esteja inicia procedimentos
    if ( new.emmanut is null) then
        new.emmanut='N';
    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
    begin
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
      SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMPPD AND
        CODFILIAL=new.CODFILIALPD AND CODPROD=new.CODPROD INTO new.REFPROD;
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPCQTGBU
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
  if (new.seqac is not null and new.seqac<>old.seqac) then
  begin
       new.status = 'CO';
  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPENTRADATGAD
AS
declare variable preco decimal;
declare variable codemppd integer;
declare variable codfilialpd smallint;
declare variable codprod integer;
declare variable codemple integer;
declare variable codfilialle smallint;
declare variable codlote varchar(20);
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable codempopm integer;
declare variable codfilialopm smallint;
declare variable codopm integer;
declare variable seqopm smallint;
declare variable qtddistiop decimal(15,5);

begin

    -- Buscando custo do produto acabado
    select sum(pd.custompmprod) from ppitop it, eqproduto pd where it.codemp=old.codemp and it.codfilial=it.codfilial and
    it.codop=old.codop and it.seqop=old.seqop and
    pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and pd.codprod=it.codprod into :preco;

    -- Buscando informaes da OP
    select codemppd, codfilialpd, codprod, codemple, codfilialle, codlote, codemptm, codfilialtm, codtipomov, codempax, codfilialax, codalmox,
    codempopm, codfilialopm, codopm, seqopm, qtddistiop
    from ppop where
    codemp=old.codemp and codfilial=old.codfilial and codop=old.codop and seqop=old.seqop
    into
    :codemppd, :codfilialpd, :codprod, :codemple, :codfilialle, :codlote, :codemptm, :codfilialtm, :codtipomov, :codempax, :codfilialax, :codalmox,
    :codempopm, codfilialopm, :codopm, :seqopm, :qtddistiop;

    execute procedure eqmovprodiudsp('U', :codemppd, :codfilialpd, :codprod,
        :codemple, :codfilialle, :codlote, :codemptm,
        :codfilialtm, :codtipomov, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, null, null, null, null, old.codemp, old.codfilial, old.codop, old.seqop, old.seqent,
        null, null, null,
        old.dtent, old.codop, 'N', 0,:preco,
        :codempax, :codfilialax, :codalmox, null, 'S', 'N' );

   if (:codopm is not null) then
   begin
      execute procedure ppatudistopsp( :codempopm, :codfilialopm, :codopm, :seqopm, :qtddistiop, 0);
   end
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPENTRADATGAI
as
declare variable preco numeric;
declare variable qtdest numeric;
declare variable codemppd integer;
declare variable codfilialpd smallint;
declare variable codprod integer;
declare variable codemple integer;
declare variable codfilialle smallint;
declare variable codlote varchar(20);
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable codempopm integer;
declare variable codfilialopm smallint;
declare variable codopm integer;
declare variable seqopm smallint;
declare variable qtddistiop decimal(15,5);
declare variable seqest integer;
declare variable prodetapas char(1);

begin

    -- Buscando preferncias de produo

    select coalesce(p5.prodetapas,'N') from sgprefere5 p5 where p5.codemp=new.codemp and p5.codfilial=new.codfilial
    into :prodetapas;

    -- Buscando informaes da OP
    select codemppd, codfilialpd, codprod, codemple, codfilialle, codlote, codemptm, codfilialtm, codtipomov, codempax, codfilialax, codalmox,
    codempopm, codfilialopm, codopm, seqopm, qtddistiop, seqest
    from ppop where codemp=new.codemp and codfilial=new.codfilial and codop=new.codop and seqop=new.seqop
    into
    :codemppd, :codfilialpd, :codprod, :codemple, :codfilialle, :codlote, :codemptm, :codfilialtm, :codtipomov, :codempax, :codfilialax, :codalmox,
    :codempopm, codfilialopm, :codopm, :seqopm, :qtddistiop, :seqest;

    select pe.qtdest from ppestrutura pe
    where pe.codemp=:codemppd and pe.codfilial=:codfilialpd and
    pe.codprod=:codprod and pe.seqest=:seqest into :qtdest;

    if (:codopm is not null) then
    begin
        execute procedure ppatudistopsp( :codempopm, :codfilialopm, :codopm, :seqopm, :qtddistiop, 0);
    end

    -- Se o processo de finalizao for em etapas deve gerar movimentao de estoque vinculada ao item de entrada da O.P.
    if( :prodetapas = 'S' ) then
    begin

        -- Buscando custo do produto acabado
        select sum((select ncustompm from eqprodutosp01(it.codemppd,it.codfilialpd,it.codprod,null,null,null,op.dtfabrop)) * it.qtditop ) / op.qtdprevprodop
        from ppitop it, eqproduto pd, ppop op
        where it.codemp=new.codemp and it.codfilial=it.codfilial
        and it.codop=new.codop and it.seqop=new.seqop
        and pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd
        and pd.codprod=it.codprod
        and op.codemp=new.codemp and op.codfilial=new.codfilial and op.codop=new.codop and op.seqop=new.seqop
        group by op.qtdprevprodop
        into :preco;

        execute procedure EQMOVPRODIUDSP('I', :CODEMPPD, :CODFILIALPD, :CODPROD,
        :CODEMPLE, :CODFILIALLE, :codlote, :codemptm,
        :codfilialtm, :codtipomov, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, null, null, null, null,new.codemp, new.codfilial,new.codop, new.seqop, new.seqent,
        null, null,  null, new.dtent, new.codop,
        'S',new.qtdent,cast(:preco as numeric(15,5)),
        :codempax, :codfilialax, :codalmox, null, 'S', 'N' );

        -- Atualizando quantidade final produzida na O.P.
        update ppop op set
        op.qtdfinalprodop=( select sum(et.qtdent) from ppopentrada et
                            where et.codemp=new.codemp and et.codfilial=new.codfilial and et.codop=new.codop and et.seqop=new.seqop
                           )
        where op.codemp=new.codemp and op.codfilial=new.codfilial and op.codop=new.codop and op.seqop=new.seqop;

    end

    if (:CODOPM is not null) then EXECUTE PROCEDURE PPATUDISTOPSP(:CODEMPOPM, :CODFILIALOPM, :CODOPM, :SEQOPM, 0, :QTDDISTIOP);

end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPFASETGAI
AS
declare variable ctipofase char(2);
declare variable imesesdesccp smallint;
declare variable ddtdescarte date;
declare variable ddtvalidop date;
declare variable icodempest integer;
declare variable icodfilialest smallint;
declare variable icodprodest integer;
declare variable iseqest smallint;
declare variable icodemppd integer;
declare variable icodfilialpd smallint;
declare variable icodprodpd integer;
declare variable icoditretcp smallint;
declare variable iqtd decimal(15,5);
declare variable numretcp integer;

begin
  select tipofase from ppfase where codemp=new.codempfs and codfilial=new.codfilialfs and codfase=new.codfase
      into :ctipofase;

  if(ctipofase='CQ') then
  begin

    select max(sg.mesesdesccp) from sgprefere5 sg where codemp=new.codemp and codfilial=new.codfilial
      into :imesesdesccp;

    select op.codemppd, op.codfilialpd, op.codprod, op.seqest, op.dtvalidpdop
        from ppop op
            where op.codemp = new.codemp and op.codfilial=new.codfilial and op.codop=new.codop
                and op.seqop=new.seqop
        into :icodempest,:icodfilialest,:icodprodest,:iseqest,:ddtvalidop;

    ddtdescarte = cast(addmonth(:ddtvalidop,:imesesdesccp) as date);

   -- Buscando o numero de contra provas (Deve haver apenas 1)
   select count(*) from ppretcp rc where rc.codemp=new.codemp and rc.codfilial=new.codfilial and rc.codop=new.codop and rc.seqop=new.seqop
   into :numretcp;
   
   if(:numretcp is null or :numretcp <1) then
   begin
       insert into ppretcp (codemp,codfilial,codop,seqop,dtdescarte)
       values(new.codemp,new.codfilial, new.codop,new.seqop,:ddtdescarte);


       for select it.codemppd,it.codfilialpd,it.codprodpd,it.seqitest,it.qtditest from ppitestrutura it
           where it.codemp = :icodempest and it.codfilial=:icodfilialest and it.codprod=:icodprodest
               and it.seqest = :iseqest and it.codempfs=new.codempfs and it.codfilialfs=new.codfilialfs
               and it.codfase = new.codfase
       into :icodemppd,:icodfilialpd,:icodprodpd,:icoditretcp,:iqtd do
       begin
           insert into ppitretcp (codemp,codfilial,codop,seqop,coditretcp,codemppd,codfilialpd,codprod,qtditret)
           values(new.codemp,new.codfilial,new.codop,new.seqop, :icoditretcp,:icodemppd,:icodfilialpd,:icodprodpd,:iqtd);
       end

    end
  end

  end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPFASETGBU0
as
declare variable finaliza char(2);
declare variable qtdpe smallint;
declare variable icodemptm int;
declare variable icodfilialtm smallint;
declare variable icodtipomov integer;

begin

    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT = cast('now' AS TIME);

    if ((new.sitfs!='FN') and (new.datafimprodfs is not null)) then
    begin

        new.sitfs = 'FN';

        select ef.finalizaop
            from ppestrufase ef, ppopfase pf, ppop op
            where
                ef.codemp = op.codemppd and ef.codfilial = op.codfilialpd
                and ef.codprod = op.codprod and ef.seqest = op.seqest
                and ef.codempfs = pf.codempfs and ef.codfilialfs = pf.codfilialfs
                and ef.codfase = pf.codfase and pf.codemp = op.codemp
                and pf.codfilial = op.codfilial and pf.codop = op.codop
                and pf.seqop = op.seqop and pf.seqof = new.seqof
                and op.codemp=new.codemp and op.codfilial=new.codfilial
                and op.codop=new.codop and op.seqop=new.seqop and ef.seqef = pf.seqof
             into :finaliza;

        if (:finaliza='S') then
            begin
                select count(1)
                    from ppopfase pf
                    where pf.codemp = new.codemp and pf.codfilial=new.codfilial
                        and pf.codop=new.codop and pf.seqop=new.seqop and pf.sitfs<>'FN'
                into :qtdpe;

                if(:qtdpe>1) then
                begin
                    exception ppopfase 'O processo no poder ser concludo, pois existem fases pendentes!';
                end
                else
                begin
                    update ppop set sitop = 'FN'
                        where codemp = new.codemp and codfilial = new.codfilial
                            and codop = new.codop and seqop = new.seqop;
                end
            end
        end
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPSUBPRODTGAD
AS
declare variable preco decimal(15,5);
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable dtestoque date;
begin

    --Buscando almoxarifado do produto
    select codempax, codfilialax, codalmox from eqproduto where codemp=old.codemppd and codfilial=old.codfilialpd and codprod=old.codprod
    into :codempax, :codfilialax, :codalmox;

    -- Buscando custo do produto;
    select ncustompm from eqprodutosp01(old.codemppd,old.codfilialpd,old.codprod,null,null,null, cast('today' as date))
    into :preco;

    -- Buscando data de finalizao da fase
    select coalesce(fs.datafimprodfs,op.dtemitop) from ppopfase fs, ppop op
    where
    op.codemp=fs.codemp and op.codfilial=fs.codfilial and op.codop=fs.codop and op.seqop=fs.seqop and
    fs.codemp=old.codemp and fs.codfilial=old.codfilial and fs.codop=old.codop and fs.seqop=old.seqop and fs.codempfs=old.codempfs
    and fs.codfilialfs=old.codfilialfs and fs.codfase=old.codfase and fs.seqof=old.seqof
    into :dtestoque;

 
   EXECUTE PROCEDURE EQMOVPRODIUDSP('D',old.CODEMPPD, old.CODFILIALPD, old.CODPROD,
        old.CODEMPLE, old.CODFILIALLE, old.codlote, old.codemptm,
        old.codfilialtm, old.codtipomov, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, null, null, null, null, old.codemp, old.codfilial, old.codop, old.seqop, null,
        null, null, null,
        :dtestoque, old.codop, 'N', old.qtditsp,:preco,
        :codempax, :codfilialax, :codalmox, old.seqsubprod, 'S', 'N' );
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPSUBPRODTGAI
AS
declare variable dtestoque date;
declare variable preco decimal(15,5);
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
begin

    --Buscando almoxarifado do produto
    select codempax, codfilialax, codalmox from eqproduto where codemp=new.codemppd and codfilial=new.codfilialpd and codprod=new.codprod
    into :codempax, :codfilialax, :codalmox;

    -- Buscando custo do produto;
    select ncustompm from eqprodutosp01(new.codemppd,new.codfilialpd,new.codprod,null,null,null,cast('today' as date))
    into :preco;

    -- Buscando data de finalizao da fase
    select coalesce(fs.datafimprodfs,op.dtemitop) from ppopfase fs, ppop op
    where
    op.codemp=fs.codemp and op.codfilial=fs.codfilial and op.codop=fs.codop and op.seqop=fs.seqop and
    fs.codemp=new.codemp and fs.codfilial=new .codfilial and fs.codop=new.codop and fs.seqop=new.seqop and fs.codempfs=new.codempfs
    and fs.codfilialfs=new.codfilialfs and fs.codfase=new.codfase and fs.seqof=new.seqof
    into :dtestoque;

    EXECUTE PROCEDURE EQMOVPRODIUDSP('I',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
    new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
    new.codfilialtm, new.codtipomov, null, null, null ,null, null,
    null, null, null, null, null, null,
    null, null, null, null, null,new.codemp, new.codfilial,new.codop, new.seqop, null,
    null, null,  null, :dtestoque, new.codop,
    'N',0.00,cast(:preco as numeric(15,5)),
    :codempax, :codfilialax, :codalmox, new.seqsubprod, 'S', 'N' );

end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPSUBPRODTGAU
AS
declare variable preco decimal(15,5);
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;

begin
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
    if ( new.qtditsp>0 and (old.dtsubprod is null and new.dtsubprod is not null) ) then
        begin

            --Buscando almoxarifado do produto
            select codempax, codfilialax, codalmox from eqproduto where codemp=new.codemppd and codfilial=new.codfilialpd and codprod=new.codprod
            into :codempax, :codfilialax, :codalmox;

            -- Buscando custo do produto;
            select ncustompm from eqprodutosp01(new.codemppd,new.codfilialpd,new.codprod,null,null,null, cast('today' as date))
            into :preco;

            execute procedure eqmovprodiudsp('U',new.codemppd, new.codfilialpd, new.codprod,
                new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
                new.codfilialtm, new.codtipomov, null, null, null ,null, null,
                null, null, null, null, null, null,null, null, null, null, null,
                new.codemp, new.codfilial,new.codop,new.seqop, null, null, null, null,
                new.dtsubprod , new.codop, 'N', new.qtditsp,:preco,
                :codempax, :codfilialax, :codalmox, new.seqsubprod, 'S', 'N' );
        end
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPSUBPRODTGBU
as
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN  
      SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMPPD AND
        CODFILIAL=new.CODFILIALPD AND CODPROD=new.CODPROD INTO new.REFPROD;
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPTGAD
AS
declare variable preco decimal;
begin
  select sum(pd.custompmprod) from ppitop it, eqproduto pd where it.codemp=old.codemp and it.codfilial=it.codfilial and
    it.codop=old.codop and it.seqop=old.seqop and
    pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and pd.codprod=it.codprod into :preco;

   EXECUTE PROCEDURE EQMOVPRODIUDSP('D',old.CODEMPPD, old.CODFILIALPD, old.CODPROD,
        old.CODEMPLE, old.CODFILIALLE, old.codlote, old.codemptm,
        old.codfilialtm, old.codtipomov, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, null, null, null, null, old.codemp, old.codfilial, old.codop, old.seqop, null,
        null, null, null,
        old.dtfabrop, old.codop, 'N', old.qtdfinalprodop,:preco,
        old.codempax, old.codfilialax, old.codalmox, null, 'S', 'N' );

   if (old.CODOPM is not null) then
      EXECUTE PROCEDURE PPATUDISTOPSP(old.CODEMPOPM, old.CODFILIALOPM, old.CODOPM,
        old.SEQOPM, old.QTDDISTIOP, 0);

end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPTGAI
as
declare variable preco numeric;
declare variable qtdest numeric;
declare variable prodetapas char(1);
begin

   EXECUTE PROCEDURE PPITOPSP01(new.CODEMP, new.CODFILIAL, new.CODOP, new.SEQOP);

   EXECUTE PROCEDURE ppgeraopcq (new.CODEMP, new.CODFILIAL, new.CODOP, new.SEQOP);

   select sum(pd.custompmprod) from ppitop it, eqproduto pd where it.codemp=new.codemp and
   it.codfilial=it.codfilial and it.codop=new.codop and it.seqop=new.seqop and
   pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and
   pd.codprod=it.codprod into :preco;

   select pe.qtdest from ppestrutura pe
      where pe.codemp=new.codemppd and pe.codfilial=new.codfilialpd and
      pe.codprod=new.codprod and pe.seqest=new.seqest into :qtdest;

   -- Buscando preferncias de produo

   select coalesce(p5.prodetapas,'N') from sgprefere5 p5 where p5.codemp=new.codemp and p5.codfilial=new.codfilial
   into :prodetapas;

   -- Se o processo de finalizao no for em etapas deve gerar movimentao de estoque vinculada diretamente a O.P.
   if( :prodetapas = 'N' or :prodetapas is null ) then
   begin

       EXECUTE PROCEDURE EQMOVPRODIUDSP('I',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
            new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
            new.codfilialtm, new.codtipomov, null, null, null ,null, null,
            null, null, null, null, null, null,
            null, null, null, null, null,new.codemp, new.codfilial,new.codop, new.seqop, null,
            null, null,  null, new.dtfabrop, new.codop,
            'N',new.qtdfinalprodop,cast(:preco as numeric(15,5)),
            new.codempax, new.codfilialax, new.codalmox, null, 'S', 'N' );

       if (new.CODOPM is not null) then
          EXECUTE PROCEDURE PPATUDISTOPSP(new.CODEMPOPM, new.CODFILIALOPM, new.CODOPM,
            new.SEQOPM, 0, new.QTDDISTIOP);

   end

end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPTGAU
as
declare variable preco decimal(15,5);
declare variable codempoc integer;
declare variable codfilialoc smallint;
declare variable tipoorc char(1);
declare variable codorc integer;
declare variable coditorc smallint;
declare variable prodetapas char(1);
declare variable qtdprodorc decimal(15,5);

begin

    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
    begin

        -- Buscando preferncias de produo
    
        select coalesce(p5.prodetapas,'N') from sgprefere5 p5 where p5.codemp=new.codemp and p5.codfilial=new.codfilial
        into :prodetapas;
    
        /*Cancelamento de O.P */
        
        if(old.sitop!='CA' and new.sitop = 'CA') then
        begin
    
            /* Cancelamento de movimentao de estoque */
    
            -- Se o processo de finalizao no for em etapas deve gerar movimentao de estoque vinculada diretamente a O.P.
            if( :prodetapas = 'N' ) then
            begin
                execute procedure eqmovprodiudsp('D',new.codemppd, new.codfilialpd, new.codprod,
                    new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
                    new.codfilialtm, new.codtipomov, null, null, null ,null, null,
                    null, null, null, null, null, null,null, null, null, null, null,
                    new.codemp, new.codfilial,new.codop,new.seqop, null, null, null, null,
                    new.dtfabrop, new.codop, null, new.qtdfinalprodop,:preco,
                    new.codempax, new.codfilialax, new.codalmox, null, 'S', 'N' );
            end
            else
            begin
    
                delete from ppopentrada et where et.codemp=new.codemp and et.codfilial=new.codfilial and et.codop=new.codop and et.seqop=new.seqop;
    
            end
    
            -- Desfazendo vinculos com tem de oramento
            delete from ppopitorc oi where oi.codemp=new.codemp and oi.codfilial=new.codfilial
            and oi.codop=new.codop and oi.seqop=new.seqop;
    
            -- Cancelando as RMAs vinculadas
            update eqrma rma set rma.sitrma='CA', rma.motivocancrma='Ordem de produo original cancelada!'
            where rma.codempof=new.codemp and rma.codfilialof=new.codfilial and rma.codop=new.codop and rma.seqop=new.seqop;
    
            -- Excluindo subproducao
            delete from ppopsubprod where codemp=new.codemp and codfilial=new.codfilial and codop=new.codop and seqop = new.seqop;
    
        end
        else if (old.sitop!='FN' and new.sitop='FN') then
        begin
            -- Atualizando status do tem de oramento na finalizao da OP
            for select oi.codempoc,oi.codfilialoc, oi.tipoorc, oi.codorc, oi.coditorc
            from ppopitorc oi
            where oi.codemp=new.codemp and oi.codfilial=new.codfilial and oi.codop=new.codop and oi.seqop=new.seqop
            into :codempoc, :codfilialoc, :tipoorc, :codorc, :coditorc do
            begin
                update vditorcamento io set io.sitproditorc = 'PD'
                where io.codemp=:codempoc and io.codfilial=:codfilialoc and io.tipoorc=:tipoorc
                and io.codorc=:codorc and io.coditorc=:coditorc;
            end
    
            if( :prodetapas = 'N' ) then
            begin
                -- Buscando custo do produto acabado
               if ( (new.qtdfinalprodop is null) or (new.qtdfinalprodop=0) ) then
               begin
                  preco = 0;
               end
               else
               begin
                   select cast(cast(sum( cast((select cast(ncustompm as decimal(15,5)) 
                   from eqprodutosp01(it.codemppd,it.codfilialpd,it.codprod,null,null,null, new.dtfabrop)) as decimal(15,5)) * it.qtditop ) 
                   as decimal(15,5)) / new.qtdfinalprodop as decimal(15,5))
                       from ppitop it, eqproduto pd
                       where it.codemp=new.codemp and it.codfilial=it.codfilial
                       and it.codop=new.codop and it.seqop=new.seqop
                       and pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd
                       and pd.codprod=it.codprod
                   into :preco;
               end
    
               execute procedure eqmovprodiudsp('U',new.codemppd, new.codfilialpd, new.codprod,
                    new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
                    new.codfilialtm, new.codtipomov, null, null, null ,null, null,
                    null, null, null, null, null, null,null, null, null, null, null,
                    new.codemp, new.codfilial,new.codop,new.seqop, null, null, null, null,
                    new.dtfabrop, new.codop, 'N', new.qtdfinalprodop,:preco,
                    new.codempax, new.codfilialax, new.codalmox, null, 'S', 'N' );
    
                -- Buscando quantidade de produto acabado destinado a oramentos;
                select cast(sum(oo.qtdprod) as decimal(15,5)) from ppopitorc oo
                where oo.codemp=new.codemp and oo.codfilial=new.codfilial and oo.codop=new.codop and oo.seqop=new.seqop
                into :qtdprodorc;
    
                -- Atualizando a quantidade final produzida por item de oramento;
    
                if(:qtdprodorc is not null and :qtdprodorc > 0 ) then
                begin
    
                    update ppopitorc oo set oo.qtdfinalproditorc = cast( ( cast(cast(oo.qtdprod as decimal(15,5)) /  cast(:qtdprodorc as decimal(15,5) ) as decimal(15,5)) * (cast(new.qtdfinalprodop as decimal(15,5)))) as decimal(15,5) )
                    where oo.codemp=new.codemp and oo.codfilial=new.codfilial and oo.codop=new.codop and oo.seqop=new.seqop;
    
                end
    
            end
            
            else
            begin    --se for em etapas executar a atualizao dos itens de RMA
                   execute procedure ppitopsp02(new.codemp, new.codfilial, new.codop, new.seqop);
            end
            
        end
    
        /* Outras aes */
    
        else
        begin
            if (old.qtdprevprodop <> new.qtdprevprodop ) then
            begin
                delete from ppitop
                    where codemp=new.codemp AND codfilial=new.codfilial
                        and codop=new.codop and seqop=new.seqop;
    
                delete from PPOPFASE
                    where codemp=new.codemp and codfilial=new.codfilial
                        and codop=new.codop and seqop=new.seqop;
    
                execute procedure ppitopsp01(new.codemp, new.codfilial, new.codop, new.seqop);
            end
    
            if( (old.qtdfinalprodop <> new.qtdfinalprodop) and (new.qtdfinalprodop>0) ) then
            begin
    
                if( :prodetapas = 'N' ) then
                begin
    
                    -- Buscando custo do produto acabado
                    select cast(sum((select ncustompm from eqprodutosp01(it.codemppd,it.codfilialpd,it.codprod,null,null,null, new.dtfabrop)) * it.qtditop ) / new.qtdfinalprodop as decimal(15,5))
    
                    from ppitop it, eqproduto pd
                    where it.codemp=new.codemp and it.codfilial=it.codfilial
                    and it.codop=new.codop and it.seqop=new.seqop
                    and pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd
                    and pd.codprod=it.codprod
                    into :preco;
    
                    execute procedure eqmovprodiudsp('U',new.codemppd, new.codfilialpd, new.codprod,
                    new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
                    new.codfilialtm, new.codtipomov, null, null, null ,null, null,
                    null, null, null, null, null, null,null, null, null, null, null,
                    new.codemp, new.codfilial,new.codop,new.seqop, null, null, null, null,
                    new.dtfabrop, new.codop, 'N', new.qtdfinalprodop,:preco,
                    new.codempax, new.codfilialax, new.codalmox, null, 'S', 'N' );
    
                end
    
                execute procedure ppitopsp02(new.codemp, new.codfilial, new.codop, new.seqop);
    
            end
            if (new.CODOPM is not null) then
                execute procedure ppatudistopsp(new.codempopm, new.codfilialopm, new.codopm,
                    new.seqopm, old.qtddistiop, new.qtddistiop);
    
        end
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPTGBU
as
declare variable prodetapas char(1);
begin

    -- Verifica se tabela est em manuteno // caso no esteja inicia procedimentos
    if ( new.emmanut is null) then
        new.emmanut='N';

    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
    begin

        new.DTALT=cast('now' AS DATE);
        new.IDUSUALT=USER;
        new.HALT = cast('now' AS TIME);
        SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP AND
        CODFILIAL=new.CODFILIAL AND CODPROD=new.CODPROD INTO new.REFPROD;
    
        -- Buscando preferncias de produo
        select coalesce(p5.prodetapas,'N') from sgprefere5 p5 where p5.codemp=new.codemp and p5.codfilial=new.codfilial
        into :prodetapas;
    
        if('S'=:prodetapas) then
        begin
    
            if( new.qtdfinalprodop>=new.qtdprevprodop ) then
            begin
                select coalesce(tm.codemptm,tm.codemp),coalesce(tm.codfilialtm,tm.codfilial),coalesce(tm.codtipomovtm,tm.codtipomov)
                from eqtipomov tm, ppop op
                where tm.codemp=op.codemptm and tm.codfilial=op.codfilialtm and tm.codtipomov=op.codtipomov
                and op.codemp=new.codemp and op.codfilial=new.codfilial and op.codop=new.codop
                and op.seqop=new.seqop
                into new.codemptm,new.codfilialtm,new.codtipomov;
                if (new.sitop<>'CA') then 
                    new.sitop='FN';
            end
    
        end
        else
        begin
            if(new.qtdfinalprodop>0 and new.qtdfinalprodop<>old.qtdfinalprodop) then
            begin
                select coalesce(tm.codemptm,tm.codemp),coalesce(tm.codfilialtm,tm.codfilial),coalesce(tm.codtipomovtm,tm.codtipomov)
                from eqtipomov tm, ppop op
                where tm.codemp=op.codemptm and tm.codfilial=op.codfilialtm and tm.codtipomov=op.codtipomov
                and op.codemp=new.codemp and op.codfilial=new.codfilial and op.codop=new.codop
                and op.seqop=new.seqop
                into new.codemptm,new.codfilialtm,new.codtipomov;
                if (new.sitop<>'CA') then 
                    new.sitop='FN';
            end
         end
    
         if(new.sitop='CA' and old.sitop<>'CA') then
         begin
             new.idusucanc=USER;
             new.dtcanc=cast('now' AS DATE);
             new.hcanc = cast('now' AS TIME);
         end
    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER PVCAIXATGBU
as
  DECLARE VARIABLE ICOUNTSEQ INTEGER;
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT=cast('now' AS TIME);
  
  IF ((old.SEQINI<>new.SEQINI) or (old.SEQMAX<>new.SEQMAX) ) THEN
  BEGIN
     SELECT COUNT(SEQCAIXA) FROM PVSEQUENCIA
        WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL
        AND CODCAIXA=new.CODCAIXA
        INTO :ICOUNTSEQ;
     IF (:ICOUNTSEQ > 0) THEN
        EXCEPTION PVSEQCAIXA01 'J EXISTEM VENDAS DENTRO DESTA FAIXA DE VENDA';
  END

  EXECUTE PROCEDURE PVVALIDFAIXACAIXASP(new.CODEMP, new.CODFILIAL, new.CODCAIXA, new.SEQINI, new.SEQMAX);

end
^

/* Alter exist trigger... */
ALTER TRIGGER PVMOVCAIXATGBI
as
declare variable iMov INTEGER;
declare variable dSaldo NUMERIC(15, 5);
begin
  if (new.vlrsldmov is NULL) then
  BEGIN
    SELECT MAX(NROMOV) FROM PVMOVCAIXA WHERE CODEMP=new.CODEMP
      AND CODFILIAL=new.CODFILIAL AND CODCAIXA=new.CODCAIXA
      AND DTAMOV=new.DTAMOV INTO iMov;
    SELECT coalesce(vlrsldmov,0) FROM PVMOVCAIXA WHERE CODEMP=new.CODEMP
      AND CODFILIAL=new.CODFILIAL AND CODCAIXA=new.CODCAIXA
      AND DTAMOV=new.DTAMOV AND NROMOV=:iMov INTO dSaldo;
    new.vlrsldmov = dSaldo + new.vlrmov;
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER SGAGENDATGBU
AS -- Mecanismo de troca de usuario da agenda
declare variable codagd integer;
begin
    new.DTALT=cast('now' as date);
    new.IDUSUALT=USER;
    new.HALT = cast('now' as time);

  if(new.codage != old.codage) then
  begin
      select iseq from spgeranum(new.codemp,new.codfilial,'AG') into codagd;
      /*Insere o agendamento para o novo usurio*/
      insert into sgagenda (
            codemp, codfilial, codage, tipoage, codagd,
            dataagd, dtainiagd, hriniagd, dtafimagd, hrfimagd,
            assuntoagd, descagd, codempta, codfilialta, codtipoagd, prioragd, sitagd,
            codempae, codfilialae, codageemit, tipoageemit, caagd, resolucaomotivo,
            codempar,codfilialar,codagear,tipoagear,codagdar)
        values (
            new.codemp, new.codfilial, new.codage, new.tipoage, :codagd,
            new.dataagd, new.dtainiagd, new.hriniagd, new.dtafimagd, new.hrfimagd,
            new.assuntoagd, new.descagd, new.codempta, new.codfilialta, new.codtipoagd,
            new.prioragd, new.sitagd,new.codempae, new.codfilialae, new.codageemit, new.tipoageemit,
            new.caagd, new.resolucaomotivo, new.codempar, new.codfilialar, new.codagear, new.tipoagear,
            new.codagdar);

        new.codage = old.codage; -- Cancela a troca de usuario;
        new.sitagd = 'CA'; -- Cancela agendamento atual;
  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER SGUSUARIOTGBU
as
  declare variable CUID char(1);
begin

    new.DTALT=cast('now' as date);
    new.IDUSUALT=USER;
    new.HALT = cast('now' as time);

    if (new.codage is null) then
        CUID = 'I';
    else
        CUID = 'U';

    select codemp, codfilial, tipoage, codage
    from sgagenteuidsp(:CUID,new.codemp, 'SGUSU', new.codage, new.nomeusu)
    into new.codempae, new.codfilialae, new.tipoage, new.codage;

end
^

/* Alter exist trigger... */
ALTER TRIGGER TKCONTATOTGBU
as
  declare variable nomemuniccto CHAR(30);
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);

   /*Atualizao do campo cidade e estado (temporrio para retro-compatibilidade)*/

    if(old.codmunic != new.codmunic) then
    begin
        select substr(mun.nomemunic,1,30) from sgmunicipio mun
            where mun.codpais=new.codpais and mun.siglauf=new.siglauf and mun.codmunic=new.codmunic
                into :nomemuniccto;
        if (nomemuniccto is not null) then new.cidcto = nomemuniccto;
    end

    if(new.siglauf is not null) then
    begin
        new.ufcto=new.siglauf;
    end

    /* Fim da atualizao do campo cidade */

end
^

/* Alter exist trigger... */
ALTER TRIGGER VDCLCOMISTGBU
AS
begin

  if ( (new.percfatclcomis+new.percpgtoclcomis) != 100.00) then
  begin
     exception VDCLCOMISEX01;
  end

  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT=cast('now'AS TIME);

end
^

/* Alter exist trigger... */
ALTER TRIGGER VDCLIENTETGBU
as
    declare variable nomemuniccli CHAR(30);
    declare variable nomemunicent CHAR(30);
    declare variable nomemuniccob CHAR(30);
    declare variable filialpref smallint;
    declare variable geracodunif char(1);
    declare variable codunifcod integer;

begin
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=user;
    new.HALT = cast('now' AS TIME);

    if (new.codpesq is null) then
    begin
        new.codemppq = new.codemp;
        new.codfilialpq = new.codfilial;
        new.codpesq = new.codcli;
    end

    /*Atualizao do campo cidade e estado (temporrio para retro-compatibilidade)*/

    if ( ((old.codmunic is null) and (new.codmunic is not null)) or
         (old.codmunic<>new.codmunic) ) then
    begin
        select substr(mun.nomemunic,1,30) from sgmunicipio mun
            where mun.codpais=new.codpais and mun.siglauf=new.siglauf and mun.codmunic=new.codmunic
                into :nomemuniccli;
        if (nomemuniccli is not null) then new.cidcli = nomemuniccli;
    end

    if(new.siglauf is not null) then
    begin
        new.ufcli=new.siglauf;
    end

    if(old.codmunicent != new.codmunicent) then
    begin
        select substr(mun.nomemunic,1,30) from sgmunicipio mun
            where mun.codpais=new.codpaisent and mun.siglauf=new.siglaufent and mun.codmunic=new.codmunicent
                into :nomemunicent;

        if (nomemunicent is not null) then new.cident = nomemunicent;
    end

    if(new.siglaufent is not null) then
    begin
        new.ufent=new.siglaufent;
    end

    if(old.codmuniccob != new.codmuniccob) then
    begin
        select substr(mun.nomemunic,1,30) from sgmunicipio mun
            where mun.codpais=new.codpaiscob and mun.siglauf=new.siglaufcob and mun.codmunic=new.codmuniccob
                into :nomemuniccob;

        if (nomemuniccob is not null) then new.cidcob = nomemuniccob;
    end

    if(new.siglaufcob is not null) then
    begin
        new.ufcob=new.siglaufcob;
    end

    /* Dados da ltima reviso do cliente*/
    if ( (coalesce(old.sitrevcli,'N')='O') and (coalesce(new.sitrevcli,'O')='R') ) then
    begin
       new.dtrevcli = cast('now' as date);
       new.hrevcli = cast('now' as time);
       new.idusurevcli = upper(user);
    end 
    /* Fim da atualizao do campo cidade */

    -- Gerao de cdigo unificador (SGUNIFCOD)

    if (new.codunifcod is null) then
    begin
      select icodfilial from sgretfilial(new.codemp,'SGPREFERE1') into filialpref;
      select geracodunif from sgprefere1 where codemp=new.codemp and codfilial=:filialpref into :geracodunif;
    
      if( :geracodunif = 'S' ) then
      begin

         select (coalesce(max(codunifcod),0)+1) from sgunifcod where codemp=new.codemp and codfilial=new.codfilial
         into :codunifcod;

         insert into sgunifcod (codemp, codfilial, codunifcod, tipounifcod, descunifcod)
         values (new.codemp, new.codfilial, :codunifcod, 'C', new.razcli);

         new.codempuc=new.codemp;
         new.codfilialuc=new.codfilial;
         new.codunifcod=:codunifcod;

       end
    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER VDCOMISSAOTGBI
AS
begin
  new.DTINS = cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  new.VLRAPAGCOMI = new.VLRCOMI - new.VLRPAGOCOMI;
  if (new.DTCOMPCOMI IS NULL) then
     new.DTCOMPCOMI = new.DATACOMI;
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDCOMISSAOTGBU
AS
BEGIN
  if (new.EMMANUT IS NULL) then
     new.EMMANUT = 'N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
     new.DTALT=cast('now' AS DATE);
     new.IDUSUALT=USER;
     new.HALT = cast('now' AS TIME);
     IF ( ( new.DTCOMPCOMI IS NULL ) OR ( new.DATACOMI<>old.DATACOMI ) ) THEN
        new.DTCOMPCOMI = new.DATACOMI;
     IF ( OLD.STATUSCOMI = 'CP' AND NEW.STATUSCOMI = 'C1' ) then
       EXCEPTION VDCOMISSAOEX01;
     ELSE if ( OLD.STATUSCOMI='CP' AND NEW.STATUSCOMI='CP' AND OLD.VLRCOMI!=NEW.VLRCOMI ) then
       EXCEPTION VDCOMISSAOEX01;
     ELSE IF ( OLD.STATUSCOMI = 'C1' AND NEW.STATUSCOMI = 'CP' ) then
       EXCEPTION VDCOMISSAOEX02;
     ELSE IF ( OLD.STATUSCOMI = 'CP' AND NEW.STATUSCOMI = 'CD' ) THEN /* Estorno de comisses */
     BEGIN
        new.STATUSCOMI ='C2';
        new.CODEMPCI = null;
        new.CODFILIALCI = null;
        new.CODPCOMI = null;
        new.VLRPAGOCOMI = 0;
     END
     IF ( new.VLRCOMI IS NULL) THEN
       new.VLRCOMI = 0;
     IF ( new.VLRPAGOCOMI IS NULL ) THEN
       new.VLRPAGOCOMI = 0;
     new.VLRAPAGCOMI = new.VLRCOMI - new.VLRPAGOCOMI;
  END
END
^

/* Alter exist trigger... */
ALTER TRIGGER VDFRETEVDTGAI
as
declare variable vlrliqvenda numeric(15,5);
declare variable vlrbaseicmsfretevd numeric(15,5);
declare variable vlricmsfretevd numeric(15,5);
begin
    -- Buscando valor liquido da venda
    select vlrliqvenda from vdvenda
    where tipovenda=new.tipovenda and codvenda=new.codvenda and codemp=new.codemp and codfilial=new.codfilial
    into vlrliqvenda;
    
    -- Calcula o percentual do frete sobre o valor da venda
    if (not vlrliqvenda is null and vlrliqvenda > 0 and not new.percvendafretevd > 0) then
    begin
        new.percvendafretevd = (new.vlrfretevd/:vlrliqvenda)*100;
    end

    -- Atualizando valor do frete na tabela de venda.

    update vdvenda vd set vd.vlrfretevenda = new.vlrfretevd
    where vd.codemp=new.codemp and vd.codfilial=new.codfilial and vd.codvenda=new.codvenda and vd.tipovenda=new.tipovenda;

    -- Busca totais da base de calculo do icms do frete e valor do icms do frete
    select sum(lfi.vlrbaseicmsfreteitvenda), sum(lfi.vlricmsfreteitvenda) from lfitvenda lfi
    where lfi.codemp=new.codemp and lfi.codfilial=new.codfilial and lfi.codvenda=new.codvenda and lfi.tipovenda=new.tipovenda
    into :vlrbaseicmsfretevd, :vlricmsfretevd;

    -- Atualizando os valores (supondo que j houve o reprocessamento dos valores nos tens);
    new.vlrbaseicmsfretevd = :vlrbaseicmsfretevd;
    new.vlricmsfretevd =: vlricmsfretevd;

end
^

/* Alter exist trigger... */
ALTER TRIGGER VDFRETEVDTGBU
as
    declare variable vlrliqvenda numeric(15,5);
    declare variable vlrbaseicmsfretevd numeric(15,5);
    declare variable vlricmsfretevd numeric(15,5);

begin

    -- Atualizando o log de alteraes
    new.dtalt=cast('now' as date);
    new.idusualt = user;
    new.halt = cast('now' as time);

    -- Buscando o valor liquido da venda
    select coalesce(vlrliqvenda,0) from vdvenda
    where tipovenda=new.tipovenda and codvenda=new.codvenda and codemp=new.codemp and codfilial=new.codfilial
    into vlrliqvenda;

    -- Calculando o percentual do frete sobre a venda
    if (vlrliqvenda > 0) then
    begin
        new.percvendafretevd = (new.vlrfretevd/:vlrliqvenda) * 100;
    end

    -- Verifica se o valor do frete foi alterado.
    if(new.vlrfretevd != old.vlrfretevd) then
    begin

        -- Atualizao do valor do frete na tabela de venda
        update vdvenda vd set vd.vlrfretevenda = new.vlrfretevd
        where vd.codemp=new.codemp and vd.codfilial=new.codfilial and vd.codvenda=new.codvenda and vd.tipovenda=new.tipovenda;

        -- Busca totais da base de calculo do icms do frete e valor do icms do frete
        select sum(lfi.vlrbaseicmsfreteitvenda), sum(lfi.vlricmsfreteitvenda) from lfitvenda lfi
        where lfi.codemp=new.codemp and lfi.codfilial=new.codfilial and lfi.codvenda=new.codvenda and lfi.tipovenda=new.tipovenda
        into :vlrbaseicmsfretevd, :vlricmsfretevd;

        -- Atualizando os valores (supondo que j houve o reprocessamento dos valores nos tens);
        new.vlrbaseicmsfretevd = :vlrbaseicmsfretevd;
        new.vlricmsfretevd =: vlricmsfretevd;

    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITKITTGBU
AS
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN  
     SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITORCAMENTOTGAD
AS
BEGIN
  IF ( not ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) THEN
  BEGIN

    UPDATE VDORCAMENTO SET VLRDESCITORC = VLRDESCITORC -old.VLRDESCITORC,
         VLRPRODORC = VLRPRODORC - old.VLRPRODITORC,
         VLRLIQORC = VLRLIQORC - old.VLRLIQITORC
         WHERE CODORC=old.CODORC AND TIPOORC=old.tipoorc AND
         CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
  END
END
^

/* Alter exist trigger... */
ALTER TRIGGER VDITORCAMENTOTGAI
AS
    declare variable visualizalucr char(1);
    declare variable custopeps numeric(15, 5);
    declare variable custompm numeric(15, 5);
    declare variable custouc numeric(15, 5);
    declare variable codfilialsel smallint;
begin
  if ( ( new.emmanut is null ) or ( new.emmanut='N' ) ) then
  begin
    -- Carregamento de preferencias
    select visualizalucr, codfilial from sgprefere1 where codemp=new.codemp and codfilial = new.codfilial
    into :visualizalucr, :codfilialsel;

    -- Salvamento de custos no momento do oramento
    if( visualizalucr = 'S' ) then
    begin
        -- Busca do custo da ultima compra;
        select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
            new.dtins,'U',new.codempax, new.codfilialax, new.codalmox,'N')
        into :custouc;

        -- Busca do custo mdio (MPM)
        select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
            new.dtins,'M',new.codempax, new.codfilialax, new.codalmox,'N')
        into :custompm;

        -- Busca do custo peps
        select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
            new.dtins,'P',new.codempax, new.codfilialax, new.codalmox,'N')
        into :custopeps;

        -- Inserindo registro na tabela de custos de item de venda
        insert into vditcustoorc (codemp,codfilial,codorc,tipoorc,coditorc,vlrprecoultcp, vlrcustompm, vlrcustopeps)
        values (new.codemp,new.codfilial,new.codorc,new.tipoorc,new.coditorc,:custouc,:custompm,:custopeps);

        -- Buscando e inserindo previso de tributos
        insert into vdprevtribitorc(codemp, codfilial, codorc, tipoorc, coditorc,
        vlricmsitorc, vlripiitorc, vlrpisitorc, vlrcofinsitorc, vlriritorc, vlrcsocialitorc, vlrissitorc)
        select new.codemp, new.codfilial, new.codorc, new.tipoorc, new.coditorc,
        vlricms, vlripi, vlrpis, vlrcofins, vlrir, vlrcsocial, vlriss
        from lfbuscaprevtriborc(new.codemp, :codfilialsel, new.codfilial, new.codorc, new.tipoorc, new.coditorc);

    end
  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITORCAMENTOTGAU
as
    declare variable visualizalucr char(1);
    declare variable custopeps numeric(15, 5);
    declare variable custompm numeric(15, 5);
    declare variable custouc numeric(15, 5);
    declare variable vlricmsitorc numeric(15,5);
    declare variable vlripiitorc numeric(15,5);
    declare variable vlrpisitorc numeric(15,5);
    declare variable vlrcofinsitorc numeric(15,5);
    declare variable vlriritorc numeric(15,5);
    declare variable vlrcsocialitorc numeric(15,5);
    declare variable vlrissitorc numeric(15,5);
    declare variable qtdstatusitem integer;
    declare variable qtdstatustot integer;
    declare variable tipoprod char(1);

begin
    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) ) ) ) then
    begin

    if (old.vlrdescitorc<>new.vlrdescitorc
        or old.vlrproditorc<>new.vlrproditorc
        or old.vlrliqitorc<>new.vlrliqitorc ) then
    begin
      update vdorcamento set
        VLRDESCITORC = VLRDESCITORC - old.VLRDESCITORC + new.VLRDESCITORC,
        VLRPRODORC = VLRPRODORC - old.VLRPRODITORC + new.VLRPRODITORC,
        VLRLIQORC = VLRLIQORC - old.VLRLIQITORC + new.VLRLIQITORC
        where CODORC=new.CODORC and TIPOORC='O' and CODEMP=new.CODEMP and CODFILIAL=new.CODFILIAL;
    end

    -- Carregamento de preferencias
    select visualizalucr from sgprefere1 where codemp=new.codemp and codfilial = new.codfilial
    into :visualizalucr;

    if( visualizalucr = 'S' ) then
    begin
            select tipoprod from eqproduto where codemp=new.codemppd and codfilial=new.codfilialpd
               and codprod=new.codprod
            into :tipoprod;

            if (tipoprod='P') then
            begin

               -- Busca do custo da ultima compra;
               select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
                   new.dtins,'U',new.codempax, new.codfilialax, new.codalmox,'N')
               into :custouc;

               -- Busca do custo mdio (MPM)
               select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
                   new.dtins,'M',new.codempax, new.codfilialax, new.codalmox,'N')
               into :custompm;

               -- Busca do custo peps
               select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
                   new.dtins,'P',new.codempax, new.codfilialax, new.codalmox,'N')
               into :custopeps;

               -- Atualizando registro na tabela de custos de item de oramento

               update vditcustoorc ico set vlrprecoultcp=:custouc, vlrcustompm=:custompm, vlrcustopeps=:custopeps
                   where ico.codemp=new.codemp and ico.codfilial=new.codfilial and ico.codorc=new.codorc
                   and ico.tipoorc=new.tipoorc and ico.coditorc=new.coditorc
                   -- Condio inserida para evitar cascade quando no for necessrio
                   and (vlrprecoultcp<>:custouc or vlrcustompm<>:custompm or vlrcustopeps<>:custopeps ) ;

            end 

            -- Buscando e inserindo previso de tributos
            select vlricms, vlripi, vlrpis, vlrcofins, vlrir, vlrcsocial, vlriss
            from lfbuscaprevtriborc(new.codemp, new.codfilial, new.codfilial, new.codorc, new.tipoorc, new.coditorc)
            into :vlricmsitorc, :vlripiitorc, :vlrpisitorc, :vlrcofinsitorc, :vlriritorc, :vlrcsocialitorc, :vlrissitorc;

            update vdprevtribitorc po set
            po.vlricmsitorc=:vlricmsitorc, po.vlripiitorc=:vlripiitorc, po.vlrpisitorc=:vlrpisitorc,
            po.vlrcofinsitorc=:vlrcofinsitorc, po.vlriritorc=:vlriritorc, po.vlrcsocialitorc=:vlrcsocialitorc,
            po.vlrissitorc=:vlrissitorc
            where po.codemp=new.codemp and po.codfilial=new.codfilial and po.codorc=new.codorc
            and po.tipoorc=new.tipoorc and po.coditorc=new.coditorc
             -- Condio inserida para evitar cascade quando no for necessrio
             and ( po.vlricmsitorc<>:vlricmsitorc or po.vlripiitorc<>:vlripiitorc
              or po.vlrpisitorc<>:vlrpisitorc or po.vlrcofinsitorc<>:vlrcofinsitorc
              or po.vlriritorc<>:vlriritorc or po.vlrcsocialitorc<>:vlrcsocialitorc
              or po.vlrissitorc<>:vlrissitorc )
            ;

       end

       -- Se o status foi alterado para Aprovado (OL), deve atualizar o status das ordens de servio vinculadas
       -- para OA (Oramento aprovado)
       if(new.statusitorc!=old.statusitorc and new.statusitorc='OL' ) then
       begin
            update eqitrecmercitositorc ios set ios.status='OA'
            where ios.codempoc=new.codemp and ios.codfilialoc=new.codfilial and ios.codorc=new.codorc
            and ios.tipoorc=new.tipoorc and ios.coditorc=new.coditorc
            and ios.status<>'OA';
       end

       -- Contando a quantidade de itens do oramento com o status do item atual
       select count(*) from vditorcamento
       where CODORC=new.CODORC and TIPOORC=new.tipoorc and CODEMP=new.CODEMP and CODFILIAL=new.CODFILIAL and statusitorc=new.statusitorc
       into :qtdstatusitem;

       -- Contando a quantidade de itens total do oramento
       select count(*) from vditorcamento
       where CODORC=new.CODORC and TIPOORC=new.tipoorc and CODEMP=new.CODEMP and CODFILIAL=new.CODFILIAL 
       into :qtdstatustot;

       -- Se todos os itens do oramento tem o mesmo status, deve ataulizar o status do cabealho do oramento;
       if(:qtdstatusitem > 0 and :qtdstatusitem = :qtdstatustot) then
       begin
            update vdorcamento set statusorc=new.statusitorc
            where CODORC=new.CODORC and TIPOORC=new.tipoorc and CODEMP=new.CODEMP and CODFILIAL=new.CODFILIAL
            and statusorc<>new.statusitorc;
       end

    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITORCAMENTOTGBI
as
    declare variable refprod VARchar(20);
    declare variable vlripi numeric(15,5);
    declare variable contribipi char(1);
    declare variable adicfrete char(1);

begin

  if ( ( new.emmanut is null ) or ( new.emmanut='N' ) ) then
  begin
    select fi.contribipifilial from sgfilial fi where fi.codemp=new.codemp and fi.codfilial=new.codfilial
    into contribipi;

    if(contribipi = 'S') then
    begin
        select pt.vlripiitorc from vdprevtribitorc pt
        where pt.codemp=new.codemp and pt.codfilial=new.codfilial and pt.codorc=new.codorc and pt.tipoorc=new.tipoorc
        and pt.coditorc=new.coditorc
        into vlripi;
    end

    -- Garantindo valor vlido para IPI
    if (vlripi is null) then vlripi = 0;

    -- Garantindo valor vlido para desconto
    if (new.vlrdescitorc is null) then new.vlrdescitorc = 0;

    -- Garantindo valor vlido para vlrliqitorc
    if (new.vlrliqitorc is null) then new.vlrliqitorc = 0;

    select adicfrete from vdorcamento
    where codemp=new.codemp and codfilial=new.codfilial and codorc=new.codorc and tipoorc=new.tipoorc
    into adicfrete;

    -- Calculando valor liquido
    if (new.vlrliqitorc = 0) then
    begin
        new.vlrliqitorc = (new.qtditorc * new.precoitorc) - new.vlrdescitorc + vlripi;
    end

    if( adicfrete = 'S' ) then
    begin
       new.vlrliqitorc = new.vlrliqitorc + coalesce(new.vlrfreteitorc,0);
    end

    new.tipoorc = 'O';

    -- Garantindo a gravao da referncia do produto.

    if (new.refprod is null) then
    begin
        select p.refprod from eqproduto p
        where p.codprod=new.codprod and p.codemp=new.codemppd and p.codfilial=new.codfilialpd
        into refprod;

        new.refprod = refprod;
    end

    -- Atualizando a tabela de oramento

    update vdorcamento o set o.vlrdescitorc=o.vlrdescitorc + new.vlrdescitorc,
                             o.vlrprodorc = o.vlrprodorc + new.vlrproditorc,
                             o.vlrliqorc = o.vlrliqorc + new.vlrliqitorc
    where o.codorc=new.codorc and o.tipoorc=new.tipoorc and o.codemp=new.codemp and o.codfilial=new.codfilial;

  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITORCAMENTOTGBU
as
    declare variable adicfrete char(1);
    declare variable tipoprod varchar(2);
    declare variable encorcprod char(1);
    declare variable vlripi decimal(15,5);
    declare variable contribipi char(1);

begin
    if ( new.emmanut is null) then
        new.emmanut='N';
    if(old.aprovitorc!=new.aprovitorc and new.aprovitorc='S') then -- Na aprovao do item de oramento
    begin
        new.statusitorc='OL';
        new.dtaprovitorc=cast('today' as date);
        if((new.qtdaprovitorc is null) or (new.qtdaprovitorc=0)) then
        begin
            new.qtdaprovitorc=new.qtditorc;
        end
    end
    else if(new.cancitorc='S' or new.statusitorc='CA' ) then
    begin
        new.aceiteitorc = 'N';
        new.aprovitorc = 'N';
        new.qtdaprovitorc = 0;
        new.statusitorc = 'CA';
        new.cancitorc = 'S';
    end
    new.qtdafatitorc = new.qtditorc - new.qtdfatitorc;
    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
    begin
        new.dtalt = cast('now' as date);
        new.halt = cast('now' as time);
        new.idusualt = user;
        select fi.contribipifilial from sgfilial fi where fi.codemp=new.codemp and fi.codfilial=new.codfilial
        into contribipi;
        if(contribipi = 'S') then
        begin
            select pt.vlripiitorc from vdprevtribitorc pt
            where pt.codemp=new.codemp and pt.codfilial=new.codfilial and pt.codorc=new.codorc and pt.tipoorc=new.tipoorc
            and pt.coditorc=new.coditorc
            into vlripi;
        end
        -- Garantindo valor vlido para IPI
        if (vlripi is null) then vlripi = 0;
        if (new.qtdfatitorc>0) then
        begin
           if (new.qtdfatitorc<new.qtditorc) then
           begin
              new.fatitorc = 'P';
           end
           else
           begin
              new.fatitorc = 'S';
           end
        end
        else 
        begin
           new.fatitorc = 'N';
        end
        select adicfrete from vdorcamento
        where codemp=new.codemp and codfilial=new.codfilial and codorc=new.codorc and tipoorc=new.tipoorc
        into adicfrete;
        if (new.vlrproditorc is null) then new.vlrproditorc = 0;
        if (new.vlrdescitorc is null) then new.vlrdescitorc = 0;
        if (new.vlrliqitorc is null) then new.vlrliqitorc = 0;
        new.vlrliqitorc = (new.qtditorc * new.precoitorc) - new.vlrdescitorc + :vlripi;
        if( adicfrete = 'S' ) then
        begin
            new.vlrliqitorc = new.vlrliqitorc + coalesce(new.vlrfreteitorc,0);
        end
        -- Buscando nas preferencias de deve encaminhar oramento para a produo.
        select coalesce(p1.encorcprod,'N') from sgprefere1 p1
        where p1.codemp=new.codemp and p1.codfilial=new.codfilial
        into :encorcprod;
        -- Se for produto acabado e encaminhamento pull definido nas preferencias e item for aprovado dever sinalizar item para produo.
        if(new.statusitorc!=old.statusitorc and new.statusitorc='OL' and :encorcprod='S') then
        begin
            select tipoprod from eqproduto pd where pd.codemp=new.codemppd and pd.codfilial=new.codfilialpd and pd.codprod=new.codprod
            into :tipoprod;
            if(:tipoprod='F' and old.sitproditorc='NP') then
            begin
                new.sitproditorc='PE';
            end
        end
        -- Atualiza status do item, quando produzido
        if( old.sitproditorc!=new.sitproditorc and new.sitproditorc='PD' ) then
        begin
           new.statusitorc = 'OP';
        end
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITVENDASERIETGBU
as
    declare variable temserie smallint;
begin
    -- Atualizando log
    new.DTALT=cast('now' as date);
    new.IDUSUALT=USER;
    new.HALT = cast('now' as time);

    -- Verificando se foi inserido um numero de srie
    if(old.numserie is null and new.numserie is not null) then
    begin
        -- Verificando se o nmero de srie informado, j existe.
        select count(*) from eqserie sr
        where sr.codemp = new.codemppd and sr.codfilial = new.codfilialpd and sr.codprod = new.codprod and sr.numserie = new.numserie
        into :temserie;

        -- se o nmero de srie informado no existe, deve inseri-lo;
        if (temserie = 0) then
        begin
            insert into eqserie (codemp, codfilial, codprod, numserie)
            values(new.codemppd, new.codfilialpd, new.codprod, new.numserie);
        end

    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITVENDATGAD
AS
  DECLARE VARIABLE DDTVENDA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE IDOCVENDA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
  declare variable subtipovenda char(2);
  declare variable estoqtipomovpd char(1);

--  DECLARE VARIABLE V_CHAVE VARCHAR(500);
--  DECLARE VARIABLE V_RECURSIVO INTEGER;
BEGIN

--  V_CHAVE = 'VDITVENDATGAD'; -- Nome do objeto (trigger ou procedure) a controlar recursividade
--  V_CHAVE = V_CHAVE || '_' || IIF(INSERTING, 'INS', IIF(UPDATING, 'UPD', 'DEL')); -- tipo de evento
--  V_CHAVE = V_CHAVE || '_' || CAST(OLD.CODVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
 -- V_CHAVE = V_CHAVE || '_' || CAST(OLD.CODITVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
--  V_CHAVE = V_CHAVE || '_' || CAST(OLD.TIPOVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
--  V_CHAVE = V_CHAVE || '_' || CAST(OLD.CODFILIAL AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
--  V_CHAVE = V_CHAVE || '_' || CAST(OLD.CODEMP AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria

--  EXECUTE PROCEDURE PRO_RECURSIVO(:V_CHAVE) RETURNING_VALUES (:V_RECURSIVO);

  /* Verifica se  uma chamada recursiva ou no, se no for continua */
--  IF (V_RECURSIVO = 0) THEN
--  BEGIN

    IF ( not ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) THEN
    BEGIN
    
      estoqtipomovpd = 'S';
      
      UPDATE VDVENDA SET
         VLRPRODVENDA = VLRPRODVENDA - old.VLRPRODITVENDA,
         VLRBASEICMSVENDA = VLRBASEICMSVENDA - old.VLRBASEICMSITVENDA,
         VLRICMSVENDA = VLRICMSVENDA -old.VLRICMSITVENDA,
         VLRISENTASVENDA = VLRISENTASVENDA - old.VLRISENTASITVENDA,
         VLROUTRASVENDA = VLROUTRASVENDA - old.VLROUTRASITVENDA,
         VLRBASEIPIVENDA = VLRBASEIPIVENDA - old.VLRBASEIPIITVENDA,
         VLRIPIVENDA = VLRIPIVENDA - old.VLRIPIITVENDA,
         VLRLIQVENDA = VLRLIQVENDA - old.VLRLIQITVENDA,
         VLRCOMISVENDA = VLRCOMISVENDA - old.VLRCOMISITVENDA,
         VLRBASEISSVENDA = VLRBASEISSVENDA - old.VLRBASEISSITVENDA,
         VLRISSVENDA = VLRISSVENDA - old.VLRISSITVENDA,
         VLRDESCITVENDA = VLRDESCITVENDA - old.VLRDESCITVENDA,
         VLRBASEICMSSTVENDA = VLRBASEICMSSTVENDA - OLD.vlrbaseicmsstitvenda,
         VLRICMSSTVENDA = VLRICMSSTVENDA - OLD.vlricmsstitvenda,
         VLRBASECOMIS = VLRBASECOMIS - OLD.vlrbasecomisitvenda
         WHERE CODVENDA=old.CODVENDA AND TIPOVENDA=old.TIPOVENDA AND
         CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
         
      SELECT V.DTEMITVENDA, V.FLAG, V.DOCVENDA,
          V.CODEMPTM, V.CODFILIALTM, V.CODTIPOMOV, V.SUBTIPOVENDA
       FROM VDVENDA V  WHERE V.CODVENDA = old.CODVENDA AND
          V.CODEMP=old.CODEMP AND V.CODFILIAL = old.CODFILIAL AND
          V.TIPOVENDA=old.TIPOVENDA
      INTO :DDTVENDA, :CFLAG, :IDOCVENDA, :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV, :subtipovenda;
      
      if ( (subtipovenda is not null) and (subtipovenda='NC') ) then
         estoqtipomovpd = 'N';
         
      EXECUTE PROCEDURE EQMOVPRODIUDSP('D', old.CODEMPPD, old.CODFILIALPD,
         old.CODPROD, old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
         :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV, null, null, null,
         null, null, null, null,
         old.CODEMP, old.CODFILIAL, old.TIPOVENDA, old.CODVENDA, old.CODITVENDA,
          null, null, null, null,null,null, null, null, null,
         old.CODEMPNT, old.CODFILIALNT, old.CODNAT, :DDTVENDA,
         :IDOCVENDA, :CFLAG, old.QTDITVENDA, old.PRECOITVENDA,
         old.CODEMPAX, old.CODFILIALAX, old.CODALMOX, null, :estoqtipomovpd, 'N');
      
    END

--  END
  
END
^

/* Alter exist trigger... */
ALTER TRIGGER VDITVENDATGAI
as
    declare variable dtvenda date ;
    declare variable flag char(1);
    declare variable docvenda integer;
    declare variable codemptm integer;
    declare variable codfilialtm smallint;
    declare variable codtipomov integer;
    declare variable preco numeric(15, 5);
    declare variable visualizalucr char(1);
    declare variable custopeps numeric(15, 5);
    declare variable custompm numeric(15, 5);
    declare variable custouc numeric(15, 5);
    declare variable subtipovenda char(2);
    declare variable estoqtipomovpd char(1);

  --DECLARE VARIABLE V_CHAVE VARCHAR(500);
  --DECLARE VARIABLE V_RECURSIVO INTEGER;
BEGIN

  --V_CHAVE = 'VDITVENDATGAI'; -- Nome do objeto (trigger ou procedure) a controlar recursividade
  --V_CHAVE = V_CHAVE || '_' || IIF(INSERTING, 'INS', IIF(UPDATING, 'UPD', 'DEL')); -- tipo de evento
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODITVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.TIPOVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODFILIAL AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODEMP AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria

  --EXECUTE PROCEDURE PRO_RECURSIVO(:V_CHAVE) RETURNING_VALUES (:V_RECURSIVO);

  /* Verifica se  uma chamada recursiva ou no, se no for continua */
  --IF (V_RECURSIVO = 0) THEN
  --BEGIN

    estoqtipomovpd = 'S';
    
    -- Carregamento de preferencias
    select visualizalucr from sgprefere1 where codemp=new.codemp and codfilial = new.codfilial
    into :visualizalucr;

    -- Carregamento de informaes do cabealho da venda
    select vd.dtemitvenda, vd.flag, vd.docvenda, vd.codemptm, vd.codfilialtm, vd.codtipomov, vd.subtipovenda
        from eqtipomov tm, vdvenda vd
        where
            tm.codemp=vd.codemptm and tm.codfilial=vd.codfilialtm and tm.codtipomov=vd.codtipomov and
            vd.codemp=new.codemp and vd.codfilial=new.codfilial and vd.tipovenda=new.tipovenda and vd.codvenda=new.codvenda
    into :dtvenda, :flag, :docvenda, :codemptm, :codfilialtm, :codtipomov, :subtipovenda;

    if ( (subtipovenda is not null) and (subtipovenda='NC')) then
       estoqtipomovpd='N';
       
    -- Inicializando preco do item
    if (new.qtditvenda != 0 ) then
        preco = new.vlrliqitvenda/new.qtditvenda;
    else
        preco = new.precoitvenda;

    -- Executando movimentao do estoque
    execute procedure eqmovprodiudsp(
        'I', new.codemppd, new.codfilialpd, new.codprod,new.codemple, new.codfilialle, new.codlote, :codemptm, :codfilialtm,
        :codtipomov, null, null, null, null, null, null, null, new.codemp, new.codfilial, new.tipovenda, new.codvenda, new.coditvenda,
        null, null, null, null,null,null,null, null, null, new.codempnt, new.codfilialnt, new.codnat,:dtvenda, :docvenda, :flag, new.qtditvenda, :preco,
        new.codempax, new.codfilialax, new.codalmox, null, :estoqtipomovpd, 'N'
    );

    -- Salvamento de custos no momento da venda
    if( visualizalucr = 'S' ) then
    begin
        -- Busca do custo da ultima compra;
        select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
            new.dtins,'U',new.codempax, new.codfilialax, new.codalmox,'N')
        into :custouc;

        -- Busca do custo mdio (MPM)
        select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
            new.dtins,'M',new.codempax, new.codfilialax, new.codalmox,'N')
        into :custompm;

        -- Busca do custo peps
        select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
            new.dtins,'P',new.codempax, new.codfilialax, new.codalmox,'N')
        into :custopeps;

        -- Inserindo registro na tabela de custos de item de venda
        insert into vditcustovenda (codemp,codfilial,codvenda,tipovenda,coditvenda,vlrprecoultcp, vlrcustompm, vlrcustopeps)
        values (new.codemp,new.codfilial,new.codvenda,new.tipovenda,new.coditvenda,:custouc,:custompm,:custopeps);

    end

     -- Executa procedure de gerao de tabela de vinculo para numeros de serie

    execute procedure vditvendaseriesp('I', new.codemp, new.codfilial, new.codvenda, new.tipovenda, new.coditvenda, new.codemppd, new.codfilialpd, new.codprod, new.numserietmp, new.qtditvenda);

    -- Inserindo registros na tabela de informaes fiscais complementares (LFITVENDA)

    execute procedure lfgeralfitvendasp(new.codemp, new.codfilial, new.codvenda, new.tipovenda, new.coditvenda);

    -- Inserindo registro na tabela de vinculo entre compras e vendas (devoluo)

    if(new.codcompra is not null and new.coditcompra is not null) then
    begin
        insert into cpdevolucao
            (codemp, codfilial, codcompra, coditcompra, qtddev,
             codempvd, codfilialvd, codvenda, tipovenda, coditvenda )
        values
            (new.codempcp, new.codfilialcp, new.codcompra, new.coditcompra,new.qtditvenda,
             new.codemp, new.codfilial,new.codvenda, new.tipovenda, new.coditvenda);
    end

    execute procedure cpgeradevolucaosp (
    new.codempcp,new.codfilialcp, new.codcompra, new.coditcompra, new.codemp, new.codfilial,
    new.codvenda, new.coditvenda, new.tipovenda, new.qtditvenda);

  --END
  
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITVENDATGAU
AS
  DECLARE VARIABLE DDTVENDA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE IDOCVENDA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
  DECLARE VARIABLE CSTATUS CHAR(2);
  DECLARE VARIABLE CTIPOPROD varCHAR(2);
  DECLARE VARIABLE NPRECO NUMERIC(15, 5);
  DECLARE VARIABLE visualizalucr CHAR(1);
  DECLARE VARIABLE custopeps NUMERIC(15, 5);
  DECLARE VARIABLE custompm NUMERIC(15, 5);
  DECLARE VARIABLE custouc NUMERIC(15, 5);
  declare variable subtipovenda char(2);
  declare variable estoqtipomovpd char(1);
  declare variable fatorcparc char(1);
  declare variable altqtdfatparc char(1);
  declare variable codfilialpf smallint;
  --DECLARE VARIABLE V_CHAVE VARCHAR(500);
  --DECLARE VARIABLE V_RECURSIVO INTEGER;
BEGIN

  --V_CHAVE = 'VDITVENDATGAU'; -- Nome do objeto (trigger ou procedure) a controlar recursividade
  --V_CHAVE = V_CHAVE || '_' || IIF(INSERTING, 'INS', IIF(UPDATING, 'UPD', 'DEL')); -- tipo de evento
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODITVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.TIPOVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODFILIAL AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODEMP AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria

  --EXECUTE PROCEDURE PRO_RECURSIVO(:V_CHAVE) RETURNING_VALUES (:V_RECURSIVO);

  /* Verifica se  uma chamada recursiva ou no, se no for continua */
  --IF (V_RECURSIVO = 0) THEN
  --BEGIN
  
    estoqtipomovpd = 'S';
  
    select visualizalucr from sgprefere1 where codemp=new.codemp and codfilial = new.codfilial
      into :visualizalucr;

    IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) ) THEN
    BEGIN
    
      SELECT VD.DTEMITVENDA,VD.DOCVENDA,VD.STATUSVENDA,VD.FLAG,
             VD.CODEMPTM, VD.CODFILIALTM, VD.CODTIPOMOV, VD.SUBTIPOVENDA
      FROM VDVENDA VD
      WHERE VD.CODVENDA = new.CODVENDA AND VD.TIPOVENDA = new.TIPOVENDA
            AND VD.CODEMP=new.CODEMP AND VD.CODFILIAL = new.CODFILIAL
      INTO :DDTVENDA, :IDOCVENDA, :CSTATUS, :CFLAG, :ICODEMPTM,
          :SCODFILIALTM, :ICODTIPOMOV, :SUBTIPOVENDA;
          
      if ( (subtipovenda is not null) and (subtipovenda='NC') ) then
          estoqtipomovpd = 'N';
          
      SELECT TIPOPROD FROM EQPRODUTO WHERE CODPROD=old.CODPROD
             AND CODEMP=old.CODEMPPD AND CODFILIAL = old.CODFILIALPD
         INTO CTIPOPROD;
      if (SUBSTRING(:CSTATUS FROM 1 FOR 1) not in ('C','N')) then
      BEGIN
        update vdvenda set vlrdescitvenda = vlrdescitvenda -old.vlrdescitvenda + new.vlrdescitvenda,
               vlrprodvenda = vlrprodvenda - old.vlrproditvenda + new.vlrproditvenda,
               vlrbaseicmsvenda = vlrbaseicmsvenda - old.vlrbaseicmsitvenda + new.vlrbaseicmsitvenda,
               vlricmsvenda = vlricmsvenda -old.vlricmsitvenda + new.vlricmsitvenda,
               vlrisentasvenda = vlrisentasvenda - old.vlrisentasitvenda + new.vlrisentasitvenda,
               vlroutrasvenda = vlroutrasvenda - old.vlroutrasitvenda + new.vlroutrasitvenda,
               vlrbaseipivenda = vlrbaseipivenda - old.vlrbaseipiitvenda + new.vlrbaseipiitvenda,
               vlripivenda = vlripivenda - old.vlripiitvenda + new.vlripiitvenda,
               vlrliqvenda = vlrliqvenda - old.vlrliqitvenda + new.vlrliqitvenda,
               vlrcomisvenda = vlrcomisvenda - old.vlrcomisitvenda + new.vlrcomisitvenda,
               vlrbaseissvenda = vlrbaseissvenda - old.vlrbaseissitvenda + new.vlrbaseissitvenda,
               vlrissvenda = vlrissvenda - old.vlrissitvenda + new.vlrissitvenda,
               vlrbaseicmsstvenda = vlrbaseicmsstvenda - old.vlrbaseicmsstitvenda + new.vlrbaseicmsstitvenda,
               vlricmsstvenda = vlricmsstvenda - old.vlricmsstitvenda + new.vlricmsstitvenda,
               vlrbasecomis = vlrbasecomis - old.vlrbasecomisitvenda + new.vlrbasecomisitvenda,
               vlricmsdevido = coalesce(vlricmsdevido,0) - old.vlricmsdevido + new.vlricmsdevido,
               vlricmsdiferido = coalesce(vlricmsdiferido,0) - old.vlricmsdiferido + new.vlricmsdiferido
               where codvenda=new.codvenda and tipovenda=new.tipovenda
               and codemp=new.codemp and codfilial=new.codfilial;
        IF (SUBSTRING(CSTATUS FROM 1 FOR 1) = 'P') THEN
          CSTATUS = 'PV';
        ELSE IF (SUBSTRING(CSTATUS FROM 1 FOR 1) = 'V') THEN
          CSTATUS = 'VD';
      END
      IF (new.QTDITVENDA = 0) THEN
         NPRECO = new.PRECOITVENDA;
      ELSE
         NPRECO = new.VLRLIQITVENDA/new.QTDITVENDA;
      EXECUTE PROCEDURE EQMOVPRODIUDSP('U',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
        new.CODEMPLE, new.CODFILIALLE, new.CODLOTE, :ICODEMPTM,
        :SCODFILIALTM, :ICODTIPOMOV, null, null, null ,null, null,
        null, null, new.CODEMP, new.CODFILIAL, new.TIPOVENDA, new.CODVENDA,
        new.CODITVENDA, null, null, null, null,null,null,null, null, null,
        new.CODEMPNT, new.CODFILIALNT,
        new.CODNAT, :DDTVENDA, :IDOCVENDA, :CFLAG, new.QTDITVENDA, :NPRECO,
        new.CODEMPAX, new.CODFILIALAX, new.CODALMOX, null, :estoqtipomovpd, 'N');
       if( visualizalucr = 'S' ) then
       begin
            -- Busca do custo da ultima compra;
            select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
                new.dtins,'U',new.codempax, new.codfilialax, new.codalmox,'N')
            into :custouc;

            -- Busca do custo mdio (MPM)
            select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
                new.dtins,'M',new.codempax, new.codfilialax, new.codalmox,'N')
            into :custompm;

            -- Busca do custo peps
            select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
                new.dtins,'P',new.codempax, new.codfilialax, new.codalmox,'N')
            into :custopeps;

            -- Atualizando registro na tabela de custos de item de venda

            update vditcustovenda icv set vlrprecoultcp=:custouc, vlrcustompm=:custompm, vlrcustopeps=:custopeps
                where icv.codemp=new.codemp and icv.codfilial=new.codfilial and icv.codvenda=new.codvenda
                and icv.tipovenda=new.tipovenda and icv.coditvenda=new.coditvenda;

       end
       -- Executa procedure para atualizao de tabela de vinculo para numeros de serie
       execute procedure vditvendaseriesp('U', old.codemp, old.codfilial, old.codvenda, old.tipovenda, old.coditvenda, old.codemppd, old.codfilialpd, old.codprod, new.numserietmp, new.qtditvenda);
       -- Atualizando registros na tabela de informaes fiscais complementares (LFITVENDA)
       if(new.coditfisc is not null) then
       begin
           execute procedure lfgeralfitvendasp(
           new.codemp, new.codfilial, new.codvenda, new.tipovenda, new.coditvenda);
       end
       -- Atualizando informaes referentes  devoluo
       execute procedure cpgeradevolucaosp (
       new.codempcp,new.codfilialcp, new.codcompra, new.coditcompra, new.codemp, new.codfilial,
       new.codvenda, new.coditvenda, new.tipovenda, new.qtditvenda);
       if ( (old.qtditvenda<>new.qtditvenda)  ) then
       begin
          select icodfilial from sgretfilial(old.codemp,'SGPREFERE1') into :codfilialpf;
          select fatorcparc, coalesce(altqtdfatparc, 'N') from sgprefere1 p
             where p.codemp=old.codemp and p.codfilial=:codfilialpf
             into :fatorcparc, :altqtdfatparc;
          if ( (fatorcparc='S')  and (altqtdfatparc='S') ) then
          begin
              update vditorcamento itorc
                   set itorc.qtdfatitorc=coalesce(itorc.qtdfatitorc,0)
                        +(coalesce(new.qtditvenda,0)-coalesce(old.qtditvenda,0))
              where exists(select * from vdvendaorc vo
                 where vo.codemp=old.codemp and vo.codfilial=old.codfilial
                 and vo.tipovenda=old.tipovenda and vo.codvenda=old.codvenda and vo.coditvenda=old.coditvenda
                 and vo.codempor=itorc.codemp and vo.codfilialor=itorc.codfilial
                 and vo.codorc=itorc.codorc and vo.coditorc=itorc.coditorc);
          end
       end
    END
END
^

/* Alter exist trigger... */
ALTER TRIGGER VDITVENDATGBD
AS
    declare variable codfilial smallint;
    declare variable fatorcparc char(1);

--  DECLARE VARIABLE V_CHAVE VARCHAR(500);
--  DECLARE VARIABLE V_RECURSIVO INTEGER;
BEGIN

--  V_CHAVE = 'VDITVENDATGBD'; -- Nome do objeto (trigger ou procedure) a controlar recursividade
--  V_CHAVE = V_CHAVE || '_' || IIF(INSERTING, 'INS', IIF(UPDATING, 'UPD', 'DEL')); -- tipo de evento
--  V_CHAVE = V_CHAVE || '_' || CAST(OLD.CODVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
--  V_CHAVE = V_CHAVE || '_' || CAST(OLD.CODITVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
--  V_CHAVE = V_CHAVE || '_' || CAST(OLD.TIPOVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
--  V_CHAVE = V_CHAVE || '_' || CAST(OLD.CODFILIAL AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
--  V_CHAVE = V_CHAVE || '_' || CAST(OLD.CODEMP AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria

--  EXECUTE PROCEDURE PRO_RECURSIVO(:V_CHAVE) RETURNING_VALUES (:V_RECURSIVO);

  /* Verifica se  uma chamada recursiva ou no, se no for continua */
--  IF (V_RECURSIVO = 0) THEN
--  BEGIN

    select icodfilial from sgretfilial(old.codemp,'SGPREFERE1') into :codfilial; 
    select fatorcparc from sgprefere1 p 
       where p.codemp=old.codemp and p.codfilial=:codfilial
    into :fatorcparc; 
    
    -- Excluindo vnculos com o oramento;
    if (fatorcparc='N') then
    begin
       delete from vdvendaorc
       where codemp=old.codemp and codfilial=old.codfilial and tipovenda=old.tipovenda and codvenda=old.codvenda and coditvenda=old.coditvenda;
    end

    -- Executa procedure para excluso de tabela de vinculo para numeros de serie
    execute procedure vditvendaseriesp('D', old.codemp, old.codfilial, old.codvenda, old.tipovenda, old.coditvenda, old.codemppd, old.codfilialpd, old.codprod, null, old.qtditvenda);

  --END
  
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITVENDATGBI
as
    declare variable srefprod VARchar(20);
    declare variable stipoprod varchar(2);
    declare variable precocomisprod numeric(15,5);
    declare variable codempcl integer;
    declare variable codfilialcl smallint;
    declare variable codcli integer;
    declare variable codemptm integer;
    declare variable codfilialtm smallint;
    declare variable codtipomov integer;
  --DECLARE VARIABLE V_CHAVE VARCHAR(500);
  --DECLARE VARIABLE V_RECURSIVO INTEGER;
BEGIN
  --V_CHAVE = 'VDITVENDATGBI'; -- Nome do objeto (trigger ou procedure) a controlar recursividade
  --V_CHAVE = V_CHAVE || '_' || IIF(INSERTING, 'INS', IIF(UPDATING, 'UPD', 'DEL')); -- tipo de evento
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODITVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.TIPOVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODFILIAL AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODEMP AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --EXECUTE PROCEDURE PRO_RECURSIVO(:V_CHAVE) RETURNING_VALUES (:V_RECURSIVO);
  /* Verifica se  uma chamada recursiva ou no, se no for continua */
  --IF (V_RECURSIVO = 0) THEN
  --BEGIN
        -- Inicializando campos nulos.
        if (new.vlrdescitvenda is null) then new.vlrdescitvenda = 0;
        if (new.vlrbaseicmsitvenda is null) then new.vlrbaseicmsitvenda = 0;
        if (new.vlricmsitvenda is null) then new.vlricmsitvenda = 0;
        if (new.vlrbaseipiitvenda is null) then new.vlrbaseipiitvenda = 0;
        if (new.vlripiitvenda is null) then new.vlripiitvenda = 0;
        if (new.vlrliqitvenda is null) then new.vlrliqitvenda = 0;
        if (new.vlrcomisitvenda is null) then new.vlrcomisitvenda = 0;
        if (new.vlradicitvenda is null) then new.vlradicitvenda = 0;
        if (new.vlrissitvenda is null) then new.vlrissitvenda = 0;
        if (new.vlrfreteitvenda is null) then new.vlrfreteitvenda = 0;
        if (new.tipovenda is null) then new.tipovenda = 'V';
        if (new.vlrbaseicmsstitvenda is null) then new.vlrbaseicmsstitvenda = 0;
        if (new.vlrbaseicmsstretitvenda is null) then new.vlrbaseicmsstretitvenda = 0;
        if (new.vlricmsstitvenda is null) then new.vlricmsstitvenda = 0;
        if (new.vlricmsstretitvenda is null) then new.vlricmsstretitvenda = 0;
        if (new.vlrbasecomisitvenda is null) then new.vlrbasecomisitvenda = 0;
        if (new.vlricmsdevido is null) then new.vlricmsdevido = 0;
        if (new.vlricmsdiferido is null) then new.vlricmsdiferido = 0;
        if (new.tipovenda='E') then
        begin
           --Busca cdigo do cliente e tipo de movimento para utilizar na procedure lfbuscafiscal.
           select vd.codempcl, vd.codfilialcl, vd.codcli, vd.codemptm,  vd.codfilialtm, vd.codtipomov from vdvenda vd
               where vd.codemp=new.codemp and vd.codfilial=new.codfilial and vd.tipovenda=new.tipovenda and vd.codvenda=new.codvenda
               into :codempcl, :codfilialcl, :codcli, :codemptm,  :codfilialtm, :codtipomov;
           select  codempif, codfilialif, codfisc, coditfisc from lfbuscafiscalsp(new.codemppd,new.codfilial,new.codfilialpd,new.codprod,:codempcl,:codfilialcl,:codcli,
               :codemptm,  :codfilialtm, :codtipomov, 'VD',
               new.codnat, null, null, null, null)  v
               into new.codempif, new.codfilialif, new.codfisc, new.coditfisc;
        end 
        -- Calculando valor liquido do tem quando zerado.
        if (new.vlrliqitvenda = 0) then
            new.vlrliqitvenda = (new.qtditvenda * new.precoitvenda) +
                new.vlradicitvenda + new.vlrfreteitvenda - new.vlrdescitvenda;
        -- Carregando almoxarifado padro do produto
        if (new.codalmox is null) then
            select codempax, codfilialax, codalmox from eqproduto
                where codemp=new.codemppd and codfilial=new.codfilialpd and codprod=new.codprod
            into new.codempax, new.codfilialax,new.codalmox;
        -- Acertando o codigo de empresa e filial da mensagem, caso a mensagem seja informada.
        if (not new.codmens is null) then
        begin
            select icodfilial from sgretfilial(new.codemp,'LFMENSAGEM') into new.codfilialme;
            new.codempme = new.codemp;
        end
        -- Buscando referncia do produto
        select p.refprod, p.tipoprod, p.precocomisprod from eqproduto p
            where p.codemp=new.codemppd and p.codfilial = new.codfilialpd and p.codprod=new.codprod
        into srefprod, stipoprod, precocomisprod;
        -- Acertando referncia quando nula
        if (new.refprod is null) then new.refprod = srefprod;
        -- Se o item vendido seja um SERVIO (Calculo do ISS);
        if (stipoprod = 'S') then
        begin
            -- Carregando aliquota do ISS
            select first 1 coalesce(c.aliqissfisc, f.percissfilial)
            from sgfilial f
            left outer join lfitclfiscal c on
            c.codemp=new.codempif and c.codfilial=new.codfilialif and c.codfisc=new.codfisc and c.coditfisc=new.coditfisc
            where f.codemp=new.codemp and f.codfilial=new.codfilial
            into new.percissitvenda;
            -- Calculando e computando base e valor do ISS;
            if (new.percissitvenda != 0) then
            begin
                new.vlrbaseissitvenda = new.vlrliqitvenda;
                new.vlrissitvenda = new.vlrbaseissitvenda*(new.percissitvenda/100);
            end
        end
        else -- Se o item vendido no for SERVIO zera ISS
            new.vlrbaseissitvenda = 0;
        -- Gerando preo especial para comissionamento
        if(precocomisprod is not null) then
        begin
            new.vlrbasecomisitvenda = new.qtditvenda * precocomisprod;
        end
        -- Atualizao de totais no cabealho da venda
        update vdvenda vd set vd.vlrdescitvenda = vd.vlrdescitvenda + new.vlrdescitvenda,
            vd.vlrprodvenda = vd.vlrprodvenda + new.vlrproditvenda,
            vd.vlrbaseicmsvenda = vd.vlrbaseicmsvenda + new.vlrbaseicmsitvenda,
            vd.vlricmsvenda = vd.vlricmsvenda + new.vlricmsitvenda,
            vd.vlrisentasvenda = vd.vlrisentasvenda + new.vlrisentasitvenda,
            vd.vlroutrasvenda = vd.vlroutrasvenda + new.vlroutrasitvenda,
            vd.vlrbaseipivenda = vd.vlrbaseipivenda + new.vlrbaseipiitvenda,
            vd.vlripivenda = vd.vlripivenda + new.vlripiitvenda,
            vd.vlrliqvenda = vd.vlrliqvenda + new.vlrliqitvenda,
            vd.vlrbaseissvenda = vd.vlrbaseissvenda + new.vlrbaseissitvenda,
            vd.vlrissvenda = vd.vlrissvenda + new.vlrissitvenda,
            vd.vlrcomisvenda = vd.vlrcomisvenda + new.vlrcomisitvenda,
            vd.vlrbaseicmsstvenda = coalesce(vd.vlrbaseicmsstvenda,0) + new.vlrbaseicmsstitvenda,
            vd.vlricmsstvenda = coalesce(vd.vlricmsstvenda,0) + new.vlricmsstitvenda,
            vd.vlrbasecomis = coalesce(vd.vlrbasecomis, 0) + new.vlrbasecomisitvenda,
            vd.vlricmsdiferido = coalesce(vd.vlricmsdiferido, 0) + new.vlricmsdiferido,
            vd.vlricmsdevido = coalesce(vd.vlricmsdevido, 9) + new.vlricmsdevido
         where vd.codvenda=new.codvenda and vd.tipovenda=new.tipovenda and
            vd.codemp=new.codemp and vd.codfilial=new.codfilial;
  --END
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITVENDATGBU
as
    declare variable srefprod varchar(20);
    declare variable stipoprod varchar(2);
    declare variable ntmp numeric(15, 5);
    declare variable precocomisprod numeric(15, 5);
    declare variable codfilialpf smallint;
    declare variable fatorcparc char(1);
    declare variable altqtdfatparc char(1);
  --declare variable v_chave varchar(500);
  --declare variable v_recursivo integer;
begin
  --v_chave = 'vditvendatgbu'; -- nome do objeto (trigger ou procedure) a controlar recursividade
  --v_chave = v_chave || '_' || iif(inserting, 'ins', iif(updating, 'upd', 'del')); -- tipo de evento
  --v_chave = v_chave || '_' || cast(new.codvenda as varchar(50)); -- concatenao dos campos que formam a chave primria
  --v_chave = v_chave || '_' || cast(new.coditvenda as varchar(50)); -- concatenao dos campos que formam a chave primria
  --v_chave = v_chave || '_' || cast(new.tipovenda as varchar(50)); -- concatenao dos campos que formam a chave primria
  --v_chave = v_chave || '_' || cast(new.codfilial as varchar(50)); -- concatenao dos campos que formam a chave primria
  --v_chave = v_chave || '_' || cast(new.codemp as varchar(50)); -- concatenao dos campos que formam a chave primria
  --execute procedure pro_recursivo(:v_chave) returning_values (:v_recursivo);
  /* verifica se  uma chamada recursiva ou no, se no for continua */
  --if (v_recursivo = 0) then
  --begin
        -- Verifica se tabela est em manuteno // caso no esteja inicia procedimentos
        if ( new.emmanut is null) then
            new.emmanut='N';
        if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
        begin
            -- Computando campos de log
            new.dtalt=cast('now' as date);
            new.idusualt=user;
            new.halt = cast('now' as time);
            -- Verifica se o produto foi alterado
            if (new.codprod != old.codprod) then
                exception vditvendaex01;
            -- Verifica se o lote foi alterado
            if (new.codlote != old.codlote) then
                exception vditvendaex02;
            -- Verifica se o cdigo do almoxarifa est nuloo, se estiver carrega o almoxarifado padro do produto
            if (new.codalmox is null) then
            begin
                select codempax,codfilialax,codalmox from eqproduto
                where codemp=new.codemppd and codfilial=new.codfilialpd and codprod=new.codprod
                into new.codempax, new.codfilialax,new.codalmox;
            end
            -- Verifica se o almoxarifado anterior estava nulo, se no informa que no  pode ser trocado
            if (old.codalmox is not null) then
            begin
                if (old.codalmox != new.codalmox) then
                    exception eqalmox01;
            end
            -- Carrega a referencia e tipo do produto
            select refprod, tipoprod, precocomisprod
            from eqproduto where codprod=new.codprod and codemp=new.codemppd and codfilial=new.codfilialpd
            into srefprod, stipoprod, precocomisprod;
            if (new.refprod is null) then new.refprod = srefprod;
            -- Caso a nota tenha sido cancelada
            if ( (new.cancitvenda is not null) and (new.cancitvenda = 'S') ) then
            begin
                new.qtditvenda = 0;
                new.vlrliqitvenda = 0;
                new.vlrproditvenda = 0;
                new.vlrbaseicmsitvenda = 0;
                new.vlrbaseipiitvenda = 0;
                new.vlrdescitvenda = 0;
            end
            -- Calculando o valor liquido o tem
            if ( (new.vlrliqitvenda = 0) and ( (new.cancitvenda is null) or (new.cancitvenda!='S') ) ) then
            begin
                new.vlrliqitvenda = (new.qtditvenda * new.precoitvenda) + new.vlradicitvenda + new.vlrfreteitvenda - new.vlrdescitvenda;
            end
            else if (new.vlrdescitvenda > 0 and new.qtditvenda > 0) then
            begin
                ntmp = new.vlrliqitvenda/new.qtditvenda;
                ntmp = ntmp * new.qtditvenda;
                new.vlrdescitvenda = new.vlrdescitvenda + (new.vlrliqitvenda-ntmp);

                -- Recalculando comisso sobre o tem
                new.vlrcomisitvenda = (new.perccomisitvenda * new.vlrliqitvenda ) / 100;
            end
            if ( (old.qtditvenda<>new.qtditvenda) and (new.qtditvenda<>0) ) then
            begin
               select icodfilial from sgretfilial(old.codemp,'SGPREFERE1') into :codfilialpf; 
               select fatorcparc, coalesce(altqtdfatparc,'N') from sgprefere1 p 
                    where p.codemp=old.codemp and p.codfilial=:codfilialpf
                 into :fatorcparc, :altqtdfatparc;
               if ( (fatorcparc='S') and (altqtdfatparc='N') ) then
               begin
                  exception vditvendaex05;
               end 
            end
            -- Ser for um servio
            if (stipoprod = 'S') then
            begin
                -- Calculo do ISS
                select first 1 coalesce(c.aliqissfisc, f.percissfilial)
                from sgfilial f
                left outer join lfitclfiscal c on
                c.codemp=new.codempif and c.codfilial=new.codfilialif and c.codfisc=new.codfisc and c.coditfisc=new.coditfisc
                where f.codemp=new.codemp and f.codfilial=new.codfilial
                into new.percissitvenda;

                if (new.percissitvenda != 0) then
                begin
                    new.vlrbaseissitvenda = new.vlrliqitvenda;
                    new.vlrissitvenda = new.vlrbaseissitvenda * (new.percissitvenda/100);
                end
            end
            else
                new.vlrbaseissitvenda = 0;
        end
        -- Atualizando preo especial para comissionamento
        if(precocomisprod is not null) then
        begin
            new.vlrbasecomisitvenda = new.qtditvenda * precocomisprod;
        end
  --END
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDKITTGBI
AS
begin
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDKITTGBU
AS
begin
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN  
     SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDORCAMENTOTGAU
as

    declare variable coditorc integer;
    declare variable percitfrete numeric(15, 5);
    declare variable vlritfrete numeric(15, 5);
    declare variable vlrproditorc numeric(15, 5);

begin

    for select io.coditorc, io.vlrproditorc
    from vditorcamento io
    where io.codemp=new.codemp and io.codfilial=new.codfilial and io.codorc=new.codorc and io.tipoorc=new.tipoorc
    into :coditorc, :vlrproditorc
    do
    begin

        -- distribuio do frete
        if ( (new.vlrfreteorc != old.vlrfreteorc) or (new.adicfrete!=old.adicfrete)  ) then
        begin
           percitfrete = :vlrproditorc / new.vlrprodorc ;
           vlritfrete =  cast(:percitfrete * new.vlrfreteorc as decimal(15,2)) ;


           -- atualizando tabela de tens
            update vditorcamento io set
            io.vlrfreteitorc = :vlritfrete
            where
            io.codemp=new.codemp and io.codfilial=new.codfilial and io.codorc=new.codorc and
            io.coditorc=:coditorc and io.tipoorc=new.tipoorc;
        end

        -- Atualizao do STATUS desde que o oramento no tenha sido faturado parcialmente.
        if(old.statusorc != new.statusorc) then
        begin
            update vditorcamento io set io.statusitorc=new.statusorc
            where io.codemp=new.codemp and io.codfilial=new.codfilial
            and io.codorc=new.codorc and io.tipoorc=new.tipoorc
            and io.statusitorc!=new.statusorc;
        end

    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER VDORCAMENTOTGBI
AS
BEGIN
  IF (new.VLRPRODORC IS NULL) THEN new.VLRPRODORC = 0;
  IF (new.VLRDESCORC IS NULL) THEN new.VLRDESCORC = 0;
  IF (new.VLRADICORC IS NULL) THEN new.VLRADICORC = 0;
  IF (new.VLRDESCITORC IS NULL) THEN new.VLRDESCITORC = 0;
  IF (new.VLRLIQORC IS NULL) THEN new.VLRLIQORC = 0;
  IF (new.CODCONV IS NOT NULL AND new.CODCLI IS NULL) THEN
  BEGIN
       SELECT CODCLI,CODEMPCL,CODFILIALCL,CODTPCONV,CODFILIALTC,CODEMPTC FROM ATCONVENIADO
          WHERE CODEMP=new.CODEMPCV AND CODFILIAL=new.CODFILIALCV
          AND CODCONV=new.CODCONV INTO new.CODCLI,new.CODEMPCL,new.CODFILIALCL,
          new.CODTPCONV,new.CODFILIALTC,new.CODEMPTC;
  END
  EXECUTE PROCEDURE VDCLIENTEATIVOSP(new.CODEMPCL, new.CODFILIALCL, new.CODCLI);
END
^

/* Alter exist trigger... */
ALTER TRIGGER VDORCAMENTOTGBU
as

    declare variable codatendo integer;
    declare variable codsetor integer;
    declare variable filialpref integer;
    declare variable filialusu integer;
    declare variable vlradic numeric(15,5);

begin

    if (new.emmanut is null) then
        new.emmanut = 'N';

    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null)) ) ) then
    begin
        new.dtalt = cast('now' as date);
        new.idusualt = user;
        new.halt = cast('now' as time);

        if(new.codcli is null and new.codconv is not null) then
        begin

            select codcli, codempcl, codfilialcl, codtpconv, codfilialtc, codemptc
            from atconveniado
            where codemp=new.codempcv and codfilial=new.codfilialcv and codconv=new.codconv into
            new.codcli, new.codempcl, new.codfilialcl, new.codtpconv, new.codfilialtc, new.codemptc;

        end

        if ( (not new.codconv = old.codconv) and (new.codconv is not null) ) then
        begin
            select codcli, codempcl, codfilialcl
            from atconveniado
            where codemp=new.codempcv and codfilial=new.codfilialcv and codconv=new.codconv into
            new.codcli, new.codempcl, new.codfilialcl;
        end

        if (old.statusorc = 'OA' and new.statusorc = 'OC') then
        begin
            select icodfilial from sgretfilial(new.codemp,'SGPREFERE2') into filialpref;
            select icodfilial from sgretfilial(new.codemp,'SGUSUARIO') into filialusu;
            select codsetat2, codtpatendo3 from sgprefere2 where codemp=new.codemp and codfilial=:filialpref into
            codsetor,codatendo;

            if(new.codconv is not null) then
            begin
                execute procedure atadicatendimentosp(new.codconv,:codatendo,new.codatend, codsetor, null, new.codemp, :filialusu, new.codorc );
            end

        end

        if (old.statusorc!='OL' and new.statusorc = 'OL') then -- Caso oramento tenha sido aprovado
        begin
           new.dtaprovorc = cast('today' as date);
        end
        
        execute procedure vdclienteativosp(new.codempcl, new.codfilialcl, new.codcli);

        if (new.vlrdescorc is null) then
            new.vlrdescorc = 0;

        new.vlrdescorc = new.vlrdescorc - old.vlrdescitorc;
        new.vlrdescorc = new.vlrdescorc + new.vlrdescitorc;

        vlradic = 0;

        if(new.adicfrete='S' and new.vlrfreteorc is not null and new.vlrfreteorc>0) then
        begin
            vlradic = vlradic + new.vlrfreteorc;
        end

        new.vlrliqorc = new.vlrprodorc - new.vlrdescorc + new.vlradicorc + vlradic;

    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDPRECOPRODTGBU
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);

  --Verifica se o preo foi realmente alterado;
  if(new.precoprod != old.precoprod) then
  begin

     new.precoant = old.precoprod;
     new.dtaltpreco = cast('now' as date);
     new.halt = cast('now' as time);
     new.idusualtpreco=USER;

  end

end
^

/* Alter exist trigger... */
ALTER TRIGGER VDTRANSPTGBU
as
    declare variable nomemunictran CHAR(30);
begin
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT = cast('now' AS TIME);

    /*Atualizao do campo cidade e estado (temporrio para retro-compatibilidade)*/

    if(old.codmunic != new.codmunic) then
    begin
        select substr(mun.nomemunic,1,30) from sgmunicipio mun
            where mun.codpais=new.codpais and mun.siglauf=new.siglauf and mun.codmunic=new.codmunic
                into :nomemunictran;
        if (nomemunictran is not null) then new.cidtran = nomemunictran;
    end

    if(new.siglauf is not null) then
    begin
        new.uftran=new.siglauf;
    end

    /* Fim da atualizao do campo cidade */


end
^

/* Alter exist trigger... */
ALTER TRIGGER VDVENDAORCTGAD
AS
begin
  UPDATE VDITORCAMENTO SET EMITITORC='N', FATITORC='N'
    , QTDFATITORC=COALESCE(QTDFATITORC,0)-
       COALESCE((SELECT QTDITVENDA FROM VDITVENDA IV WHERE IV.CODEMP=old.CODEMP and IV.CODFILIAL=old.CODFILIAL and
       IV.TIPOVENDA=old.TIPOVENDA and IV.CODVENDA=old.CODVENDA and IV.CODITVENDA=old.CODITVENDA ),0)
    , QTDAFATITORC=COALESCE(QTDFATITORC,0)+
       COALESCE((SELECT QTDITVENDA FROM VDITVENDA IV WHERE IV.CODEMP=old.CODEMP and IV.CODFILIAL=old.CODFILIAL and
       IV.TIPOVENDA=old.TIPOVENDA and IV.CODVENDA=old.CODVENDA and IV.CODITVENDA=old.CODITVENDA ),0)
    WHERE CODEMP=old.CODEMPOR AND CODFILIAL=old.CODFILIALOR AND
       TIPOORC=old.TIPOORC AND CODORC=old.CODORC AND CODITORC=old.CODITORC;
  UPDATE VDORCAMENTO SET STATUSORC='OL'
    WHERE CODEMP=old.CODEMPOR AND CODFILIAL=old.CODFILIALOR AND
       TIPOORC=old.TIPOORC AND CODORC=old.CODORC;
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDVENDAORCTGAI
AS
    declare variable qtditvenda numeric(15,5);
begin
    -- Insero de registro de movimentao de numero de srie,
    -- para faturamento de sevios de conserto (recmerc/Ordens de servio)
   -- EXECUTE PROCEDURE sgdebugsp 'vdvendaorctgai, orc.: '||new.codorc, 'inicio do vdvendaorctgai '|| cast('now' as time);

    insert into eqmovserie (
        codemp      , codfilial     , codmovserie   , codemppd      , codfilialpd   , codprod    ,
        numserie    , codempvd      , codfilialvd   , codvenda      , coditvenda    , tipovenda  ,
        dtmovserie  , tipomovserie  , docmovserie
    )
    select
        ir.codemp, ir.codfilial, coalesce((select max(codmovserie) + 1 from eqmovserie where codemp=vd.codemp and codfilial=vd.codfilial),1), ir.codemppd, ir.codfilialpd, ir.codprod,
        ir.numserie, new.codemp, new.codfilial, new.codvenda, new.coditvenda, new.tipovenda, vd.dtsaidavenda, -1, vd.docvenda
    from eqitrecmercitositorc ro, eqitrecmerc ir, vdvenda vd, vditvenda iv
    where
        ro.codemp=new.codempor and ro.codfilial=new.codfilialor and ro.codorc=new.codorc and ro.tipoorc=new.tipoorc and ro.coditorc=new.coditorc and
        ir.codemp=ro.codemp and ir.codfilial=ro.codfilial and ir.ticket=ro.ticket and ir.coditrecmerc=ro.coditrecmerc and
        iv.codemp=new.codemp and iv.codfilial=new.codfilial and iv.codvenda=new.codvenda and iv.tipovenda=new.tipovenda and iv.coditvenda=new.coditvenda and
        vd.codemp=iv.codemp and vd.codfilial=iv.codfilial and vd.tipovenda=iv.tipovenda and vd.codvenda=iv.codvenda and
        ir.numserie is not null;

--    EXECUTE PROCEDURE sgdebugsp 'vdvendaorctgai, orc.: '||new.codorc, 'aps insert no eqmovserie '|| cast('now' as time);

    -- Atualizando status do item de oramento indicando que o mesmo foi faturado.
    select iv.qtditvenda from vditvenda iv where iv.codemp=new.codemp and iv.codfilial=new.codfilial and 
       iv.tipovenda=new.tipovenda and iv.codvenda=new.codvenda and iv.coditvenda=new.coditvenda
       into :qtditvenda;

--    EXECUTE PROCEDURE sgdebugsp 'vdvendaorctgai, orc.: '||new.codorc, 'aps select vditvenda '|| cast('now' as time);
       
    update vditorcamento io set
    --io.emmanut='S',
    io.statusitorc='OV', io.qtdfatitorc=coalesce(io.qtdfatitorc,0)+coalesce(:qtditvenda,0)
    where io.codemp=new.codempor and io.codfilial=new.codfilialor and io.codorc=new.codorc and io.tipoorc=new.tipoorc and io.coditorc=new.coditorc
    and (io.statusitorc<>'OV' or io.qtdfatitorc is null or io.qtdfatitorc<>coalesce(io.qtdfatitorc,0)+coalesce(:qtditvenda,0) ) ;

--    update vditorcamento io set io.emmanut='N'
--     where io.codemp=new.codempor and io.codfilial=new.codfilialor and io.codorc=new.codorc and io.tipoorc=new.tipoorc and io.coditorc=new.coditorc
--    and io.emmanut='S'
--    and (io.statusitorc<>'OV' or io.qtdfatitorc is null or io.qtdfatitorc<>coalesce(io.qtdfatitorc,0)+coalesce(:qtditvenda,0) ) ;
--    EXECUTE PROCEDURE sgdebugsp 'vdvendaorctgai, orc.: '||new.codorc, 'aps update vditorcamento '|| cast('now' as time);


end
^

/* Alter exist trigger... */
ALTER TRIGGER VDVENDATGAU
as
    declare variable icodrec integer;
    declare variable scodfilialrc smallint;
    declare variable icoditvenda integer;
    declare variable percred numeric(15,5);
    declare variable percit numeric(15,5);
    declare variable percicmsitvenda numeric(15,5);
    declare variable percipiitvenda numeric(15,5);
    declare variable tipofisc char(2);
    declare variable vlrdescitvenda numeric(15, 5);
    declare variable vlrbaseipiitvenda numeric(15, 5);
    declare variable vlrbaseicmsitvenda numeric(15, 5);
    declare variable vlrbaseicmsfreteitvenda numeric(15, 5);
    declare variable vlripiitvenda numeric(15, 5);
    declare variable vlrproditvenda numeric(15, 5);
    declare variable vlrliqitvenda numeric(15, 5);
    declare variable vlricmsitvenda numeric(15, 5);
    declare variable vlricmsfreteitvenda numeric(15, 5);
    declare variable tipomov char(2);
    declare variable vlrmfintipomov char(1);
    declare variable vlrtmp numeric(15, 5);
    declare variable qtditvenda numeric(15,5);
    declare variable nvlrparcrec numeric(15, 5);
    declare variable nvlrcomirec numeric(15, 5);
    declare variable percitfrete numeric(15, 5);
    declare variable vlritfrete numeric(15, 5);
    declare variable snroparcrec smallint;
    declare variable codempif integer;
    declare variable codfilialif smallint;
    declare variable codfisc char(13);
    declare variable coditfisc integer;
    declare variable dtrec date;
    declare variable gerarecemis char(1);
    declare variable tpredicms char(1);
    declare variable redbasefrete char(1);
    declare variable vlrretensaoiss numeric(15, 5);
    declare variable vlrtotfrete numeric(15,5);
    declare variable coditvenda_max integer;
    declare variable vlrliqitvenda_max numeric(15,5);
    --declare variable icodmodnota integer;

  --DECLARE VARIABLE V_CHAVE VARCHAR(500);
  --DECLARE VARIABLE V_RECURSIVO INTEGER;
BEGIN

  --V_CHAVE = 'VDVENDATGAU'; -- Nome do objeto (trigger ou procedure) a controlar recursividade
  --V_CHAVE = V_CHAVE || '_' || IIF(INSERTING, 'INS', IIF(UPDATING, 'UPD', 'DEL')); -- tipo de evento
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.TIPOVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODFILIAL AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
  --V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODEMP AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria

  --EXECUTE PROCEDURE PRO_RECURSIVO(:V_CHAVE) RETURNING_VALUES (:V_RECURSIVO);

  /* Verifica se  uma chamada recursiva ou no, se no for continua */
  --IF (V_RECURSIVO = 0) THEN
  --BEGIN

        if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
        begin

        -- buscando preferncias
        select gerarecemis from sgprefere1 p1 where p1.codemp=new.codemp and p1.codfilial=new.codfilial
        into :gerarecemis;

        -- Se foi dado desconto ou alterado o valor do frete da venda

        if ((not new.vlrdescvenda = old.vlrdescvenda) or (not new.vlrfretevenda = old.vlrfretevenda) ) then
        begin
            -- Varivel de comparao do frete
            vlrtotfrete = 0;
            -- variveis de verificao de item com maior valor
            coditvenda_max = 0;
            vlrliqitvenda_max = 0;
            -- distribuindo o desconto e frete csocial e ir:
            
            for select coditvenda,percicmsitvenda,vlrdescitvenda,
                cast(vlrliqitvenda as decimal(15,2)), cast(vlrproditvenda as decimal(15,2)),qtditvenda,codempif,codfilialif,codfisc,coditfisc
                from vditvenda
                where codemp=new.codemp and codfilial=new.codfilial and codvenda=new.codvenda and tipovenda=new.tipovenda
                into icoditvenda,percicmsitvenda,
                vlrdescitvenda,vlrliqitvenda,vlrproditvenda,qtditvenda,codempif,codfilialif,codfisc,coditfisc
            do
            begin
                -- Definio do item com maior valor
                if (coalesce(:vlrliqitvenda,0)>:vlrliqitvenda_max) then
                begin
                   coditvenda_max = :icoditvenda;
                   vlrliqitvenda_max = :vlrliqitvenda;
                end
                -- distribuio do desconto
                percit = 0;
                if (new.vlrprodvenda > 0 and not new.vlrdescitvenda > 0 and new.vlrdescvenda > 0) then
                begin
                    percit = (100*vlrproditvenda) / new.vlrprodvenda;
                    vlrdescitvenda = cast((new.vlrdescvenda  * percit) / 100 as decimal(15,2));
                end

                -- distribuio do frete
                if ( new.vlrfretevenda > 0 and ( not new.vlrfretevenda = old.vlrfretevenda) ) then
                begin
                    percitfrete = :vlrproditvenda / new.vlrprodvenda ;
                    vlritfrete =  cast(:percitfrete * new.vlrfretevenda as decimal(15,2)) ;
                    vlrtotfrete = :vlrtotfrete + :vlritfrete;
                end

                -- busca informaes fiscais.:
                select first 1 i.redfisc, i.aliqipifisc, i.tipofisc, i.tpredicmsfisc, i.redbasefrete
                from lfitclfiscal i
                where i.codemp=:codempif and i.codfilial=:codfilialif and i.codfisc=:codfisc and i.coditfisc=:coditfisc
                into percred, percipiitvenda, tipofisc, tpredicms, redbasefrete;

                if (percred is null) then
                    percred = 0;

                if (percipiitvenda is null) then
                    percipiitvenda = 0;

                if (percicmsitvenda is null) then
                    percicmsitvenda = 0;

                vlrliqitvenda = cast(vlrproditvenda - vlrdescitvenda as decimal(15,2));
                vlrbaseipiitvenda = 0;
                vlrbaseicmsitvenda = 0;
                vlricmsitvenda = 0;
                vlripiitvenda = 0;

                if (qtditvenda > 0) then
                begin
                    vlrtmp = vlrliqitvenda/qtditvenda;
                    vlrdescitvenda = cast(vlrproditvenda - (vlrtmp*qtditvenda) as decimal(15,2));
                    vlrliqitvenda = cast(vlrproditvenda - vlrdescitvenda as decimal(15,2));
                end

                if ( tipofisc = 'II' ) then -- Isento de ICMS
                begin
                    percicmsitvenda = 0;
                    vlricmsitvenda = 0;
                    vlrbaseicmsfreteitvenda = 0;
                    vlrbaseicmsitvenda = 0;
                    percipiitvenda = 0;
                    vlripiitvenda = 0;
                    vlrbaseipiitvenda = 0;
                end
                else if ( tipofisc = 'FF' ) then -- Substituio tributria do icms
                begin
                    vlrbaseicmsitvenda = cast(vlrliqitvenda - (vlrproditvenda*(percred/100)) as decimal(15,2));
                    vlricmsitvenda = cast(vlrbaseicmsitvenda*(percicmsitvenda/100) as decimal(15,2));
                    vlrbaseipiitvenda = cast( vlrliqitvenda as decimal(15,2));
                    vlripiitvenda = cast(vlrbaseipiitvenda*(percipiitvenda/100) as decimal(15,2));
                end
                else if ( tipofisc = 'NN') then -- No insidncia do icms
                begin
                    percicmsitvenda = 0;
                    vlricmsitvenda = 0;
                    vlrbaseicmsitvenda = 0;
                    vlrbaseicmsfreteitvenda = 0;
                    percipiitvenda = 0;
                    vlripiitvenda = 0;
                    vlrbaseipiitvenda = 0;
                end
                else if ( tipofisc = 'TT') then -- Tributado integralmente o icms
                begin

                    vlrbaseicmsitvenda = vlrliqitvenda;
                    vlrbaseicmsfreteitvenda = vlritfrete;

                    if(percred>0) then
                    begin
                        if(:tpredicms='B') then
                        begin
                            --Se deve reduzir a base do icms do frete...

                            if(:redbasefrete='S' and vlritfrete>0) then
                            begin
                                vlrbaseicmsfreteitvenda = vlritfrete - ( vlritfrete *(percred/100) );
                                vlricmsfreteitvenda = vlrbaseicmsfreteitvenda*(percicmsitvenda/100);
                            end
                            else
                            begin
                                vlrbaseicmsfreteitvenda = vlritfrete;
                            end

                            --vlrbaseicmsitvenda = vlrliqitvenda - (vlrproditvenda*(percred/100));
                            -- Revisao 12/07/2010 - Robson Sanchez
                            -- Foram separados os calculos de ICMS do frete e da venda.
                            -- Em virtude disso a formacao da base de calculo nao pode ser sobre o valor liquido,
                            -- pois o valor liquido pode conter valor adicional de frete, causando duplicacao de impostos.

                            vlrbaseicmsitvenda = cast((vlrproditvenda + vlripiitvenda - vlrdescitvenda)*(1-(percred/100) ) as decimal(15,2));

                            vlricmsitvenda = cast(vlrbaseicmsitvenda*(percicmsitvenda/100) as decimal(15,2));

                        end
                        else if(:tpredicms='V') then
                        begin
                            vlricmsitvenda = cast(( vlrbaseicmsitvenda*(percicmsitvenda/100) ) as decimal(15,2));
                            vlricmsitvenda = cast(vlricmsitvenda - ( vlricmsitvenda * (percred/100) ) as decimal(15,2));

                            vlricmsfreteitvenda = cast(vlrbaseicmsfreteitvenda*(percicmsitvenda/100) as decimal(15,2));
                            vlricmsfreteitvenda = cast(vlricmsfreteitvenda - ( vlricmsfreteitvenda * (percred/100) ) as decimal(15,2));

                        end
                    end
                    else
                    begin
                        vlricmsitvenda = cast(vlrbaseicmsitvenda*(percicmsitvenda/100) as decimal(15,2));
                        vlricmsfreteitvenda = cast(vlrbaseicmsfreteitvenda*(percicmsitvenda/100) as decimal(15,2));
                    end

                    vlrbaseipiitvenda = cast(vlrliqitvenda as decimal(15,2));
                    vlripiitvenda = cast(vlrbaseipiitvenda*(percipiitvenda/100) as decimal(15,2));

                end

                -- atualizando tabela de tens
                update vditvenda set
                vlrbaseicmsitvenda = :vlrbaseicmsitvenda, vlrbaseipiitvenda = :vlrbaseipiitvenda,
                vlricmsitvenda = :vlricmsitvenda, vlripiitvenda = :vlripiitvenda,
                vlrdescitvenda = :vlrdescitvenda, vlrliqitvenda = :vlrliqitvenda,
                vlrfreteitvenda = :vlritfrete
                where
                codemp=new.codemp and codfilial=new.codfilial and codvenda=new.codvenda and
                coditvenda=:icoditvenda and tipovenda=new.tipovenda;

                -- Atualizando tabela de tributos referente ao frete
                if(new.vlrfretevenda != old.vlrfretevenda) then
                begin
                    update lfitvenda set
                    vlrbaseicmsfreteitvenda = :vlrbaseicmsfreteitvenda,
                    vlricmsfreteitvenda = :vlricmsfreteitvenda
                    where
                    codemp=new.codemp and codfilial=new.codfilial and codvenda=new.codvenda and
                    coditvenda=:icoditvenda and tipovenda=new.tipovenda;
                end

            end
            -- Rotina para ajustar as diferenas de arredondamento do frete;
            if ( (new.vlrfretevenda > 0) and ( not new.vlrfretevenda = old.vlrfretevenda)
                and (new.vlrfretevenda<>:vlrtotfrete) and (coditvenda_max>0) ) then
            begin
                  update vditvenda iv set iv.vlrfreteitvenda = iv.vlrfreteitvenda + (new.vlrfretevenda - :vlrtotfrete)
                    where iv.codemp=new.codemp and iv.codfilial=new.codfilial and iv.tipovenda=new.tipovenda 
                    and iv.codvenda=new.codvenda and iv.coditvenda=:coditvenda_max;  
            end
        end


    -- Busca informaes do tipo de movimento da venda
    select tipomov, vlrmfintipomov
    from eqtipomov
    where codtipomov=new.codtipomov and codemp=new.codemptm and codfilial=new.codfilialtm
    into tipomov, vlrmfintipomov;

    -- Busca informaes do contas a receber da venda
    select codrec
    from fnreceber
    where codvenda=new.codvenda and tipovenda=new.tipovenda and codemp=new.codemp and codfilialva=new.codfilial
    into icodrec;

    -- Verifica de
    if ((not tipomov in ('DV','TR')) and ((icodrec is null) or ((new.codplanopag != old.codplanopag) or
        (new.codcli != old.codcli) or (new.codvend != old.codvend) or (new.vlrliqvenda != old.vlrliqvenda) or
        (new.dtemitvenda != old.dtemitvenda) or (new.docvenda != old.docvenda) or (new.codbanco != old.codbanco)))) then

    begin

        if(gerarecemis = 'S') then
        begin
            dtrec = new.dtemitvenda;
        end
        else
        begin
            dtrec = new.dtsaidavenda;
        end


        -- Verica se deve haver retenso de ISS

        select sum(coalesce(iv.vlrissitvenda,0))
        from vditvenda iv left outer join lfitclfiscal cf on
        cf.codemp=iv.codempif and cf.codfilial=iv.codfilialif and cf.codfisc=iv.codfisc and cf.coditfisc=iv.coditfisc and cf.retensaoiss='S'
        where iv.codemp=new.codemp and iv.codfilial=new.codfilial and iv.codvenda=new.codvenda and iv.tipovenda=new.tipovenda
        and iv.vlrissitvenda>0
        into :vlrretensaoiss;

        if(:vlrretensaoiss is null) then
        begin
            vlrretensaoiss = 0;
        end

        -- De pedido para Venda
        if ((SUBSTRING(old.statusvenda FROM 1 FOR 1) = 'P') and (SUBSTRING(new.statusvenda FROM 1 FOR 1) = 'V' ) or
        ( (not new.vlrcomisvenda=old.vlrcomisvenda ) and (not new.statusvenda in ('P1','V1') ) ) ) then

        begin
           if (new.vlrliqvenda > 0) then
           begin

              execute procedure fnadicrecebersp01(
                   new.tipovenda, new.codvenda,
                   new.codemptc, new.codfilialtc, new.codtipocob,
                   new.codemppg,new.codfilialpg,new.codplanopag,
                   new.codempcl,new.codfilialcl,new.codcli,
                   new.codempvd,new.codfilialvd,new.codvend,
                   new.vlrliqvenda,dtrec, new.dtcompvenda, new.vlrcomisvenda,new.docvenda,
                   new.codempbo,new.codfilialbo,new.codbanco,
                   new.codemp,new.codfilial,
                   new.codempcb, new.codfilialcb, new.codcartcob, 
                   new.codempca, new.codfilialca, new.numconta,
                   new.flag, new.obsrec, new.vlrbasecomis, :vlrretensaoiss);
           end
           else
           begin
               delete from fnreceber where codvenda = new.codvenda and tipovenda=new.tipovenda and codemp=new.codemp and codfilialva = new.codfilial;
           end
           
           --SELECT CODMODNOTA FROM EQTIPOMOV m WHERE m.codemp=new.codemptm and m.codfilial=new.codfilialtm and m.codtipomov=new.codtipomov INTO ICODMODNOTA;
           --execute procedure sgdebugsp 'vdvendatgbu', 'PEGOU O MODELO DE NOTA:'||:ICODMODNOTA;
           --IF(:ICODMODNOTA=55) THEN
           --BEGIN
             --execute procedure sgdebugsp 'vdvendatgbu', 'ENTROU NO IF MODELO DA NOTA  IGUAL A 55:';
             --execute procedure sggeracnfsp('VD', new.codemp, new.codfilial, new.tipovenda, new.codvenda,null,null,null);
           --END
        end
        -- De pedido ou venda aberto mudou para finalizado
        if ((new.statusvenda in ('P2','V2')) and (old.statusvenda in ('P1','V1'))) then
        begin
           if (new.vlrliqvenda > 0) then
               execute procedure fnadicrecebersp01(
                   new.tipovenda, new.codvenda,
                   new.codemptc, new.codfilialtc, new.codtipocob,
                   new.codemppg,new.codfilialpg,new.codplanopag,
                   new.codempcl,new.codfilialcl,new.codcli,
                   new.codempvd,new.codfilialvd,new.codvend,
                   new.vlrliqvenda,new.dtsaidavenda, new.dtcompvenda, new.vlrcomisvenda,new.docvenda,
                   new.codempbo,new.codfilialbo,new.codbanco,
                   new.codemp,new.codfilial,
                   new.codempcb, new.codfilialcb, new.codcartcob, 
                   new.codempca, new.codfilialca, new.numconta,
                   new.flag, new.obsrec, new.vlrbasecomis, :vlrretensaoiss);
           else
           begin
               delete from fnreceber where codvenda = new.codvenda and tipovenda=new.tipovenda and codemp=new.codemp and codfilialva = new.codfilial;
           end
        end
        -- De pedido fechado para venda fechada ou venda fechada para pedido fechado, ou sem alterao (em processo de fechamento)
        else if ((new.statusvenda in ('P2','V2')) and (old.statusvenda in ('P2','V2'))) then
        begin
           if (new.vlrliqvenda > 0) then
               execute procedure fnadicrecebersp01(
                   new.tipovenda, new.codvenda,
                   new.codemptc, new.codfilialtc, new.codtipocob,
                   new.codemppg,new.codfilialpg,new.codplanopag,
                   new.codempcl,new.codfilialcl,new.codcli,
                   new.codempvd,new.codfilialvd,new.codvend,
                   new.vlrliqvenda,new.dtsaidavenda, new.dtcompvenda, new.vlrcomisvenda,new.docvenda,
                   new.codempbo,new.codfilialbo,new.codbanco,
                   new.codemp,new.codfilial,
                   new.codempcb, new.codfilialcb, new.codcartcob, 
                   new.codempca, new.codfilialca, new.numconta,
                   new.flag, new.obsrec, new.vlrbasecomis, :vlrretensaoiss);
           else
           begin
                delete from fnreceber where codvenda = new.codvenda and tipovenda=new.tipovenda and codemp=new.codemp and codfilialva = new.codfilial;
           end
        end
        -- De pedido emitido para venda emitida ou venda emitida para pedido emitido, ou sem alterao
        else if ((new.statusvenda in ('P3','V3')) and (old.statusvenda in ('P3','V3'))) then
        begin
           if (new.vlrliqvenda > 0) then
               execute procedure fnadicrecebersp01(
                   new.tipovenda, new.codvenda,
                   new.codemptc, new.codfilialtc, new.codtipocob,
                   new.codemppg,new.codfilialpg,new.codplanopag,
                   new.codempcl,new.codfilialcl,new.codcli,
                   new.codempvd,new.codfilialvd,new.codvend,
                   new.vlrliqvenda,new.dtsaidavenda, new.dtcompvenda, new.vlrcomisvenda,new.docvenda,
                   new.codempbo,new.codfilialbo,new.codbanco,
                   new.codemp,new.codfilial,
                   new.codempcb, new.codfilialcb, new.codcartcob,
                   new.codempca, new.codfilialca, new.numconta,
                   new.flag, new.obsrec, new.vlrbasecomis, :vlrretensaoiss);
           else
           begin
               delete from fnreceber where codvenda = new.codvenda and tipovenda=new.tipovenda and codemp=new.codemp and codfilialva = new.codfilial;
           end
        end
      end
      if (old.vlrcomisvenda != new.vlrcomisvenda) then
      begin
          update fnreceber set vlrcomirec=new.vlrcomisvenda
          where codvenda=new.codvenda and tipovenda=new.tipovenda and codempvd=new.codemp and
                codfilialvd=new.codfilial;
      end
      else if (old.codclcomis != new.codclcomis) then
      begin
          select r.codfilial,r.codrec,r.vlrparcrec,r.vlrcomirec,r.nroparcrec
              from fnreceber r
              where r.codvenda=new.codvenda and r.tipovenda=new.tipovenda
              and r.codempva=new.codemp and r.codfilialva=new.codfilial
              into :scodfilialrc, :icodrec, :nvlrparcrec, :nvlrcomirec, :snroparcrec;
          execute procedure fnitrecebersp01(new.codemp,:scodfilialrc,:icodrec,
                :nvlrparcrec,:nvlrcomirec,:snroparcrec,'S');
      end

      /**
        testa valor das parcelas x valor da venda
      **/
      if ((old.statusvenda in ('P2','V2')) and (new.statusvenda in ('P3','V3')) and (vlrmfintipomov<>'S') ) then
      begin
        select vlrparcrec from fnreceber
            where codvenda=new.codvenda and tipovenda=new.tipovenda
            and codempva=new.codemp and codfilialva = new.codfilial
            into :nvlrparcrec;

       if (new.vlrliqvenda-:vlrretensaoiss != :nvlrparcrec) then
        begin
            exception vdvendaex06;
        end

      end

      -- Caso a data ou o tipo de movimento tenham sido alterados, deve disparar o trigger da vditvenda
    if ( (new.dtsaidavenda != old.dtsaidavenda) or (new.codtipomov!=old.codtipomov) or ( new.docvenda != old.docvenda )  ) then
    begin
        -- Update necessrio para disparar o trigger da tabela vditvenda
        update vditvenda set coditvenda=coditvenda
        where codvenda = old.codvenda and tipovenda = old.tipovenda and codemp=old.codemp and codfilial=old.codfilial;
    end
    else if ((SUBSTRING(new.statusvenda FROM 1 FOR 1) IN ('C','N')) and (SUBSTRING(old.statusvenda FROM 1 FOR 1) in ('P','V'))) then
    begin

        delete from vdvendaorc where codemp=new.codemp and codfilial=new.codfilial and
        codvenda=new.codvenda and tipovenda=new.tipovenda;

        update vditvenda set qtditvendacanc=qtditvenda, qtditvenda=0 where codvenda=new.codvenda and tipovenda=new.tipovenda and
        codemp=new.codemp and codfilial=new.codfilial;

        delete from fnreceber where codvenda=new.codvenda and tipovenda=new.tipovenda and
        codemp=new.codemp and codfilialva=new.codfilial;

      end
      -- Verificao se existem registros na tabela eqmovserie com o mesmo cdigo de venda
      -- caso existam registros, os mesmos devem ser atualizados para o novo documento de venda,
      -- para que sejam listados no mdulo GMS Consulta Mov. Srie, com o documento correto de sada.
      -- antes desta alterao havia apenas a insero de registros na tabela eqmovserie com nmero
      -- de documento de pedido, no sendo atualizado aps o pedido se transforme em PV PS PR PD
      if (old.docvenda<>new.docvenda) then 
      begin
         update eqmovserie eqm set eqm.docmovserie=new.docvenda 
            where eqm.codempvd=new.codemp and eqm.codfilialvd=new.codfilial and 
              eqm.tipovenda=new.tipovenda and eqm.codvenda=new.codvenda and eqm.docmovserie<>new.docvenda;
      end

    end

  --END
  
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDVENDATGBI
AS
  DECLARE VARIABLE sTipoMov CHAR(2);
--  DECLARE VARIABLE V_CHAVE VARCHAR(500);
--  DECLARE VARIABLE V_RECURSIVO INTEGER;
BEGIN
--  V_CHAVE = 'VDVENDATGBI'; -- Nome do objeto (trigger ou procedure) a controlar recursividade
--  V_CHAVE = V_CHAVE || '_' || IIF(INSERTING, 'INS', IIF(UPDATING, 'UPD', 'DEL')); -- tipo de evento
--  V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
--  V_CHAVE = V_CHAVE || '_' || CAST(NEW.TIPOVENDA AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
--  V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODFILIAL AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
--  V_CHAVE = V_CHAVE || '_' || CAST(NEW.CODEMP AS VARCHAR(50)); -- concatenao dos campos que formam a chave primria
--  EXECUTE PROCEDURE PRO_RECURSIVO(:V_CHAVE) RETURNING_VALUES (:V_RECURSIVO);
  /* Verifica se  uma chamada recursiva ou no, se no for continua */
--  IF (V_RECURSIVO = 0) THEN
--  BEGIN
    EXECUTE PROCEDURE VDCLIENTEATIVOSP(new.CODEMPCL, new.CODFILIALCL, new.CODCLI);
    /*  EXECUTE PROCEDURE FNLIBCREDSP(new.CODVENDA,new.CODCLI,new.CODEMPCL,new.CODFILIALCL,null); */
    IF (new.VLRPRODVENDA IS NULL) THEN new.VLRPRODVENDA = 0;
    IF (new.VLRDESCVENDA IS NULL) THEN new.VLRDESCVENDA = 0;
    IF (new.VLRDESCITVENDA IS NULL) THEN new.VLRDESCITVENDA = 0;
    IF (new.VLRVENDA IS NULL) THEN new.VLRVENDA = 0;
    IF (new.VLRBASEICMSVENDA IS NULL) THEN new.VLRBASEICMSVENDA = 0;
    IF (new.VLRICMSVENDA IS NULL) THEN new.VLRICMSVENDA = 0;
    IF (new.VLRPISVENDA IS NULL) THEN new.VLRPISVENDA = 0;
    IF (new.VLRIRVENDA IS NULL) THEN new.VLRIRVENDA = 0;
    IF (new.VLRCSOCIALVENDA IS NULL) THEN new.VLRCSOCIALVENDA = 0;
    IF (new.VLRISENTASVENDA IS NULL) THEN new.VLRISENTASVENDA = 0;
    IF (new.VLROUTRASVENDA IS NULL) THEN new.VLROUTRASVENDA = 0;
    IF (new.VLRBASEIPIVENDA IS NULL) THEN new.VLRBASEIPIVENDA = 0;
    IF (new.VLRIPIVENDA IS NULL) THEN new.VLRIPIVENDA = 0;
    IF (new.VLRLIQVENDA IS NULL) THEN new.VLRLIQVENDA = 0;
    IF (new.VLRCOMISVENDA IS NULL) THEN new.VLRCOMISVENDA = 0;
    IF (new.VLRFRETEVENDA IS NULL) THEN new.VLRFRETEVENDA = 0;
    IF (new.VLRADICVENDA IS NULL) THEN new.VLRADICVENDA = 0;
    IF (new.TIPOVENDA IS NULL) THEN new.TIPOVENDA = 'V';
    IF (new.VLRBASEISSVENDA IS NULL) THEN new.VLRBASEISSVENDA = 0;
    IF (new.VLRISSVENDA IS NULL) THEN new.VLRISSVENDA = 0;
    IF (new.VLRPISVENDA IS NULL) THEN new.VLRPISVENDA = 0;
    IF (new.VLRIRVENDA IS NULL) THEN new.VLRIRVENDA = 0;
    IF (new.VLRCSOCIALVENDA IS NULL) THEN new.VLRCSOCIALVENDA = 0;
    IF (new.vlrbasepisvenda IS NULL) THEN new.vlrbasepisvenda = 0;
    IF (new.vlrbasecofinsvenda IS NULL) THEN new.vlrbasecofinsvenda = 0;
    IF (new.vlrpisvenda IS NULL) THEN new.vlrpisvenda = 0;
    IF (new.vlrcofinsvenda IS NULL) THEN new.vlrcofinsvenda = 0;
    IF (new.vlrbasecomis IS NULL) THEN new.vlrbasecomis = 0;
    if (new.sitdoc is null) then new.sitdoc='00';
    if (new.dtcompvenda is null) then new.dtcompvenda=new.dtemitvenda;
    if (new.codcaixa is null) then
        select codterm from sgretcaixa into new.codcaixa;
    select icodfilial from sgretfilial(new.codemp,'PVCAIXA') into new.codfilialcx;
    new.CODEMPCX = new.CODEMP;
    IF (NOT new.tipovenda = 'E') THEN -- Se for ECF no precisa buscar o DOC, porque o DOC  o numero do cupom.
        SELECT DOC FROM LFNOVODOCSP(new.Serie,new.CODEMPSE,new.CODFILIALSE) INTO new.DocVenda;
    SELECT TIPOMOV,FISCALTIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIALTM INTO sTipoMov,new.FLAG;
    IF ( new.FLAG <> 'S') THEN
    BEGIN
        new.FLAG = 'N';
    END
    if ((new.STATUSVENDA is null) OR (TRIM(new.STATUSVENDA) = '*')) then
    BEGIN
        IF (sTipoMov = 'VD') THEN new.STATUSVENDA = 'V1';
            ELSE new.STATUSVENDA = 'P1';
    END
--  END
END
^

/* Alter exist trigger... */
ALTER TRIGGER VDVENDATGBU
as
  declare variable icodfilial integer;
  declare variable icoditvenda integer;
  declare variable icodtipomov integer;
  declare variable sserie varchar(5);
  declare variable credicmssimples char(1);
  declare variable icodfilialpref smallint;
  declare variable ddesc numeric(15, 5);
  declare variable percpisfilial numeric(9,2);
  declare variable perccofinsfilial numeric(9,2);
  declare variable percirfilial numeric(9,2);
  declare variable perccsocialfilial numeric(9,2);
  declare variable percsimplesfilial numeric(9,2);
  declare variable vlrproditvenda numeric(15, 5);
  declare variable qtditvenda numeric(9,2);
  declare variable vlrcomisitvenda numeric(15, 5);
  declare variable vlrdescitvenda numeric(15, 5);
  declare variable perccomisitvenda numeric(9,2);
  declare variable simplesfilial char(1);
  declare variable simplescli char(1);
  declare variable pessoacli char(1);          
  declare variable nvlrfrete numeric(15,5);
  declare variable cadicfretevd char(1);
  declare variable percit numeric(9,2);
  declare variable retensaoimp char(1);
  declare variable tipomodnota char(1);
  --declare variable v_chave varchar(500);
  --declare variable v_recursivo integer;
begin
  --v_chave = 'vdvendatgbu'; -- nome do objeto (trigger ou procedure) a controlar recursividade
  --v_chave = v_chave || '_' || iif(inserting, 'ins', iif(updating, 'upd', 'del')); -- tipo de evento
  --v_chave = v_chave || '_' || cast(new.codvenda as varchar(50)); -- concatenao dos campos que formam a chave primria
  --v_chave = v_chave || '_' || cast(new.tipovenda as varchar(50)); -- concatenao dos campos que formam a chave primria
  --v_chave = v_chave || '_' || cast(new.codfilial as varchar(50)); -- concatenao dos campos que formam a chave primria
  --v_chave = v_chave || '_' || cast(new.codemp as varchar(50)); -- concatenao dos campos que formam a chave primria
  --execute procedure pro_recursivo(:v_chave) returning_values (:v_recursivo);
  /* Verifica se  uma chamada recursiva ou no, se no for continua */
  --if (v_recursivo = 0) then
  --begin
    retensaoimp = 'N';
    if (new.emmanut is null) then
      new.EMMANUT='N';
    if (new.BLOQVENDA IS NULL) then
      new.BLOQVENDA='N';
    IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
    BEGIN
      if ( ( (old.BLOQVENDA IS  NULL) OR (old.BLOQVENDA='N') ) AND (new.BLOQVENDA='S') )  then
      begin
          new.DTALT=cast('now' AS DATE);
          new.IDUSUALT=user;
          new.HALT=cast('now' AS TIME);
      end

      IF ( (new.DTCOMPVENDA is null) or (old.DTEMITVENDA<>new.DTEMITVENDA)  ) THEN
         new.DTCOMPVENDA=new.DTEMITVENDA;

      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP, 'SGPREFERE1') INTO iCodFilialPref;

      EXECUTE PROCEDURE VDCLIENTEATIVOSP(new.CODEMPCL, new.CODFILIALCL, new.CODCLI);

      if ( ( (old.BLOQVENDA IS NOT NULL AND old.BLOQVENDA='S') or (new.BLOQVENDA='S') ) and coalesce(old.chavenfevenda,'')=coalesce(new.chavenfevenda,'')) then
         EXCEPTION VDVENDAEX07 'ESTA VENDA EST BLOQUEADA!!!';

      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=user;
      new.HALT=cast('now' AS TIME);
      SELECT CODFILIALSEL FROM SGCONEXAO WHERE NRCONEXAO=CURRENT_CONNECTION AND
          CONECTADO > 0 INTO ICODFILIAL;
      IF (SUBSTRING(old.STATUSVENDA FROM 1 FOR 1) = 'C' and SUBSTRING(new.STATUSVENDA FROM 1 FOR 1) <> 'C' and old.chavenfevenda=new.chavenfevenda ) THEN
        EXCEPTION VDVENDAEX05;
      IF (SUBSTRING(old.STATUSVENDA FROM 1 FOR 1) = 'D' and SUBSTRING(old.STATUSVENDA FROM 1 FOR 1) <> 'D' and old.chavenfevenda=new.chavenfevenda) THEN
        EXCEPTION VDVENDAEX05 'ESTA VENDA FOI DEVOLVIDA!';
      IF (SUBSTRING(old.STATUSVENDA FROM 1 FOR 1) = 'N' and SUBSTRING(old.STATUSVENDA FROM 1 FOR 1) <> 'N' and old.chavenfevenda=new.chavenfevenda) THEN
        EXCEPTION VDVENDAEX05 'ESTA VENDA FOI DENEGADA!';
      IF ((SUBSTRING(old.STATUSVENDA FROM 1 FOR 1) = 'P') AND (SUBSTRING(new.STATUSVENDA FROM 1 FOR 1) = 'V' ) AND new.IMPNOTAVENDA = 'N') THEN
      BEGIN
        if ( new.subtipovenda = 'NC' ) then
        begin
             SELECT T2.CODTIPOMOV, T2.SERIE FROM EQTIPOMOV T2, EQTIPOMOV T WHERE T2.CODEMP=T.CODEMPTC
               AND T2.CODFILIAL=T.CODFILIALTC AND T2.CODTIPOMOV = T.CODTIPOMOVTC
               AND T.CODEMP=new.CODEMPTM AND T.CODFILIAL=new.CODFILIALTM AND T.CODTIPOMOV=new.CODTIPOMOV
               INTO :iCodTipoMov, :sSerie;
        end
        if ( ( new.subtipovenda <> 'NC') or (iCodTipoMov is null) ) then 
        begin
             SELECT T2.CODTIPOMOV
             , (case when p.tipoemissaonfe='3' then coalesce(T2.SERIEC, T2.SERIE) else T2.SERIE end) SERIE 
             FROM EQTIPOMOV T2, EQTIPOMOV T, SGPREFERE1 P 
             WHERE T2.CODEMP=T.CODEMPTM
               AND T2.CODFILIAL=T.CODFILIALTM AND T2.CODTIPOMOV = T.CODTIPOMOVTM
               AND T.CODEMP=new.CODEMPTM AND T.CODFILIAL=new.CODFILIALTM AND T.CODTIPOMOV=new.CODTIPOMOV
               AND P.CODEMP=T.CODEMP AND P.CODFILIAL=:iCodFilialPref
               INTO :iCodTipoMov, :sSerie;
        end
        IF (iCodTipoMov IS NULL) THEN
          SELECT T.CODTIPOMOV, T.SERIE FROM SGPREFERE1 P, EQTIPOMOV T 
          WHERE P.CODEMPTM=T.CODEMP AND
                 P.CODFILIALTM=T.CODFILIAL AND P.CODTIPOMOV = T.CODTIPOMOV
                 AND P.CODEMP=new.CODEMP AND P.CODFILIAL = :iCodFilialPref INTO :iCodTipoMov, :sSerie;
        new.CODTIPOMOV = :iCodTipoMov;
        new.SERIE = :sSerie;
        IF ( ( not (old.IMPNOTAVENDA = 'S') ) AND ( not (new.IMPNOTAVENDA = 'S') ) ) THEN
        BEGIN
            SELECT DOC FROM LFNOVODOCSP(new.Serie,new.CODEMPSE,new.CODFILIALSE) INTO new.DocVenda;
            new.IMPNOTAVENDA = 'S';
        END
      END
      SELECT FISCALTIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
             AND CODEMP=new.CODEMP AND CODFILIAL = new.codfilialtm INTO new.FLAG;
      IF (new.FLAG<>'S') THEN
        new.FLAG = 'N';
      SELECT VLRFRETEVD, ADICFRETEVD FROM VDFRETEVD WHERE CODVENDA=old.CODVENDA AND TIPOVENDA=old.TIPOVENDA AND ADICFRETEVD = 'S'
             AND CODEMP=old.CODEMP AND CODFILIAL = old.codfilial INTO new.VLRFRETEVENDA, :CADICFRETEVD;
      IF (new.VLRDESCVENDA IS NULL) THEN
        new.VLRDESCVENDA = 0;
      IF (new.VLRDESCITVENDA IS NULL) THEN
        new.VLRDESCITVENDA = 0;
      IF (new.VLRADICVENDA IS NULL) THEN
        new.VLRADICVENDA = 0;
      IF (new.VLRFRETEVENDA IS NULL) THEN
        new.VLRFRETEVENDA = 0;
      IF (new.VLRPRODVENDA IS NULL) THEN
        new.VLRPRODVENDA = 0;
      IF (new.VLRIPIVENDA IS NULL) THEN
        new.VLRIPIVENDA = 0;
      IF (new.VLRBASEICMSVENDA IS NULL) THEN
        new.VLRBASEICMSVENDA = 0;
      IF (new.VLRDESCITVENDA > 0) THEN
        dDesc = new.VLRDESCITVENDA;
      ELSE
        dDesc = new.VLRDESCVENDA;
      IF (new.VLRBASEICMSSTVENDA IS NULL) THEN
        new.VLRBASEICMSSTVENDA = 0;
      IF (new.VLRICMSSTVENDA IS NULL) THEN
        new.VLRICMSSTVENDA = 0;

      SELECT C.SIMPLESCLI,C.PESSOACLI FROM VDCLIENTE C WHERE C.CODCLI=new.CODCLI AND
        C.CODFILIAL=new.CODFILIALCL AND C.CODEMP=new.CODEMPCL INTO SIMPLESCLI,PESSOACLI;
      SELECT SIMPLESFILIAL,PERCPISFILIAL,PERCCOFINSFILIAL,PERCIRFILIAL,PERCCSOCIALFILIAL,coalesce(PERCSIMPLESFILIAL,0)
        FROM SGFILIAL WHERE CODEMP=new.CODEMP AND CODFILIAL=:ICODFILIAL
        INTO SIMPLESFILIAL,PERCPISFILIAL,PERCCOFINSFILIAL,PERCIRFILIAL,PERCCSOCIALFILIAL,PERCSIMPLESFILIAL;
      IF (SIMPLESFILIAL = 'N') THEN
      BEGIN
        new.VLRIRVENDA = (new.vlrliqvenda/100)*PERCIRFILIAL;
        new.VLRCSOCIALVENDA = (new.vlrliqvenda/100)*PERCCSOCIALFILIAL;
      END
      ELSE
      BEGIN
        new.VLRIRVENDA = 0;
        new.VLRCSOCIALVENDA = 0;

        /*Verifica se deve destacar crdito de icms (simples)*/
        select p1.credicmssimples,p1.retensaoimp from sgprefere1 p1 where p1.codemp=new.codemp and p1.codfilial=:icodfilialpref
        into credicmssimples,retensaoimp;

        if(credicmssimples='S') then
        begin
            new.vlricmssimples = (new.vlrprodvenda/100) * percsimplesfilial ;
            new.percicmssimples = percsimplesfilial;
        end

      END
      if (CADICFRETEVD = 'S') then
         NVLRFRETE = cast(new.VLRFRETEVENDA as decimal(15,2));
      else
         NVLRFRETE = 0;

      new.VLRLIQVENDA = coalesce(new.VLRPRODVENDA,0)
                      - coalesce(dDesc,0)
                      + coalesce(new.VLRADICVENDA,0)
                      + coalesce(:NVLRFRETE,0)
                      + coalesce(new.VLRIPIVENDA,0)
                      + coalesce(new.vlricmsstvenda,0);

      if (SIMPLESCLI = 'N' AND PESSOACLI = 'J' AND RETENSAOIMP = 'S') then
      begin
        new.VLRLIQVENDA =
             cast(
                (coalesce(new.VLRLIQVENDA,0)) -
                (case when new.calcpisvenda='S' then coalesce(new.vlrpisvenda,0) else 0 end) -
                (case when new.calccofinsvenda='S' then coalesce(new.vlrcofinsvenda,0) else 0 end) -
                (case when new.calcirvenda='S' then coalesce(new.vlrirvenda,0) else 0 end) -
                (case when new.calccsocialvenda='S' then coalesce(new.vlrcsocialvenda,0) else 0 end)
            as numeric(15, 5));
      end

      IF ((SUBSTRING(old.STATUSVENDA FROM 1 FOR 1) IN ('P','V')) AND (SUBSTRING(new.STATUSVENDA FROM 1 FOR 1) IN ('C','N'))) THEN
      BEGIN
          new.VLRDESCITVENDA = 0;
          new.VLRPRODVENDA = 0;
          new.VLRBASEICMSVENDA = 0;
          new.VLRICMSVENDA = 0;
          new.VLRISENTASVENDA = 0;
          new.VLROUTRASVENDA = 0;
          new.VLRBASEIPIVENDA = 0;
          new.VLRIPIVENDA = 0;
          new.VLRLIQVENDA = 0;
          new.VLRCOMISVENDA = 0;
          new.VLRISSVENDA = 0;
          new.VLRBASEISSVENDA = 0;
          new.vlrpisvenda = 0;
          new.vlrcofinsvenda = 0;
          new.vlrirvenda = 0;
          new.vlrcsocialvenda =0;
          new.vlrbaseicmsstvenda=0;
          new.vlricmsstvenda=0;
      END
      /**
       COMISSAO
      **/
      IF ((NOT NEW.VLRCOMISVENDA IS NULL) AND
          (NEW.VLRLIQVENDA > 0) AND
          ((NOT NEW.VLRDESCVENDA = OLD.VLRDESCVENDA) OR (NOT NEW.PERCMCOMISVENDA = OLD.PERCMCOMISVENDA))) then
      BEGIN
        /* Distribuindo a comissao: */
        FOR SELECT CODITVENDA,VLRPRODITVENDA,QTDITVENDA,coalesce(VLRCOMISITVENDA,0),coalesce(vlrdescitvenda,0),
            coalesce(iv.perccomisitvenda,0)
            FROM VDITVENDA IV
            WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND CODVENDA=new.CODVENDA and tipovenda=new.tipovenda
            INTO ICODITVENDA,VLRPRODITVENDA,QTDITVENDA,VLRCOMISITVENDA,VLRDESCITVENDA,PERCCOMISITVENDA DO
        BEGIN
          /* Calculo do item.: */
          /* INCLUIDO PARA DISTRIBUIR A COMISSAO MENOS O DESCONTO PROPORCIONALMENTE*/
          PERCIT = 0;
          IF (new.VLRPRODVENDA > 0 AND NOT new.VLRDESCITVENDA > 0 AND new.VLRDESCVENDA > 0) THEN
          BEGIN
            PERCIT = (100*VLRPRODITVENDA) / new.VLRPRODVENDA;
            VLRDESCITVENDA = (new.VLRDESCVENDA  * PERCIT) / 100;
          END
          IF (new.VLRPRODVENDA > 0 AND new.PERCMCOMISVENDA > 0) THEN
          BEGIN
            PERCCOMISITVENDA = new.PERCMCOMISVENDA;
            /* Retira.. */
            new.VLRCOMISVENDA = new.VLRCOMISVENDA - VLRCOMISITVENDA;
            /* Atualiza.. */
            VLRCOMISITVENDA = ((VLRPRODITVENDA - VLRDESCITVENDA) * PERCCOMISITVENDA) / 100;
            /* Adiciona.. */
            new.VLRCOMISVENDA = new.VLRCOMISVENDA + VLRCOMISITVENDA;
          END
          ELSE IF (new.PERCMCOMISVENDA=0) then
          BEGIN
              VLRCOMISITVENDA = 0;
              PERCCOMISITVENDA = 0;
              new.VLRCOMISVENDA = 0;
          END
          UPDATE VDITVENDA SET VLRCOMISITVENDA=:VLRCOMISITVENDA,PERCCOMISITVENDA=:PERCCOMISITVENDA
          WHERE CODITVENDA=:ICODITVENDA AND CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
        END
      END
      /* Calcula o percentual medio da comissao */
      ELSE IF (new.PERCMCOMISVENDA = old.PERCMCOMISVENDA AND new.VLRLIQVENDA > 0) THEN
      begin
        -- new.PERCMCOMISVENDA = (new.VLRCOMISVENDA/new.VLRLIQVENDA)*100.000;
        -- Modificado, pois causava divergencia em vendas geradas a partir de oramentos.
        if ((new.vlrprodvenda-new.vlrdescvenda)>0) then
        begin
          new.PERCMCOMISVENDA = (new.VLRCOMISVENDA/(new.vlrprodvenda-new.vlrdescvenda)) * 100;
        end
        else
        begin
          new.PERCMCOMISVENDA = 0;
        end
      end

      IF (new.STATUSVENDA = 'V4') THEN
      BEGIN
        new.IMPNOTAVENDA = 'S';
        new.STATUSVENDA = 'V3';
      END
      IF ((new.IMPNOTAVENDA = 'S') AND (old.IMPNOTAVENDA = 'S')) THEN
      BEGIN
        new.DOCVENDA = old.DOCVENDA;
      END
      if (coalesce(new.cnf,0)=0) then
      begin
         select mn.tipomodnota from eqtipomov tm, lfmodnota mn
            where mn.codemp=tm.codempmn and mn.codfilial=tm.codfilialmn and mn.codmodnota=tm.codmodnota
            and tm.codemp=new.codemptm and tm.codfilial=new.codfilialtm and tm.codtipomov=new.codtipomov
            into :tipomodnota;
         if (coalesce(tipomodnota,'')='E') then
         begin 
             select cnf from sggeracnfsp('VD', new.codemp, new.codfilial, new.tipovenda, new.codvenda,null,null,null) into new.cnf;
         end
      end
      
    END

    -- Atualizando o status do documento fiscal para 02 - Documento cancelado, quando nota for cancelado pelo sistema.
    IF (SUBSTRING(new.STATUSVENDA FROM 1 FOR 1) IN ('C','N') and new.sitdoc!='02') THEN
    begin
      new.sitdoc = '02';
    end

    if(old.chavenfevenda is null and new.chavenfevenda is not null) then
    begin
      new.emmanut = 'N';
    end

  --END

END
^

/* Alter Procedure... */
/* Alter (ATADICATENDIMENTOCLISP) */
ALTER PROCEDURE ATADICATENDIMENTOCLISP(ICODTIPOATENDO INTEGER,
ICODATEND INTEGER,
ICODSETOR INTEGER,
ICODEMP INTEGER,
ICODFILIAL INTEGER,
IDOC INTEGER,
DATAATENDO DATE,
DATAATENDOFIN DATE,
HORAATENDO TIME,
HORAATENDOFIN TIME,
OBSATENDO VARCHAR(10000),
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
CODEMPCT INTEGER,
CODFILIALCT INTEGER,
CODCONTR INTEGER,
CODITCONTR INTEGER,
CODREC INTEGER,
NPARCITREC INTEGER,
CODEMPCH INTEGER,
CODFILIALCH SMALLINT,
CODCHAMADO INTEGER,
OBSINTERNO VARCHAR(10000),
CONCLUICHAMADO CHAR,
CODEMPEA INTEGER,
CODFILIALEA SMALLINT,
CODESPEC INTEGER)
 AS
declare variable icodatendo integer;
declare variable ifilialatendo integer;
declare variable ifilialtipoatendo integer;
declare variable ifilialatend integer;
declare variable ifilialsetor integer;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATATENDIMENTO') INTO IFILIALATENDO;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATTIPOATENDO') INTO IFILIALTIPOATENDO;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATATENDENTE') INTO IFILIALATEND;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATSETOR') INTO IFILIALSETOR;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALATENDO,'AT') INTO ICODATENDO;

  INSERT INTO ATATENDIMENTO (
    CODEMP,CODFILIAL,CODATENDO,CODEMPTO,
    CODFILIALTO,CODTPATENDO,CODEMPAE,
    CODFILIALAE,CODATEND,CODEMPSA,CODFILIALSA,
    CODSETAT,STATUSATENDO,IDUSU,CODEMPUS,CODFILIALUS,DOCATENDO, DATAATENDO,
    DATAATENDOFIN, HORAATENDO, HORAATENDOFIN, OBSATENDO, CODEMPCL, CODFILIALCL, CODCLI, CODEMPCT, CODFILIALCT,
    CODCONTR, CODITCONTR, CODEMPCH, CODFILIALCH, CODCHAMADO, obsinterno, CONCLUICHAMADO,
    CODEMPEA, CODFILIALEA, CODESPEC )

  VALUES
  (
    :ICODEMP,:IFILIALATENDO,:ICODATENDO,:ICODEMP,
    :IFILIALTIPOATENDO,:ICODTIPOATENDO,:ICODEMP,
    :IFILIALATEND,:ICODATEND,:ICODEMP,:IFILIALSETOR,
    :ICODSETOR,'AA',lower(USER),:ICODEMP,:ICODFILIAL,:IDOC,
    :DATAATENDO,:DATAATENDOFIN,:HORAATENDO,:HORAATENDOFIN,:OBSATENDO,:CODEMPCL,
    :CODFILIALCL,:CODCLI, :CODEMPCT, :CODFILIALCT, :CODCONTR, :CODITCONTR, :codempch,
    :codfilialch, :codchamado, :obsinterno, :CONCLUICHAMADO,
    :CODEMPEA, :CODFILIALEA, :CODESPEC
  );

  -- Caso o atendimento tenha vinculo com o contas a receber
  IF(CODREC IS NOT NULL AND NPARCITREC IS NOT NULL) THEN
  BEGIN
    INSERT INTO ATATENDIMENTOITREC (CODEMP,CODFILIAL,CODATENDO,CODEMPIR,CODFILIALIR,CODREC,NPARCITREC) VALUES
        (:ICODEMP,:ICODFILIAL,:ICODATENDO,:ICODEMP,:ICODFILIAL,:CODREC,:NPARCITREC);
  END



END
^

/* Alter (ATATENDIMENTOIUSP) */
ALTER PROCEDURE ATATENDIMENTOIUSP(IU CHAR,
CODEMP INTEGER,
CODFILIAL SMALLINT,
CODATENDO INTEGER,
CODEMPTO INTEGER,
CODFILIALTO SMALLINT,
CODTPATENDO INTEGER,
CODEMPAE INTEGER,
CODFILIALAE SMALLINT,
CODATEND INTEGER,
CODEMPSA INTEGER,
CODFILIALSA SMALLINT,
CODSETOR INTEGER,
DOCATENDO INTEGER,
DATAATENDO DATE,
DATAATENDOFIN DATE,
HORAATENDO TIME,
HORAATENDOFIN TIME,
OBSATENDO VARCHAR(10000),
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
CODCONTR INTEGER,
CODITCONTR SMALLINT,
CODEMPIR INTEGER,
CODFILIALIR SMALLINT,
CODREC INTEGER,
NPARCITREC INTEGER,
CODEMPCH INTEGER,
CODFILIALCH SMALLINT,
CODCHAMADO INTEGER,
OBSINTERNO VARCHAR(10000),
CONCLUICHAMADO CHAR,
CODEMPEA INTEGER,
CODFILIALEA SMALLINT,
CODESPEC INTEGER,
CODEMPUS INTEGER,
CODFILIALUS SMALLINT,
IDUSU VARCHAR(128),
STATUSATENDO CHAR(2),
CODEMPTA INTEGER,
CODFILIALTA SMALLINT,
CODTAREFA INTEGER,
CODEMPOC INTEGER,
CODFILIALOC INTEGER,
TIPOORC CHAR,
CODORC INTEGER,
SITATENDO CHAR(2),
CODEMPAG INTEGER,
CODFILIALAG SMALLINT,
TIPOAGE CHAR(5),
CODAGE INTEGER,
CODAGD INTEGER)
 AS
declare variable horaatendors time;
declare variable horaatendofinrs time;
declare variable dataatendors date;
declare variable contorc integer;
BEGIN

  DATAATENDORS = NULL;

  SELECT FIRST 1 A.DATAATENDO, A.HORAATENDO, A.HORAATENDOFIN
    FROM ATATENDIMENTO A
    WHERE A.CODEMP=:CODEMP AND A.CODFILIAL=:CODFILIAL AND
        A.CODEMPAE=:CODEMPAE AND A.CODFILIALAE=:CODFILIALAE AND
        A.CODATEND=:CODATEND AND A.CODATENDO<>:CODATENDO AND
        A.DATAATENDO=:DATAATENDO AND ( (A.HORAATENDO BETWEEN :HORAATENDO+1 AND :HORAATENDOFIN-1 )
        OR (A.HORAATENDOFIN BETWEEN :HORAATENDO+1 AND :HORAATENDOFIN-1 ) )
    INTO :DATAATENDORS, :HORAATENDORS, :HORAATENDOFINRS ;

  if (DATAATENDORS IS NOT NULL) then
  begin
     exception atatendimentoex02 'Jah existe(m) lancamento(s) em '||:dataatendors||' - h.: '||
        :horaatendors||' - '||:horaatendofinrs;
  end

  if (IU = 'I') then
  begin
     SELECT ISEQ FROM SPGERANUM(:CODEMP,:CODFILIAL,'AT') INTO :CODATENDO;
     STATUSATENDO = 'AA';
     INSERT INTO ATATENDIMENTO (
        CODEMP,CODFILIAL,CODATENDO,CODEMPTO,
        CODFILIALTO,CODTPATENDO,CODEMPAE,
        CODFILIALAE,CODATEND,CODEMPSA,CODFILIALSA,
        CODSETAT,STATUSATENDO,
        CODEMPUS,CODFILIALUS, IDUSU,
        DOCATENDO, DATAATENDO,
        DATAATENDOFIN, HORAATENDO, HORAATENDOFIN, OBSATENDO, CODEMPCL, CODFILIALCL, CODCLI, CODEMPCT, CODFILIALCT,
        CODCONTR, CODITCONTR, CODEMPCH, CODFILIALCH, CODCHAMADO, obsinterno, CONCLUICHAMADO,
        CODEMPEA, CODFILIALEA, CODESPEC , CODEMPTA, CODFILIALTA, CODTAREFA, SITATENDO )

     VALUES (
        :CODEMP, :CODFILIAL, :CODATENDO,
        :CODEMPTO, :CODFILIALTO, :CODTPATENDO,
        :CODEMPAE, :CODFILIALAE,:CODATEND,
        :CODEMPSA,:CODFILIALSA, :CODSETOR,
        :STATUSATENDO ,
        :CODEMPUS, :CODFILIALUS, lower(:IDUSU),
        :DOCATENDO, :DATAATENDO, :DATAATENDOFIN, :HORAATENDO,
        :HORAATENDOFIN, :OBSATENDO,
        :CODEMPCL, :CODFILIALCL, :CODCLI,
        :CODEMPCT, :CODFILIALCT, :CODCONTR, :CODITCONTR,
        :CODEMPCH, :CODFILIALCH, :CODCHAMADO,
        :OBSINTERNO, :CONCLUICHAMADO,
        :CODEMPEA, :CODFILIALEA, :CODESPEC , :CODEMPTA, :CODFILIALTA, :CODTAREFA, :SITATENDO
     );
  -- Caso o atendimento tenha vinculo com o contas a receber
     if (CODREC IS NOT NULL AND NPARCITREC IS NOT NULL) then
     begin
        INSERT INTO ATATENDIMENTOITREC (CODEMP,CODFILIAL,CODATENDO,CODEMPIR,CODFILIALIR,CODREC,NPARCITREC) VALUES
                (:CODEMP,:CODFILIAL,:CODATENDO,:CODEMPIR,:CODFILIALIR,:CODREC,:NPARCITREC);
     end

       -- Caso o atendimento tenha vinculo com o contas a receber
     if ( CODORC IS NOT NULL AND TIPOORC IS NOT NULL) then
     begin
        INSERT INTO atatendimentoorc (CODEMP,CODFILIAL,CODATENDO,CODEMPOC,CODFILIALOC,TIPOORC,CODORC) VALUES
                (:CODEMP,:CODFILIAL,:CODATENDO,:CODEMPOC,:CODFILIALOC,:TIPOORC,:CODORC);
     end

     -- Caso o atendimento tenha vinculo com um agendamento
     if ( CODAGD IS NOT NULL AND TIPOAGE IS NOT NULL) then
     begin
       
        INSERT INTO ATATENDOAGENDA (CODEMP, CODFILIAL, CODATENDO, CODEMPAG, CODFILIALAG, TIPOAGE, CODAGE, CODAGD)
                 VALUES (:CODEMP, :CODFILIAL, :CODATENDO, :CODEMPAG, :CODFILIALAG, :TIPOAGE, :CODAGE, :CODAGD);
     end

  end
  else if (IU = 'U') then
  begin
        UPDATE ATATENDIMENTO SET
            CODATEND=:CODATEND, DATAATENDO=:DATAATENDO, HORAATENDO=:HORAATENDO, DATAATENDOFIN=:DATAATENDOFIN,
            HORAATENDOFIN=:HORAATENDOFIN, OBSATENDO=:OBSATENDO,CODEMPTO=:CODEMPTO, CODFILIALTO=:CODFILIALTO,
            CODTPATENDO=:CODTPATENDO,CODEMPSA=:CODEMPSA, CODFILIALSA=:CODFILIALSA, CODSETAT=:CODSETOR, CODEMPCH=:CODEMPCH,
            CODFILIALCH=:CODFILIALCH, CODCHAMADO=:CODCHAMADO, CODEMPCT=:CODEMPCT, CODFILIALCT=:CODFILIALCT,
            CODCONTR=:CODCONTR, CODITCONTR=:CODITCONTR, STATUSATENDO=:STATUSATENDO, OBSINTERNO=:OBSINTERNO,
            CONCLUICHAMADO=:CONCLUICHAMADO, CODEMPEA=:CODEMPEA, CODFILIALEA=:CODFILIALEA, CODESPEC=:CODESPEC,
            CODEMPTA=:CODEMPTA, CODFILIALTA=:CODFILIALTA, CODTAREFA=:CODTAREFA,
            CODEMPCL=:CODEMPCL, CODFILIALCL=:CODFILIALCL, CODCLI=:CODCLI, SITATENDO=:SITATENDO
        WHERE
            CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL AND CODATENDO=:CODATENDO;

        SELECT COUNT(*) FROM ATATENDIMENTOORC WHERE CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL AND CODATENDO=:CODATENDO
        INTO :CONTORC;

        if ( :CONTORC = 0 AND CODORC IS NOT NULL AND TIPOORC IS NOT NULL) then
        begin
           INSERT INTO atatendimentoorc (CODEMP,CODFILIAL,CODATENDO,CODEMPOC,CODFILIALOC,TIPOORC,CODORC) VALUES
                    (:CODEMP,:CODFILIAL,:CODATENDO,:CODEMPOC,:CODFILIALOC,:TIPOORC,:CODORC);
        end

                 -- Caso o atendimento tenha vinculo com um agendamento
         if ( CODAGD IS NOT NULL AND TIPOAGE IS NOT NULL) then
         begin
           
            INSERT INTO ATATENDOAGENDA (CODEMP, CODFILIAL, CODATENDO, CODEMPAG, CODFILIALAG, TIPOAGE, CODAGE, CODAGD)
                     VALUES (:CODEMP, :CODFILIAL, :CODATENDO, :CODEMPAG, :CODFILIALAG, :TIPOAGE, :CODAGE, :CODAGD);
         end
  end
END
^

/* Alter (CRTOTAL01ISP) */
ALTER PROCEDURE CRTOTAL01ISP(CODEMP INTEGER,
CODFILIAL INTEGER)
 RETURNS(SEQTOT INTEGER)
 AS
declare variable codfilialtt smallint;
begin
  select icodfilial from sgretfilial(:codemp, 'CRTOTAL')
    into :codfilialtt;
  select iseq from spgeranum(:codemp, :codfilialtt, 'TT')
    into :seqtot;
  insert into crtotal (codemp, codfilial, seqtot)
    values(:codemp, :codfilialtt, :seqtot);
  suspend;
end
^

/* Alter (EQMOVPRODDSP) */
ALTER PROCEDURE EQMOVPRODDSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
DDTMOVPROD DATE,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
SEQSUBPROD SMALLINT,
TIPONF CHAR)
 AS
declare variable icodemp integer;
declare variable scodfilial smallint;
declare variable icodmovprod integer;
declare variable nsldmovprod numeric(15,5);
declare variable ncustompmmovprod numeric(15,5);
declare variable nsldmovprodax numeric(15,5);
declare variable ncustompmmovprodax numeric(15,5);
begin
  /* Procedure de deleo da tabela eqmovprod */
  SELECT ICODEMP, SCODFILIAL, ICODMOVPROD
  FROM EQMOVPRODRETCODSP(:ICODEMPIV, :SCODFILIALIV, :ICODINVPROD, :ICODEMPCP,
    :SCODFILIALCP, :ICODCOMPRA, :SCODITCOMPRA, :ICODEMPVD, :SCODFILIALVD,
    :CTIPOVENDA, :ICODVENDA, :SCODITVENDA, :ICODEMPRM, :SCODFILIALRM, :ICODRMA,
    :SCODITRMA, :ICODEMPOP,  :SCODFILIALOP,  :ICODOP, :SSEQOP, :sseqentop, :seqsubprod)
    INTO :ICODEMP, :SCODFILIAL, :ICODMOVPROD;

  SELECT NSALDO, NCUSTOMPM, NSALDOAX, NCUSTOMPMAX
  FROM EQMOVPRODSLDSP(:ICODEMP, :SCODFILIAL, :ICODMOVPROD,
   :ICODEMPPD, :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, 0, 0,
   :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX)
     INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX  ;

  /* DELETAR EQMOVPROD */
  DELETE FROM EQMOVPROD WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL
    AND CODMOVPROD=:ICODMOVPROD;

  /* REPROCESSAR ESTOQUE */
  SELECT NSLDPRC, NCUSTOMPMPRC, NSLDPRCAX, NCUSTOMPMPRCAX
    FROM EQMOVPRODPRCSLDSP( :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
      :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, null, :NSLDMOVPROD, :NCUSTOMPMMOVPROD,
      :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX, :ICODEMPAX, :SCODFILIALAX, :ICODALMOX,
      :CMULTIALMOX, :TIPONF)
    INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX;

  /* ATUALIZA CUSTO NO CADASTRO DE PRODUTOS
   OPERADOR 1 PARA EFETUAR A ATUALIZAO SEMPRE
  EXECUTE PROCEDURE EQMOVPRODATCUSTSP( 1, :ICODEMP, :SCODFILIAL,
   :ICODMOVPROD,  :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, 0);
   */

  suspend;
end
^

/* Alter (EQMOVPRODSEQSP) */
ALTER PROCEDURE EQMOVPRODSEQSP(ICODEMP INTEGER)
 RETURNS(SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER)
 AS
begin
  /* Busca o cdigo sequencial da tabela eqmovprod */
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP, 'EQMOVPROD') INTO :SCODFILIAL ;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP, :SCODFILIAL, 'MP' ) INTO :ICODMOVPROD ;
  suspend;
end
^

/* empty dependent procedure body */
/* Clear: SGINICONSP for: SGATUALIZABDSP */
ALTER PROCEDURE SGINICONSP(ICODEMP INTEGER,
CIDUSU CHAR(8),
ICODFILIALSEL SMALLINT,
ICODTERM SMALLINT)
 RETURNS(SRET SMALLINT)
 AS
 BEGIN SUSPEND; END
^

/* Alter (SGATUALIZABDSP) */
ALTER PROCEDURE SGATUALIZABDSP(ICODEMP INTEGER)
 AS
DECLARE VARIABLE ICODEMPTMP INTEGER;
begin
  if (ICODEMP IS NULL) then
     ICODEMP = 99;
  /*CTEMP = printLog('Entrou no atualizabdsp '||cast(ICODEMP AS CHAR(10)));*/

  EXECUTE PROCEDURE SGDADOSINISP(:ICODEMP);
  EXECUTE PROCEDURE SGGRANTUSERSP ;
  FOR SELECT CODEMP FROM SGEMPRESA INTO :ICODEMPTMP DO
  BEGIN
     EXECUTE PROCEDURE SGOBJETOINSTBSP(:ICODEMPTMP);
     EXECUTE PROCEDURE SGGRANTADMSP(:ICODEMPTMP);
  END
  suspend;
end
^

/* Alter (SGINICONSP) */
ALTER PROCEDURE SGINICONSP(ICODEMP INTEGER,
CIDUSU CHAR(8),
ICODFILIALSEL SMALLINT,
ICODTERM SMALLINT)
 RETURNS(SRET SMALLINT)
 AS
DECLARE VARIABLE ICONECTADO INTEGER;
DECLARE VARIABLE ICODFILIALSELCX SMALLINT;
DECLARE VARIABLE ICODEMPTMP INTEGER;
DECLARE VARIABLE ICODFILIAL SMALLINT;
begin
  /* Procedure para inicializao da conexo com o banco de dados */
  SRET = 0;
  if (ICODEMP IS NULL) then
     ICODEMP = 99;
  /*CTEMP = printLog('Vai verificar o usurio');*/
  CIDUSU = lower(CIDUSU);
  IF ( CIDUSU='sysdba' ) THEN
  BEGIN
/*     CTEMP = printLog('Usurio sysdba');*/

     SELECT CODEMP FROM SGEMPRESA WHERE CODEMP=:ICODEMP INTO :ICODEMPTMP;
     IF (ICODEMPTMP IS NULL) THEN
        EXECUTE PROCEDURE SGATUALIZABDSP(:ICODEMP);
  END
  SELECT CODFILIAL FROM SGUSUARIO WHERE IDUSU=:cIdUsu AND
      CODEMP=:ICODEMP  INTO :iCodFilial;
/*  CTEMP = printLog('O usurio  = '||cIdUsu); */

/*  CTEMP = printLog('Contador de usurios '||cIdUsu); */

  if (iCodFilial is null) then
    EXCEPTION SGCONEXAOEX02;

  if (iCodFilialSel is not null) then
  begin
      SRET = 1;
      SELECT CONECTADO, CODFILIALSEL FROM SGCONEXAO
        WHERE NRCONEXAO=CURRENT_CONNECTION INTO :iConectado, iCodFilialSelCX;
      if (iConectado is null) then
          INSERT INTO SGCONEXAO (NRCONEXAO, CODEMP,CODFILIAL,IDUSU,CODFILIALSEL,CONECTADO,CODTERM)
            VALUES (CURRENT_CONNECTION, :iCodemp, :iCodfilial, :cIdusu, :iCodfilialSel, 1, :iCodTerm);
      else
      begin
          if (iConectado<=0) then
             UPDATE SGCONEXAO SET CONECTADO=1, CODFILIALSEL=:iCodfilialSel, CODTERM = :iCodTerm,
               CODEMP=:iCodemp, CODFILIAL=:iCodfilial , IDUSU=:cIdUsu
               WHERE NRCONEXAO=CURRENT_CONNECTION;
          else
          begin
             if (not (iCodfilialSelCX=iCodfilialSel) ) then
                EXCEPTION SGCONEXAOEX01;
             else
                UPDATE SGCONEXAO SET CONECTADO=CONECTADO+1, CODTERM = :iCodTerm,
                   CODEMP=:iCodemp, CODFILIAL=:iCodfilial, IDUSU=:cIdUsu
                WHERE NRCONEXAO=CURRENT_CONNECTION;
          end
      end
      -- Implementao de atualizao de verso do aplicativo emissor de NFe, quando emisso prpria.
      update sgprefere1 set verprocnfe='1.3.4.9' where proceminfe=0 and verprocnfe<>'1.3.4.9';
  end
  suspend;
end
^

/* Alter (SGLOGSP01) */
ALTER PROCEDURE SGLOGSP01(CLASLOG CHAR(2),
TIPOLOG CHAR(3),
DESCLOG CHAR(60),
OBSLOG VARCHAR(1000))
 RETURNS(CODFILIAL SMALLINT,
CODLOG INTEGER)
 AS
DECLARE VARIABLE IDUSU CHAR(8);
DECLARE VARIABLE CODEMP INTEGER;
DECLARE VARIABLE CODCAIXA INTEGER;
BEGIN
  SELECT CODEMP,CODFILIALSEL,CODTERM, IDUSU FROM SGCONEXAO WHERE NRCONEXAO=CURRENT_CONNECTION AND
    CONECTADO > 0 INTO CODEMP, CODFILIAL, CODCAIXA, IDUSU;
  SELECT ISEQ FROM SPGERANUM(:CODEMP,:CODFILIAL,'LG') INTO CODLOG;
  INSERT INTO SGLOG(CODEMP,CODFILIAL,CODLOG,CODEMPUS,CODFILIALUS,IDUSU,
               CLASLOG,TIPOLOG,CODEMPCX,CODFILIALCX,CODCAIXA,
        DESCLOG,OBSLOG) VALUES
              (:CODEMP,:CODFILIAL,:CODLOG,:CODEMP,:CODFILIAL,:IDUSU,
               :CLASLOG,:TIPOLOG,:CODEMP,:CODFILIAL,:CODCAIXA,
               :DESCLOG,:OBSLOG);
  SUSPEND;
END
^

/* Alter (SGSETAGENDASP) */
ALTER PROCEDURE SGSETAGENDASP(CODAGD INTEGER,
CODEMP INTEGER,
DTAINIAGD DATE,
HRINIAGD TIME,
DTAFIMAGD DATE,
HRFIMAGD TIME,
ASSUNTOAGD CHAR(50),
DESCAGD VARCHAR(10000),
CODFILIALTA SMALLINT,
CODTIPOAGD INTEGER,
PRIORAGD SMALLINT,
CODAGE INTEGER,
TIPOAGE CHAR(5),
CODFILIALAE SMALLINT,
CODAGEEMIT INTEGER,
TIPOAGEEMIT CHAR(5),
CAAGD CHAR(2),
SITAGD CHAR(2),
RESOLUCAOMOTIVO VARCHAR(10000),
CODAGDAR INTEGER,
DIATODO CHAR)
 RETURNS(IRET INTEGER)
 AS
DECLARE VARIABLE IFILIALAGD INTEGER;
begin
  select ICODFILIAL from SGRETFILIAL(:CODEMP,'SGAGENDA') INTO IFILIALAGD;
  IF (CODAGD = 0) THEN
  BEGIN

    SELECT ISEQ FROM SPGERANUM(:CODEMP,:IFILIALAGD,'AG') INTO CODAGD;

    if(codagdar is not null ) then  -- Agendamento vinculado (repetio)
    begin
        insert into sgagenda (
            codemp, codfilial, codage, tipoage, codagd,
            dataagd, dtainiagd, hriniagd, dtafimagd, hrfimagd,
            assuntoagd, descagd, codempta, codfilialta, codtipoagd, prioragd, sitagd,
            codempae, codfilialae, codageemit, tipoageemit, caagd, resolucaomotivo,
            codempar,codfilialar,codagear,tipoagear,codagdar,diatodo)
        values (
            :codemp, :ifilialagd, :codage, :tipoage, :codagd,
            cast('today' as date), :dtainiagd, :hriniagd, :dtafimagd, :hrfimagd,
            :assuntoagd, :descagd, :codemp, :codfilialta, :codtipoagd, :prioragd, :sitagd,
            :codemp, :codfilialae, :codageemit, :tipoageemit, :caagd, :resolucaomotivo,
            :codemp,:ifilialagd,:codage,:tipoage,:codagdar,:diatodo
        );
    end
    else -- Agendamento simples, sem vnvulo (repetio)
    begin
        insert into sgagenda (
            CODEMP,CODFILIAL,CODAGE,TIPOAGE,CODAGD,
            DATAAGD,DTAINIAGD,HRINIAGD,DTAFIMAGD,HRFIMAGD,
            ASSUNTOAGD,DESCAGD,CODEMPTA,CODFILIALTA,CODTIPOAGD,PRIORAGD,SITAGD,
            CODEMPAE,CODFILIALAE,CODAGEEMIT,TIPOAGEEMIT,CAAGD, RESOLUCAOMOTIVO, DIATODO)
        values (
            :CODEMP,:IFILIALAGD,:CODAGE,:TIPOAGE,:CODAGD,
            CAST('today' AS DATE),:DTAINIAGD,:HRINIAGD,:DTAFIMAGD,:HRFIMAGD,
            :ASSUNTOAGD,:DESCAGD,:CODEMP,:CODFILIALTA,:CODTIPOAGD,:PRIORAGD,:SITAGD,
            :CODEMP,:CODFILIALAE,:CODAGEEMIT,:TIPOAGEEMIT,:CAAGD, :RESOLUCAOMOTIVO,:DIATODO

        );
    end
  end
  else
    update sgagenda set
      DTAINIAGD=:DTAINIAGD,HRINIAGD=:HRINIAGD,
      DTAFIMAGD=:DTAFIMAGD,HRFIMAGD=:HRFIMAGD,
      ASSUNTOAGD=:ASSUNTOAGD,DESCAGD=:DESCAGD,
      CODEMPTA=:CODEMP,CODFILIALTA=:CODFILIALTA,CODTIPOAGD=:CODTIPOAGD,
      PRIORAGD=:PRIORAGD,CAAGD=:CAAGD,
      SITAGD=:SITAGD,
      RESOLUCAOMOTIVO=:RESOLUCAOMOTIVO,
      codage=:codage, diatodo=:diatodo
      WHERE CODEMP=:CODEMP AND CODFILIAL=:IFILIALAGD
      AND CODAGD=:CODAGD AND TIPOAGE=:TIPOAGE;
  IRET = CODAGD;
  SUSPEND;
END
^

SET TERM ; ^

ALTER TABLE ATCONVENIADO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODCONV POSITION 3;

ALTER TABLE ATCONVENIADO ALTER COLUMN NOMECONV POSITION 4;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODEMPTC POSITION 5;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODFILIALTC POSITION 6;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODTPCONV POSITION 7;

ALTER TABLE ATCONVENIADO ALTER COLUMN DTNASCCONV POSITION 8;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODEMPAE POSITION 9;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODFILIALAE POSITION 10;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODATEND POSITION 11;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODEMPGI POSITION 12;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODFILIALGI POSITION 13;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODGRI POSITION 14;

ALTER TABLE ATCONVENIADO ALTER COLUMN RGCONV POSITION 15;

ALTER TABLE ATCONVENIADO ALTER COLUMN CPFCONV POSITION 16;

ALTER TABLE ATCONVENIADO ALTER COLUMN ENDCONV POSITION 17;

ALTER TABLE ATCONVENIADO ALTER COLUMN NUMCONV POSITION 18;

ALTER TABLE ATCONVENIADO ALTER COLUMN BAIRCONV POSITION 19;

ALTER TABLE ATCONVENIADO ALTER COLUMN CIDCONV POSITION 20;

ALTER TABLE ATCONVENIADO ALTER COLUMN CEPCONV POSITION 21;

ALTER TABLE ATCONVENIADO ALTER COLUMN FONECONV POSITION 22;

ALTER TABLE ATCONVENIADO ALTER COLUMN FAXCONV POSITION 23;

ALTER TABLE ATCONVENIADO ALTER COLUMN EMAILCONV POSITION 24;

ALTER TABLE ATCONVENIADO ALTER COLUMN PAICONV POSITION 25;

ALTER TABLE ATCONVENIADO ALTER COLUMN MAECONV POSITION 26;

ALTER TABLE ATCONVENIADO ALTER COLUMN RGPAICONV POSITION 27;

ALTER TABLE ATCONVENIADO ALTER COLUMN RGMAECONV POSITION 28;

ALTER TABLE ATCONVENIADO ALTER COLUMN CNSCONV POSITION 29;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODEMPCL POSITION 30;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODFILIALCL POSITION 31;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODCLI POSITION 32;

ALTER TABLE ATCONVENIADO ALTER COLUMN UFCONV POSITION 33;

ALTER TABLE ATCONVENIADO ALTER COLUMN CELCONV POSITION 34;

ALTER TABLE ATCONVENIADO ALTER COLUMN SEXOCONV POSITION 35;

ALTER TABLE ATCONVENIADO ALTER COLUMN IDENTIFICCONV POSITION 36;

ALTER TABLE ATCONVENIADO ALTER COLUMN COMPLCONV POSITION 37;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODEMPEC POSITION 38;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODFILIALEC POSITION 39;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODENC POSITION 40;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODEMPFC POSITION 41;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODFILIALFC POSITION 42;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODFUNC POSITION 43;

ALTER TABLE ATCONVENIADO ALTER COLUMN ICARDCONV POSITION 44;

ALTER TABLE ATCONVENIADO ALTER COLUMN NRVIACONV POSITION 45;

ALTER TABLE ATCONVENIADO ALTER COLUMN DDDCONV POSITION 46;

ALTER TABLE ATCONVENIADO ALTER COLUMN DDDFAXCONV POSITION 47;

ALTER TABLE ATCONVENIADO ALTER COLUMN DDDCELCONV POSITION 48;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODPAIS POSITION 49;

ALTER TABLE ATCONVENIADO ALTER COLUMN SIGLAUF POSITION 50;

ALTER TABLE ATCONVENIADO ALTER COLUMN CODMUNIC POSITION 51;

ALTER TABLE ATCONVENIADO ALTER COLUMN DTINS POSITION 52;

ALTER TABLE ATCONVENIADO ALTER COLUMN HINS POSITION 53;

ALTER TABLE ATCONVENIADO ALTER COLUMN IDUSUINS POSITION 54;

ALTER TABLE ATCONVENIADO ALTER COLUMN DTALT POSITION 55;

ALTER TABLE ATCONVENIADO ALTER COLUMN HALT POSITION 56;

ALTER TABLE ATCONVENIADO ALTER COLUMN IDUSUALT POSITION 57;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE CPCOMPRA ALTER COLUMN CODCOMPRA POSITION 3;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPPG POSITION 4;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALPG POSITION 5;

ALTER TABLE CPCOMPRA ALTER COLUMN CODPLANOPAG POSITION 6;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPFR POSITION 7;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALFR POSITION 8;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFOR POSITION 9;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPSE POSITION 10;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALSE POSITION 11;

ALTER TABLE CPCOMPRA ALTER COLUMN SERIE POSITION 12;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPTM POSITION 13;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALTM POSITION 14;

ALTER TABLE CPCOMPRA ALTER COLUMN CODTIPOMOV POSITION 15;

ALTER TABLE CPCOMPRA ALTER COLUMN DOCCOMPRA POSITION 16;

ALTER TABLE CPCOMPRA ALTER COLUMN DTENTCOMPRA POSITION 17;

ALTER TABLE CPCOMPRA ALTER COLUMN DTEMITCOMPRA POSITION 18;

ALTER TABLE CPCOMPRA ALTER COLUMN DTCOMPCOMPRA POSITION 19;

ALTER TABLE CPCOMPRA ALTER COLUMN HEMITCOMPRA POSITION 20;

ALTER TABLE CPCOMPRA ALTER COLUMN HENTCOMPRA POSITION 21;

ALTER TABLE CPCOMPRA ALTER COLUMN PERCDESCCOMPRA POSITION 22;

ALTER TABLE CPCOMPRA ALTER COLUMN PERCIPICOMPRA POSITION 23;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRPRODCOMPRA POSITION 24;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRLIQCOMPRA POSITION 25;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRCOMPRA POSITION 26;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRDESCCOMPRA POSITION 27;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRDESCITCOMPRA POSITION 28;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRADICCOMPRA POSITION 29;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEICMSCOMPRA POSITION 30;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEICMSSTCOMPRA POSITION 31;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEIPICOMPRA POSITION 32;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEPISCOMPRA POSITION 33;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASECOFINSCOMPRA POSITION 34;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSCOMPRA POSITION 35;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSSTCOMPRA POSITION 36;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRIPICOMPRA POSITION 37;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRPISCOMPRA POSITION 38;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRCOFINSCOMPRA POSITION 39;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRFUNRURALCOMPRA POSITION 40;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRFRETECOMPRA POSITION 41;

ALTER TABLE CPCOMPRA ALTER COLUMN VLROUTRASCOMPRA POSITION 42;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRISENTASCOMPRA POSITION 43;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPTC POSITION 44;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALTC POSITION 45;

ALTER TABLE CPCOMPRA ALTER COLUMN CODTIPOCOB POSITION 46;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPBO POSITION 47;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALBO POSITION 48;

ALTER TABLE CPCOMPRA ALTER COLUMN CODBANCO POSITION 49;

ALTER TABLE CPCOMPRA ALTER COLUMN IMPNOTACOMPRA POSITION 50;

ALTER TABLE CPCOMPRA ALTER COLUMN BLOQCOMPRA POSITION 51;

ALTER TABLE CPCOMPRA ALTER COLUMN EMMANUT POSITION 52;

ALTER TABLE CPCOMPRA ALTER COLUMN FLAG POSITION 53;

ALTER TABLE CPCOMPRA ALTER COLUMN ADICFRETECOMPRA POSITION 54;

ALTER TABLE CPCOMPRA ALTER COLUMN TIPOFRETECOMPRA POSITION 55;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPSOL POSITION 56;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALSOL POSITION 57;

ALTER TABLE CPCOMPRA ALTER COLUMN CODSOL POSITION 58;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPTN POSITION 59;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALTN POSITION 60;

ALTER TABLE CPCOMPRA ALTER COLUMN CODTRAN POSITION 61;

ALTER TABLE CPCOMPRA ALTER COLUMN OBSERVACAO POSITION 62;

ALTER TABLE CPCOMPRA ALTER COLUMN OBS01 POSITION 63;

ALTER TABLE CPCOMPRA ALTER COLUMN OBS02 POSITION 64;

ALTER TABLE CPCOMPRA ALTER COLUMN OBS03 POSITION 65;

ALTER TABLE CPCOMPRA ALTER COLUMN OBS04 POSITION 66;

ALTER TABLE CPCOMPRA ALTER COLUMN ADICADICCOMPRA POSITION 67;

ALTER TABLE CPCOMPRA ALTER COLUMN QTDFRETECOMPRA POSITION 68;

ALTER TABLE CPCOMPRA ALTER COLUMN ADICFRETEBASEICMS POSITION 69;

ALTER TABLE CPCOMPRA ALTER COLUMN ADICADICBASEICMS POSITION 70;

ALTER TABLE CPCOMPRA ALTER COLUMN ADICIPIBASEICMS POSITION 71;

ALTER TABLE CPCOMPRA ALTER COLUMN CHAVENFECOMPRA POSITION 72;

ALTER TABLE CPCOMPRA ALTER COLUMN STATUSCOMPRA POSITION 73;

ALTER TABLE CPCOMPRA ALTER COLUMN NRODI POSITION 74;

ALTER TABLE CPCOMPRA ALTER COLUMN DTREGDI POSITION 75;

ALTER TABLE CPCOMPRA ALTER COLUMN LOCDESEMBDI POSITION 76;

ALTER TABLE CPCOMPRA ALTER COLUMN SIGLAUFDESEMBDI POSITION 77;

ALTER TABLE CPCOMPRA ALTER COLUMN CODPAISDESEMBDI POSITION 78;

ALTER TABLE CPCOMPRA ALTER COLUMN DTDESEMBDI POSITION 79;

ALTER TABLE CPCOMPRA ALTER COLUMN IDENTCONTAINER POSITION 80;

ALTER TABLE CPCOMPRA ALTER COLUMN CALCTRIB POSITION 81;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPRM POSITION 82;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALRM POSITION 83;

ALTER TABLE CPCOMPRA ALTER COLUMN TICKET POSITION 84;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPCT POSITION 85;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALCT POSITION 86;

ALTER TABLE CPCOMPRA ALTER COLUMN NUMCONTA POSITION 87;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPCC POSITION 88;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALCC POSITION 89;

ALTER TABLE CPCOMPRA ALTER COLUMN ANOCC POSITION 90;

ALTER TABLE CPCOMPRA ALTER COLUMN CODCC POSITION 91;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPPN POSITION 92;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALPN POSITION 93;

ALTER TABLE CPCOMPRA ALTER COLUMN ANOPLAN POSITION 94;

ALTER TABLE CPCOMPRA ALTER COLUMN CODPLAN POSITION 95;

ALTER TABLE CPCOMPRA ALTER COLUMN INFCOMPL POSITION 96;

ALTER TABLE CPCOMPRA ALTER COLUMN NUMACDRAW POSITION 97;

ALTER TABLE CPCOMPRA ALTER COLUMN TIPODOCIMP POSITION 98;

ALTER TABLE CPCOMPRA ALTER COLUMN SITDOC POSITION 99;

ALTER TABLE CPCOMPRA ALTER COLUMN OBSNFE POSITION 100;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPOP POSITION 101;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALOP POSITION 102;

ALTER TABLE CPCOMPRA ALTER COLUMN CODOP POSITION 103;

ALTER TABLE CPCOMPRA ALTER COLUMN SEQOP POSITION 104;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPIM POSITION 105;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALIM POSITION 106;

ALTER TABLE CPCOMPRA ALTER COLUMN CODIMP POSITION 107;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEIICOMPRA POSITION 108;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRIICOMPRA POSITION 109;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSDIFERIDO POSITION 110;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSCREDOR POSITION 111;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSCREDPRESUM POSITION 112;

ALTER TABLE CPCOMPRA ALTER COLUMN OBSPAG POSITION 113;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPOC POSITION 114;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALOC POSITION 115;

ALTER TABLE CPCOMPRA ALTER COLUMN CODORDCP POSITION 116;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRISSCOMPRA POSITION 117;

ALTER TABLE CPCOMPRA ALTER COLUMN NROORDEMCOMPRA POSITION 118;

ALTER TABLE CPCOMPRA ALTER COLUMN VLROUTRASDESP POSITION 119;

ALTER TABLE CPCOMPRA ALTER COLUMN CNF POSITION 120;

ALTER TABLE CPCOMPRA ALTER COLUMN CHAVENFEVALIDA POSITION 121;

ALTER TABLE CPCOMPRA ALTER COLUMN MOTIVOCANCCOMPRA POSITION 122;

ALTER TABLE CPCOMPRA ALTER COLUMN RECEBTOCONFIRMADO POSITION 123;

ALTER TABLE CPCOMPRA ALTER COLUMN DOWNLOADXML POSITION 124;

ALTER TABLE CPCOMPRA ALTER COLUMN CRT POSITION 125;

ALTER TABLE CPCOMPRA ALTER COLUMN TPVIATRANSP POSITION 126;

ALTER TABLE CPCOMPRA ALTER COLUMN TPINTERMEDIO POSITION 127;

ALTER TABLE CPCOMPRA ALTER COLUMN DTINS POSITION 128;

ALTER TABLE CPCOMPRA ALTER COLUMN HINS POSITION 129;

ALTER TABLE CPCOMPRA ALTER COLUMN IDUSUINS POSITION 130;

ALTER TABLE CPCOMPRA ALTER COLUMN DTALT POSITION 131;

ALTER TABLE CPCOMPRA ALTER COLUMN HALT POSITION 132;

ALTER TABLE CPCOMPRA ALTER COLUMN IDUSUALT POSITION 133;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODCOMPRA POSITION 3;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODITCOMPRA POSITION 4;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODEMPPD POSITION 5;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODFILIALPD POSITION 6;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODPROD POSITION 7;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODEMPLE POSITION 8;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODFILIALLE POSITION 9;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODLOTE POSITION 10;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODEMPNT POSITION 11;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODFILIALNT POSITION 12;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODNAT POSITION 13;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODEMPAX POSITION 14;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODFILIALAX POSITION 15;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODALMOX POSITION 16;

ALTER TABLE CPITCOMPRA ALTER COLUMN QTDITCOMPRA POSITION 17;

ALTER TABLE CPITCOMPRA ALTER COLUMN QTDITCOMPRACANC POSITION 18;

ALTER TABLE CPITCOMPRA ALTER COLUMN PRECOITCOMPRA POSITION 19;

ALTER TABLE CPITCOMPRA ALTER COLUMN PERCDESCITCOMPRA POSITION 20;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRDESCITCOMPRA POSITION 21;

ALTER TABLE CPITCOMPRA ALTER COLUMN PERCICMSITCOMPRA POSITION 22;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRBASEICMSITCOMPRA POSITION 23;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRICMSITCOMPRA POSITION 24;

ALTER TABLE CPITCOMPRA ALTER COLUMN PERCICMSSTITCOMPRA POSITION 25;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRBASEICMSSTITCOMPRA POSITION 26;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRICMSSTITCOMPRA POSITION 27;

ALTER TABLE CPITCOMPRA ALTER COLUMN PERCIPIITCOMPRA POSITION 28;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRBASEIPIITCOMPRA POSITION 29;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRIPIITCOMPRA POSITION 30;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRBASEFUNRURALITCOMPRA POSITION 31;

ALTER TABLE CPITCOMPRA ALTER COLUMN ALIQFUNRURALITCOMPRA POSITION 32;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRFUNRURALITCOMPRA POSITION 33;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRLIQITCOMPRA POSITION 34;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRADICITCOMPRA POSITION 35;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRFRETEITCOMPRA POSITION 36;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRISENTASITCOMPRA POSITION 37;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLROUTRASITCOMPRA POSITION 38;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRPRODITCOMPRA POSITION 39;

ALTER TABLE CPITCOMPRA ALTER COLUMN CUSTOITCOMPRA POSITION 40;

ALTER TABLE CPITCOMPRA ALTER COLUMN CUSTOVDITCOMPRA POSITION 41;

ALTER TABLE CPITCOMPRA ALTER COLUMN REFPROD POSITION 42;

ALTER TABLE CPITCOMPRA ALTER COLUMN OBSITCOMPRA POSITION 43;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODEMPIF POSITION 44;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODFILIALIF POSITION 45;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODFISC POSITION 46;

ALTER TABLE CPITCOMPRA ALTER COLUMN EMMANUT POSITION 47;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODITFISC POSITION 48;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODEMPNS POSITION 49;

ALTER TABLE CPITCOMPRA ALTER COLUMN CODFILIALNS POSITION 50;

ALTER TABLE CPITCOMPRA ALTER COLUMN NUMSERIETMP POSITION 51;

ALTER TABLE CPITCOMPRA ALTER COLUMN NADICAO POSITION 52;

ALTER TABLE CPITCOMPRA ALTER COLUMN SEQADIC POSITION 53;

ALTER TABLE CPITCOMPRA ALTER COLUMN DESCDI POSITION 54;

ALTER TABLE CPITCOMPRA ALTER COLUMN APROVPRECO POSITION 55;

ALTER TABLE CPITCOMPRA ALTER COLUMN EMITITCOMPRA POSITION 56;

ALTER TABLE CPITCOMPRA ALTER COLUMN ALIQISSITCOMPRA POSITION 57;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRISSITCOMPRA POSITION 58;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRIIITCOMPRA POSITION 59;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRITOUTRASDESPITCOMPRA POSITION 60;

ALTER TABLE CPITCOMPRA ALTER COLUMN CALCCUSTO POSITION 61;

ALTER TABLE CPITCOMPRA ALTER COLUMN ADICICMSTOTNOTA POSITION 62;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRTXSISCOMEXITCOMPRA POSITION 63;

ALTER TABLE CPITCOMPRA ALTER COLUMN TIPONFITCOMPRA POSITION 64;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRICMSDIFERIDO POSITION 65;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRICMSCREDOR POSITION 66;

ALTER TABLE CPITCOMPRA ALTER COLUMN PBCOP POSITION 67;

ALTER TABLE CPITCOMPRA ALTER COLUMN ICMSPART POSITION 68;

ALTER TABLE CPITCOMPRA ALTER COLUMN PFCP POSITION 69;

ALTER TABLE CPITCOMPRA ALTER COLUMN VBCUFDEST POSITION 70;

ALTER TABLE CPITCOMPRA ALTER COLUMN VFCPUFDEST POSITION 71;

ALTER TABLE CPITCOMPRA ALTER COLUMN VICMSUFDEST POSITION 72;

ALTER TABLE CPITCOMPRA ALTER COLUMN VICMSUFREMET POSITION 73;

ALTER TABLE CPITCOMPRA ALTER COLUMN PICMSINTER POSITION 74;

ALTER TABLE CPITCOMPRA ALTER COLUMN PICMSUFDEST POSITION 75;

ALTER TABLE CPITCOMPRA ALTER COLUMN MARGEMVLAGRITCOMPRA POSITION 76;

ALTER TABLE CPITCOMPRA ALTER COLUMN DTINS POSITION 77;

ALTER TABLE CPITCOMPRA ALTER COLUMN HINS POSITION 78;

ALTER TABLE CPITCOMPRA ALTER COLUMN IDUSUINS POSITION 79;

ALTER TABLE CPITCOMPRA ALTER COLUMN DTALT POSITION 80;

ALTER TABLE CPITCOMPRA ALTER COLUMN HALT POSITION 81;

ALTER TABLE CPITCOMPRA ALTER COLUMN IDUSUALT POSITION 82;

ALTER TABLE CPITCOMPRA ALTER COLUMN VLRDIFICMSINTER POSITION 83;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODSOL POSITION 3;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODITSOL POSITION 4;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODEMPPD POSITION 5;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODFILIALPD POSITION 6;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODPROD POSITION 7;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN REFPROD POSITION 8;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN QTDITSOL POSITION 9;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN QTDAPROVITSOL POSITION 10;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN IDUSUITSOL POSITION 11;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN DTITSOL POSITION 12;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN IDUSUAPROVITSOL POSITION 13;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN DTAPROVITSOL POSITION 14;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN SITAPROVITSOL POSITION 15;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN SITCOMPITSOL POSITION 16;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN SITITSOL POSITION 17;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODEMPAM POSITION 18;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODFILIALAM POSITION 19;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODALMOX POSITION 20;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODEMPCT POSITION 21;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODFILIALCT POSITION 22;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODCONTR POSITION 23;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODITCONTR POSITION 24;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN MOTIVOITSOL POSITION 25;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN MOTIVOAPROVITSOL POSITION 26;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN MOTIVOCOMPITSOL POSITION 27;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN IDUSUCANCITSOL POSITION 28;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN PRIORITSOL POSITION 29;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN MOTIVOPRIORITSOL POSITION 30;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN MOTIVOCANCITSOL POSITION 31;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN MOTIVOCOTABAIX POSITION 32;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODEMPUA POSITION 33;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN CODFILIALUA POSITION 34;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN EMMANUT POSITION 35;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN DTINS POSITION 36;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN HINS POSITION 37;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN IDUSUINS POSITION 38;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN DTALT POSITION 39;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN HALT POSITION 40;

ALTER TABLE CPITSOLICITACAO ALTER COLUMN IDUSUALT POSITION 41;

ALTER TABLE CPRATEIO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE CPRATEIO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE CPRATEIO ALTER COLUMN CODCOMPRA POSITION 3;

ALTER TABLE CPRATEIO ALTER COLUMN SEQRATEIO POSITION 4;

ALTER TABLE CPRATEIO ALTER COLUMN CODEMPFN POSITION 5;

ALTER TABLE CPRATEIO ALTER COLUMN CODFILIALFN POSITION 6;

ALTER TABLE CPRATEIO ALTER COLUMN ANOPLAN POSITION 7;

ALTER TABLE CPRATEIO ALTER COLUMN CODPLAN POSITION 8;

ALTER TABLE CPRATEIO ALTER COLUMN CODEMPCC POSITION 9;

ALTER TABLE CPRATEIO ALTER COLUMN CODFILIALCC POSITION 10;

ALTER TABLE CPRATEIO ALTER COLUMN ANOCC POSITION 11;

ALTER TABLE CPRATEIO ALTER COLUMN CODCC POSITION 12;

ALTER TABLE CPRATEIO ALTER COLUMN PERCRATEIO POSITION 13;

ALTER TABLE CPRATEIO ALTER COLUMN VLRRATEIO POSITION 14;

ALTER TABLE CPRATEIO ALTER COLUMN SITRATEIO POSITION 15;

ALTER TABLE CPRATEIO ALTER COLUMN DTINS POSITION 16;

ALTER TABLE CPRATEIO ALTER COLUMN HINS POSITION 17;

ALTER TABLE CPRATEIO ALTER COLUMN IDUSUINS POSITION 18;

ALTER TABLE CPRATEIO ALTER COLUMN DTALT POSITION 19;

ALTER TABLE CPRATEIO ALTER COLUMN HALT POSITION 20;

ALTER TABLE CPRATEIO ALTER COLUMN IDUSUALT POSITION 21;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODSOL POSITION 3;

ALTER TABLE CPSOLICITACAO ALTER COLUMN DTEMITSOL POSITION 4;

ALTER TABLE CPSOLICITACAO ALTER COLUMN SITSOL POSITION 5;

ALTER TABLE CPSOLICITACAO ALTER COLUMN ORIGSOL POSITION 6;

ALTER TABLE CPSOLICITACAO ALTER COLUMN MOTIVOSOL POSITION 7;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODEMPUU POSITION 8;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODFILIALUU POSITION 9;

ALTER TABLE CPSOLICITACAO ALTER COLUMN IDUSU POSITION 10;

ALTER TABLE CPSOLICITACAO ALTER COLUMN DTAAPROVSOL POSITION 11;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODEMPUA POSITION 12;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODFILIALUA POSITION 13;

ALTER TABLE CPSOLICITACAO ALTER COLUMN IDUSUAPROV POSITION 14;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODEMPCC POSITION 15;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODFILIALCC POSITION 16;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODCC POSITION 17;

ALTER TABLE CPSOLICITACAO ALTER COLUMN ANOCC POSITION 18;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODEMPCT POSITION 19;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODFILIALCT POSITION 20;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODCONTR POSITION 21;

ALTER TABLE CPSOLICITACAO ALTER COLUMN CODITCONTR POSITION 22;

ALTER TABLE CPSOLICITACAO ALTER COLUMN IDUSUCANCSOL POSITION 23;

ALTER TABLE CPSOLICITACAO ALTER COLUMN MOTIVOCANCSOL POSITION 24;

ALTER TABLE CPSOLICITACAO ALTER COLUMN DTINS POSITION 25;

ALTER TABLE CPSOLICITACAO ALTER COLUMN HINS POSITION 26;

ALTER TABLE CPSOLICITACAO ALTER COLUMN IDUSUINS POSITION 27;

ALTER TABLE CPSOLICITACAO ALTER COLUMN DTALT POSITION 28;

ALTER TABLE CPSOLICITACAO ALTER COLUMN HALT POSITION 29;

ALTER TABLE CPSOLICITACAO ALTER COLUMN IDUSUALT POSITION 30;

ALTER TABLE EQETIQPROD ALTER COLUMN NRCONEXAO POSITION 1;

ALTER TABLE EQETIQPROD ALTER COLUMN CODEMP POSITION 2;

ALTER TABLE EQETIQPROD ALTER COLUMN CODFILIAL POSITION 3;

ALTER TABLE EQETIQPROD ALTER COLUMN CODPROD POSITION 4;

ALTER TABLE EQETIQPROD ALTER COLUMN TIPO POSITION 5;

ALTER TABLE EQETIQPROD ALTER COLUMN CODPED POSITION 6;

ALTER TABLE EQETIQPROD ALTER COLUMN SEQITEM POSITION 7;

ALTER TABLE EQETIQPROD ALTER COLUMN QTDADE POSITION 8;

ALTER TABLE EQETIQPROD ALTER COLUMN IMPOK POSITION 9;

ALTER TABLE EQETIQPROD ALTER COLUMN CODEMPLE POSITION 10;

ALTER TABLE EQETIQPROD ALTER COLUMN CODFILIALLE POSITION 11;

ALTER TABLE EQETIQPROD ALTER COLUMN CODLOTE POSITION 12;

ALTER TABLE EQETIQPROD ALTER COLUMN CODEMPME POSITION 13;

ALTER TABLE EQETIQPROD ALTER COLUMN CODFILIALME POSITION 14;

ALTER TABLE EQETIQPROD ALTER COLUMN CODMODETIQ POSITION 15;

ALTER TABLE EQETIQPROD ALTER COLUMN DTINS POSITION 16;

ALTER TABLE EQETIQPROD ALTER COLUMN HINS POSITION 17;

ALTER TABLE EQETIQPROD ALTER COLUMN IDUSUINS POSITION 18;

ALTER TABLE EQETIQPROD ALTER COLUMN DTALT POSITION 19;

ALTER TABLE EQETIQPROD ALTER COLUMN HALT POSITION 20;

ALTER TABLE EQETIQPROD ALTER COLUMN IDUSUALT POSITION 21;

ALTER TABLE EQITRECMERC ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE EQITRECMERC ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE EQITRECMERC ALTER COLUMN TICKET POSITION 3;

ALTER TABLE EQITRECMERC ALTER COLUMN CODITRECMERC POSITION 4;

ALTER TABLE EQITRECMERC ALTER COLUMN DESCITRECMERC POSITION 5;

ALTER TABLE EQITRECMERC ALTER COLUMN CODEMPPD POSITION 6;

ALTER TABLE EQITRECMERC ALTER COLUMN CODFILIALPD POSITION 7;

ALTER TABLE EQITRECMERC ALTER COLUMN CODPROD POSITION 8;

ALTER TABLE EQITRECMERC ALTER COLUMN CODEMPNS POSITION 9;

ALTER TABLE EQITRECMERC ALTER COLUMN CODFILIALNS POSITION 10;

ALTER TABLE EQITRECMERC ALTER COLUMN NUMSERIE POSITION 11;

ALTER TABLE EQITRECMERC ALTER COLUMN GARANTIA POSITION 12;

ALTER TABLE EQITRECMERC ALTER COLUMN REFPROD POSITION 13;

ALTER TABLE EQITRECMERC ALTER COLUMN CODEMPTP POSITION 14;

ALTER TABLE EQITRECMERC ALTER COLUMN CODFILIALTP POSITION 15;

ALTER TABLE EQITRECMERC ALTER COLUMN CODTIPORECMERC POSITION 16;

ALTER TABLE EQITRECMERC ALTER COLUMN CODPROCRECMERC POSITION 17;

ALTER TABLE EQITRECMERC ALTER COLUMN MEDIAAMOSTRAGEM POSITION 18;

ALTER TABLE EQITRECMERC ALTER COLUMN RENDAAMOSTRAGEM POSITION 19;

ALTER TABLE EQITRECMERC ALTER COLUMN QTDITRECMERC POSITION 20;

ALTER TABLE EQITRECMERC ALTER COLUMN STATUSITRECMERC POSITION 21;

ALTER TABLE EQITRECMERC ALTER COLUMN DEFEITOITRECMERC POSITION 22;

ALTER TABLE EQITRECMERC ALTER COLUMN CONDICOESITRECMERC POSITION 23;

ALTER TABLE EQITRECMERC ALTER COLUMN SERVICOSOLICITRECMERC POSITION 24;

ALTER TABLE EQITRECMERC ALTER COLUMN OBSITRECMERC POSITION 25;

ALTER TABLE EQITRECMERC ALTER COLUMN PLACAVEICULO POSITION 26;

ALTER TABLE EQITRECMERC ALTER COLUMN NROFROTA POSITION 27;

ALTER TABLE EQITRECMERC ALTER COLUMN GARAGEM POSITION 28;

ALTER TABLE EQITRECMERC ALTER COLUMN OBRIGALAUDO POSITION 29;

ALTER TABLE EQITRECMERC ALTER COLUMN ALERTAEMITIDO POSITION 30;

ALTER TABLE EQITRECMERC ALTER COLUMN LAUDOIMPRESSO POSITION 31;

ALTER TABLE EQITRECMERC ALTER COLUMN EMMANUT POSITION 32;

ALTER TABLE EQITRECMERC ALTER COLUMN DTINS POSITION 33;

ALTER TABLE EQITRECMERC ALTER COLUMN HINS POSITION 34;

ALTER TABLE EQITRECMERC ALTER COLUMN IDUSUINS POSITION 35;

ALTER TABLE EQITRECMERC ALTER COLUMN DTALT POSITION 36;

ALTER TABLE EQITRECMERC ALTER COLUMN HALT POSITION 37;

ALTER TABLE EQITRECMERC ALTER COLUMN IDUSUALT POSITION 38;

ALTER TABLE EQLOTE ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE EQLOTE ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE EQLOTE ALTER COLUMN CODPROD POSITION 3;

ALTER TABLE EQLOTE ALTER COLUMN CODLOTE POSITION 4;

ALTER TABLE EQLOTE ALTER COLUMN VENCTOLOTE POSITION 5;

ALTER TABLE EQLOTE ALTER COLUMN HVENCTOLOTE POSITION 6;

ALTER TABLE EQLOTE ALTER COLUMN SLDLOTE POSITION 7;

ALTER TABLE EQLOTE ALTER COLUMN SLDRESLOTE POSITION 8;

ALTER TABLE EQLOTE ALTER COLUMN SLDCONSIGLOTE POSITION 9;

ALTER TABLE EQLOTE ALTER COLUMN SLDLIQLOTE POSITION 10;

ALTER TABLE EQLOTE ALTER COLUMN QTDPRODLOTE POSITION 11;

ALTER TABLE EQLOTE ALTER COLUMN DINILOTE POSITION 12;

ALTER TABLE EQLOTE ALTER COLUMN HINILOTE POSITION 13;

ALTER TABLE EQLOTE ALTER COLUMN DIASAVISOLOTE POSITION 14;

ALTER TABLE EQLOTE ALTER COLUMN EMMANUT POSITION 15;

ALTER TABLE EQLOTE ALTER COLUMN DTINS POSITION 16;

ALTER TABLE EQLOTE ALTER COLUMN HINS POSITION 17;

ALTER TABLE EQLOTE ALTER COLUMN IDUSUINS POSITION 18;

ALTER TABLE EQLOTE ALTER COLUMN DTALT POSITION 19;

ALTER TABLE EQLOTE ALTER COLUMN HALT POSITION 20;

ALTER TABLE EQLOTE ALTER COLUMN IDUSUALT POSITION 21;

ALTER TABLE EQPRODPLAN ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE EQPRODPLAN ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE EQPRODPLAN ALTER COLUMN CODPROD POSITION 3;

ALTER TABLE EQPRODPLAN ALTER COLUMN SEQPP POSITION 4;

ALTER TABLE EQPRODPLAN ALTER COLUMN TIPOPP POSITION 5;

ALTER TABLE EQPRODPLAN ALTER COLUMN CODEMPPN POSITION 6;

ALTER TABLE EQPRODPLAN ALTER COLUMN CODFILIALPN POSITION 7;

ALTER TABLE EQPRODPLAN ALTER COLUMN ANOPLAN POSITION 8;

ALTER TABLE EQPRODPLAN ALTER COLUMN CODPLAN POSITION 9;

ALTER TABLE EQPRODPLAN ALTER COLUMN CODEMPCC POSITION 10;

ALTER TABLE EQPRODPLAN ALTER COLUMN CODFILIALCC POSITION 11;

ALTER TABLE EQPRODPLAN ALTER COLUMN ANOCC POSITION 12;

ALTER TABLE EQPRODPLAN ALTER COLUMN CODCC POSITION 13;

ALTER TABLE EQPRODPLAN ALTER COLUMN PERCPP POSITION 14;

ALTER TABLE EQPRODPLAN ALTER COLUMN DTINS POSITION 15;

ALTER TABLE EQPRODPLAN ALTER COLUMN HINS POSITION 16;

ALTER TABLE EQPRODPLAN ALTER COLUMN IDUSUINS POSITION 17;

ALTER TABLE EQPRODPLAN ALTER COLUMN DTALT POSITION 18;

ALTER TABLE EQPRODPLAN ALTER COLUMN HALT POSITION 19;

ALTER TABLE EQPRODPLAN ALTER COLUMN IDUSUALT POSITION 20;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE EQPRODUTO ALTER COLUMN CODPROD POSITION 3;

ALTER TABLE EQPRODUTO ALTER COLUMN DESCPROD POSITION 4;

ALTER TABLE EQPRODUTO ALTER COLUMN REFPROD POSITION 5;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPAX POSITION 6;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALAX POSITION 7;

ALTER TABLE EQPRODUTO ALTER COLUMN CODALMOX POSITION 8;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPMA POSITION 9;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALMA POSITION 10;

ALTER TABLE EQPRODUTO ALTER COLUMN CODMOEDA POSITION 11;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPUD POSITION 12;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALUD POSITION 13;

ALTER TABLE EQPRODUTO ALTER COLUMN CODUNID POSITION 14;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPFC POSITION 15;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALFC POSITION 16;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFISC POSITION 17;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPMC POSITION 18;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALMC POSITION 19;

ALTER TABLE EQPRODUTO ALTER COLUMN CODMARCA POSITION 20;

ALTER TABLE EQPRODUTO ALTER COLUMN DESCAUXPROD POSITION 21;

ALTER TABLE EQPRODUTO ALTER COLUMN TIPOPROD POSITION 22;

ALTER TABLE EQPRODUTO ALTER COLUMN CVPROD POSITION 23;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPGP POSITION 24;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALGP POSITION 25;

ALTER TABLE EQPRODUTO ALTER COLUMN CODGRUP POSITION 26;

ALTER TABLE EQPRODUTO ALTER COLUMN CODBARPROD POSITION 27;

ALTER TABLE EQPRODUTO ALTER COLUMN CLOTEPROD POSITION 28;

ALTER TABLE EQPRODUTO ALTER COLUMN SERIEPROD POSITION 29;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPTL POSITION 30;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALTL POSITION 31;

ALTER TABLE EQPRODUTO ALTER COLUMN CODTPCTRL POSITION 32;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFABPROD POSITION 33;

ALTER TABLE EQPRODUTO ALTER COLUMN COMISPROD POSITION 34;

ALTER TABLE EQPRODUTO ALTER COLUMN PESOLIQPROD POSITION 35;

ALTER TABLE EQPRODUTO ALTER COLUMN PESOBRUTPROD POSITION 36;

ALTER TABLE EQPRODUTO ALTER COLUMN QTDMINPROD POSITION 37;

ALTER TABLE EQPRODUTO ALTER COLUMN QTDMAXPROD POSITION 38;

ALTER TABLE EQPRODUTO ALTER COLUMN DTMPMPROD POSITION 39;

ALTER TABLE EQPRODUTO ALTER COLUMN CUSTOMPMPROD POSITION 40;

ALTER TABLE EQPRODUTO ALTER COLUMN CUSTOPEPSPROD POSITION 41;

ALTER TABLE EQPRODUTO ALTER COLUMN CUSTOINFOPROD POSITION 42;

ALTER TABLE EQPRODUTO ALTER COLUMN PRECOBASEPROD POSITION 43;

ALTER TABLE EQPRODUTO ALTER COLUMN PRECOCOMISPROD POSITION 44;

ALTER TABLE EQPRODUTO ALTER COLUMN SLDPROD POSITION 45;

ALTER TABLE EQPRODUTO ALTER COLUMN SLDRESPROD POSITION 46;

ALTER TABLE EQPRODUTO ALTER COLUMN SLDCONSIGPROD POSITION 47;

ALTER TABLE EQPRODUTO ALTER COLUMN SLDLIQPROD POSITION 48;

ALTER TABLE EQPRODUTO ALTER COLUMN ATIVOPROD POSITION 49;

ALTER TABLE EQPRODUTO ALTER COLUMN DTULTCPPROD POSITION 50;

ALTER TABLE EQPRODUTO ALTER COLUMN QTDULTCPPROD POSITION 51;

ALTER TABLE EQPRODUTO ALTER COLUMN DESCCOMPPROD POSITION 52;

ALTER TABLE EQPRODUTO ALTER COLUMN OBSPROD POSITION 53;

ALTER TABLE EQPRODUTO ALTER COLUMN VERIFPROD POSITION 54;

ALTER TABLE EQPRODUTO ALTER COLUMN LOCALPROD POSITION 55;

ALTER TABLE EQPRODUTO ALTER COLUMN RMAPROD POSITION 56;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPPE POSITION 57;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALPE POSITION 58;

ALTER TABLE EQPRODUTO ALTER COLUMN CODPE POSITION 59;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPCC POSITION 60;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALCC POSITION 61;

ALTER TABLE EQPRODUTO ALTER COLUMN ANOCC POSITION 62;

ALTER TABLE EQPRODUTO ALTER COLUMN CODCC POSITION 63;

ALTER TABLE EQPRODUTO ALTER COLUMN USARECEITAPROD POSITION 64;

ALTER TABLE EQPRODUTO ALTER COLUMN USATELAADICPDV POSITION 65;

ALTER TABLE EQPRODUTO ALTER COLUMN VLRDENSIDADE POSITION 66;

ALTER TABLE EQPRODUTO ALTER COLUMN VLRCONCENT POSITION 67;

ALTER TABLE EQPRODUTO ALTER COLUMN COMPRIMENTO POSITION 68;

ALTER TABLE EQPRODUTO ALTER COLUMN LARGURA POSITION 69;

ALTER TABLE EQPRODUTO ALTER COLUMN ESPESSURA POSITION 70;

ALTER TABLE EQPRODUTO ALTER COLUMN GUIATRAFPROD POSITION 71;

ALTER TABLE EQPRODUTO ALTER COLUMN QTDEMBALAGEM POSITION 72;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEANPROD POSITION 73;

ALTER TABLE EQPRODUTO ALTER COLUMN CUBAGEM POSITION 74;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPSC POSITION 75;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALSC POSITION 76;

ALTER TABLE EQPRODUTO ALTER COLUMN CODSECAO POSITION 77;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPTC POSITION 78;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALTC POSITION 79;

ALTER TABLE EQPRODUTO ALTER COLUMN CODTPCHAMADO POSITION 80;

ALTER TABLE EQPRODUTO ALTER COLUMN QTDHORASSERV POSITION 81;

ALTER TABLE EQPRODUTO ALTER COLUMN NRODIASVALID POSITION 82;

ALTER TABLE EQPRODUTO ALTER COLUMN DESCCLI POSITION 83;

ALTER TABLE EQPRODUTO ALTER COLUMN QTDPORPLANO POSITION 84;

ALTER TABLE EQPRODUTO ALTER COLUMN NROPLANOS POSITION 85;

ALTER TABLE EQPRODUTO ALTER COLUMN CERTFSC POSITION 86;

ALTER TABLE EQPRODUTO ALTER COLUMN FATORFSC POSITION 87;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPOG POSITION 88;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALOG POSITION 89;

ALTER TABLE EQPRODUTO ALTER COLUMN CODPRODOG POSITION 90;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPMG POSITION 91;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALMG POSITION 92;

ALTER TABLE EQPRODUTO ALTER COLUMN CODMODG POSITION 93;

ALTER TABLE EQPRODUTO ALTER COLUMN PRAZOREPO POSITION 94;

ALTER TABLE EQPRODUTO ALTER COLUMN MEDIAVENDA POSITION 95;

ALTER TABLE EQPRODUTO ALTER COLUMN REGISTROANVISA POSITION 96;

ALTER TABLE EQPRODUTO ALTER COLUMN MATERIAPRIMAPROD POSITION 97;

ALTER TABLE EQPRODUTO ALTER COLUMN PMCPROD POSITION 98;

ALTER TABLE EQPRODUTO ALTER COLUMN FATSEMPRODUCAO POSITION 99;

ALTER TABLE EQPRODUTO ALTER COLUMN EMMANUT POSITION 100;

ALTER TABLE EQPRODUTO ALTER COLUMN DTINS POSITION 101;

ALTER TABLE EQPRODUTO ALTER COLUMN HINS POSITION 102;

ALTER TABLE EQPRODUTO ALTER COLUMN IDUSUINS POSITION 103;

ALTER TABLE EQPRODUTO ALTER COLUMN DTALT POSITION 104;

ALTER TABLE EQPRODUTO ALTER COLUMN HALT POSITION 105;

ALTER TABLE EQPRODUTO ALTER COLUMN IDUSUALT POSITION 106;

ALTER TABLE EQRMA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE EQRMA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE EQRMA ALTER COLUMN CODRMA POSITION 3;

ALTER TABLE EQRMA ALTER COLUMN IDUSU POSITION 4;

ALTER TABLE EQRMA ALTER COLUMN CODEMPTM POSITION 5;

ALTER TABLE EQRMA ALTER COLUMN CODFILIALTM POSITION 6;

ALTER TABLE EQRMA ALTER COLUMN CODTIPOMOV POSITION 7;

ALTER TABLE EQRMA ALTER COLUMN MOTIVORMA POSITION 8;

ALTER TABLE EQRMA ALTER COLUMN MOTIVOCANCRMA POSITION 9;

ALTER TABLE EQRMA ALTER COLUMN SITRMA POSITION 10;

ALTER TABLE EQRMA ALTER COLUMN CODEMPCC POSITION 11;

ALTER TABLE EQRMA ALTER COLUMN CODFILIALCC POSITION 12;

ALTER TABLE EQRMA ALTER COLUMN ANOCC POSITION 13;

ALTER TABLE EQRMA ALTER COLUMN CODCC POSITION 14;

ALTER TABLE EQRMA ALTER COLUMN CODEMPUU POSITION 15;

ALTER TABLE EQRMA ALTER COLUMN CODFILIALUU POSITION 16;

ALTER TABLE EQRMA ALTER COLUMN DTAREQRMA POSITION 17;

ALTER TABLE EQRMA ALTER COLUMN DTAEXPRMA POSITION 18;

ALTER TABLE EQRMA ALTER COLUMN SITAPROVRMA POSITION 19;

ALTER TABLE EQRMA ALTER COLUMN SITEXPRMA POSITION 20;

ALTER TABLE EQRMA ALTER COLUMN IDUSUAPROV POSITION 21;

ALTER TABLE EQRMA ALTER COLUMN CODEMPUA POSITION 22;

ALTER TABLE EQRMA ALTER COLUMN CODFILIALUA POSITION 23;

ALTER TABLE EQRMA ALTER COLUMN IDUSUEXP POSITION 24;

ALTER TABLE EQRMA ALTER COLUMN CODEMPUE POSITION 25;

ALTER TABLE EQRMA ALTER COLUMN CODFILIALUE POSITION 26;

ALTER TABLE EQRMA ALTER COLUMN DTAAPROVRMA POSITION 27;

ALTER TABLE EQRMA ALTER COLUMN CODEMPOF POSITION 28;

ALTER TABLE EQRMA ALTER COLUMN CODFILIALOF POSITION 29;

ALTER TABLE EQRMA ALTER COLUMN CODOP POSITION 30;

ALTER TABLE EQRMA ALTER COLUMN SEQOP POSITION 31;

ALTER TABLE EQRMA ALTER COLUMN SEQOF POSITION 32;

ALTER TABLE EQRMA ALTER COLUMN CODEMPCT POSITION 33;

ALTER TABLE EQRMA ALTER COLUMN CODFILIALCT POSITION 34;

ALTER TABLE EQRMA ALTER COLUMN CODCONTR POSITION 35;

ALTER TABLE EQRMA ALTER COLUMN CODITCONTR POSITION 36;

ALTER TABLE EQRMA ALTER COLUMN CODEMPOS POSITION 37;

ALTER TABLE EQRMA ALTER COLUMN CODFILIALOS POSITION 38;

ALTER TABLE EQRMA ALTER COLUMN TICKET POSITION 39;

ALTER TABLE EQRMA ALTER COLUMN CODITRECMERC POSITION 40;

ALTER TABLE EQRMA ALTER COLUMN CODEMPCL POSITION 41;

ALTER TABLE EQRMA ALTER COLUMN CODFILIALCL POSITION 42;

ALTER TABLE EQRMA ALTER COLUMN CODCLI POSITION 43;

ALTER TABLE EQRMA ALTER COLUMN DTINS POSITION 44;

ALTER TABLE EQRMA ALTER COLUMN HINS POSITION 45;

ALTER TABLE EQRMA ALTER COLUMN IDUSUINS POSITION 46;

ALTER TABLE EQRMA ALTER COLUMN DTALT POSITION 47;

ALTER TABLE EQRMA ALTER COLUMN HALT POSITION 48;

ALTER TABLE EQRMA ALTER COLUMN IDUSUALT POSITION 49;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODTIPOMOV POSITION 3;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPMN POSITION 4;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALMN POSITION 5;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODMODNOTA POSITION 6;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPSE POSITION 7;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALSE POSITION 8;

ALTER TABLE EQTIPOMOV ALTER COLUMN SERIE POSITION 9;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPSC POSITION 10;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALSC POSITION 11;

ALTER TABLE EQTIPOMOV ALTER COLUMN SERIEC POSITION 12;

ALTER TABLE EQTIPOMOV ALTER COLUMN DESCTIPOMOV POSITION 13;

ALTER TABLE EQTIPOMOV ALTER COLUMN ESTIPOMOV POSITION 14;

ALTER TABLE EQTIPOMOV ALTER COLUMN FISCALTIPOMOV POSITION 15;

ALTER TABLE EQTIPOMOV ALTER COLUMN ESTOQTIPOMOV POSITION 16;

ALTER TABLE EQTIPOMOV ALTER COLUMN TIPOMOV POSITION 17;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPTB POSITION 18;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALTB POSITION 19;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODTAB POSITION 20;

ALTER TABLE EQTIPOMOV ALTER COLUMN ESPECIETIPOMOV POSITION 21;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPTM POSITION 22;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALTM POSITION 23;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODTIPOMOVTM POSITION 24;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPTC POSITION 25;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALTC POSITION 26;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODTIPOMOVTC POSITION 27;

ALTER TABLE EQTIPOMOV ALTER COLUMN IMPPEDTIPOMOV POSITION 28;

ALTER TABLE EQTIPOMOV ALTER COLUMN IMPNFTIPOMOV POSITION 29;

ALTER TABLE EQTIPOMOV ALTER COLUMN IMPBOLTIPOMOV POSITION 30;

ALTER TABLE EQTIPOMOV ALTER COLUMN IMPRECTIPOMOV POSITION 31;

ALTER TABLE EQTIPOMOV ALTER COLUMN REIMPNFTIPOMOV POSITION 32;

ALTER TABLE EQTIPOMOV ALTER COLUMN TUSUTIPOMOV POSITION 33;

ALTER TABLE EQTIPOMOV ALTER COLUMN SOMAVDTIPOMOV POSITION 34;

ALTER TABLE EQTIPOMOV ALTER COLUMN SEQNFTIPOMOV POSITION 35;

ALTER TABLE EQTIPOMOV ALTER COLUMN VLRMFINTIPOMOV POSITION 36;

ALTER TABLE EQTIPOMOV ALTER COLUMN MCOMISTIPOMOV POSITION 37;

ALTER TABLE EQTIPOMOV ALTER COLUMN OPERTIPOMOV POSITION 38;

ALTER TABLE EQTIPOMOV ALTER COLUMN CTIPOFRETE POSITION 39;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPRC POSITION 40;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALRC POSITION 41;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODREGRCOMIS POSITION 42;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPTN POSITION 43;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALTN POSITION 44;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODTRAN POSITION 45;

ALTER TABLE EQTIPOMOV ALTER COLUMN EMITNFCPMOV POSITION 46;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPDF POSITION 47;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALDF POSITION 48;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODMODDOCFISC POSITION 49;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPPP POSITION 50;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALPP POSITION 51;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODPLANOPAG POSITION 52;

ALTER TABLE EQTIPOMOV ALTER COLUMN DESCNATCOMPL POSITION 53;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPMC POSITION 54;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALMC POSITION 55;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODMENS POSITION 56;

ALTER TABLE EQTIPOMOV ALTER COLUMN CALCIMPCP POSITION 57;

ALTER TABLE EQTIPOMOV ALTER COLUMN DESBLOQCV POSITION 58;

ALTER TABLE EQTIPOMOV ALTER COLUMN PERMITDIGIPI POSITION 59;

ALTER TABLE EQTIPOMOV ALTER COLUMN INDPRES POSITION 60;

ALTER TABLE EQTIPOMOV ALTER COLUMN IMPDANFE POSITION 61;

ALTER TABLE EQTIPOMOV ALTER COLUMN DTINS POSITION 62;

ALTER TABLE EQTIPOMOV ALTER COLUMN HINS POSITION 63;

ALTER TABLE EQTIPOMOV ALTER COLUMN IDUSUINS POSITION 64;

ALTER TABLE EQTIPOMOV ALTER COLUMN DTALT POSITION 65;

ALTER TABLE EQTIPOMOV ALTER COLUMN HALT POSITION 66;

ALTER TABLE EQTIPOMOV ALTER COLUMN IDUSUALT POSITION 67;

ALTER TABLE FNBANCO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNBANCO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNBANCO ALTER COLUMN CODBANCO POSITION 3;

ALTER TABLE FNBANCO ALTER COLUMN NOMEBANCO POSITION 4;

ALTER TABLE FNBANCO ALTER COLUMN DVBANCO POSITION 5;

ALTER TABLE FNBANCO ALTER COLUMN SITEBANCO POSITION 6;

ALTER TABLE FNBANCO ALTER COLUMN CODEMPMB POSITION 7;

ALTER TABLE FNBANCO ALTER COLUMN CODFILIALMB POSITION 8;

ALTER TABLE FNBANCO ALTER COLUMN CODMODBOL POSITION 9;

ALTER TABLE FNBANCO ALTER COLUMN IMGBOLBANCO POSITION 10;

ALTER TABLE FNBANCO ALTER COLUMN IMGBOLBANCO2 POSITION 11;

ALTER TABLE FNBANCO ALTER COLUMN LAYOUTCHEQBANCO POSITION 12;

ALTER TABLE FNBANCO ALTER COLUMN CODEMPBP POSITION 13;

ALTER TABLE FNBANCO ALTER COLUMN CODFILIALBP POSITION 14;

ALTER TABLE FNBANCO ALTER COLUMN CODBANCOBP POSITION 15;

ALTER TABLE FNBANCO ALTER COLUMN DTINS POSITION 16;

ALTER TABLE FNBANCO ALTER COLUMN HINS POSITION 17;

ALTER TABLE FNBANCO ALTER COLUMN IDUSUINS POSITION 18;

ALTER TABLE FNBANCO ALTER COLUMN DTALT POSITION 19;

ALTER TABLE FNBANCO ALTER COLUMN HALT POSITION 20;

ALTER TABLE FNBANCO ALTER COLUMN IDUSUALT POSITION 21;

ALTER TABLE FNCC ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNCC ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNCC ALTER COLUMN ANOCC POSITION 3;

ALTER TABLE FNCC ALTER COLUMN CODCC POSITION 4;

ALTER TABLE FNCC ALTER COLUMN DESCCC POSITION 5;

ALTER TABLE FNCC ALTER COLUMN NIVELCC POSITION 6;

ALTER TABLE FNCC ALTER COLUMN CODREDCC POSITION 7;

ALTER TABLE FNCC ALTER COLUMN CODEMPSCC POSITION 8;

ALTER TABLE FNCC ALTER COLUMN CODFILIALSCC POSITION 9;

ALTER TABLE FNCC ALTER COLUMN ANOSCC POSITION 10;

ALTER TABLE FNCC ALTER COLUMN CODSUBCC POSITION 11;

ALTER TABLE FNCC ALTER COLUMN SIGLACC POSITION 12;

ALTER TABLE FNCC ALTER COLUMN ATIVOCC POSITION 13;

ALTER TABLE FNCC ALTER COLUMN DTINS POSITION 14;

ALTER TABLE FNCC ALTER COLUMN HINS POSITION 15;

ALTER TABLE FNCC ALTER COLUMN IDUSUINS POSITION 16;

ALTER TABLE FNCC ALTER COLUMN DTALT POSITION 17;

ALTER TABLE FNCC ALTER COLUMN HALT POSITION 18;

ALTER TABLE FNCC ALTER COLUMN IDUSUALT POSITION 19;

ALTER TABLE FNCONTA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNCONTA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNCONTA ALTER COLUMN NUMCONTA POSITION 3;

ALTER TABLE FNCONTA ALTER COLUMN DESCCONTA POSITION 4;

ALTER TABLE FNCONTA ALTER COLUMN CODEMPMA POSITION 5;

ALTER TABLE FNCONTA ALTER COLUMN CODFILIALMA POSITION 6;

ALTER TABLE FNCONTA ALTER COLUMN CODMOEDA POSITION 7;

ALTER TABLE FNCONTA ALTER COLUMN CODEMPBO POSITION 8;

ALTER TABLE FNCONTA ALTER COLUMN CODFILIALBO POSITION 9;

ALTER TABLE FNCONTA ALTER COLUMN CODBANCO POSITION 10;

ALTER TABLE FNCONTA ALTER COLUMN CODEMPPN POSITION 11;

ALTER TABLE FNCONTA ALTER COLUMN CODFILIALPN POSITION 12;

ALTER TABLE FNCONTA ALTER COLUMN ANOPLAN POSITION 13;

ALTER TABLE FNCONTA ALTER COLUMN CODPLAN POSITION 14;

ALTER TABLE FNCONTA ALTER COLUMN CODEMPPO POSITION 15;

ALTER TABLE FNCONTA ALTER COLUMN CODFILIALPO POSITION 16;

ALTER TABLE FNCONTA ALTER COLUMN ANOPLANPO POSITION 17;

ALTER TABLE FNCONTA ALTER COLUMN CODPLANPO POSITION 18;

ALTER TABLE FNCONTA ALTER COLUMN TIPOCONTA POSITION 19;

ALTER TABLE FNCONTA ALTER COLUMN DATACONTA POSITION 20;

ALTER TABLE FNCONTA ALTER COLUMN CODEMPHP POSITION 21;

ALTER TABLE FNCONTA ALTER COLUMN CODFILIALHP POSITION 22;

ALTER TABLE FNCONTA ALTER COLUMN CODHIST POSITION 23;

ALTER TABLE FNCONTA ALTER COLUMN CODCONTDEB POSITION 24;

ALTER TABLE FNCONTA ALTER COLUMN CODCONTCRED POSITION 25;

ALTER TABLE FNCONTA ALTER COLUMN AGENCIACONTA POSITION 26;

ALTER TABLE FNCONTA ALTER COLUMN CONVCOBCONTA POSITION 27;

ALTER TABLE FNCONTA ALTER COLUMN AGENCIACONTABOL POSITION 28;

ALTER TABLE FNCONTA ALTER COLUMN NUMCONTABOL POSITION 29;

ALTER TABLE FNCONTA ALTER COLUMN ATIVACONTA POSITION 30;

ALTER TABLE FNCONTA ALTER COLUMN TUSUCONTA POSITION 31;

ALTER TABLE FNCONTA ALTER COLUMN TIPOCAIXA POSITION 32;

ALTER TABLE FNCONTA ALTER COLUMN POSTOCONTA POSITION 33;

ALTER TABLE FNCONTA ALTER COLUMN DTINS POSITION 34;

ALTER TABLE FNCONTA ALTER COLUMN HINS POSITION 35;

ALTER TABLE FNCONTA ALTER COLUMN IDUSUINS POSITION 36;

ALTER TABLE FNCONTA ALTER COLUMN DTALT POSITION 37;

ALTER TABLE FNCONTA ALTER COLUMN HALT POSITION 38;

ALTER TABLE FNCONTA ALTER COLUMN IDUSUALT POSITION 39;

ALTER TABLE FNFBNCLI ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNFBNCLI ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNFBNCLI ALTER COLUMN CODCLI POSITION 3;

ALTER TABLE FNFBNCLI ALTER COLUMN CODEMPPF POSITION 4;

ALTER TABLE FNFBNCLI ALTER COLUMN CODFILIALPF POSITION 5;

ALTER TABLE FNFBNCLI ALTER COLUMN CODEMPBO POSITION 6;

ALTER TABLE FNFBNCLI ALTER COLUMN CODFILIALBO POSITION 7;

ALTER TABLE FNFBNCLI ALTER COLUMN CODBANCO POSITION 8;

ALTER TABLE FNFBNCLI ALTER COLUMN TIPOFEBRABAN POSITION 9;

ALTER TABLE FNFBNCLI ALTER COLUMN NUMCONTACLI POSITION 10;

ALTER TABLE FNFBNCLI ALTER COLUMN AGENCIACLI POSITION 11;

ALTER TABLE FNFBNCLI ALTER COLUMN IDENTCLI POSITION 12;

ALTER TABLE FNFBNCLI ALTER COLUMN STIPOFEBRABAN POSITION 13;

ALTER TABLE FNFBNCLI ALTER COLUMN TIPOREMCLI POSITION 14;

ALTER TABLE FNFBNCLI ALTER COLUMN CODEMPCA POSITION 15;

ALTER TABLE FNFBNCLI ALTER COLUMN CODFILIALCA POSITION 16;

ALTER TABLE FNFBNCLI ALTER COLUMN NUMCONTA POSITION 17;

ALTER TABLE FNFBNCLI ALTER COLUMN CODEMPPN POSITION 18;

ALTER TABLE FNFBNCLI ALTER COLUMN CODFILIALPN POSITION 19;

ALTER TABLE FNFBNCLI ALTER COLUMN ANOPLAN POSITION 20;

ALTER TABLE FNFBNCLI ALTER COLUMN CODPLAN POSITION 21;

ALTER TABLE FNFBNCLI ALTER COLUMN DTINS POSITION 22;

ALTER TABLE FNFBNCLI ALTER COLUMN HINS POSITION 23;

ALTER TABLE FNFBNCLI ALTER COLUMN IDUSUINS POSITION 24;

ALTER TABLE FNFBNCLI ALTER COLUMN DTALT POSITION 25;

ALTER TABLE FNFBNCLI ALTER COLUMN HALT POSITION 26;

ALTER TABLE FNFBNCLI ALTER COLUMN IDUSUALT POSITION 27;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNITPAGAR ALTER COLUMN CODPAG POSITION 3;

ALTER TABLE FNITPAGAR ALTER COLUMN NPARCPAG POSITION 4;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRITPAG POSITION 5;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRDESCITPAG POSITION 6;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRMULTAITPAG POSITION 7;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRJUROSITPAG POSITION 8;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRDEVITPAG POSITION 9;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRPARCITPAG POSITION 10;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRPAGOITPAG POSITION 11;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRAPAGITPAG POSITION 12;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRADICITPAG POSITION 13;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRCANCITPAG POSITION 14;

ALTER TABLE FNITPAGAR ALTER COLUMN DTITPAG POSITION 15;

ALTER TABLE FNITPAGAR ALTER COLUMN DTCOMPITPAG POSITION 16;

ALTER TABLE FNITPAGAR ALTER COLUMN DTVENCITPAG POSITION 17;

ALTER TABLE FNITPAGAR ALTER COLUMN DTPAGOITPAG POSITION 18;

ALTER TABLE FNITPAGAR ALTER COLUMN DTCANCITPAG POSITION 19;

ALTER TABLE FNITPAGAR ALTER COLUMN STATUSITPAG POSITION 20;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMPCA POSITION 21;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIALCA POSITION 22;

ALTER TABLE FNITPAGAR ALTER COLUMN NUMCONTA POSITION 23;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMPPN POSITION 24;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIALPN POSITION 25;

ALTER TABLE FNITPAGAR ALTER COLUMN ANOPLAN POSITION 26;

ALTER TABLE FNITPAGAR ALTER COLUMN CODPLAN POSITION 27;

ALTER TABLE FNITPAGAR ALTER COLUMN DOCLANCAITPAG POSITION 28;

ALTER TABLE FNITPAGAR ALTER COLUMN OBSITPAG POSITION 29;

ALTER TABLE FNITPAGAR ALTER COLUMN FLAG POSITION 30;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMPCC POSITION 31;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIALCC POSITION 32;

ALTER TABLE FNITPAGAR ALTER COLUMN ANOCC POSITION 33;

ALTER TABLE FNITPAGAR ALTER COLUMN CODCC POSITION 34;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMPTC POSITION 35;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIALTC POSITION 36;

ALTER TABLE FNITPAGAR ALTER COLUMN CODTIPOCOB POSITION 37;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMPCT POSITION 38;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIALCT POSITION 39;

ALTER TABLE FNITPAGAR ALTER COLUMN CODCONTR POSITION 40;

ALTER TABLE FNITPAGAR ALTER COLUMN CODITCONTR POSITION 41;

ALTER TABLE FNITPAGAR ALTER COLUMN EMMANUT POSITION 42;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMPSN POSITION 43;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIALSN POSITION 44;

ALTER TABLE FNITPAGAR ALTER COLUMN CODSINAL POSITION 45;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMPEM POSITION 46;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIALEM POSITION 47;

ALTER TABLE FNITPAGAR ALTER COLUMN MATEMPR POSITION 48;

ALTER TABLE FNITPAGAR ALTER COLUMN MULTIBAIXA POSITION 49;

ALTER TABLE FNITPAGAR ALTER COLUMN EDITITPAG POSITION 50;

ALTER TABLE FNITPAGAR ALTER COLUMN DTINS POSITION 51;

ALTER TABLE FNITPAGAR ALTER COLUMN IDUSUINS POSITION 52;

ALTER TABLE FNITPAGAR ALTER COLUMN DTALT POSITION 53;

ALTER TABLE FNITPAGAR ALTER COLUMN IDUSUALT POSITION 54;

ALTER TABLE FNITPAGAR ALTER COLUMN HINS POSITION 55;

ALTER TABLE FNITPAGAR ALTER COLUMN HALT POSITION 56;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNITRECEBER ALTER COLUMN CODREC POSITION 3;

ALTER TABLE FNITRECEBER ALTER COLUMN NPARCITREC POSITION 4;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRITREC POSITION 5;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRDESCITREC POSITION 6;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRMULTAITREC POSITION 7;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRJUROSITREC POSITION 8;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRDEVITREC POSITION 9;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRPARCITREC POSITION 10;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRPAGOITREC POSITION 11;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRAPAGITREC POSITION 12;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRCOMIITREC POSITION 13;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRCANCITREC POSITION 14;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRBASECOMIS POSITION 15;

ALTER TABLE FNITRECEBER ALTER COLUMN DESCPONT POSITION 16;

ALTER TABLE FNITRECEBER ALTER COLUMN DTITREC POSITION 17;

ALTER TABLE FNITRECEBER ALTER COLUMN DTCOMPITREC POSITION 18;

ALTER TABLE FNITRECEBER ALTER COLUMN DTVENCITREC POSITION 19;

ALTER TABLE FNITRECEBER ALTER COLUMN DTPREVITREC POSITION 20;

ALTER TABLE FNITRECEBER ALTER COLUMN DTPAGOITREC POSITION 21;

ALTER TABLE FNITRECEBER ALTER COLUMN DTLIQITREC POSITION 22;

ALTER TABLE FNITRECEBER ALTER COLUMN DTCANCITREC POSITION 23;

ALTER TABLE FNITRECEBER ALTER COLUMN STATUSITREC POSITION 24;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPPN POSITION 25;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALPN POSITION 26;

ALTER TABLE FNITRECEBER ALTER COLUMN ANOPLAN POSITION 27;

ALTER TABLE FNITRECEBER ALTER COLUMN CODPLAN POSITION 28;

ALTER TABLE FNITRECEBER ALTER COLUMN OBSITREC POSITION 29;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPCA POSITION 30;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALCA POSITION 31;

ALTER TABLE FNITRECEBER ALTER COLUMN NUMCONTA POSITION 32;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPBO POSITION 33;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALBO POSITION 34;

ALTER TABLE FNITRECEBER ALTER COLUMN CODBANCO POSITION 35;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPTC POSITION 36;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALTC POSITION 37;

ALTER TABLE FNITRECEBER ALTER COLUMN CODTIPOCOB POSITION 38;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPCB POSITION 39;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALCB POSITION 40;

ALTER TABLE FNITRECEBER ALTER COLUMN CODCARTCOB POSITION 41;

ALTER TABLE FNITRECEBER ALTER COLUMN DOCLANCAITREC POSITION 42;

ALTER TABLE FNITRECEBER ALTER COLUMN FLAG POSITION 43;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPCC POSITION 44;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALCC POSITION 45;

ALTER TABLE FNITRECEBER ALTER COLUMN ANOCC POSITION 46;

ALTER TABLE FNITRECEBER ALTER COLUMN CODCC POSITION 47;

ALTER TABLE FNITRECEBER ALTER COLUMN IMPRECIBOITREC POSITION 48;

ALTER TABLE FNITRECEBER ALTER COLUMN RECIBOITREC POSITION 49;

ALTER TABLE FNITRECEBER ALTER COLUMN ALTUSUITREC POSITION 50;

ALTER TABLE FNITRECEBER ALTER COLUMN PDVITREC POSITION 51;

ALTER TABLE FNITRECEBER ALTER COLUMN RECEMCOB POSITION 52;

ALTER TABLE FNITRECEBER ALTER COLUMN DTINIEMCOB POSITION 53;

ALTER TABLE FNITRECEBER ALTER COLUMN DTFIMEMCOB POSITION 54;

ALTER TABLE FNITRECEBER ALTER COLUMN SEQNOSSONUMERO POSITION 55;

ALTER TABLE FNITRECEBER ALTER COLUMN NOSSONUMERO POSITION 56;

ALTER TABLE FNITRECEBER ALTER COLUMN EMMANUT POSITION 57;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPSN POSITION 58;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALSN POSITION 59;

ALTER TABLE FNITRECEBER ALTER COLUMN CODSINAL POSITION 60;

ALTER TABLE FNITRECEBER ALTER COLUMN MULTIBAIXA POSITION 61;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPCT POSITION 62;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALCT POSITION 63;

ALTER TABLE FNITRECEBER ALTER COLUMN CODCONTR POSITION 64;

ALTER TABLE FNITRECEBER ALTER COLUMN CODITCONTR POSITION 65;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPEM POSITION 66;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALEM POSITION 67;

ALTER TABLE FNITRECEBER ALTER COLUMN MATEMPR POSITION 68;

ALTER TABLE FNITRECEBER ALTER COLUMN TPAG POSITION 69;

ALTER TABLE FNITRECEBER ALTER COLUMN DTINS POSITION 70;

ALTER TABLE FNITRECEBER ALTER COLUMN HINS POSITION 71;

ALTER TABLE FNITRECEBER ALTER COLUMN IDUSUINS POSITION 72;

ALTER TABLE FNITRECEBER ALTER COLUMN DTALT POSITION 73;

ALTER TABLE FNITRECEBER ALTER COLUMN HALT POSITION 74;

ALTER TABLE FNITRECEBER ALTER COLUMN IDUSUALT POSITION 75;

ALTER TABLE FNITRENEGREC ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNITRENEGREC ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNITRENEGREC ALTER COLUMN CODRENEGREC POSITION 3;

ALTER TABLE FNITRENEGREC ALTER COLUMN CODITRENEGREC POSITION 4;

ALTER TABLE FNITRENEGREC ALTER COLUMN CODEMPIR POSITION 5;

ALTER TABLE FNITRENEGREC ALTER COLUMN CODFILIALIR POSITION 6;

ALTER TABLE FNITRENEGREC ALTER COLUMN CODREC POSITION 7;

ALTER TABLE FNITRENEGREC ALTER COLUMN NPARCITREC POSITION 8;

ALTER TABLE FNITRENEGREC ALTER COLUMN VLRRENEGITREC POSITION 9;

ALTER TABLE FNITRENEGREC ALTER COLUMN DTINI POSITION 10;

ALTER TABLE FNITRENEGREC ALTER COLUMN DTINS POSITION 11;

ALTER TABLE FNITRENEGREC ALTER COLUMN HINS POSITION 12;

ALTER TABLE FNITRENEGREC ALTER COLUMN IDUSUINS POSITION 13;

ALTER TABLE FNITRENEGREC ALTER COLUMN DTALT POSITION 14;

ALTER TABLE FNITRENEGREC ALTER COLUMN HALT POSITION 15;

ALTER TABLE FNITRENEGREC ALTER COLUMN IDUSUALT POSITION 16;

ALTER TABLE FNLANCA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNLANCA ALTER COLUMN CODLANCA POSITION 3;

ALTER TABLE FNLANCA ALTER COLUMN CODCOMI POSITION 4;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPPG POSITION 5;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALPG POSITION 6;

ALTER TABLE FNLANCA ALTER COLUMN CODPAG POSITION 7;

ALTER TABLE FNLANCA ALTER COLUMN NPARCPAG POSITION 8;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPRC POSITION 9;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALRC POSITION 10;

ALTER TABLE FNLANCA ALTER COLUMN CODREC POSITION 11;

ALTER TABLE FNLANCA ALTER COLUMN NPARCITREC POSITION 12;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPPN POSITION 13;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALPN POSITION 14;

ALTER TABLE FNLANCA ALTER COLUMN ANOPLAN POSITION 15;

ALTER TABLE FNLANCA ALTER COLUMN CODPLAN POSITION 16;

ALTER TABLE FNLANCA ALTER COLUMN DTCOMPLANCA POSITION 17;

ALTER TABLE FNLANCA ALTER COLUMN DATALANCA POSITION 18;

ALTER TABLE FNLANCA ALTER COLUMN DOCLANCA POSITION 19;

ALTER TABLE FNLANCA ALTER COLUMN HISTBLANCA POSITION 20;

ALTER TABLE FNLANCA ALTER COLUMN HISTLANCA POSITION 21;

ALTER TABLE FNLANCA ALTER COLUMN TRANSFLANCA POSITION 22;

ALTER TABLE FNLANCA ALTER COLUMN STATUSLANCA POSITION 23;

ALTER TABLE FNLANCA ALTER COLUMN DTPREVLANCA POSITION 24;

ALTER TABLE FNLANCA ALTER COLUMN DTPREVSUBLANCA POSITION 25;

ALTER TABLE FNLANCA ALTER COLUMN VLRLANCA POSITION 26;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPCI POSITION 27;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALCI POSITION 28;

ALTER TABLE FNLANCA ALTER COLUMN CODPCOMI POSITION 29;

ALTER TABLE FNLANCA ALTER COLUMN FLAG POSITION 30;

ALTER TABLE FNLANCA ALTER COLUMN TIPOLANCA POSITION 31;

ALTER TABLE FNLANCA ALTER COLUMN PDVITREC POSITION 32;

ALTER TABLE FNLANCA ALTER COLUMN CODCLI POSITION 33;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPCL POSITION 34;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALCL POSITION 35;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPFR POSITION 36;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALFR POSITION 37;

ALTER TABLE FNLANCA ALTER COLUMN CODFOR POSITION 38;

ALTER TABLE FNLANCA ALTER COLUMN EMMANUT POSITION 39;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPSN POSITION 40;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALSN POSITION 41;

ALTER TABLE FNLANCA ALTER COLUMN CODSINAL POSITION 42;

ALTER TABLE FNLANCA ALTER COLUMN DTINS POSITION 43;

ALTER TABLE FNLANCA ALTER COLUMN HINS POSITION 44;

ALTER TABLE FNLANCA ALTER COLUMN IDUSUINS POSITION 45;

ALTER TABLE FNLANCA ALTER COLUMN DTALT POSITION 46;

ALTER TABLE FNLANCA ALTER COLUMN HALT POSITION 47;

ALTER TABLE FNLANCA ALTER COLUMN IDUSUALT POSITION 48;

ALTER TABLE FNMODBOLETO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNMODBOLETO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNMODBOLETO ALTER COLUMN CODMODBOL POSITION 3;

ALTER TABLE FNMODBOLETO ALTER COLUMN DESCMODBOL POSITION 4;

ALTER TABLE FNMODBOLETO ALTER COLUMN TXAMODBOL POSITION 5;

ALTER TABLE FNMODBOLETO ALTER COLUMN PREIMPMODBOL POSITION 6;

ALTER TABLE FNMODBOLETO ALTER COLUMN CARTCOB POSITION 7;

ALTER TABLE FNMODBOLETO ALTER COLUMN MDECOB POSITION 8;

ALTER TABLE FNMODBOLETO ALTER COLUMN ACEITEMODBOL POSITION 9;

ALTER TABLE FNMODBOLETO ALTER COLUMN PERCJUROSDIAMODBOL POSITION 10;

ALTER TABLE FNMODBOLETO ALTER COLUMN CLASSMODBOL POSITION 11;

ALTER TABLE FNMODBOLETO ALTER COLUMN ESPDOCMODBOL POSITION 12;

ALTER TABLE FNMODBOLETO ALTER COLUMN DESCLPMODBOL POSITION 13;

ALTER TABLE FNMODBOLETO ALTER COLUMN INSTPAGMODBOL POSITION 14;

ALTER TABLE FNMODBOLETO ALTER COLUMN CODEMPCC POSITION 15;

ALTER TABLE FNMODBOLETO ALTER COLUMN CODFILIALCC POSITION 16;

ALTER TABLE FNMODBOLETO ALTER COLUMN NUMCONTA POSITION 17;

ALTER TABLE FNMODBOLETO ALTER COLUMN IMPINFOPARC POSITION 18;

ALTER TABLE FNMODBOLETO ALTER COLUMN DTINS POSITION 19;

ALTER TABLE FNMODBOLETO ALTER COLUMN HINS POSITION 20;

ALTER TABLE FNMODBOLETO ALTER COLUMN IDUSUINS POSITION 21;

ALTER TABLE FNMODBOLETO ALTER COLUMN DTALT POSITION 22;

ALTER TABLE FNMODBOLETO ALTER COLUMN HALT POSITION 23;

ALTER TABLE FNMODBOLETO ALTER COLUMN IDUSUALT POSITION 24;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNPAGAR ALTER COLUMN CODPAG POSITION 3;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPCP POSITION 4;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALCP POSITION 5;

ALTER TABLE FNPAGAR ALTER COLUMN CODCOMPRA POSITION 6;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPPG POSITION 7;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALPG POSITION 8;

ALTER TABLE FNPAGAR ALTER COLUMN CODPLANOPAG POSITION 9;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPFR POSITION 10;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALFR POSITION 11;

ALTER TABLE FNPAGAR ALTER COLUMN CODFOR POSITION 12;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPBO POSITION 13;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALBO POSITION 14;

ALTER TABLE FNPAGAR ALTER COLUMN CODBANCO POSITION 15;

ALTER TABLE FNPAGAR ALTER COLUMN VLRDESCPAG POSITION 16;

ALTER TABLE FNPAGAR ALTER COLUMN VLRMULTAPAG POSITION 17;

ALTER TABLE FNPAGAR ALTER COLUMN VLRJUROSPAG POSITION 18;

ALTER TABLE FNPAGAR ALTER COLUMN VLRDEVPAG POSITION 19;

ALTER TABLE FNPAGAR ALTER COLUMN VLRPARCPAG POSITION 20;

ALTER TABLE FNPAGAR ALTER COLUMN VLRPAGOPAG POSITION 21;

ALTER TABLE FNPAGAR ALTER COLUMN VLRAPAGPAG POSITION 22;

ALTER TABLE FNPAGAR ALTER COLUMN DATAPAG POSITION 23;

ALTER TABLE FNPAGAR ALTER COLUMN DTCOMPPAG POSITION 24;

ALTER TABLE FNPAGAR ALTER COLUMN STATUSPAG POSITION 25;

ALTER TABLE FNPAGAR ALTER COLUMN DTQUITPAG POSITION 26;

ALTER TABLE FNPAGAR ALTER COLUMN DOCPAG POSITION 27;

ALTER TABLE FNPAGAR ALTER COLUMN VLRPAG POSITION 28;

ALTER TABLE FNPAGAR ALTER COLUMN NROPARCPAG POSITION 29;

ALTER TABLE FNPAGAR ALTER COLUMN OBSPAG POSITION 30;

ALTER TABLE FNPAGAR ALTER COLUMN VLRADICPAG POSITION 31;

ALTER TABLE FNPAGAR ALTER COLUMN FLAG POSITION 32;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPTC POSITION 33;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALTC POSITION 34;

ALTER TABLE FNPAGAR ALTER COLUMN CODTIPOCOB POSITION 35;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPCA POSITION 36;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALCA POSITION 37;

ALTER TABLE FNPAGAR ALTER COLUMN NUMCONTA POSITION 38;

ALTER TABLE FNPAGAR ALTER COLUMN EMMANUT POSITION 39;

ALTER TABLE FNPAGAR ALTER COLUMN VLRBASEIRRF POSITION 40;

ALTER TABLE FNPAGAR ALTER COLUMN VLRBASEINSS POSITION 41;

ALTER TABLE FNPAGAR ALTER COLUMN VLRRETIRRF POSITION 42;

ALTER TABLE FNPAGAR ALTER COLUMN VLRRETINSS POSITION 43;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPPN POSITION 44;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALPN POSITION 45;

ALTER TABLE FNPAGAR ALTER COLUMN ANOPLAN POSITION 46;

ALTER TABLE FNPAGAR ALTER COLUMN CODPLAN POSITION 47;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPCC POSITION 48;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALCC POSITION 49;

ALTER TABLE FNPAGAR ALTER COLUMN ANOCC POSITION 50;

ALTER TABLE FNPAGAR ALTER COLUMN CODCC POSITION 51;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPOC POSITION 52;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALOC POSITION 53;

ALTER TABLE FNPAGAR ALTER COLUMN CODORDCP POSITION 54;

ALTER TABLE FNPAGAR ALTER COLUMN DTINS POSITION 55;

ALTER TABLE FNPAGAR ALTER COLUMN HINS POSITION 56;

ALTER TABLE FNPAGAR ALTER COLUMN IDUSUINS POSITION 57;

ALTER TABLE FNPAGAR ALTER COLUMN DTALT POSITION 58;

ALTER TABLE FNPAGAR ALTER COLUMN HALT POSITION 59;

ALTER TABLE FNPAGAR ALTER COLUMN IDUSUALT POSITION 60;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODPCOMI POSITION 3;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODEMPPN POSITION 4;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODFILIALPN POSITION 5;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN ANOPLAN POSITION 6;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODPLAN POSITION 7;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODEMPCA POSITION 8;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODFILIALCA POSITION 9;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN NUMCONTA POSITION 10;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN VLRPCOMI POSITION 11;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN DOCPCOMI POSITION 12;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN OBSPCOMI POSITION 13;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN DTCOMPPCOMI POSITION 14;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN DATAPCOMI POSITION 15;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN FLAG POSITION 16;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN EMMANUT POSITION 17;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN DTINS POSITION 18;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN HINS POSITION 19;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN IDUSUINS POSITION 20;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN DTALT POSITION 21;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN HALT POSITION 22;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN IDUSUALT POSITION 23;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN ANOPLAN POSITION 3;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODPLAN POSITION 4;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN DESCPLAN POSITION 5;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN NIVELPLAN POSITION 6;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODREDPLAN POSITION 7;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODEMPSP POSITION 8;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODFILIALSP POSITION 9;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN ANOPLANSP POSITION 10;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODSUBPLAN POSITION 11;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN TIPOPLAN POSITION 12;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN FINPLAN POSITION 13;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN COMPSLDCXPLAN POSITION 14;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODEMPHP POSITION 15;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODFILIALHP POSITION 16;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODHIST POSITION 17;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODCONTCRED POSITION 18;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODCONTDEB POSITION 19;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN ESFINPLAN POSITION 20;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CLASFINPLAN POSITION 21;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN LANCTOXPLAN POSITION 22;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN ATIVOPLAN POSITION 23;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODEMPANT POSITION 24;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODFILIALANT POSITION 25;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN ANOPLANANT POSITION 26;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN CODPLANANT POSITION 27;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN DTINS POSITION 28;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN HINS POSITION 29;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN IDUSUINS POSITION 30;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN DTALT POSITION 31;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN HALT POSITION 32;

ALTER TABLE FNPLANEJAMENTO ALTER COLUMN IDUSUALT POSITION 33;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODPLANOPAG POSITION 3;

ALTER TABLE FNPLANOPAG ALTER COLUMN DESCPLANOPAG POSITION 4;

ALTER TABLE FNPLANOPAG ALTER COLUMN PARCPLANOPAG POSITION 5;

ALTER TABLE FNPLANOPAG ALTER COLUMN APORCPLANOPAG POSITION 6;

ALTER TABLE FNPLANOPAG ALTER COLUMN AUTOBAIXAPLANOPAG POSITION 7;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODEMPCA POSITION 8;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODFILIALCA POSITION 9;

ALTER TABLE FNPLANOPAG ALTER COLUMN NUMCONTA POSITION 10;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODEMPPN POSITION 11;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODFILIALPN POSITION 12;

ALTER TABLE FNPLANOPAG ALTER COLUMN ANOPLAN POSITION 13;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODPLAN POSITION 14;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODEMPCC POSITION 15;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODFILIALCC POSITION 16;

ALTER TABLE FNPLANOPAG ALTER COLUMN ANOCC POSITION 17;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODCC POSITION 18;

ALTER TABLE FNPLANOPAG ALTER COLUMN ATIVOPLANOPAG POSITION 19;

ALTER TABLE FNPLANOPAG ALTER COLUMN CVPLANOPAG POSITION 20;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODEMPTBJ POSITION 21;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODFILIALTBJ POSITION 22;

ALTER TABLE FNPLANOPAG ALTER COLUMN CODTBJ POSITION 23;

ALTER TABLE FNPLANOPAG ALTER COLUMN PERCDESC POSITION 24;

ALTER TABLE FNPLANOPAG ALTER COLUMN REGRVCTOPLANOPAG POSITION 25;

ALTER TABLE FNPLANOPAG ALTER COLUMN RVSABPLANOPAG POSITION 26;

ALTER TABLE FNPLANOPAG ALTER COLUMN RVDOMPLANOPAG POSITION 27;

ALTER TABLE FNPLANOPAG ALTER COLUMN RVFERPLANOPAG POSITION 28;

ALTER TABLE FNPLANOPAG ALTER COLUMN RVDIAPLANOPAG POSITION 29;

ALTER TABLE FNPLANOPAG ALTER COLUMN DIAVCTOPLANOPAG POSITION 30;

ALTER TABLE FNPLANOPAG ALTER COLUMN DTINS POSITION 31;

ALTER TABLE FNPLANOPAG ALTER COLUMN HINS POSITION 32;

ALTER TABLE FNPLANOPAG ALTER COLUMN IDUSUINS POSITION 33;

ALTER TABLE FNPLANOPAG ALTER COLUMN DTALT POSITION 34;

ALTER TABLE FNPLANOPAG ALTER COLUMN HALT POSITION 35;

ALTER TABLE FNPLANOPAG ALTER COLUMN IDUSUALT POSITION 36;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNRECEBER ALTER COLUMN CODREC POSITION 3;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPBO POSITION 4;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALBO POSITION 5;

ALTER TABLE FNRECEBER ALTER COLUMN CODBANCO POSITION 6;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPPG POSITION 7;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALPG POSITION 8;

ALTER TABLE FNRECEBER ALTER COLUMN CODPLANOPAG POSITION 9;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPCL POSITION 10;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALCL POSITION 11;

ALTER TABLE FNRECEBER ALTER COLUMN CODCLI POSITION 12;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPVD POSITION 13;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALVD POSITION 14;

ALTER TABLE FNRECEBER ALTER COLUMN CODVEND POSITION 15;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPVA POSITION 16;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALVA POSITION 17;

ALTER TABLE FNRECEBER ALTER COLUMN TIPOVENDA POSITION 18;

ALTER TABLE FNRECEBER ALTER COLUMN CODVENDA POSITION 19;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPTC POSITION 20;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALTC POSITION 21;

ALTER TABLE FNRECEBER ALTER COLUMN CODTIPOCOB POSITION 22;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPCB POSITION 23;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALCB POSITION 24;

ALTER TABLE FNRECEBER ALTER COLUMN CODCARTCOB POSITION 25;

ALTER TABLE FNRECEBER ALTER COLUMN VLRREC POSITION 26;

ALTER TABLE FNRECEBER ALTER COLUMN VLRDESCREC POSITION 27;

ALTER TABLE FNRECEBER ALTER COLUMN VLRMULTAREC POSITION 28;

ALTER TABLE FNRECEBER ALTER COLUMN VLRJUROSREC POSITION 29;

ALTER TABLE FNRECEBER ALTER COLUMN VLRDEVREC POSITION 30;

ALTER TABLE FNRECEBER ALTER COLUMN VLRPARCREC POSITION 31;

ALTER TABLE FNRECEBER ALTER COLUMN VLRPAGOREC POSITION 32;

ALTER TABLE FNRECEBER ALTER COLUMN VLRAPAGREC POSITION 33;

ALTER TABLE FNRECEBER ALTER COLUMN VLRBASECOMIS POSITION 34;

ALTER TABLE FNRECEBER ALTER COLUMN VLRRETENSAOISS POSITION 35;

ALTER TABLE FNRECEBER ALTER COLUMN DTCOMPREC POSITION 36;

ALTER TABLE FNRECEBER ALTER COLUMN DATAREC POSITION 37;

ALTER TABLE FNRECEBER ALTER COLUMN STATUSREC POSITION 38;

ALTER TABLE FNRECEBER ALTER COLUMN VLRCOMIREC POSITION 39;

ALTER TABLE FNRECEBER ALTER COLUMN DTQUITREC POSITION 40;

ALTER TABLE FNRECEBER ALTER COLUMN DOCREC POSITION 41;

ALTER TABLE FNRECEBER ALTER COLUMN NROPARCREC POSITION 42;

ALTER TABLE FNRECEBER ALTER COLUMN OBSREC POSITION 43;

ALTER TABLE FNRECEBER ALTER COLUMN FLAG POSITION 44;

ALTER TABLE FNRECEBER ALTER COLUMN ALTUSUREC POSITION 45;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPCA POSITION 46;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALCA POSITION 47;

ALTER TABLE FNRECEBER ALTER COLUMN NUMCONTA POSITION 48;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPPN POSITION 49;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALPN POSITION 50;

ALTER TABLE FNRECEBER ALTER COLUMN ANOPLAN POSITION 51;

ALTER TABLE FNRECEBER ALTER COLUMN CODPLAN POSITION 52;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPCC POSITION 53;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALCC POSITION 54;

ALTER TABLE FNRECEBER ALTER COLUMN ANOCC POSITION 55;

ALTER TABLE FNRECEBER ALTER COLUMN CODCC POSITION 56;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPRR POSITION 57;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALRR POSITION 58;

ALTER TABLE FNRECEBER ALTER COLUMN CODRENEGREC POSITION 59;

ALTER TABLE FNRECEBER ALTER COLUMN EMMANUT POSITION 60;

ALTER TABLE FNRECEBER ALTER COLUMN DTINS POSITION 61;

ALTER TABLE FNRECEBER ALTER COLUMN HINS POSITION 62;

ALTER TABLE FNRECEBER ALTER COLUMN IDUSUINS POSITION 63;

ALTER TABLE FNRECEBER ALTER COLUMN DTALT POSITION 64;

ALTER TABLE FNRECEBER ALTER COLUMN HALT POSITION 65;

ALTER TABLE FNRECEBER ALTER COLUMN IDUSUALT POSITION 66;

ALTER TABLE FNSALDOLANCA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNSALDOLANCA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNSALDOLANCA ALTER COLUMN CODEMPPN POSITION 3;

ALTER TABLE FNSALDOLANCA ALTER COLUMN CODFILIALPN POSITION 4;

ALTER TABLE FNSALDOLANCA ALTER COLUMN ANOPLAN POSITION 5;

ALTER TABLE FNSALDOLANCA ALTER COLUMN CODPLAN POSITION 6;

ALTER TABLE FNSALDOLANCA ALTER COLUMN DATASL POSITION 7;

ALTER TABLE FNSALDOLANCA ALTER COLUMN PREVSL POSITION 8;

ALTER TABLE FNSALDOLANCA ALTER COLUMN SALDOSL POSITION 9;

ALTER TABLE FNSALDOLANCA ALTER COLUMN FECHADO POSITION 10;

ALTER TABLE FNSALDOLANCA ALTER COLUMN EMMANUT POSITION 11;

ALTER TABLE FNSALDOLANCA ALTER COLUMN DTINS POSITION 12;

ALTER TABLE FNSALDOLANCA ALTER COLUMN HINS POSITION 13;

ALTER TABLE FNSALDOLANCA ALTER COLUMN IDUSUINS POSITION 14;

ALTER TABLE FNSALDOLANCA ALTER COLUMN DTALT POSITION 15;

ALTER TABLE FNSALDOLANCA ALTER COLUMN HALT POSITION 16;

ALTER TABLE FNSALDOLANCA ALTER COLUMN IDUSUALT POSITION 17;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODLANCA POSITION 3;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODSUBLANCA POSITION 4;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPPN POSITION 5;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALPN POSITION 6;

ALTER TABLE FNSUBLANCA ALTER COLUMN ANOPLAN POSITION 7;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODPLAN POSITION 8;

ALTER TABLE FNSUBLANCA ALTER COLUMN STATUSSUBLANCA POSITION 9;

ALTER TABLE FNSUBLANCA ALTER COLUMN ORIGSUBLANCA POSITION 10;

ALTER TABLE FNSUBLANCA ALTER COLUMN DTCOMPSUBLANCA POSITION 11;

ALTER TABLE FNSUBLANCA ALTER COLUMN DTPREVSUBLANCA POSITION 12;

ALTER TABLE FNSUBLANCA ALTER COLUMN TIPOSUBLANCA POSITION 13;

ALTER TABLE FNSUBLANCA ALTER COLUMN DATASUBLANCA POSITION 14;

ALTER TABLE FNSUBLANCA ALTER COLUMN VLRSUBLANCA POSITION 15;

ALTER TABLE FNSUBLANCA ALTER COLUMN FLAG POSITION 16;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPCC POSITION 17;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALCC POSITION 18;

ALTER TABLE FNSUBLANCA ALTER COLUMN ANOCC POSITION 19;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODCC POSITION 20;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPCL POSITION 21;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALCL POSITION 22;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODCLI POSITION 23;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPFR POSITION 24;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALFR POSITION 25;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFOR POSITION 26;

ALTER TABLE FNSUBLANCA ALTER COLUMN HISTSUBLANCA POSITION 27;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPCT POSITION 28;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALCT POSITION 29;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODCONTR POSITION 30;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODITCONTR POSITION 31;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPPG POSITION 32;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALPG POSITION 33;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODPAG POSITION 34;

ALTER TABLE FNSUBLANCA ALTER COLUMN NPARCPAG POSITION 35;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPRC POSITION 36;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALRC POSITION 37;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODREC POSITION 38;

ALTER TABLE FNSUBLANCA ALTER COLUMN NPARCITREC POSITION 39;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPEM POSITION 40;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALEM POSITION 41;

ALTER TABLE FNSUBLANCA ALTER COLUMN MATEMPR POSITION 42;

ALTER TABLE FNSUBLANCA ALTER COLUMN TPAG POSITION 43;

ALTER TABLE FNSUBLANCA ALTER COLUMN EMMANUT POSITION 44;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPTC POSITION 45;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALTC POSITION 46;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODTIPOCOB POSITION 47;

ALTER TABLE FNSUBLANCA ALTER COLUMN DTINS POSITION 48;

ALTER TABLE FNSUBLANCA ALTER COLUMN HINS POSITION 49;

ALTER TABLE FNSUBLANCA ALTER COLUMN IDUSUINS POSITION 50;

ALTER TABLE FNSUBLANCA ALTER COLUMN DTALT POSITION 51;

ALTER TABLE FNSUBLANCA ALTER COLUMN HALT POSITION 52;

ALTER TABLE FNSUBLANCA ALTER COLUMN IDUSUALT POSITION 53;

ALTER TABLE LFFRETE ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE LFFRETE ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE LFFRETE ALTER COLUMN CODFRETE POSITION 3;

ALTER TABLE LFFRETE ALTER COLUMN DOCFRETE POSITION 4;

ALTER TABLE LFFRETE ALTER COLUMN CODEMPTN POSITION 5;

ALTER TABLE LFFRETE ALTER COLUMN CODFILIALTN POSITION 6;

ALTER TABLE LFFRETE ALTER COLUMN CODTRAN POSITION 7;

ALTER TABLE LFFRETE ALTER COLUMN CODEMPTM POSITION 8;

ALTER TABLE LFFRETE ALTER COLUMN CODFILIALTM POSITION 9;

ALTER TABLE LFFRETE ALTER COLUMN CODTIPOMOV POSITION 10;

ALTER TABLE LFFRETE ALTER COLUMN CODEMPNT POSITION 11;

ALTER TABLE LFFRETE ALTER COLUMN CODFILIALNT POSITION 12;

ALTER TABLE LFFRETE ALTER COLUMN CODNAT POSITION 13;

ALTER TABLE LFFRETE ALTER COLUMN TIPOFRETE POSITION 14;

ALTER TABLE LFFRETE ALTER COLUMN TIPOPGTO POSITION 15;

ALTER TABLE LFFRETE ALTER COLUMN CODEMPRE POSITION 16;

ALTER TABLE LFFRETE ALTER COLUMN CODFILIALRE POSITION 17;

ALTER TABLE LFFRETE ALTER COLUMN CODREMET POSITION 18;

ALTER TABLE LFFRETE ALTER COLUMN CODEMPDE POSITION 19;

ALTER TABLE LFFRETE ALTER COLUMN CODFILIALDE POSITION 20;

ALTER TABLE LFFRETE ALTER COLUMN CODDESTINAT POSITION 21;

ALTER TABLE LFFRETE ALTER COLUMN DTEMITFRETE POSITION 22;

ALTER TABLE LFFRETE ALTER COLUMN DTMOVFRETE POSITION 23;

ALTER TABLE LFFRETE ALTER COLUMN DTPAGFRETE POSITION 24;

ALTER TABLE LFFRETE ALTER COLUMN QTDFRETE POSITION 25;

ALTER TABLE LFFRETE ALTER COLUMN VLRMERCADORIA POSITION 26;

ALTER TABLE LFFRETE ALTER COLUMN VLRFRETE POSITION 27;

ALTER TABLE LFFRETE ALTER COLUMN VLRFRETENOTA POSITION 28;

ALTER TABLE LFFRETE ALTER COLUMN PESOBRUTO POSITION 29;

ALTER TABLE LFFRETE ALTER COLUMN PESOLIQUIDO POSITION 30;

ALTER TABLE LFFRETE ALTER COLUMN ALIQICMSFRETE POSITION 31;

ALTER TABLE LFFRETE ALTER COLUMN VLRICMSFRETE POSITION 32;

ALTER TABLE LFFRETE ALTER COLUMN VLRBASEICMSFRETE POSITION 33;

ALTER TABLE LFFRETE ALTER COLUMN CODEMPPA POSITION 34;

ALTER TABLE LFFRETE ALTER COLUMN CODFILIALPA POSITION 35;

ALTER TABLE LFFRETE ALTER COLUMN CODPAG POSITION 36;

ALTER TABLE LFFRETE ALTER COLUMN SERIE POSITION 37;

ALTER TABLE LFFRETE ALTER COLUMN CODEMPRM POSITION 38;

ALTER TABLE LFFRETE ALTER COLUMN CODFILIALRM POSITION 39;

ALTER TABLE LFFRETE ALTER COLUMN TICKET POSITION 40;

ALTER TABLE LFFRETE ALTER COLUMN CHAVECTE POSITION 41;

ALTER TABLE LFFRETE ALTER COLUMN CODEMPTT POSITION 42;

ALTER TABLE LFFRETE ALTER COLUMN CODFILIALTT POSITION 43;

ALTER TABLE LFFRETE ALTER COLUMN CODTRATTRIB POSITION 44;

ALTER TABLE LFFRETE ALTER COLUMN CODEMPEX POSITION 45;

ALTER TABLE LFFRETE ALTER COLUMN CODFILIALEX POSITION 46;

ALTER TABLE LFFRETE ALTER COLUMN TICKETEX POSITION 47;

ALTER TABLE LFFRETE ALTER COLUMN EMMANUT POSITION 48;

ALTER TABLE LFFRETE ALTER COLUMN DTINS POSITION 49;

ALTER TABLE LFFRETE ALTER COLUMN HINS POSITION 50;

ALTER TABLE LFFRETE ALTER COLUMN IDUSUINS POSITION 51;

ALTER TABLE LFFRETE ALTER COLUMN DTALT POSITION 52;

ALTER TABLE LFFRETE ALTER COLUMN HALT POSITION 53;

ALTER TABLE LFFRETE ALTER COLUMN IDUSUALT POSITION 54;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFISC POSITION 3;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODITFISC POSITION 4;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ORIGFISC POSITION 5;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPTT POSITION 6;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALTT POSITION 7;

ALTER TABLE LFITCLFISCAL ALTER COLUMN TIPOFISC POSITION 8;

ALTER TABLE LFITCLFISCAL ALTER COLUMN TPREDICMSFISC POSITION 9;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ATIVOITFISC POSITION 10;

ALTER TABLE LFITCLFISCAL ALTER COLUMN REDFISC POSITION 11;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODTRATTRIB POSITION 12;

ALTER TABLE LFITCLFISCAL ALTER COLUMN NOUFITFISC POSITION 13;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPFC POSITION 14;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALFC POSITION 15;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFISCCLI POSITION 16;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQFISC POSITION 17;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQFISCINTRA POSITION 18;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQLFISC POSITION 19;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQIPIFISC POSITION 20;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQPISFISC POSITION 21;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQCOFINSFISC POSITION 22;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQCSOCIALFISC POSITION 23;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQIRFISC POSITION 24;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQFUNRURALFISC POSITION 25;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQIIFISC POSITION 26;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPME POSITION 27;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALME POSITION 28;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODMENS POSITION 29;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPTM POSITION 30;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALTM POSITION 31;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODTIPOMOV POSITION 32;

ALTER TABLE LFITCLFISCAL ALTER COLUMN TIPOST POSITION 33;

ALTER TABLE LFITCLFISCAL ALTER COLUMN MARGEMVLAGR POSITION 34;

ALTER TABLE LFITCLFISCAL ALTER COLUMN GERALFISC POSITION 35;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPSP POSITION 36;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALSP POSITION 37;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODSITTRIBPIS POSITION 38;

ALTER TABLE LFITCLFISCAL ALTER COLUMN IMPSITTRIBPIS POSITION 39;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CREDDEBPIS POSITION 40;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPSC POSITION 41;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALSC POSITION 42;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODSITTRIBCOF POSITION 43;

ALTER TABLE LFITCLFISCAL ALTER COLUMN IMPSITTRIBCOF POSITION 44;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CREDDEBCOF POSITION 45;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPSI POSITION 46;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALSI POSITION 47;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODSITTRIBIPI POSITION 48;

ALTER TABLE LFITCLFISCAL ALTER COLUMN IMPSITTRIBIPI POSITION 49;

ALTER TABLE LFITCLFISCAL ALTER COLUMN TPCALCIPI POSITION 50;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CREDDEBIPI POSITION 51;

ALTER TABLE LFITCLFISCAL ALTER COLUMN VLRIPIUNIDTRIB POSITION 52;

ALTER TABLE LFITCLFISCAL ALTER COLUMN MODBCICMS POSITION 53;

ALTER TABLE LFITCLFISCAL ALTER COLUMN MODBCICMSST POSITION 54;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODPAIS POSITION 55;

ALTER TABLE LFITCLFISCAL ALTER COLUMN SIGLAUF POSITION 56;

ALTER TABLE LFITCLFISCAL ALTER COLUMN VLRPISUNIDTRIB POSITION 57;

ALTER TABLE LFITCLFISCAL ALTER COLUMN VLRCOFUNIDTRIB POSITION 58;

ALTER TABLE LFITCLFISCAL ALTER COLUMN TIPOUSOITFISC POSITION 59;

ALTER TABLE LFITCLFISCAL ALTER COLUMN REDBASEST POSITION 60;

ALTER TABLE LFITCLFISCAL ALTER COLUMN REDBASEFRETE POSITION 61;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPRA POSITION 62;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALRA POSITION 63;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODREGRA POSITION 64;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPIS POSITION 65;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALIS POSITION 66;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODSITTRIBISS POSITION 67;

ALTER TABLE LFITCLFISCAL ALTER COLUMN IMPSITTRIBISS POSITION 68;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQISSFISC POSITION 69;

ALTER TABLE LFITCLFISCAL ALTER COLUMN RETENSAOISS POSITION 70;

ALTER TABLE LFITCLFISCAL ALTER COLUMN INDAPURIPI POSITION 71;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPCN POSITION 72;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALCN POSITION 73;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CSOSN POSITION 74;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPEQ POSITION 75;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALEQ POSITION 76;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODENQ POSITION 77;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQICMSIMP POSITION 78;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CREDDEBICMS POSITION 79;

ALTER TABLE LFITCLFISCAL ALTER COLUMN PERCCREDPRESIMP POSITION 80;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ADICIPIBASEICMS POSITION 81;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ADICICMSTOTNOTA POSITION 82;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPCC POSITION 83;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALCC POSITION 84;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODCALC POSITION 85;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQICMSSTCM POSITION 86;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CALCSTCM POSITION 87;

ALTER TABLE LFITCLFISCAL ALTER COLUMN TRIBREGNORMAL POSITION 88;

ALTER TABLE LFITCLFISCAL ALTER COLUMN SIMPLESFILIAL POSITION 89;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ICMSPART POSITION 90;

ALTER TABLE LFITCLFISCAL ALTER COLUMN PBCOP POSITION 91;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODCEST POSITION 92;

ALTER TABLE LFITCLFISCAL ALTER COLUMN DTINS POSITION 93;

ALTER TABLE LFITCLFISCAL ALTER COLUMN HINS POSITION 94;

ALTER TABLE LFITCLFISCAL ALTER COLUMN IDUSUINS POSITION 95;

ALTER TABLE LFITCLFISCAL ALTER COLUMN DTALT POSITION 96;

ALTER TABLE LFITCLFISCAL ALTER COLUMN HALT POSITION 97;

ALTER TABLE LFITCLFISCAL ALTER COLUMN IDUSUALT POSITION 98;

ALTER TABLE LFTABICMS ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE LFTABICMS ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE LFTABICMS ALTER COLUMN UFTI POSITION 3;

ALTER TABLE LFTABICMS ALTER COLUMN ALIQTI POSITION 4;

ALTER TABLE LFTABICMS ALTER COLUMN ALIQINTRATI POSITION 5;

ALTER TABLE LFTABICMS ALTER COLUMN ALIQFCPTI POSITION 6;

ALTER TABLE LFTABICMS ALTER COLUMN DTINS POSITION 7;

ALTER TABLE LFTABICMS ALTER COLUMN HINS POSITION 8;

ALTER TABLE LFTABICMS ALTER COLUMN IDUSUINS POSITION 9;

ALTER TABLE LFTABICMS ALTER COLUMN DTALT POSITION 10;

ALTER TABLE LFTABICMS ALTER COLUMN HALT POSITION 11;

ALTER TABLE LFTABICMS ALTER COLUMN IDUSUALT POSITION 12;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN CODFISCCLI POSITION 3;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN DESCFISCCLI POSITION 4;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN CALCCOFINSTF POSITION 5;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN CALCCSOCIALTF POSITION 6;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN CALCICMSTF POSITION 7;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN CALCIPITF POSITION 8;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN CALCIRTF POSITION 9;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN CALCISSTF POSITION 10;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN CALCPISTF POSITION 11;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN IMPCOFINSTF POSITION 12;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN IMPCSOCIALTF POSITION 13;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN IMPICMSTF POSITION 14;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN IMPISSTF POSITION 15;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN IMPIPITF POSITION 16;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN IMPIRTF POSITION 17;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN IMPPISTF POSITION 18;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN LEITRANSP POSITION 19;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN ATIVO POSITION 20;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN CODEMPOC POSITION 21;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN CODFILIALOC POSITION 22;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN CODTIPOMOVOC POSITION 23;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN DTINS POSITION 24;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN HINS POSITION 25;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN IDUSUINS POSITION 26;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN DTALT POSITION 27;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN HALT POSITION 28;

ALTER TABLE LFTIPOFISCCLI ALTER COLUMN IDUSUALT POSITION 29;

ALTER TABLE PPESTRUTURA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE PPESTRUTURA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE PPESTRUTURA ALTER COLUMN CODPROD POSITION 3;

ALTER TABLE PPESTRUTURA ALTER COLUMN SEQEST POSITION 4;

ALTER TABLE PPESTRUTURA ALTER COLUMN DESCEST POSITION 5;

ALTER TABLE PPESTRUTURA ALTER COLUMN QTDEST POSITION 6;

ALTER TABLE PPESTRUTURA ALTER COLUMN REFPROD POSITION 7;

ALTER TABLE PPESTRUTURA ALTER COLUMN ATIVOEST POSITION 8;

ALTER TABLE PPESTRUTURA ALTER COLUMN CODEMPML POSITION 9;

ALTER TABLE PPESTRUTURA ALTER COLUMN CODFILIALML POSITION 10;

ALTER TABLE PPESTRUTURA ALTER COLUMN CODMODLOTE POSITION 11;

ALTER TABLE PPESTRUTURA ALTER COLUMN NRODIASVALID POSITION 12;

ALTER TABLE PPESTRUTURA ALTER COLUMN GLOTEOPP POSITION 13;

ALTER TABLE PPESTRUTURA ALTER COLUMN USADENSIDADEOP POSITION 14;

ALTER TABLE PPESTRUTURA ALTER COLUMN OBSERVACAO POSITION 15;

ALTER TABLE PPESTRUTURA ALTER COLUMN ESTDINAMICA POSITION 16;

ALTER TABLE PPESTRUTURA ALTER COLUMN DESPAUTO POSITION 17;

ALTER TABLE PPESTRUTURA ALTER COLUMN BLOQQTDPROD POSITION 18;

ALTER TABLE PPESTRUTURA ALTER COLUMN EXPEDIRRMA POSITION 19;

ALTER TABLE PPESTRUTURA ALTER COLUMN GERAROP POSITION 20;

ALTER TABLE PPESTRUTURA ALTER COLUMN NUMEROFT POSITION 21;

ALTER TABLE PPESTRUTURA ALTER COLUMN DTREVISAOFT POSITION 22;

ALTER TABLE PPESTRUTURA ALTER COLUMN EMMANUT POSITION 23;

ALTER TABLE PPESTRUTURA ALTER COLUMN MANIPULACAO POSITION 24;

ALTER TABLE PPESTRUTURA ALTER COLUMN SEGUIMENTO POSITION 25;

ALTER TABLE PPESTRUTURA ALTER COLUMN CATEGORIA POSITION 26;

ALTER TABLE PPESTRUTURA ALTER COLUMN ANVISA POSITION 27;

ALTER TABLE PPESTRUTURA ALTER COLUMN MINISTERIOAGRI POSITION 28;

ALTER TABLE PPESTRUTURA ALTER COLUMN PRINCIPIOATIVO POSITION 29;

ALTER TABLE PPESTRUTURA ALTER COLUMN DESCCOMPL POSITION 30;

ALTER TABLE PPESTRUTURA ALTER COLUMN FINALIDADEUSO POSITION 31;

ALTER TABLE PPESTRUTURA ALTER COLUMN MODOUSAR POSITION 32;

ALTER TABLE PPESTRUTURA ALTER COLUMN RESTRICAOUSO POSITION 33;

ALTER TABLE PPESTRUTURA ALTER COLUMN COMPOSICAO POSITION 34;

ALTER TABLE PPESTRUTURA ALTER COLUMN MECANISMOACAO POSITION 35;

ALTER TABLE PPESTRUTURA ALTER COLUMN CARACTERISTICA01 POSITION 36;

ALTER TABLE PPESTRUTURA ALTER COLUMN CARACTERISTICA02 POSITION 37;

ALTER TABLE PPESTRUTURA ALTER COLUMN CARACTERISTICA03 POSITION 38;

ALTER TABLE PPESTRUTURA ALTER COLUMN EMBALAGEM POSITION 39;

ALTER TABLE PPESTRUTURA ALTER COLUMN PRECAUCOES POSITION 40;

ALTER TABLE PPESTRUTURA ALTER COLUMN TITPARAM01 POSITION 41;

ALTER TABLE PPESTRUTURA ALTER COLUMN TITPARAM02 POSITION 42;

ALTER TABLE PPESTRUTURA ALTER COLUMN TITPARAM03 POSITION 43;

ALTER TABLE PPESTRUTURA ALTER COLUMN TITPARAM04 POSITION 44;

ALTER TABLE PPESTRUTURA ALTER COLUMN TITPARAM05 POSITION 45;

ALTER TABLE PPESTRUTURA ALTER COLUMN TITPARAM06 POSITION 46;

ALTER TABLE PPESTRUTURA ALTER COLUMN VLRPARAM01 POSITION 47;

ALTER TABLE PPESTRUTURA ALTER COLUMN VLRPARAM02 POSITION 48;

ALTER TABLE PPESTRUTURA ALTER COLUMN VLRPARAM03 POSITION 49;

ALTER TABLE PPESTRUTURA ALTER COLUMN VLRPARAM04 POSITION 50;

ALTER TABLE PPESTRUTURA ALTER COLUMN VLRPARAM05 POSITION 51;

ALTER TABLE PPESTRUTURA ALTER COLUMN VLRPARAM06 POSITION 52;

ALTER TABLE PPESTRUTURA ALTER COLUMN TABTIT POSITION 53;

ALTER TABLE PPESTRUTURA ALTER COLUMN TABTITCOL01 POSITION 54;

ALTER TABLE PPESTRUTURA ALTER COLUMN TABTITCOL02 POSITION 55;

ALTER TABLE PPESTRUTURA ALTER COLUMN TABTITLIN01 POSITION 56;

ALTER TABLE PPESTRUTURA ALTER COLUMN TABTITLIN02 POSITION 57;

ALTER TABLE PPESTRUTURA ALTER COLUMN TABTITLIN03 POSITION 58;

ALTER TABLE PPESTRUTURA ALTER COLUMN TABCELL01C01 POSITION 59;

ALTER TABLE PPESTRUTURA ALTER COLUMN TABCELL01C02 POSITION 60;

ALTER TABLE PPESTRUTURA ALTER COLUMN TABCELL02C01 POSITION 61;

ALTER TABLE PPESTRUTURA ALTER COLUMN TABCELL02C02 POSITION 62;

ALTER TABLE PPESTRUTURA ALTER COLUMN TABCELL03C01 POSITION 63;

ALTER TABLE PPESTRUTURA ALTER COLUMN TABCELL03C02 POSITION 64;

ALTER TABLE PPESTRUTURA ALTER COLUMN NOTADILUICAO POSITION 65;

ALTER TABLE PPESTRUTURA ALTER COLUMN DTINS POSITION 66;

ALTER TABLE PPESTRUTURA ALTER COLUMN HINS POSITION 67;

ALTER TABLE PPESTRUTURA ALTER COLUMN IDUSUINS POSITION 68;

ALTER TABLE PPESTRUTURA ALTER COLUMN DTALT POSITION 69;

ALTER TABLE PPESTRUTURA ALTER COLUMN HALT POSITION 70;

ALTER TABLE PPESTRUTURA ALTER COLUMN IDUSUALT POSITION 71;

ALTER TABLE SGESTACAO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGESTACAO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGESTACAO ALTER COLUMN CODEST POSITION 3;

ALTER TABLE SGESTACAO ALTER COLUMN DESCEST POSITION 4;

ALTER TABLE SGESTACAO ALTER COLUMN MODODEMOEST POSITION 5;

ALTER TABLE SGESTACAO ALTER COLUMN NFEEST POSITION 6;

ALTER TABLE SGESTACAO ALTER COLUMN ATIVAEST POSITION 7;

ALTER TABLE SGESTACAO ALTER COLUMN TAMFONTETXT POSITION 8;

ALTER TABLE SGESTACAO ALTER COLUMN FONTETXT POSITION 9;

ALTER TABLE SGESTACAO ALTER COLUMN PATHCACERTS POSITION 10;

ALTER TABLE SGESTACAO ALTER COLUMN CODEMPPX POSITION 11;

ALTER TABLE SGESTACAO ALTER COLUMN CODFILIALPX POSITION 12;

ALTER TABLE SGESTACAO ALTER COLUMN CODPROXY POSITION 13;

ALTER TABLE SGESTACAO ALTER COLUMN HOSTEST POSITION 14;

ALTER TABLE SGESTACAO ALTER COLUMN IPEST POSITION 15;

ALTER TABLE SGESTACAO ALTER COLUMN MACADDRESSEST POSITION 16;

ALTER TABLE SGESTACAO ALTER COLUMN DESCLOCALEST POSITION 17;

ALTER TABLE SGESTACAO ALTER COLUMN NOMECONTEST POSITION 18;

ALTER TABLE SGESTACAO ALTER COLUMN RAMALEST POSITION 19;

ALTER TABLE SGESTACAO ALTER COLUMN EMAILEST POSITION 20;

ALTER TABLE SGESTACAO ALTER COLUMN PATHPDFREADER POSITION 21;

ALTER TABLE SGESTACAO ALTER COLUMN PRINTPDF POSITION 22;

ALTER TABLE SGESTACAO ALTER COLUMN CMDGBAK POSITION 23;

ALTER TABLE SGESTACAO ALTER COLUMN DIRGBAK POSITION 24;

ALTER TABLE SGESTACAO ALTER COLUMN CONTINGENCIAPESAGEM POSITION 25;

ALTER TABLE SGESTACAO ALTER COLUMN CMDIMPPADRAOWIN POSITION 26;

ALTER TABLE SGESTACAO ALTER COLUMN CMDIMPPADRAOLIN POSITION 27;

ALTER TABLE SGESTACAO ALTER COLUMN DTINS POSITION 28;

ALTER TABLE SGESTACAO ALTER COLUMN HINS POSITION 29;

ALTER TABLE SGESTACAO ALTER COLUMN IDUSUINS POSITION 30;

ALTER TABLE SGESTACAO ALTER COLUMN DTALT POSITION 31;

ALTER TABLE SGESTACAO ALTER COLUMN HALT POSITION 32;

ALTER TABLE SGESTACAO ALTER COLUMN IDUSUALT POSITION 33;

ALTER TABLE SGFILIAL ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGFILIAL ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGFILIAL ALTER COLUMN RAZFILIAL POSITION 3;

ALTER TABLE SGFILIAL ALTER COLUMN NOMEFILIAL POSITION 4;

ALTER TABLE SGFILIAL ALTER COLUMN MZFILIAL POSITION 5;

ALTER TABLE SGFILIAL ALTER COLUMN CNPJFILIAL POSITION 6;

ALTER TABLE SGFILIAL ALTER COLUMN INSCFILIAL POSITION 7;

ALTER TABLE SGFILIAL ALTER COLUMN ENDFILIAL POSITION 8;

ALTER TABLE SGFILIAL ALTER COLUMN NUMFILIAL POSITION 9;

ALTER TABLE SGFILIAL ALTER COLUMN COMPLFILIAL POSITION 10;

ALTER TABLE SGFILIAL ALTER COLUMN BAIRFILIAL POSITION 11;

ALTER TABLE SGFILIAL ALTER COLUMN CEPFILIAL POSITION 12;

ALTER TABLE SGFILIAL ALTER COLUMN CIDFILIAL POSITION 13;

ALTER TABLE SGFILIAL ALTER COLUMN UFFILIAL POSITION 14;

ALTER TABLE SGFILIAL ALTER COLUMN DDDFILIAL POSITION 15;

ALTER TABLE SGFILIAL ALTER COLUMN FONEFILIAL POSITION 16;

ALTER TABLE SGFILIAL ALTER COLUMN FAXFILIAL POSITION 17;

ALTER TABLE SGFILIAL ALTER COLUMN EMAILFILIAL POSITION 18;

ALTER TABLE SGFILIAL ALTER COLUMN WWWFILIAL POSITION 19;

ALTER TABLE SGFILIAL ALTER COLUMN CODDISTFILIAL POSITION 20;

ALTER TABLE SGFILIAL ALTER COLUMN PERCPISFILIAL POSITION 21;

ALTER TABLE SGFILIAL ALTER COLUMN PERCCOFINSFILIAL POSITION 22;

ALTER TABLE SGFILIAL ALTER COLUMN PERCIRFILIAL POSITION 23;

ALTER TABLE SGFILIAL ALTER COLUMN PERCCSOCIALFILIAL POSITION 24;

ALTER TABLE SGFILIAL ALTER COLUMN SIMPLESFILIAL POSITION 25;

ALTER TABLE SGFILIAL ALTER COLUMN PERCSIMPLESFILIAL POSITION 26;

ALTER TABLE SGFILIAL ALTER COLUMN CODMUNIC POSITION 27;

ALTER TABLE SGFILIAL ALTER COLUMN SIGLAUF POSITION 28;

ALTER TABLE SGFILIAL ALTER COLUMN CODPAIS POSITION 29;

ALTER TABLE SGFILIAL ALTER COLUMN CODEMPUC POSITION 30;

ALTER TABLE SGFILIAL ALTER COLUMN CODFILIALUC POSITION 31;

ALTER TABLE SGFILIAL ALTER COLUMN CODUNIFCOD POSITION 32;

ALTER TABLE SGFILIAL ALTER COLUMN INSCMUNFILIAL POSITION 33;

ALTER TABLE SGFILIAL ALTER COLUMN CNAEFILIAL POSITION 34;

ALTER TABLE SGFILIAL ALTER COLUMN PERCISSFILIAL POSITION 35;

ALTER TABLE SGFILIAL ALTER COLUMN CONTRIBIPIFILIAL POSITION 36;

ALTER TABLE SGFILIAL ALTER COLUMN TIMBREFILIAL POSITION 37;

ALTER TABLE SGFILIAL ALTER COLUMN PERFILFILIAL POSITION 38;

ALTER TABLE SGFILIAL ALTER COLUMN PERFILEPC POSITION 39;

ALTER TABLE SGFILIAL ALTER COLUMN INDATIVFILIAL POSITION 40;

ALTER TABLE SGFILIAL ALTER COLUMN INDATIVEPC POSITION 41;

ALTER TABLE SGFILIAL ALTER COLUMN INDNATPJFILIAL POSITION 42;

ALTER TABLE SGFILIAL ALTER COLUMN CODEMPCO POSITION 43;

ALTER TABLE SGFILIAL ALTER COLUMN CODFILIALCO POSITION 44;

ALTER TABLE SGFILIAL ALTER COLUMN CODFOR POSITION 45;

ALTER TABLE SGFILIAL ALTER COLUMN SUFRAMA POSITION 46;

ALTER TABLE SGFILIAL ALTER COLUMN CODINCTRIB POSITION 47;

ALTER TABLE SGFILIAL ALTER COLUMN INDAPROCRED POSITION 48;

ALTER TABLE SGFILIAL ALTER COLUMN CODTIPOCONT POSITION 49;

ALTER TABLE SGFILIAL ALTER COLUMN INDREGCUM POSITION 50;

ALTER TABLE SGFILIAL ALTER COLUMN UNIDFRANQUEADA POSITION 51;

ALTER TABLE SGFILIAL ALTER COLUMN MARCAFRANQUEADORA POSITION 52;

ALTER TABLE SGFILIAL ALTER COLUMN WWWFRANQUEADORA POSITION 53;

ALTER TABLE SGFILIAL ALTER COLUMN CODRECEITA POSITION 54;

ALTER TABLE SGFILIAL ALTER COLUMN LOGOPREFEITURA POSITION 55;

ALTER TABLE SGFILIAL ALTER COLUMN LOGOFILIAL POSITION 56;

ALTER TABLE SGFILIAL ALTER COLUMN REGISTRO POSITION 57;

ALTER TABLE SGFILIAL ALTER COLUMN DTREGISTRO POSITION 58;

ALTER TABLE SGFILIAL ALTER COLUMN HREGISTRO POSITION 59;

ALTER TABLE SGFILIAL ALTER COLUMN DTINS POSITION 60;

ALTER TABLE SGFILIAL ALTER COLUMN HINS POSITION 61;

ALTER TABLE SGFILIAL ALTER COLUMN IDUSUINS POSITION 62;

ALTER TABLE SGFILIAL ALTER COLUMN DTALT POSITION 63;

ALTER TABLE SGFILIAL ALTER COLUMN HALT POSITION 64;

ALTER TABLE SGFILIAL ALTER COLUMN IDUSUALT POSITION 65;

ALTER TABLE SGIMAGEM ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGIMAGEM ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGIMAGEM ALTER COLUMN CODIMG POSITION 3;

ALTER TABLE SGIMAGEM ALTER COLUMN DESCIMG POSITION 4;

ALTER TABLE SGIMAGEM ALTER COLUMN CODEMPCI POSITION 5;

ALTER TABLE SGIMAGEM ALTER COLUMN CODFILIALCI POSITION 6;

ALTER TABLE SGIMAGEM ALTER COLUMN CODCATIMG POSITION 7;

ALTER TABLE SGIMAGEM ALTER COLUMN BINIMG POSITION 8;

ALTER TABLE SGIMAGEM ALTER COLUMN FORMATOIMG POSITION 9;

ALTER TABLE SGIMAGEM ALTER COLUMN DTINS POSITION 10;

ALTER TABLE SGIMAGEM ALTER COLUMN HINS POSITION 11;

ALTER TABLE SGIMAGEM ALTER COLUMN IDUSUINS POSITION 12;

ALTER TABLE SGIMAGEM ALTER COLUMN DTALT POSITION 13;

ALTER TABLE SGIMAGEM ALTER COLUMN HALT POSITION 14;

ALTER TABLE SGIMAGEM ALTER COLUMN IDUSUALT POSITION 15;

ALTER TABLE SGIMPRESSORA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGIMPRESSORA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGIMPRESSORA ALTER COLUMN CODIMP POSITION 3;

ALTER TABLE SGIMPRESSORA ALTER COLUMN DESCIMP POSITION 4;

ALTER TABLE SGIMPRESSORA ALTER COLUMN TIPOIMP POSITION 5;

ALTER TABLE SGIMPRESSORA ALTER COLUMN CODEMPMD POSITION 6;

ALTER TABLE SGIMPRESSORA ALTER COLUMN CODFILIALMD POSITION 7;

ALTER TABLE SGIMPRESSORA ALTER COLUMN CODMODDOCFISC POSITION 8;

ALTER TABLE SGIMPRESSORA ALTER COLUMN LINPAGIMP POSITION 9;

ALTER TABLE SGIMPRESSORA ALTER COLUMN NSERIEIMP POSITION 10;

ALTER TABLE SGIMPRESSORA ALTER COLUMN PORTAWINIMP POSITION 11;

ALTER TABLE SGIMPRESSORA ALTER COLUMN PORTALINIMP POSITION 12;

ALTER TABLE SGIMPRESSORA ALTER COLUMN CODEMPPL POSITION 13;

ALTER TABLE SGIMPRESSORA ALTER COLUMN CODFILIALPL POSITION 14;

ALTER TABLE SGIMPRESSORA ALTER COLUMN CODPAPEL POSITION 15;

ALTER TABLE SGIMPRESSORA ALTER COLUMN DESTIMP POSITION 16;

ALTER TABLE SGIMPRESSORA ALTER COLUMN MODELOIMP POSITION 17;

ALTER TABLE SGIMPRESSORA ALTER COLUMN DTINS POSITION 18;

ALTER TABLE SGIMPRESSORA ALTER COLUMN HINS POSITION 19;

ALTER TABLE SGIMPRESSORA ALTER COLUMN IDUSUINS POSITION 20;

ALTER TABLE SGIMPRESSORA ALTER COLUMN DTALT POSITION 21;

ALTER TABLE SGIMPRESSORA ALTER COLUMN HALT POSITION 22;

ALTER TABLE SGIMPRESSORA ALTER COLUMN IDUSUALT POSITION 23;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODEMPBO POSITION 3;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODFILIALBO POSITION 4;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODBANCO POSITION 5;

ALTER TABLE SGITPREFERE6 ALTER COLUMN TIPOFEBRABAN POSITION 6;

ALTER TABLE SGITPREFERE6 ALTER COLUMN MDECOB POSITION 7;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODCONV POSITION 8;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CONVCOB POSITION 9;

ALTER TABLE SGITPREFERE6 ALTER COLUMN VERLAYOUT POSITION 10;

ALTER TABLE SGITPREFERE6 ALTER COLUMN IDENTSERV POSITION 11;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CONTACOMPR POSITION 12;

ALTER TABLE SGITPREFERE6 ALTER COLUMN IDENTAMBCLI POSITION 13;

ALTER TABLE SGITPREFERE6 ALTER COLUMN IDENTAMBBCO POSITION 14;

ALTER TABLE SGITPREFERE6 ALTER COLUMN NROSEQ POSITION 15;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODEMPCA POSITION 16;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODFILIALCA POSITION 17;

ALTER TABLE SGITPREFERE6 ALTER COLUMN NUMCONTA POSITION 18;

ALTER TABLE SGITPREFERE6 ALTER COLUMN FORCADTIT POSITION 19;

ALTER TABLE SGITPREFERE6 ALTER COLUMN TIPODOC POSITION 20;

ALTER TABLE SGITPREFERE6 ALTER COLUMN IDENTEMITBOL POSITION 21;

ALTER TABLE SGITPREFERE6 ALTER COLUMN IDENTDISTBOL POSITION 22;

ALTER TABLE SGITPREFERE6 ALTER COLUMN ESPECTIT POSITION 23;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODJUROS POSITION 24;

ALTER TABLE SGITPREFERE6 ALTER COLUMN VLRPERCJUROS POSITION 25;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODDESC POSITION 26;

ALTER TABLE SGITPREFERE6 ALTER COLUMN VLRPERCDESC POSITION 27;

ALTER TABLE SGITPREFERE6 ALTER COLUMN VLRPERCMULTA POSITION 28;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODPROT POSITION 29;

ALTER TABLE SGITPREFERE6 ALTER COLUMN DIASPROT POSITION 30;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODBAIXADEV POSITION 31;

ALTER TABLE SGITPREFERE6 ALTER COLUMN DIASBAIXADEV POSITION 32;

ALTER TABLE SGITPREFERE6 ALTER COLUMN ACEITE POSITION 33;

ALTER TABLE SGITPREFERE6 ALTER COLUMN PADRAOCNAB POSITION 34;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CAMINHOREMESSA POSITION 35;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CAMINHORETORNO POSITION 36;

ALTER TABLE SGITPREFERE6 ALTER COLUMN BACKUPREMESSA POSITION 37;

ALTER TABLE SGITPREFERE6 ALTER COLUMN BACKUPRETORNO POSITION 38;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODINSTR POSITION 39;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CODOUTINSTR POSITION 40;

ALTER TABLE SGITPREFERE6 ALTER COLUMN PADRAOSIACC POSITION 41;

ALTER TABLE SGITPREFERE6 ALTER COLUMN CONSISTERETORNO POSITION 42;

ALTER TABLE SGITPREFERE6 ALTER COLUMN DTINS POSITION 43;

ALTER TABLE SGITPREFERE6 ALTER COLUMN HINS POSITION 44;

ALTER TABLE SGITPREFERE6 ALTER COLUMN IDUSUINS POSITION 45;

ALTER TABLE SGITPREFERE6 ALTER COLUMN DTALT POSITION 46;

ALTER TABLE SGITPREFERE6 ALTER COLUMN HALT POSITION 47;

ALTER TABLE SGITPREFERE6 ALTER COLUMN IDUSUALT POSITION 48;

ALTER TABLE SGMODETIQUETA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGMODETIQUETA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGMODETIQUETA ALTER COLUMN CODMODETIQ POSITION 3;

ALTER TABLE SGMODETIQUETA ALTER COLUMN DESCMODETIQ POSITION 4;

ALTER TABLE SGMODETIQUETA ALTER COLUMN TIPOETIQ POSITION 5;

ALTER TABLE SGMODETIQUETA ALTER COLUMN NCOLMODETIQ POSITION 6;

ALTER TABLE SGMODETIQUETA ALTER COLUMN EECMODETIQ POSITION 7;

ALTER TABLE SGMODETIQUETA ALTER COLUMN TXAMODETIQ POSITION 8;

ALTER TABLE SGMODETIQUETA ALTER COLUMN CODEMPPL POSITION 9;

ALTER TABLE SGMODETIQUETA ALTER COLUMN CODFILIALPL POSITION 10;

ALTER TABLE SGMODETIQUETA ALTER COLUMN CODPAPEL POSITION 11;

ALTER TABLE SGMODETIQUETA ALTER COLUMN CODEMPCI POSITION 12;

ALTER TABLE SGMODETIQUETA ALTER COLUMN CODFILIALCI POSITION 13;

ALTER TABLE SGMODETIQUETA ALTER COLUMN CODCATIMG POSITION 14;

ALTER TABLE SGMODETIQUETA ALTER COLUMN COMPRIMIDO POSITION 15;

ALTER TABLE SGMODETIQUETA ALTER COLUMN POSSCRIPT POSITION 16;

ALTER TABLE SGMODETIQUETA ALTER COLUMN MODETIQ POSITION 17;

ALTER TABLE SGMODETIQUETA ALTER COLUMN BLOQIMPVISUAL POSITION 18;

ALTER TABLE SGMODETIQUETA ALTER COLUMN IMPSUMARIZADA POSITION 19;

ALTER TABLE SGMODETIQUETA ALTER COLUMN BLOQREIMP POSITION 20;

ALTER TABLE SGMODETIQUETA ALTER COLUMN NOMEIMPRESSORA POSITION 21;

ALTER TABLE SGMODETIQUETA ALTER COLUMN EXECCMDIMPPADRAO POSITION 22;

ALTER TABLE SGMODETIQUETA ALTER COLUMN DTINS POSITION 23;

ALTER TABLE SGMODETIQUETA ALTER COLUMN HINS POSITION 24;

ALTER TABLE SGMODETIQUETA ALTER COLUMN IDUSUINS POSITION 25;

ALTER TABLE SGMODETIQUETA ALTER COLUMN DTALT POSITION 26;

ALTER TABLE SGMODETIQUETA ALTER COLUMN HALT POSITION 27;

ALTER TABLE SGMODETIQUETA ALTER COLUMN IDUSUALT POSITION 28;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAREFPROD POSITION 3;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV POSITION 4;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTM POSITION 5;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTM POSITION 6;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAPEDSEQ POSITION 7;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAORCSEQ POSITION 8;

ALTER TABLE SGPREFERE1 ALTER COLUMN FILTRO POSITION 9;

ALTER TABLE SGPREFERE1 ALTER COLUMN USALIQREL POSITION 10;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOPRECOCUSTO POSITION 11;

ALTER TABLE SGPREFERE1 ALTER COLUMN ANOCENTROCUSTO POSITION 12;

ALTER TABLE SGPREFERE1 ALTER COLUMN ANOPLAN POSITION 13;

ALTER TABLE SGPREFERE1 ALTER COLUMN OBSORCPAD POSITION 14;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV2 POSITION 15;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT2 POSITION 16;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT2 POSITION 17;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLASSORC POSITION 18;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLASSORCPD POSITION 19;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLASSORCLAUDOSUS POSITION 20;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLASSORCCTALUGUEL POSITION 21;

ALTER TABLE SGPREFERE1 ALTER COLUMN TITORCTXT01 POSITION 22;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV3 POSITION 23;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT3 POSITION 24;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT3 POSITION 25;

ALTER TABLE SGPREFERE1 ALTER COLUMN ORDNOTA POSITION 26;

ALTER TABLE SGPREFERE1 ALTER COLUMN SETORVENDA POSITION 27;

ALTER TABLE SGPREFERE1 ALTER COLUMN PREFCRED POSITION 28;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOPREFCRED POSITION 29;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPMO POSITION 30;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALMO POSITION 31;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODMOEDA POSITION 32;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV4 POSITION 33;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT4 POSITION 34;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT4 POSITION 35;

ALTER TABLE SGPREFERE1 ALTER COLUMN USACLASCOMIS POSITION 36;

ALTER TABLE SGPREFERE1 ALTER COLUMN PERCPRECOCUSTO POSITION 37;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODGRUP POSITION 38;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALGP POSITION 39;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPGP POSITION 40;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODMARCA POSITION 41;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALMC POSITION 42;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPMC POSITION 43;

ALTER TABLE SGPREFERE1 ALTER COLUMN RGCLIOBRIG POSITION 44;

ALTER TABLE SGPREFERE1 ALTER COLUMN TABFRETEVD POSITION 45;

ALTER TABLE SGPREFERE1 ALTER COLUMN TABADICVD POSITION 46;

ALTER TABLE SGPREFERE1 ALTER COLUMN TRAVATMNFVD POSITION 47;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOVALIDORC POSITION 48;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLIMESMOCNPJ POSITION 49;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTBJ POSITION 50;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTJ POSITION 51;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTJ POSITION 52;

ALTER TABLE SGPREFERE1 ALTER COLUMN CNPJOBRIGCLI POSITION 53;

ALTER TABLE SGPREFERE1 ALTER COLUMN JUROSPOSCALC POSITION 54;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPFR POSITION 55;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALFR POSITION 56;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFOR POSITION 57;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTN POSITION 58;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTN POSITION 59;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTRAN POSITION 60;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTF POSITION 61;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTF POSITION 62;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOFOR POSITION 63;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT5 POSITION 64;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT5 POSITION 65;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV5 POSITION 66;

ALTER TABLE SGPREFERE1 ALTER COLUMN ESTLOTNEG POSITION 67;

ALTER TABLE SGPREFERE1 ALTER COLUMN ESTNEG POSITION 68;

ALTER TABLE SGPREFERE1 ALTER COLUMN NATVENDA POSITION 69;

ALTER TABLE SGPREFERE1 ALTER COLUMN IPIVENDA POSITION 70;

ALTER TABLE SGPREFERE1 ALTER COLUMN CUSTOSICMS POSITION 71;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPPG POSITION 72;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALPG POSITION 73;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANOPAG POSITION 74;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTB POSITION 75;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTB POSITION 76;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTAB POSITION 77;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPCE POSITION 78;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALCE POSITION 79;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODCLASCLI POSITION 80;

ALTER TABLE SGPREFERE1 ALTER COLUMN CASASDEC POSITION 81;

ALTER TABLE SGPREFERE1 ALTER COLUMN CASASDECFIN POSITION 82;

ALTER TABLE SGPREFERE1 ALTER COLUMN COMISPDUPL POSITION 83;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT6 POSITION 84;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT6 POSITION 85;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV6 POSITION 86;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQVENDA POSITION 87;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQCOMPRA POSITION 88;

ALTER TABLE SGPREFERE1 ALTER COLUMN VENDAMATPRIM POSITION 89;

ALTER TABLE SGPREFERE1 ALTER COLUMN VENDAPATRIM POSITION 90;

ALTER TABLE SGPREFERE1 ALTER COLUMN PEPSPROD POSITION 91;

ALTER TABLE SGPREFERE1 ALTER COLUMN CNPJFOROBRIG POSITION 92;

ALTER TABLE SGPREFERE1 ALTER COLUMN INSCESTFOROBRIG POSITION 93;

ALTER TABLE SGPREFERE1 ALTER COLUMN BUSCAPRODSIMILAR POSITION 94;

ALTER TABLE SGPREFERE1 ALTER COLUMN MULTIALMOX POSITION 95;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT8 POSITION 96;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT8 POSITION 97;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV8 POSITION 98;

ALTER TABLE SGPREFERE1 ALTER COLUMN ESTNEGGRUP POSITION 99;

ALTER TABLE SGPREFERE1 ALTER COLUMN USATABPE POSITION 100;

ALTER TABLE SGPREFERE1 ALTER COLUMN TAMDESCPROD POSITION 101;

ALTER TABLE SGPREFERE1 ALTER COLUMN DESCCOMPPED POSITION 102;

ALTER TABLE SGPREFERE1 ALTER COLUMN OBSCLIVEND POSITION 103;

ALTER TABLE SGPREFERE1 ALTER COLUMN MAXOBSCLI POSITION 104;

ALTER TABLE SGPREFERE1 ALTER COLUMN CONTESTOQ POSITION 105;

ALTER TABLE SGPREFERE1 ALTER COLUMN DIASPEDT POSITION 106;

ALTER TABLE SGPREFERE1 ALTER COLUMN RECALCPCVENDA POSITION 107;

ALTER TABLE SGPREFERE1 ALTER COLUMN RECALCPCORC POSITION 108;

ALTER TABLE SGPREFERE1 ALTER COLUMN USALAYOUTPED POSITION 109;

ALTER TABLE SGPREFERE1 ALTER COLUMN VERIFALTPARCVENDA POSITION 110;

ALTER TABLE SGPREFERE1 ALTER COLUMN BUSCACODPRODGEN POSITION 111;

ALTER TABLE SGPREFERE1 ALTER COLUMN FILBUSCGENPROD POSITION 112;

ALTER TABLE SGPREFERE1 ALTER COLUMN FILBUSCGENREF POSITION 113;

ALTER TABLE SGPREFERE1 ALTER COLUMN FILBUSCGENCODBAR POSITION 114;

ALTER TABLE SGPREFERE1 ALTER COLUMN FILBUSCGENCODFAB POSITION 115;

ALTER TABLE SGPREFERE1 ALTER COLUMN FILBUSCGENCODFOR POSITION 116;

ALTER TABLE SGPREFERE1 ALTER COLUMN BUSCAVLRULTCOMPRA POSITION 117;

ALTER TABLE SGPREFERE1 ALTER COLUMN ICMSVENDA POSITION 118;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAPRECOZERO POSITION 119;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAIMGASSORC POSITION 120;

ALTER TABLE SGPREFERE1 ALTER COLUMN IMGASSORC POSITION 121;

ALTER TABLE SGPREFERE1 ALTER COLUMN CONSISTCPFCLI POSITION 122;

ALTER TABLE SGPREFERE1 ALTER COLUMN CONSISTEIECLI POSITION 123;

ALTER TABLE SGPREFERE1 ALTER COLUMN CONSISTEIEFOR POSITION 124;

ALTER TABLE SGPREFERE1 ALTER COLUMN CONSISTECPFFOR POSITION 125;

ALTER TABLE SGPREFERE1 ALTER COLUMN USANOMEVENDORC POSITION 126;

ALTER TABLE SGPREFERE1 ALTER COLUMN SISCONTABIL POSITION 127;

ALTER TABLE SGPREFERE1 ALTER COLUMN ATBANCOIMPBOL POSITION 128;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOCODBAR POSITION 129;

ALTER TABLE SGPREFERE1 ALTER COLUMN ADICORCOBSPED POSITION 130;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPMENSORC POSITION 131;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALMENSORC POSITION 132;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODMENSORC POSITION 133;

ALTER TABLE SGPREFERE1 ALTER COLUMN CUSTOCOMPRA POSITION 134;

ALTER TABLE SGPREFERE1 ALTER COLUMN TABTRANSPCP POSITION 135;

ALTER TABLE SGPREFERE1 ALTER COLUMN TABTRANSPORC POSITION 136;

ALTER TABLE SGPREFERE1 ALTER COLUMN TABSOLCP POSITION 137;

ALTER TABLE SGPREFERE1 ALTER COLUMN ADICFRETEBASEICM POSITION 138;

ALTER TABLE SGPREFERE1 ALTER COLUMN PRECOCPREL POSITION 139;

ALTER TABLE SGPREFERE1 ALTER COLUMN DESCORC POSITION 140;

ALTER TABLE SGPREFERE1 ALTER COLUMN MULTICOMIS POSITION 141;

ALTER TABLE SGPREFERE1 ALTER COLUMN USUATIVCLI POSITION 142;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPHISTREC POSITION 143;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALHISTREC POSITION 144;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODHISTREC POSITION 145;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPHISTPAG POSITION 146;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALHISTPAG POSITION 147;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODHISTPAG POSITION 148;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTC POSITION 149;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTC POSITION 150;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOCLI POSITION 151;

ALTER TABLE SGPREFERE1 ALTER COLUMN ESTITRECALTDTVENC POSITION 152;

ALTER TABLE SGPREFERE1 ALTER COLUMN LCREDGLOBAL POSITION 153;

ALTER TABLE SGPREFERE1 ALTER COLUMN VDMANUTCOMOBRIG POSITION 154;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLASSPED POSITION 155;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLASSPED02 POSITION 156;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOCLASSPED POSITION 157;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAIBGECLI POSITION 158;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAIBGEFOR POSITION 159;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAIBGETRANSP POSITION 160;

ALTER TABLE SGPREFERE1 ALTER COLUMN SOMAVOLUMES POSITION 161;

ALTER TABLE SGPREFERE1 ALTER COLUMN BUSCACEP POSITION 162;

ALTER TABLE SGPREFERE1 ALTER COLUMN URLWSCEP POSITION 163;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLASSCP POSITION 164;

ALTER TABLE SGPREFERE1 ALTER COLUMN LABELOBS01CP POSITION 165;

ALTER TABLE SGPREFERE1 ALTER COLUMN LABELOBS02CP POSITION 166;

ALTER TABLE SGPREFERE1 ALTER COLUMN LABELOBS03CP POSITION 167;

ALTER TABLE SGPREFERE1 ALTER COLUMN LABELOBS04CP POSITION 168;

ALTER TABLE SGPREFERE1 ALTER COLUMN CONSISTEIEPF POSITION 169;

ALTER TABLE SGPREFERE1 ALTER COLUMN CREDICMSSIMPLES POSITION 170;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPMS POSITION 171;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALMS POSITION 172;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODMENSICMSSIMPLES POSITION 173;

ALTER TABLE SGPREFERE1 ALTER COLUMN GERACOMISVENDAORC POSITION 174;

ALTER TABLE SGPREFERE1 ALTER COLUMN GERACODUNIF POSITION 175;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV9 POSITION 176;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT9 POSITION 177;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT9 POSITION 178;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPMP POSITION 179;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALMP POSITION 180;

ALTER TABLE SGPREFERE1 ALTER COLUMN ANOPLANMP POSITION 181;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANMP POSITION 182;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPJP POSITION 183;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALJP POSITION 184;

ALTER TABLE SGPREFERE1 ALTER COLUMN ANOPLANJP POSITION 185;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANJP POSITION 186;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPMR POSITION 187;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALMR POSITION 188;

ALTER TABLE SGPREFERE1 ALTER COLUMN ANOPLANMR POSITION 189;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANMR POSITION 190;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPJR POSITION 191;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALJR POSITION 192;

ALTER TABLE SGPREFERE1 ALTER COLUMN ANOPLANJR POSITION 193;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANJR POSITION 194;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPDR POSITION 195;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALDR POSITION 196;

ALTER TABLE SGPREFERE1 ALTER COLUMN ANOPLANDR POSITION 197;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANDR POSITION 198;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPDC POSITION 199;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALDC POSITION 200;

ALTER TABLE SGPREFERE1 ALTER COLUMN ANOPLANDC POSITION 201;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANDC POSITION 202;

ALTER TABLE SGPREFERE1 ALTER COLUMN GERAPAGEMIS POSITION 203;

ALTER TABLE SGPREFERE1 ALTER COLUMN LANCAFINCONTR POSITION 204;

ALTER TABLE SGPREFERE1 ALTER COLUMN LANCARMACONTR POSITION 205;

ALTER TABLE SGPREFERE1 ALTER COLUMN CASASDECPRE POSITION 206;

ALTER TABLE SGPREFERE1 ALTER COLUMN VISUALIZALUCR POSITION 207;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLASSNFE POSITION 208;

ALTER TABLE SGPREFERE1 ALTER COLUMN DIRNFE POSITION 209;

ALTER TABLE SGPREFERE1 ALTER COLUMN DIRNFELIN POSITION 210;

ALTER TABLE SGPREFERE1 ALTER COLUMN FORMATODANFE POSITION 211;

ALTER TABLE SGPREFERE1 ALTER COLUMN FORMATODANFENFCE POSITION 212;

ALTER TABLE SGPREFERE1 ALTER COLUMN AMBIENTENFE POSITION 213;

ALTER TABLE SGPREFERE1 ALTER COLUMN PROCEMINFE POSITION 214;

ALTER TABLE SGPREFERE1 ALTER COLUMN VERPROCNFE POSITION 215;

ALTER TABLE SGPREFERE1 ALTER COLUMN KEYLICNFE POSITION 216;

ALTER TABLE SGPREFERE1 ALTER COLUMN DTVENCTONFE POSITION 217;

ALTER TABLE SGPREFERE1 ALTER COLUMN INFADPRODNFE POSITION 218;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPNF POSITION 219;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALNF POSITION 220;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMAILNF POSITION 221;

ALTER TABLE SGPREFERE1 ALTER COLUMN EXIBEPARCOBSDANFE POSITION 222;

ALTER TABLE SGPREFERE1 ALTER COLUMN VERSAONFE POSITION 223;

ALTER TABLE SGPREFERE1 ALTER COLUMN REGIMETRIBNFE POSITION 224;

ALTER TABLE SGPREFERE1 ALTER COLUMN INFCPDEVOLUCAO POSITION 225;

ALTER TABLE SGPREFERE1 ALTER COLUMN INFVDREMESSA POSITION 226;

ALTER TABLE SGPREFERE1 ALTER COLUMN GERARECEMIS POSITION 227;

ALTER TABLE SGPREFERE1 ALTER COLUMN RETENSAOIMP POSITION 228;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOCUSTOLUC POSITION 229;

ALTER TABLE SGPREFERE1 ALTER COLUMN TABIMPORTCP POSITION 230;

ALTER TABLE SGPREFERE1 ALTER COLUMN HABVLRTOTITORC POSITION 231;

ALTER TABLE SGPREFERE1 ALTER COLUMN USABUSCAGENPRODCP POSITION 232;

ALTER TABLE SGPREFERE1 ALTER COLUMN ADICOBSORCPED POSITION 233;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAPRECOCOT POSITION 234;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQPRECOAPROV POSITION 235;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPFT POSITION 236;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALFT POSITION 237;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOFORFT POSITION 238;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAPRECOCOMIS POSITION 239;

ALTER TABLE SGPREFERE1 ALTER COLUMN ESPECIALCOMIS POSITION 240;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTS POSITION 241;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOVS POSITION 242;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTS POSITION 243;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPSV POSITION 244;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALSV POSITION 245;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANOPAGSV POSITION 246;

ALTER TABLE SGPREFERE1 ALTER COLUMN ARREDPRECO POSITION 247;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPPC POSITION 248;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALPC POSITION 249;

ALTER TABLE SGPREFERE1 ALTER COLUMN ANOPLANPC POSITION 250;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANPC POSITION 251;

ALTER TABLE SGPREFERE1 ALTER COLUMN TPNOSSONUMERO POSITION 252;

ALTER TABLE SGPREFERE1 ALTER COLUMN IMPDOCBOL POSITION 253;

ALTER TABLE SGPREFERE1 ALTER COLUMN FECHACAIXA POSITION 254;

ALTER TABLE SGPREFERE1 ALTER COLUMN FECHACAIXAAUTO POSITION 255;

ALTER TABLE SGPREFERE1 ALTER COLUMN NUMDIGIDENTTIT POSITION 256;

ALTER TABLE SGPREFERE1 ALTER COLUMN KEYLICEFD POSITION 257;

ALTER TABLE SGPREFERE1 ALTER COLUMN DTVENCTOEFD POSITION 258;

ALTER TABLE SGPREFERE1 ALTER COLUMN REVALIDARLOTECOMPRA POSITION 259;

ALTER TABLE SGPREFERE1 ALTER COLUMN ENCORCPROD POSITION 260;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPIM POSITION 261;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALIM POSITION 262;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOVIM POSITION 263;

ALTER TABLE SGPREFERE1 ALTER COLUMN COMISSAODESCONTO POSITION 264;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPHC POSITION 265;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALHC POSITION 266;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODHISTCNAB POSITION 267;

ALTER TABLE SGPREFERE1 ALTER COLUMN ALINHATELALANCA POSITION 268;

ALTER TABLE SGPREFERE1 ALTER COLUMN VENDACONSUM POSITION 269;

ALTER TABLE SGPREFERE1 ALTER COLUMN CVPROD POSITION 270;

ALTER TABLE SGPREFERE1 ALTER COLUMN VERIFPROD POSITION 271;

ALTER TABLE SGPREFERE1 ALTER COLUMN RMAPROD POSITION 272;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOPROD POSITION 273;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPIG POSITION 274;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALIG POSITION 275;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODIMG POSITION 276;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPIP POSITION 277;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALIP POSITION 278;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODIMGPD POSITION 279;

ALTER TABLE SGPREFERE1 ALTER COLUMN OBSITVENDAPED POSITION 280;

ALTER TABLE SGPREFERE1 ALTER COLUMN FATORCPARC POSITION 281;

ALTER TABLE SGPREFERE1 ALTER COLUMN APROVORCFATPARC POSITION 282;

ALTER TABLE SGPREFERE1 ALTER COLUMN ALTQTDFATPARC POSITION 283;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQSEQICP POSITION 284;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQSEQIVD POSITION 285;

ALTER TABLE SGPREFERE1 ALTER COLUMN UTILORDCPINT POSITION 286;

ALTER TABLE SGPREFERE1 ALTER COLUMN KEYLICEPC POSITION 287;

ALTER TABLE SGPREFERE1 ALTER COLUMN DTVENCTOEPC POSITION 288;

ALTER TABLE SGPREFERE1 ALTER COLUMN IMPLOTENFE POSITION 289;

ALTER TABLE SGPREFERE1 ALTER COLUMN TOTCPSFRETE POSITION 290;

ALTER TABLE SGPREFERE1 ALTER COLUMN IDENTCLIBCO POSITION 291;

ALTER TABLE SGPREFERE1 ALTER COLUMN QTDDESC POSITION 292;

ALTER TABLE SGPREFERE1 ALTER COLUMN LOCALSERV POSITION 293;

ALTER TABLE SGPREFERE1 ALTER COLUMN VDPRODQQCLAS POSITION 294;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPVD POSITION 295;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALVD POSITION 296;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODVEND POSITION 297;

ALTER TABLE SGPREFERE1 ALTER COLUMN PADRAONFE POSITION 298;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPME POSITION 299;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALME POSITION 300;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODMENSVENDA POSITION 301;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOEMISSAONFE POSITION 302;

ALTER TABLE SGPREFERE1 ALTER COLUMN CCNFECP POSITION 303;

ALTER TABLE SGPREFERE1 ALTER COLUMN ADICICMSTOTNOTA POSITION 304;

ALTER TABLE SGPREFERE1 ALTER COLUMN UTILIZATBCALCCA POSITION 305;

ALTER TABLE SGPREFERE1 ALTER COLUMN HABCOMPRACOMPL POSITION 306;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPIC POSITION 307;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALIC POSITION 308;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOVIC POSITION 309;

ALTER TABLE SGPREFERE1 ALTER COLUMN DESCNATCOMPL POSITION 310;

ALTER TABLE SGPREFERE1 ALTER COLUMN HABLOGPAGAR POSITION 311;

ALTER TABLE SGPREFERE1 ALTER COLUMN HABLOGRECEBER POSITION 312;

ALTER TABLE SGPREFERE1 ALTER COLUMN CONSISTENDENTVD POSITION 313;

ALTER TABLE SGPREFERE1 ALTER COLUMN USACLISEQ POSITION 314;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQDESCCOMPORC POSITION 315;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQPRECOORC POSITION 316;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQDESCCOMPVD POSITION 317;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQPRECOVD POSITION 318;

ALTER TABLE SGPREFERE1 ALTER COLUMN DESABDESCFECHAVD POSITION 319;

ALTER TABLE SGPREFERE1 ALTER COLUMN DESABDESCFECHAORC POSITION 320;

ALTER TABLE SGPREFERE1 ALTER COLUMN PERMITBAIXAPARCJDM POSITION 321;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQCOMISSORC POSITION 322;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQCOMISSVD POSITION 323;

ALTER TABLE SGPREFERE1 ALTER COLUMN CALCPRECOG POSITION 324;

ALTER TABLE SGPREFERE1 ALTER COLUMN ENDERECOOBRIGCLI POSITION 325;

ALTER TABLE SGPREFERE1 ALTER COLUMN ENTREGAOBRIGCLI POSITION 326;

ALTER TABLE SGPREFERE1 ALTER COLUMN PERIODOCONSCH POSITION 327;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQPEDVD POSITION 328;

ALTER TABLE SGPREFERE1 ALTER COLUMN AGENDAFPRINCIPAL POSITION 329;

ALTER TABLE SGPREFERE1 ALTER COLUMN ATUALIZAAGENDA POSITION 330;

ALTER TABLE SGPREFERE1 ALTER COLUMN TEMPOATUAGENDA POSITION 331;

ALTER TABLE SGPREFERE1 ALTER COLUMN SOLDTSAIDA POSITION 332;

ALTER TABLE SGPREFERE1 ALTER COLUMN NPERMITDTMAIOR POSITION 333;

ALTER TABLE SGPREFERE1 ALTER COLUMN PERMITIMPORCANTAP POSITION 334;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQEDITORCAPOSAP POSITION 335;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQVDPORATRASO POSITION 336;

ALTER TABLE SGPREFERE1 ALTER COLUMN NUMDIASBLOQVD POSITION 337;

ALTER TABLE SGPREFERE1 ALTER COLUMN FATORSEGESTOQ POSITION 338;

ALTER TABLE SGPREFERE1 ALTER COLUMN LEITRANSP POSITION 339;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOIMPDANFE POSITION 340;

ALTER TABLE SGPREFERE1 ALTER COLUMN REPLICAORC POSITION 341;

ALTER TABLE SGPREFERE1 ALTER COLUMN SQLREPLICAORC POSITION 342;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQNFEVDAUTORIZ POSITION 343;

ALTER TABLE SGPREFERE1 ALTER COLUMN OBRIGTIPOFISC POSITION 344;

ALTER TABLE SGPREFERE1 ALTER COLUMN MATRICEMPFN POSITION 345;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPRS POSITION 346;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALRS POSITION 347;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOVRS POSITION 348;

ALTER TABLE SGPREFERE1 ALTER COLUMN ESTOQALMOX POSITION 349;

ALTER TABLE SGPREFERE1 ALTER COLUMN ALMOXPDORC POSITION 350;

ALTER TABLE SGPREFERE1 ALTER COLUMN RATEIOESTBUSCAORC POSITION 351;

ALTER TABLE SGPREFERE1 ALTER COLUMN OBRIGCCFIN POSITION 352;

ALTER TABLE SGPREFERE1 ALTER COLUMN MOTOBRIGFRETE POSITION 353;

ALTER TABLE SGPREFERE1 ALTER COLUMN VEICOBRIGFRETE POSITION 354;

ALTER TABLE SGPREFERE1 ALTER COLUMN RNTCOBRIGFRETE POSITION 355;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLFISCALATIVA POSITION 356;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLFISCALREGIMEATUAL POSITION 357;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLFISCALVDESPECIFICA POSITION 358;

ALTER TABLE SGPREFERE1 ALTER COLUMN DIFICMSCUSTO POSITION 359;

ALTER TABLE SGPREFERE1 ALTER COLUMN IMPESTRUORC POSITION 360;

ALTER TABLE SGPREFERE1 ALTER COLUMN FORMDANFEPREIMP POSITION 361;

ALTER TABLE SGPREFERE1 ALTER COLUMN DTINS POSITION 362;

ALTER TABLE SGPREFERE1 ALTER COLUMN HINS POSITION 363;

ALTER TABLE SGPREFERE1 ALTER COLUMN IDUSUINS POSITION 364;

ALTER TABLE SGPREFERE1 ALTER COLUMN DTALT POSITION 365;

ALTER TABLE SGPREFERE1 ALTER COLUMN HALT POSITION 366;

ALTER TABLE SGPREFERE1 ALTER COLUMN IDUSUALT POSITION 367;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGPREFERE3 ALTER COLUMN SMTPMAIL POSITION 3;

ALTER TABLE SGPREFERE3 ALTER COLUMN SMTPSSLMAIL POSITION 4;

ALTER TABLE SGPREFERE3 ALTER COLUMN SMTPAUTMAIL POSITION 5;

ALTER TABLE SGPREFERE3 ALTER COLUMN PORTAMAIL POSITION 6;

ALTER TABLE SGPREFERE3 ALTER COLUMN USERMAIL POSITION 7;

ALTER TABLE SGPREFERE3 ALTER COLUMN PASSMAIL POSITION 8;

ALTER TABLE SGPREFERE3 ALTER COLUMN ENDMAIL POSITION 9;

ALTER TABLE SGPREFERE3 ALTER COLUMN AUTOHORATEND POSITION 10;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPCE POSITION 11;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALCE POSITION 12;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODATIVCE POSITION 13;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPTE POSITION 14;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALTE POSITION 15;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODATIVTE POSITION 16;

ALTER TABLE SGPREFERE3 ALTER COLUMN BLOQATENDCLIATRASO POSITION 17;

ALTER TABLE SGPREFERE3 ALTER COLUMN MOSTRACLIATRASO POSITION 18;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPNC POSITION 19;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALNC POSITION 20;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMAILNC POSITION 21;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPAO POSITION 22;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALAO POSITION 23;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODATENDO POSITION 24;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPMI POSITION 25;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALMI POSITION 26;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODMODELMI POSITION 27;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPME POSITION 28;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALME POSITION 29;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODMODELME POSITION 30;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPFI POSITION 31;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALFI POSITION 32;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODMODELFI POSITION 33;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPFJ POSITION 34;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALFJ POSITION 35;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODMODELFJ POSITION 36;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPAP POSITION 37;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALAP POSITION 38;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODMODELAP POSITION 39;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPOR POSITION 40;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALOR POSITION 41;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODMODELOR POSITION 42;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPMC POSITION 43;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALMC POSITION 44;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODMODELMC POSITION 45;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPEC POSITION 46;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALEC POSITION 47;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMAILEC POSITION 48;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPEA POSITION 49;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALEA POSITION 50;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMAILEA POSITION 51;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPT1 POSITION 52;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALT1 POSITION 53;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODTIPOCONT1 POSITION 54;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPT2 POSITION 55;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALT2 POSITION 56;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODTIPOCONT2 POSITION 57;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPCF POSITION 58;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALCF POSITION 59;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODCONFEMAIL POSITION 60;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPC2 POSITION 61;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALC2 POSITION 62;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODCONFEMAIL2 POSITION 63;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPEN POSITION 64;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALEN POSITION 65;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMAILEN POSITION 66;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPE2 POSITION 67;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALE2 POSITION 68;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMAILEN2 POSITION 69;

ALTER TABLE SGPREFERE3 ALTER COLUMN EMAILNOTIF1 POSITION 70;

ALTER TABLE SGPREFERE3 ALTER COLUMN EMAILNOTIF2 POSITION 71;

ALTER TABLE SGPREFERE3 ALTER COLUMN TEMPOMAXINT POSITION 72;

ALTER TABLE SGPREFERE3 ALTER COLUMN LANCAPONTOAF POSITION 73;

ALTER TABLE SGPREFERE3 ALTER COLUMN TOLREGPONTO POSITION 74;

ALTER TABLE SGPREFERE3 ALTER COLUMN USACTOSEQ POSITION 75;

ALTER TABLE SGPREFERE3 ALTER COLUMN LAYOUTFICHAAVAL POSITION 76;

ALTER TABLE SGPREFERE3 ALTER COLUMN LAYOUTPREFICHAAVAL POSITION 77;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPV1 POSITION 78;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALV1 POSITION 79;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODVARG1 POSITION 80;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPV2 POSITION 81;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALV2 POSITION 82;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODVARG2 POSITION 83;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPV3 POSITION 84;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALV3 POSITION 85;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODVARG3 POSITION 86;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPV4 POSITION 87;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALV4 POSITION 88;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODVARG4 POSITION 89;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPV5 POSITION 90;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALV5 POSITION 91;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODVARG5 POSITION 92;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPV6 POSITION 93;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALV6 POSITION 94;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODVARG6 POSITION 95;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPV7 POSITION 96;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALV7 POSITION 97;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODVARG7 POSITION 98;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPV8 POSITION 99;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALV8 POSITION 100;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODVARG8 POSITION 101;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPSR POSITION 102;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALSR POSITION 103;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODSETOR POSITION 104;

ALTER TABLE SGPREFERE3 ALTER COLUMN BLOQATENDIMENTO POSITION 105;

ALTER TABLE SGPREFERE3 ALTER COLUMN PERIODOBLOQ POSITION 106;

ALTER TABLE SGPREFERE3 ALTER COLUMN CONTROLEACESATEND POSITION 107;

ALTER TABLE SGPREFERE3 ALTER COLUMN AGENDAOBRIGORC POSITION 108;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPTI POSITION 109;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALTI POSITION 110;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODTIPOCLI POSITION 111;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPCC POSITION 112;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALCC POSITION 113;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODCLASCLI POSITION 114;

ALTER TABLE SGPREFERE3 ALTER COLUMN HABVENDA3 POSITION 115;

ALTER TABLE SGPREFERE3 ALTER COLUMN REPLICAPROCVD3 POSITION 116;

ALTER TABLE SGPREFERE3 ALTER COLUMN DTINS POSITION 117;

ALTER TABLE SGPREFERE3 ALTER COLUMN HINS POSITION 118;

ALTER TABLE SGPREFERE3 ALTER COLUMN IDUSUINS POSITION 119;

ALTER TABLE SGPREFERE3 ALTER COLUMN DTALT POSITION 120;

ALTER TABLE SGPREFERE3 ALTER COLUMN HALT POSITION 121;

ALTER TABLE SGPREFERE3 ALTER COLUMN IDUSUALT POSITION 122;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGPREFERE5 ALTER COLUMN CLASSOP POSITION 3;

ALTER TABLE SGPREFERE5 ALTER COLUMN NOMERESP POSITION 4;

ALTER TABLE SGPREFERE5 ALTER COLUMN IDENTPROFRESP POSITION 5;

ALTER TABLE SGPREFERE5 ALTER COLUMN CARGORESP POSITION 6;

ALTER TABLE SGPREFERE5 ALTER COLUMN NOMESUPERVQUALID POSITION 7;

ALTER TABLE SGPREFERE5 ALTER COLUMN IDENTSUPERVQUALID POSITION 8;

ALTER TABLE SGPREFERE5 ALTER COLUMN CARGOSUPERVQUALID POSITION 9;

ALTER TABLE SGPREFERE5 ALTER COLUMN NOMEGERENTEQUALID POSITION 10;

ALTER TABLE SGPREFERE5 ALTER COLUMN CARGOGERENTEQUALID POSITION 11;

ALTER TABLE SGPREFERE5 ALTER COLUMN IDENTGERENTEQUALID POSITION 12;

ALTER TABLE SGPREFERE5 ALTER COLUMN MESESDESCCP POSITION 13;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODTIPOMOV POSITION 14;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPTM POSITION 15;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALTM POSITION 16;

ALTER TABLE SGPREFERE5 ALTER COLUMN SITRMAOP POSITION 17;

ALTER TABLE SGPREFERE5 ALTER COLUMN IMGASSRESP POSITION 18;

ALTER TABLE SGPREFERE5 ALTER COLUMN IMGASSSUPERVQUALID POSITION 19;

ALTER TABLE SGPREFERE5 ALTER COLUMN IMGASSGERENTEQUALID POSITION 20;

ALTER TABLE SGPREFERE5 ALTER COLUMN BAIXARMAAPROV POSITION 21;

ALTER TABLE SGPREFERE5 ALTER COLUMN RATAUTO POSITION 22;

ALTER TABLE SGPREFERE5 ALTER COLUMN APAGARMAOP POSITION 23;

ALTER TABLE SGPREFERE5 ALTER COLUMN NOMERELANAL POSITION 24;

ALTER TABLE SGPREFERE5 ALTER COLUMN SITPADOP POSITION 25;

ALTER TABLE SGPREFERE5 ALTER COLUMN SITPADOPCONV POSITION 26;

ALTER TABLE SGPREFERE5 ALTER COLUMN HABCONVCP POSITION 27;

ALTER TABLE SGPREFERE5 ALTER COLUMN OPSEQ POSITION 28;

ALTER TABLE SGPREFERE5 ALTER COLUMN PRODETAPAS POSITION 29;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPTS POSITION 30;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALTS POSITION 31;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODTIPOMOVSP POSITION 32;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPEN POSITION 33;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALEN POSITION 34;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODTIPOMOVEN POSITION 35;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPRE POSITION 36;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALRE POSITION 37;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODTIPOMOVRE POSITION 38;

ALTER TABLE SGPREFERE5 ALTER COLUMN EXPEDIRRMA POSITION 39;

ALTER TABLE SGPREFERE5 ALTER COLUMN VALIDAQTDOP POSITION 40;

ALTER TABLE SGPREFERE5 ALTER COLUMN VALIDAFASEOP POSITION 41;

ALTER TABLE SGPREFERE5 ALTER COLUMN EDITQTDOP POSITION 42;

ALTER TABLE SGPREFERE5 ALTER COLUMN BLOQOPSEMSALDO POSITION 43;

ALTER TABLE SGPREFERE5 ALTER COLUMN LAYOUTFT POSITION 44;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPI1 POSITION 45;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALI1 POSITION 46;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODIMGFT01 POSITION 47;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPI2 POSITION 48;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALI2 POSITION 49;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODIMGFT02 POSITION 50;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPI3 POSITION 51;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALI3 POSITION 52;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODIMGFT03 POSITION 53;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPI4 POSITION 54;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALI4 POSITION 55;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODIMGFT04 POSITION 56;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPI5 POSITION 57;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALI5 POSITION 58;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODIMGFT05 POSITION 59;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPI6 POSITION 60;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALI6 POSITION 61;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODIMGFT06 POSITION 62;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPCI POSITION 63;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALCI POSITION 64;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODCATIMG POSITION 65;

ALTER TABLE SGPREFERE5 ALTER COLUMN ADICOPOBSVD POSITION 66;

ALTER TABLE SGPREFERE5 ALTER COLUMN DTINS POSITION 67;

ALTER TABLE SGPREFERE5 ALTER COLUMN HINS POSITION 68;

ALTER TABLE SGPREFERE5 ALTER COLUMN IDUSUINS POSITION 69;

ALTER TABLE SGPREFERE5 ALTER COLUMN DTALT POSITION 70;

ALTER TABLE SGPREFERE5 ALTER COLUMN HALT POSITION 71;

ALTER TABLE SGPREFERE5 ALTER COLUMN IDUSUALT POSITION 72;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODEMPCO POSITION 3;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODFILIALCO POSITION 4;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODTIPOMOVCO POSITION 5;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODEMPTV POSITION 6;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODFILIALTV POSITION 7;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODTIPOMOVTV POSITION 8;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODEMPTP POSITION 9;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODFILIALTP POSITION 10;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODTIPOMOVTP POSITION 11;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODEMPPV POSITION 12;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODEMPPC POSITION 13;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODFILIALPC POSITION 14;

ALTER TABLE SGPREFERE7 ALTER COLUMN ANOPLANCONSIG POSITION 15;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODPLANCONSIG POSITION 16;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODFILIALPV POSITION 17;

ALTER TABLE SGPREFERE7 ALTER COLUMN ANOPLANVDCONSIG POSITION 18;

ALTER TABLE SGPREFERE7 ALTER COLUMN CODPLANVDCONSIG POSITION 19;

ALTER TABLE SGPREFERE7 ALTER COLUMN DTINS POSITION 20;

ALTER TABLE SGPREFERE7 ALTER COLUMN HINS POSITION 21;

ALTER TABLE SGPREFERE7 ALTER COLUMN IDUSUINS POSITION 22;

ALTER TABLE SGPREFERE7 ALTER COLUMN DTALT POSITION 23;

ALTER TABLE SGPREFERE7 ALTER COLUMN HALT POSITION 24;

ALTER TABLE SGPREFERE7 ALTER COLUMN IDUSUALT POSITION 25;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODEMPTR POSITION 3;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODFILIALTR POSITION 4;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODTIPORECMERC POSITION 5;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODEMPCM POSITION 6;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODFILIALCM POSITION 7;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODTIPORECMERCCM POSITION 8;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODEMPTC POSITION 9;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODFILIALTC POSITION 10;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODTIPOMOVTC POSITION 11;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODEMPTO POSITION 12;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODFILIALTO POSITION 13;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODTIPORECMERCOS POSITION 14;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODEMPPP POSITION 15;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODFILIALPP POSITION 16;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODPLANOPAG POSITION 17;

ALTER TABLE SGPREFERE8 ALTER COLUMN GERACHAMADOOS POSITION 18;

ALTER TABLE SGPREFERE8 ALTER COLUMN USAPRECOPECASERV POSITION 19;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODEMPDS POSITION 20;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODFILIALDS POSITION 21;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODTIPOMOVDS POSITION 22;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODEMPSE POSITION 23;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODFILIALSE POSITION 24;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODPRODSE POSITION 25;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODEMPTE POSITION 26;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODFILIALTE POSITION 27;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODTIPOEXPED POSITION 28;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODEMPTN POSITION 29;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODFILIALTN POSITION 30;

ALTER TABLE SGPREFERE8 ALTER COLUMN CODTRAN POSITION 31;

ALTER TABLE SGPREFERE8 ALTER COLUMN SINCTICKET POSITION 32;

ALTER TABLE SGPREFERE8 ALTER COLUMN SOLCPHOMOLOGFOR POSITION 33;

ALTER TABLE SGPREFERE8 ALTER COLUMN UTILRENDACOT POSITION 34;

ALTER TABLE SGPREFERE8 ALTER COLUMN PERMITDOCCOLDUPL POSITION 35;

ALTER TABLE SGPREFERE8 ALTER COLUMN OBSPADOC POSITION 36;

ALTER TABLE SGPREFERE8 ALTER COLUMN PERMITITEMREPCP POSITION 37;

ALTER TABLE SGPREFERE8 ALTER COLUMN PERCPRECOCOLETACP POSITION 38;

ALTER TABLE SGPREFERE8 ALTER COLUMN DETITEMPAINELSERV POSITION 39;

ALTER TABLE SGPREFERE8 ALTER COLUMN CONTINGENCIAPESAGEM POSITION 40;

ALTER TABLE SGPREFERE8 ALTER COLUMN ALERTARETNUMSERIE POSITION 41;

ALTER TABLE SGPREFERE8 ALTER COLUMN DIASALERTANUMSERIE POSITION 42;

ALTER TABLE SGPREFERE8 ALTER COLUMN BLOQOSSEMLAUDOIMP POSITION 43;

ALTER TABLE SGPREFERE8 ALTER COLUMN BLOQINSERCAOOS POSITION 44;

ALTER TABLE SGPREFERE8 ALTER COLUMN LAYOUTLAUDOCOLETA POSITION 45;

ALTER TABLE SGPREFERE8 ALTER COLUMN DTINS POSITION 46;

ALTER TABLE SGPREFERE8 ALTER COLUMN HINS POSITION 47;

ALTER TABLE SGPREFERE8 ALTER COLUMN IDUSUINS POSITION 48;

ALTER TABLE SGPREFERE8 ALTER COLUMN DTALT POSITION 49;

ALTER TABLE SGPREFERE8 ALTER COLUMN HALT POSITION 50;

ALTER TABLE SGPREFERE8 ALTER COLUMN IDUSUALT POSITION 51;

ALTER TABLE SGUSUARIO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGUSUARIO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGUSUARIO ALTER COLUMN IDUSU POSITION 3;

ALTER TABLE SGUSUARIO ALTER COLUMN NOMEUSU POSITION 4;

ALTER TABLE SGUSUARIO ALTER COLUMN TIPOUSU POSITION 5;

ALTER TABLE SGUSUARIO ALTER COLUMN CODEMPIG POSITION 6;

ALTER TABLE SGUSUARIO ALTER COLUMN CODFILIALIG POSITION 7;

ALTER TABLE SGUSUARIO ALTER COLUMN IDGRPUSU POSITION 8;

ALTER TABLE SGUSUARIO ALTER COLUMN CODEMPCC POSITION 9;

ALTER TABLE SGUSUARIO ALTER COLUMN CODFILIALCC POSITION 10;

ALTER TABLE SGUSUARIO ALTER COLUMN ANOCC POSITION 11;

ALTER TABLE SGUSUARIO ALTER COLUMN CODCC POSITION 12;

ALTER TABLE SGUSUARIO ALTER COLUMN PNOMEUSU POSITION 13;

ALTER TABLE SGUSUARIO ALTER COLUMN UNOMEUSU POSITION 14;

ALTER TABLE SGUSUARIO ALTER COLUMN COMENTUSU POSITION 15;

ALTER TABLE SGUSUARIO ALTER COLUMN BAIXOCUSTOUSU POSITION 16;

ALTER TABLE SGUSUARIO ALTER COLUMN CODALMOX POSITION 17;

ALTER TABLE SGUSUARIO ALTER COLUMN CODEMPAM POSITION 18;

ALTER TABLE SGUSUARIO ALTER COLUMN CODFILIALAM POSITION 19;

ALTER TABLE SGUSUARIO ALTER COLUMN ABREGAVETAUSU POSITION 20;

ALTER TABLE SGUSUARIO ALTER COLUMN APROVCPSOLICITACAOUSU POSITION 21;

ALTER TABLE SGUSUARIO ALTER COLUMN ALMOXARIFEUSU POSITION 22;

ALTER TABLE SGUSUARIO ALTER COLUMN CODEMPAE POSITION 23;

ALTER TABLE SGUSUARIO ALTER COLUMN CODFILIALAE POSITION 24;

ALTER TABLE SGUSUARIO ALTER COLUMN TIPOAGE POSITION 25;

ALTER TABLE SGUSUARIO ALTER COLUMN CODAGE POSITION 26;

ALTER TABLE SGUSUARIO ALTER COLUMN APROVRMAUSU POSITION 27;

ALTER TABLE SGUSUARIO ALTER COLUMN COMPRASUSU POSITION 28;

ALTER TABLE SGUSUARIO ALTER COLUMN ALTPARCVENDA POSITION 29;

ALTER TABLE SGUSUARIO ALTER COLUMN APROVRECEITA POSITION 30;

ALTER TABLE SGUSUARIO ALTER COLUMN ATIVCLI POSITION 31;

ALTER TABLE SGUSUARIO ALTER COLUMN LIBERACREDUSU POSITION 32;

ALTER TABLE SGUSUARIO ALTER COLUMN CORAGENDA POSITION 33;

ALTER TABLE SGUSUARIO ALTER COLUMN CODEMPCE POSITION 34;

ALTER TABLE SGUSUARIO ALTER COLUMN CODFILIALCE POSITION 35;

ALTER TABLE SGUSUARIO ALTER COLUMN CODCONFEMAIL POSITION 36;

ALTER TABLE SGUSUARIO ALTER COLUMN CANCELAOP POSITION 37;

ALTER TABLE SGUSUARIO ALTER COLUMN VENDAPATRIMUSU POSITION 38;

ALTER TABLE SGUSUARIO ALTER COLUMN RMAOUTCC POSITION 39;

ALTER TABLE SGUSUARIO ALTER COLUMN ATIVOUSU POSITION 40;

ALTER TABLE SGUSUARIO ALTER COLUMN VISUALIZALUCR POSITION 41;

ALTER TABLE SGUSUARIO ALTER COLUMN LIBERACAMPOPESAGEM POSITION 42;

ALTER TABLE SGUSUARIO ALTER COLUMN APROVORDCP POSITION 43;

ALTER TABLE SGUSUARIO ALTER COLUMN ACESOPBTCADLOTE POSITION 44;

ALTER TABLE SGUSUARIO ALTER COLUMN ACESOPBTRMA POSITION 45;

ALTER TABLE SGUSUARIO ALTER COLUMN ACESOPBTQUALID POSITION 46;

ALTER TABLE SGUSUARIO ALTER COLUMN ACESOPBTDISTR POSITION 47;

ALTER TABLE SGUSUARIO ALTER COLUMN ACESOPBTFASE POSITION 48;

ALTER TABLE SGUSUARIO ALTER COLUMN ACESOPBTCANC POSITION 49;

ALTER TABLE SGUSUARIO ALTER COLUMN ACESOPBTSUBPROD POSITION 50;

ALTER TABLE SGUSUARIO ALTER COLUMN ACESOPBTREMESSA POSITION 51;

ALTER TABLE SGUSUARIO ALTER COLUMN ACESOPBTRETORNO POSITION 52;

ALTER TABLE SGUSUARIO ALTER COLUMN ACESOPVERITENS POSITION 53;

ALTER TABLE SGUSUARIO ALTER COLUMN ACESESTRUITFASE POSITION 54;

ALTER TABLE SGUSUARIO ALTER COLUMN CADOUTUSU POSITION 55;

ALTER TABLE SGUSUARIO ALTER COLUMN SENHAUSU POSITION 56;

ALTER TABLE SGUSUARIO ALTER COLUMN DTINS POSITION 57;

ALTER TABLE SGUSUARIO ALTER COLUMN HINS POSITION 58;

ALTER TABLE SGUSUARIO ALTER COLUMN IDUSUINS POSITION 59;

ALTER TABLE SGUSUARIO ALTER COLUMN DTALT POSITION 60;

ALTER TABLE SGUSUARIO ALTER COLUMN HALT POSITION 61;

ALTER TABLE SGUSUARIO ALTER COLUMN IDUSUALT POSITION 62;

ALTER TABLE TKCONTATO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE TKCONTATO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE TKCONTATO ALTER COLUMN CODCTO POSITION 3;

ALTER TABLE TKCONTATO ALTER COLUMN RAZCTO POSITION 4;

ALTER TABLE TKCONTATO ALTER COLUMN CODEMPVD POSITION 5;

ALTER TABLE TKCONTATO ALTER COLUMN CODFILIALVD POSITION 6;

ALTER TABLE TKCONTATO ALTER COLUMN CODVEND POSITION 7;

ALTER TABLE TKCONTATO ALTER COLUMN CODEMPSR POSITION 8;

ALTER TABLE TKCONTATO ALTER COLUMN CODFILIALSR POSITION 9;

ALTER TABLE TKCONTATO ALTER COLUMN CODSETOR POSITION 10;

ALTER TABLE TKCONTATO ALTER COLUMN NOMECTO POSITION 11;

ALTER TABLE TKCONTATO ALTER COLUMN DATACTO POSITION 12;

ALTER TABLE TKCONTATO ALTER COLUMN PESSOACTO POSITION 13;

ALTER TABLE TKCONTATO ALTER COLUMN ATIVOCTO POSITION 14;

ALTER TABLE TKCONTATO ALTER COLUMN CNPJCTO POSITION 15;

ALTER TABLE TKCONTATO ALTER COLUMN INSCCTO POSITION 16;

ALTER TABLE TKCONTATO ALTER COLUMN CPFCTO POSITION 17;

ALTER TABLE TKCONTATO ALTER COLUMN RGCTO POSITION 18;

ALTER TABLE TKCONTATO ALTER COLUMN ENDCTO POSITION 19;

ALTER TABLE TKCONTATO ALTER COLUMN NUMCTO POSITION 20;

ALTER TABLE TKCONTATO ALTER COLUMN COMPLCTO POSITION 21;

ALTER TABLE TKCONTATO ALTER COLUMN EDIFICIOCTO POSITION 22;

ALTER TABLE TKCONTATO ALTER COLUMN BAIRCTO POSITION 23;

ALTER TABLE TKCONTATO ALTER COLUMN CIDCTO POSITION 24;

ALTER TABLE TKCONTATO ALTER COLUMN UFCTO POSITION 25;

ALTER TABLE TKCONTATO ALTER COLUMN CEPCTO POSITION 26;

ALTER TABLE TKCONTATO ALTER COLUMN DDDCTO POSITION 27;

ALTER TABLE TKCONTATO ALTER COLUMN DDDCTO2 POSITION 28;

ALTER TABLE TKCONTATO ALTER COLUMN DDDCTO3 POSITION 29;

ALTER TABLE TKCONTATO ALTER COLUMN DDDCTO4 POSITION 30;

ALTER TABLE TKCONTATO ALTER COLUMN FONECTO POSITION 31;

ALTER TABLE TKCONTATO ALTER COLUMN FONECTO2 POSITION 32;

ALTER TABLE TKCONTATO ALTER COLUMN FONECTO3 POSITION 33;

ALTER TABLE TKCONTATO ALTER COLUMN FONECTO4 POSITION 34;

ALTER TABLE TKCONTATO ALTER COLUMN FAXCTO POSITION 35;

ALTER TABLE TKCONTATO ALTER COLUMN EMAILCTO POSITION 36;

ALTER TABLE TKCONTATO ALTER COLUMN CONTCTO POSITION 37;

ALTER TABLE TKCONTATO ALTER COLUMN CARGOCONTCTO POSITION 38;

ALTER TABLE TKCONTATO ALTER COLUMN OBSCTO POSITION 39;

ALTER TABLE TKCONTATO ALTER COLUMN REMOVCTO POSITION 40;

ALTER TABLE TKCONTATO ALTER COLUMN CODEMPTI POSITION 41;

ALTER TABLE TKCONTATO ALTER COLUMN CODFILIALTI POSITION 42;

ALTER TABLE TKCONTATO ALTER COLUMN CODTPIMP POSITION 43;

ALTER TABLE TKCONTATO ALTER COLUMN CODEMPSO POSITION 44;

ALTER TABLE TKCONTATO ALTER COLUMN CODFILIALSO POSITION 45;

ALTER TABLE TKCONTATO ALTER COLUMN CODSETORCTO POSITION 46;

ALTER TABLE TKCONTATO ALTER COLUMN NUMEMPCTO POSITION 47;

ALTER TABLE TKCONTATO ALTER COLUMN CODMUNIC POSITION 48;

ALTER TABLE TKCONTATO ALTER COLUMN SIGLAUF POSITION 49;

ALTER TABLE TKCONTATO ALTER COLUMN CODPAIS POSITION 50;

ALTER TABLE TKCONTATO ALTER COLUMN CODEMPTC POSITION 51;

ALTER TABLE TKCONTATO ALTER COLUMN CODFILIALTC POSITION 52;

ALTER TABLE TKCONTATO ALTER COLUMN CODTIPOCLI POSITION 53;

ALTER TABLE TKCONTATO ALTER COLUMN CODEMPOC POSITION 54;

ALTER TABLE TKCONTATO ALTER COLUMN CODFILIALOC POSITION 55;

ALTER TABLE TKCONTATO ALTER COLUMN CODORIGCONT POSITION 56;

ALTER TABLE TKCONTATO ALTER COLUMN CODEMPTO POSITION 57;

ALTER TABLE TKCONTATO ALTER COLUMN CODFILIALTO POSITION 58;

ALTER TABLE TKCONTATO ALTER COLUMN CODTIPOCONT POSITION 59;

ALTER TABLE TKCONTATO ALTER COLUMN DDDCELCTO POSITION 60;

ALTER TABLE TKCONTATO ALTER COLUMN DDDCELCTO2 POSITION 61;

ALTER TABLE TKCONTATO ALTER COLUMN CELCTO POSITION 62;

ALTER TABLE TKCONTATO ALTER COLUMN CELCTO2 POSITION 63;

ALTER TABLE TKCONTATO ALTER COLUMN CODCNAE POSITION 64;

ALTER TABLE TKCONTATO ALTER COLUMN CODCNAE2 POSITION 65;

ALTER TABLE TKCONTATO ALTER COLUMN CODCNAE3 POSITION 66;

ALTER TABLE TKCONTATO ALTER COLUMN CODCNAE4 POSITION 67;

ALTER TABLE TKCONTATO ALTER COLUMN CODCNAE5 POSITION 68;

ALTER TABLE TKCONTATO ALTER COLUMN CODCNAE6 POSITION 69;

ALTER TABLE TKCONTATO ALTER COLUMN CODCNAE7 POSITION 70;

ALTER TABLE TKCONTATO ALTER COLUMN CODCNAE8 POSITION 71;

ALTER TABLE TKCONTATO ALTER COLUMN CODCNAE9 POSITION 72;

ALTER TABLE TKCONTATO ALTER COLUMN CODNJ POSITION 73;

ALTER TABLE TKCONTATO ALTER COLUMN REPLICADO POSITION 74;

ALTER TABLE TKCONTATO ALTER COLUMN DTFUNDCTO POSITION 75;

ALTER TABLE TKCONTATO ALTER COLUMN DTREPL POSITION 76;

ALTER TABLE TKCONTATO ALTER COLUMN HREPL POSITION 77;

ALTER TABLE TKCONTATO ALTER COLUMN DTINS POSITION 78;

ALTER TABLE TKCONTATO ALTER COLUMN HINS POSITION 79;

ALTER TABLE TKCONTATO ALTER COLUMN IDUSUINS POSITION 80;

ALTER TABLE TKCONTATO ALTER COLUMN DTALT POSITION 81;

ALTER TABLE TKCONTATO ALTER COLUMN HALT POSITION 82;

ALTER TABLE TKCONTATO ALTER COLUMN IDUSUALT POSITION 83;

ALTER TABLE TKEMAIL ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE TKEMAIL ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE TKEMAIL ALTER COLUMN CODEMAIL POSITION 3;

ALTER TABLE TKEMAIL ALTER COLUMN DESCEMAIL POSITION 4;

ALTER TABLE TKEMAIL ALTER COLUMN ASSUNTO POSITION 5;

ALTER TABLE TKEMAIL ALTER COLUMN CORPO POSITION 6;

ALTER TABLE TKEMAIL ALTER COLUMN FORMATO POSITION 7;

ALTER TABLE TKEMAIL ALTER COLUMN CHARSET POSITION 8;

ALTER TABLE TKEMAIL ALTER COLUMN CODEMPCM POSITION 9;

ALTER TABLE TKEMAIL ALTER COLUMN CODFILIALCM POSITION 10;

ALTER TABLE TKEMAIL ALTER COLUMN CODCONFEMAIL POSITION 11;

ALTER TABLE TKEMAIL ALTER COLUMN CODEMPCI POSITION 12;

ALTER TABLE TKEMAIL ALTER COLUMN CODFILIALCI POSITION 13;

ALTER TABLE TKEMAIL ALTER COLUMN CODCATIMG POSITION 14;

ALTER TABLE TKEMAIL ALTER COLUMN DTINS POSITION 15;

ALTER TABLE TKEMAIL ALTER COLUMN HINS POSITION 16;

ALTER TABLE TKEMAIL ALTER COLUMN IDUSUINS POSITION 17;

ALTER TABLE TKEMAIL ALTER COLUMN DTALT POSITION 18;

ALTER TABLE TKEMAIL ALTER COLUMN HALT POSITION 19;

ALTER TABLE TKEMAIL ALTER COLUMN IDUSUALT POSITION 20;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCLI POSITION 3;

ALTER TABLE VDCLIENTE ALTER COLUMN RAZCLI POSITION 4;

ALTER TABLE VDCLIENTE ALTER COLUMN NOMECLI POSITION 5;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPCC POSITION 6;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALCC POSITION 7;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCLASCLI POSITION 8;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPVD POSITION 9;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALVD POSITION 10;

ALTER TABLE VDCLIENTE ALTER COLUMN CODVEND POSITION 11;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPTC POSITION 12;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALTC POSITION 13;

ALTER TABLE VDCLIENTE ALTER COLUMN CODTIPOCOB POSITION 14;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPPG POSITION 15;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALPG POSITION 16;

ALTER TABLE VDCLIENTE ALTER COLUMN CODPLANOPAG POSITION 17;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPTN POSITION 18;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALTN POSITION 19;

ALTER TABLE VDCLIENTE ALTER COLUMN CODTRAN POSITION 20;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPBO POSITION 21;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALBO POSITION 22;

ALTER TABLE VDCLIENTE ALTER COLUMN CODBANCO POSITION 23;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPSR POSITION 24;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALSR POSITION 25;

ALTER TABLE VDCLIENTE ALTER COLUMN CODSETOR POSITION 26;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPTI POSITION 27;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALTI POSITION 28;

ALTER TABLE VDCLIENTE ALTER COLUMN CODTIPOCLI POSITION 29;

ALTER TABLE VDCLIENTE ALTER COLUMN CODTPCRED POSITION 30;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALTR POSITION 31;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPTR POSITION 32;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFISCCLI POSITION 33;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPFC POSITION 34;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALFC POSITION 35;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPEC POSITION 36;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALEC POSITION 37;

ALTER TABLE VDCLIENTE ALTER COLUMN CODTBEC POSITION 38;

ALTER TABLE VDCLIENTE ALTER COLUMN CODITTBEC POSITION 39;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPHP POSITION 40;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALHP POSITION 41;

ALTER TABLE VDCLIENTE ALTER COLUMN CODHIST POSITION 42;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPCB POSITION 43;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALCB POSITION 44;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCARTCOB POSITION 45;

ALTER TABLE VDCLIENTE ALTER COLUMN DATACLI POSITION 46;

ALTER TABLE VDCLIENTE ALTER COLUMN PESSOACLI POSITION 47;

ALTER TABLE VDCLIENTE ALTER COLUMN CONSUMIDORCLI POSITION 48;

ALTER TABLE VDCLIENTE ALTER COLUMN ATIVOCLI POSITION 49;

ALTER TABLE VDCLIENTE ALTER COLUMN CNPJCLI POSITION 50;

ALTER TABLE VDCLIENTE ALTER COLUMN INSCCLI POSITION 51;

ALTER TABLE VDCLIENTE ALTER COLUMN CPFCLI POSITION 52;

ALTER TABLE VDCLIENTE ALTER COLUMN RGCLI POSITION 53;

ALTER TABLE VDCLIENTE ALTER COLUMN SSPCLI POSITION 54;

ALTER TABLE VDCLIENTE ALTER COLUMN ENDCLI POSITION 55;

ALTER TABLE VDCLIENTE ALTER COLUMN NUMCLI POSITION 56;

ALTER TABLE VDCLIENTE ALTER COLUMN COMPLCLI POSITION 57;

ALTER TABLE VDCLIENTE ALTER COLUMN EDIFICIOCLI POSITION 58;

ALTER TABLE VDCLIENTE ALTER COLUMN BAIRCLI POSITION 59;

ALTER TABLE VDCLIENTE ALTER COLUMN CIDCLI POSITION 60;

ALTER TABLE VDCLIENTE ALTER COLUMN UFCLI POSITION 61;

ALTER TABLE VDCLIENTE ALTER COLUMN CEPCLI POSITION 62;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDCLI POSITION 63;

ALTER TABLE VDCLIENTE ALTER COLUMN FONECLI POSITION 64;

ALTER TABLE VDCLIENTE ALTER COLUMN RAMALCLI POSITION 65;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDFAXCLI POSITION 66;

ALTER TABLE VDCLIENTE ALTER COLUMN FAXCLI POSITION 67;

ALTER TABLE VDCLIENTE ALTER COLUMN EMAILCLI POSITION 68;

ALTER TABLE VDCLIENTE ALTER COLUMN EMAILCOB POSITION 69;

ALTER TABLE VDCLIENTE ALTER COLUMN EMAILENT POSITION 70;

ALTER TABLE VDCLIENTE ALTER COLUMN EMAILNFECLI POSITION 71;

ALTER TABLE VDCLIENTE ALTER COLUMN CONTCLI POSITION 72;

ALTER TABLE VDCLIENTE ALTER COLUMN ENDCOB POSITION 73;

ALTER TABLE VDCLIENTE ALTER COLUMN NUMCOB POSITION 74;

ALTER TABLE VDCLIENTE ALTER COLUMN COMPLCOB POSITION 75;

ALTER TABLE VDCLIENTE ALTER COLUMN BAIRCOB POSITION 76;

ALTER TABLE VDCLIENTE ALTER COLUMN CIDCOB POSITION 77;

ALTER TABLE VDCLIENTE ALTER COLUMN UFCOB POSITION 78;

ALTER TABLE VDCLIENTE ALTER COLUMN CEPCOB POSITION 79;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDFONECOB POSITION 80;

ALTER TABLE VDCLIENTE ALTER COLUMN FONECOB POSITION 81;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDFAXCOB POSITION 82;

ALTER TABLE VDCLIENTE ALTER COLUMN FAXCOB POSITION 83;

ALTER TABLE VDCLIENTE ALTER COLUMN ENDENT POSITION 84;

ALTER TABLE VDCLIENTE ALTER COLUMN NUMENT POSITION 85;

ALTER TABLE VDCLIENTE ALTER COLUMN COMPLENT POSITION 86;

ALTER TABLE VDCLIENTE ALTER COLUMN BAIRENT POSITION 87;

ALTER TABLE VDCLIENTE ALTER COLUMN CIDENT POSITION 88;

ALTER TABLE VDCLIENTE ALTER COLUMN UFENT POSITION 89;

ALTER TABLE VDCLIENTE ALTER COLUMN CEPENT POSITION 90;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDFONEENT POSITION 91;

ALTER TABLE VDCLIENTE ALTER COLUMN FONEENT POSITION 92;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDFAXENT POSITION 93;

ALTER TABLE VDCLIENTE ALTER COLUMN FAXENT POSITION 94;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDCELENT POSITION 95;

ALTER TABLE VDCLIENTE ALTER COLUMN CELENT POSITION 96;

ALTER TABLE VDCLIENTE ALTER COLUMN OBSCLI POSITION 97;

ALTER TABLE VDCLIENTE ALTER COLUMN AGENCIACLI POSITION 98;

ALTER TABLE VDCLIENTE ALTER COLUMN NCONTABCOCLI POSITION 99;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPPQ POSITION 100;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALPQ POSITION 101;

ALTER TABLE VDCLIENTE ALTER COLUMN CODPESQ POSITION 102;

ALTER TABLE VDCLIENTE ALTER COLUMN INCRACLI POSITION 103;

ALTER TABLE VDCLIENTE ALTER COLUMN DTINITR POSITION 104;

ALTER TABLE VDCLIENTE ALTER COLUMN DTVENCTOTR POSITION 105;

ALTER TABLE VDCLIENTE ALTER COLUMN NIRFCLI POSITION 106;

ALTER TABLE VDCLIENTE ALTER COLUMN SIMPLESCLI POSITION 107;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDCELCLI POSITION 108;

ALTER TABLE VDCLIENTE ALTER COLUMN CELCLI POSITION 109;

ALTER TABLE VDCLIENTE ALTER COLUMN NATCLI POSITION 110;

ALTER TABLE VDCLIENTE ALTER COLUMN UFNATCLI POSITION 111;

ALTER TABLE VDCLIENTE ALTER COLUMN TEMPORESCLI POSITION 112;

ALTER TABLE VDCLIENTE ALTER COLUMN APELIDOCLI POSITION 113;

ALTER TABLE VDCLIENTE ALTER COLUMN SITECLI POSITION 114;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCONTDEB POSITION 115;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCONTCRED POSITION 116;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCLICONTAB POSITION 117;

ALTER TABLE VDCLIENTE ALTER COLUMN FOTOCLI POSITION 118;

ALTER TABLE VDCLIENTE ALTER COLUMN IMGASSCLI POSITION 119;

ALTER TABLE VDCLIENTE ALTER COLUMN CODMUNIC POSITION 120;

ALTER TABLE VDCLIENTE ALTER COLUMN SIGLAUF POSITION 121;

ALTER TABLE VDCLIENTE ALTER COLUMN CODPAIS POSITION 122;

ALTER TABLE VDCLIENTE ALTER COLUMN CODMUNICENT POSITION 123;

ALTER TABLE VDCLIENTE ALTER COLUMN SIGLAUFENT POSITION 124;

ALTER TABLE VDCLIENTE ALTER COLUMN CODPAISENT POSITION 125;

ALTER TABLE VDCLIENTE ALTER COLUMN CODMUNICCOB POSITION 126;

ALTER TABLE VDCLIENTE ALTER COLUMN SIGLAUFCOB POSITION 127;

ALTER TABLE VDCLIENTE ALTER COLUMN CODPAISCOB POSITION 128;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPUC POSITION 129;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALUC POSITION 130;

ALTER TABLE VDCLIENTE ALTER COLUMN CODUNIFCOD POSITION 131;

ALTER TABLE VDCLIENTE ALTER COLUMN SUFRAMACLI POSITION 132;

ALTER TABLE VDCLIENTE ALTER COLUMN PRODRURALCLI POSITION 133;

ALTER TABLE VDCLIENTE ALTER COLUMN CTOCLI POSITION 134;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCNAE POSITION 135;

ALTER TABLE VDCLIENTE ALTER COLUMN INSCMUNCLI POSITION 136;

ALTER TABLE VDCLIENTE ALTER COLUMN PERCDESCCLI POSITION 137;

ALTER TABLE VDCLIENTE ALTER COLUMN CONTCLICOB POSITION 138;

ALTER TABLE VDCLIENTE ALTER COLUMN CONTCLIENT POSITION 139;

ALTER TABLE VDCLIENTE ALTER COLUMN DESCIPI POSITION 140;

ALTER TABLE VDCLIENTE ALTER COLUMN IDENTCLIBCO POSITION 141;

ALTER TABLE VDCLIENTE ALTER COLUMN DTNASCCLI POSITION 142;

ALTER TABLE VDCLIENTE ALTER COLUMN PEDCLIOBRIG POSITION 143;

ALTER TABLE VDCLIENTE ALTER COLUMN SITREVCLI POSITION 144;

ALTER TABLE VDCLIENTE ALTER COLUMN IDUSUREVCLI POSITION 145;

ALTER TABLE VDCLIENTE ALTER COLUMN DTREVCLI POSITION 146;

ALTER TABLE VDCLIENTE ALTER COLUMN HREVCLI POSITION 147;

ALTER TABLE VDCLIENTE ALTER COLUMN VENDA3CLI POSITION 148;

ALTER TABLE VDCLIENTE ALTER COLUMN NOMEREPLEGALCLI POSITION 149;

ALTER TABLE VDCLIENTE ALTER COLUMN CARGOREPLEGALCLI POSITION 150;

ALTER TABLE VDCLIENTE ALTER COLUMN CPFREPLEGALCLI POSITION 151;

ALTER TABLE VDCLIENTE ALTER COLUMN RGREPLEGALCLI POSITION 152;

ALTER TABLE VDCLIENTE ALTER COLUMN ENVIAIMNFSE POSITION 153;

ALTER TABLE VDCLIENTE ALTER COLUMN DTINS POSITION 154;

ALTER TABLE VDCLIENTE ALTER COLUMN HINS POSITION 155;

ALTER TABLE VDCLIENTE ALTER COLUMN IDUSUINS POSITION 156;

ALTER TABLE VDCLIENTE ALTER COLUMN DTALT POSITION 157;

ALTER TABLE VDCLIENTE ALTER COLUMN HALT POSITION 158;

ALTER TABLE VDCLIENTE ALTER COLUMN IDUSUALT POSITION 159;

ALTER TABLE VDCONTRATO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDCONTRATO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDCONTRATO ALTER COLUMN CODCONTR POSITION 3;

ALTER TABLE VDCONTRATO ALTER COLUMN DESCCONTR POSITION 4;

ALTER TABLE VDCONTRATO ALTER COLUMN MINUTACONTR POSITION 5;

ALTER TABLE VDCONTRATO ALTER COLUMN CODEMPCL POSITION 6;

ALTER TABLE VDCONTRATO ALTER COLUMN CODFILIALCL POSITION 7;

ALTER TABLE VDCONTRATO ALTER COLUMN CODCLI POSITION 8;

ALTER TABLE VDCONTRATO ALTER COLUMN CODEMPTC POSITION 9;

ALTER TABLE VDCONTRATO ALTER COLUMN CODFILIALTC POSITION 10;

ALTER TABLE VDCONTRATO ALTER COLUMN CODTIPOCONTR POSITION 11;

ALTER TABLE VDCONTRATO ALTER COLUMN DTINICIO POSITION 12;

ALTER TABLE VDCONTRATO ALTER COLUMN DTFIM POSITION 13;

ALTER TABLE VDCONTRATO ALTER COLUMN TPCOBCONTR POSITION 14;

ALTER TABLE VDCONTRATO ALTER COLUMN DIAVENCCONTR POSITION 15;

ALTER TABLE VDCONTRATO ALTER COLUMN DIAFECHCONTR POSITION 16;

ALTER TABLE VDCONTRATO ALTER COLUMN INDEXCONTR POSITION 17;

ALTER TABLE VDCONTRATO ALTER COLUMN TPCONTR POSITION 18;

ALTER TABLE VDCONTRATO ALTER COLUMN SITCONTR POSITION 19;

ALTER TABLE VDCONTRATO ALTER COLUMN CODEMPMC POSITION 20;

ALTER TABLE VDCONTRATO ALTER COLUMN CODFILIALMC POSITION 21;

ALTER TABLE VDCONTRATO ALTER COLUMN CODMODCONTR POSITION 22;

ALTER TABLE VDCONTRATO ALTER COLUMN DTPREVFIN POSITION 23;

ALTER TABLE VDCONTRATO ALTER COLUMN CODEMPSP POSITION 24;

ALTER TABLE VDCONTRATO ALTER COLUMN CODFILIALSP POSITION 25;

ALTER TABLE VDCONTRATO ALTER COLUMN CODCONTRSP POSITION 26;

ALTER TABLE VDCONTRATO ALTER COLUMN DESCSITCONTR POSITION 27;

ALTER TABLE VDCONTRATO ALTER COLUMN ATIVO POSITION 28;

ALTER TABLE VDCONTRATO ALTER COLUMN RECEBCONTR POSITION 29;

ALTER TABLE VDCONTRATO ALTER COLUMN CONTHSUBCONTR POSITION 30;

ALTER TABLE VDCONTRATO ALTER COLUMN VLRFRETEIDACONTR POSITION 31;

ALTER TABLE VDCONTRATO ALTER COLUMN VLRFRETEVOLTACONTR POSITION 32;

ALTER TABLE VDCONTRATO ALTER COLUMN VLRMULTACONTR POSITION 33;

ALTER TABLE VDCONTRATO ALTER COLUMN VLRJUROSCONTR POSITION 34;

ALTER TABLE VDCONTRATO ALTER COLUMN PERCMULTACONTR POSITION 35;

ALTER TABLE VDCONTRATO ALTER COLUMN PERCJUROSCONTR POSITION 36;

ALTER TABLE VDCONTRATO ALTER COLUMN LANCTOOUTROCLI POSITION 37;

ALTER TABLE VDCONTRATO ALTER COLUMN DTINS POSITION 38;

ALTER TABLE VDCONTRATO ALTER COLUMN HINS POSITION 39;

ALTER TABLE VDCONTRATO ALTER COLUMN IDUSUINS POSITION 40;

ALTER TABLE VDCONTRATO ALTER COLUMN DTALT POSITION 41;

ALTER TABLE VDCONTRATO ALTER COLUMN HALT POSITION 42;

ALTER TABLE VDCONTRATO ALTER COLUMN IDUSUALT POSITION 43;

ALTER TABLE VDFRETEVD ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDFRETEVD ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDFRETEVD ALTER COLUMN TIPOVENDA POSITION 3;

ALTER TABLE VDFRETEVD ALTER COLUMN CODVENDA POSITION 4;

ALTER TABLE VDFRETEVD ALTER COLUMN CODEMPTN POSITION 5;

ALTER TABLE VDFRETEVD ALTER COLUMN CODFILIALTN POSITION 6;

ALTER TABLE VDFRETEVD ALTER COLUMN CODTRAN POSITION 7;

ALTER TABLE VDFRETEVD ALTER COLUMN TIPOFRETEVD POSITION 8;

ALTER TABLE VDFRETEVD ALTER COLUMN PLACAFRETEVD POSITION 9;

ALTER TABLE VDFRETEVD ALTER COLUMN UFFRETEVD POSITION 10;

ALTER TABLE VDFRETEVD ALTER COLUMN VLRFRETEVD POSITION 11;

ALTER TABLE VDFRETEVD ALTER COLUMN QTDFRETEVD POSITION 12;

ALTER TABLE VDFRETEVD ALTER COLUMN PESOBRUTVD POSITION 13;

ALTER TABLE VDFRETEVD ALTER COLUMN PESOLIQVD POSITION 14;

ALTER TABLE VDFRETEVD ALTER COLUMN ESPFRETEVD POSITION 15;

ALTER TABLE VDFRETEVD ALTER COLUMN MARCAFRETEVD POSITION 16;

ALTER TABLE VDFRETEVD ALTER COLUMN CONHECFRETEVD POSITION 17;

ALTER TABLE VDFRETEVD ALTER COLUMN PERCVENDAFRETEVD POSITION 18;

ALTER TABLE VDFRETEVD ALTER COLUMN FLAG POSITION 19;

ALTER TABLE VDFRETEVD ALTER COLUMN ADICFRETEVD POSITION 20;

ALTER TABLE VDFRETEVD ALTER COLUMN ADICFRETEBASEICM POSITION 21;

ALTER TABLE VDFRETEVD ALTER COLUMN VLRBASEICMSFRETEVD POSITION 22;

ALTER TABLE VDFRETEVD ALTER COLUMN ALIQICMSFRETEVD POSITION 23;

ALTER TABLE VDFRETEVD ALTER COLUMN VLRICMSFRETEVD POSITION 24;

ALTER TABLE VDFRETEVD ALTER COLUMN VLRSEGFRETEVD POSITION 25;

ALTER TABLE VDFRETEVD ALTER COLUMN RNTCVD POSITION 26;

ALTER TABLE VDFRETEVD ALTER COLUMN CODEMPVE POSITION 27;

ALTER TABLE VDFRETEVD ALTER COLUMN CODFILIALVE POSITION 28;

ALTER TABLE VDFRETEVD ALTER COLUMN CODVEIC POSITION 29;

ALTER TABLE VDFRETEVD ALTER COLUMN CODEMPMA POSITION 30;

ALTER TABLE VDFRETEVD ALTER COLUMN CODFILIALMA POSITION 31;

ALTER TABLE VDFRETEVD ALTER COLUMN CODMOT POSITION 32;

ALTER TABLE VDFRETEVD ALTER COLUMN DTINS POSITION 33;

ALTER TABLE VDFRETEVD ALTER COLUMN HINS POSITION 34;

ALTER TABLE VDFRETEVD ALTER COLUMN IDUSUINS POSITION 35;

ALTER TABLE VDFRETEVD ALTER COLUMN DTALT POSITION 36;

ALTER TABLE VDFRETEVD ALTER COLUMN HALT POSITION 37;

ALTER TABLE VDFRETEVD ALTER COLUMN IDUSUALT POSITION 38;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDITORCAMENTO ALTER COLUMN TIPOORC POSITION 3;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODORC POSITION 4;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODITORC POSITION 5;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODEMPPD POSITION 6;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODFILIALPD POSITION 7;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODPROD POSITION 8;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODEMPAX POSITION 9;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODFILIALAX POSITION 10;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODALMOX POSITION 11;

ALTER TABLE VDITORCAMENTO ALTER COLUMN QTDITORC POSITION 12;

ALTER TABLE VDITORCAMENTO ALTER COLUMN QTDAPROVITORC POSITION 13;

ALTER TABLE VDITORCAMENTO ALTER COLUMN QTDAFATITORC POSITION 14;

ALTER TABLE VDITORCAMENTO ALTER COLUMN QTDFATITORC POSITION 15;

ALTER TABLE VDITORCAMENTO ALTER COLUMN PRECOITORC POSITION 16;

ALTER TABLE VDITORCAMENTO ALTER COLUMN PERCDESCITORC POSITION 17;

ALTER TABLE VDITORCAMENTO ALTER COLUMN VLRDESCITORC POSITION 18;

ALTER TABLE VDITORCAMENTO ALTER COLUMN VLRLIQITORC POSITION 19;

ALTER TABLE VDITORCAMENTO ALTER COLUMN VLRPRODITORC POSITION 20;

ALTER TABLE VDITORCAMENTO ALTER COLUMN REFPROD POSITION 21;

ALTER TABLE VDITORCAMENTO ALTER COLUMN NUMAUTORIZORC POSITION 22;

ALTER TABLE VDITORCAMENTO ALTER COLUMN ACEITEITORC POSITION 23;

ALTER TABLE VDITORCAMENTO ALTER COLUMN APROVITORC POSITION 24;

ALTER TABLE VDITORCAMENTO ALTER COLUMN EMITITORC POSITION 25;

ALTER TABLE VDITORCAMENTO ALTER COLUMN VENCAUTORIZORC POSITION 26;

ALTER TABLE VDITORCAMENTO ALTER COLUMN STRDESCITORC POSITION 27;

ALTER TABLE VDITORCAMENTO ALTER COLUMN OBSITORC POSITION 28;

ALTER TABLE VDITORCAMENTO ALTER COLUMN STATUSITORC POSITION 29;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODEMPPE POSITION 30;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODFILIALPE POSITION 31;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODPE POSITION 32;

ALTER TABLE VDITORCAMENTO ALTER COLUMN DIASPE POSITION 33;

ALTER TABLE VDITORCAMENTO ALTER COLUMN EMMANUT POSITION 34;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODEMPLG POSITION 35;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODFILIALLG POSITION 36;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODLOG POSITION 37;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODEMPLE POSITION 38;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODFILIALLE POSITION 39;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CODLOTE POSITION 40;

ALTER TABLE VDITORCAMENTO ALTER COLUMN SITENTITORC POSITION 41;

ALTER TABLE VDITORCAMENTO ALTER COLUMN SITTERMRITORC POSITION 42;

ALTER TABLE VDITORCAMENTO ALTER COLUMN CANCITORC POSITION 43;

ALTER TABLE VDITORCAMENTO ALTER COLUMN FATITORC POSITION 44;

ALTER TABLE VDITORCAMENTO ALTER COLUMN VLRCOMISITORC POSITION 45;

ALTER TABLE VDITORCAMENTO ALTER COLUMN PERCCOMISITORC POSITION 46;

ALTER TABLE VDITORCAMENTO ALTER COLUMN VLRFRETEITORC POSITION 47;

ALTER TABLE VDITORCAMENTO ALTER COLUMN DTAPROVITORC POSITION 48;

ALTER TABLE VDITORCAMENTO ALTER COLUMN SITPRODITORC POSITION 49;

ALTER TABLE VDITORCAMENTO ALTER COLUMN PEDCLIITORC POSITION 50;

ALTER TABLE VDITORCAMENTO ALTER COLUMN NITEMCLI POSITION 51;

ALTER TABLE VDITORCAMENTO ALTER COLUMN DTINS POSITION 52;

ALTER TABLE VDITORCAMENTO ALTER COLUMN HINS POSITION 53;

ALTER TABLE VDITORCAMENTO ALTER COLUMN IDUSUINS POSITION 54;

ALTER TABLE VDITORCAMENTO ALTER COLUMN DTALT POSITION 55;

ALTER TABLE VDITORCAMENTO ALTER COLUMN HALT POSITION 56;

ALTER TABLE VDITORCAMENTO ALTER COLUMN IDUSUALT POSITION 57;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDITVENDA ALTER COLUMN TIPOVENDA POSITION 3;

ALTER TABLE VDITVENDA ALTER COLUMN CODVENDA POSITION 4;

ALTER TABLE VDITVENDA ALTER COLUMN CODITVENDA POSITION 5;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPNT POSITION 6;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALNT POSITION 7;

ALTER TABLE VDITVENDA ALTER COLUMN CODNAT POSITION 8;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPPD POSITION 9;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALPD POSITION 10;

ALTER TABLE VDITVENDA ALTER COLUMN CODPROD POSITION 11;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPLE POSITION 12;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALLE POSITION 13;

ALTER TABLE VDITVENDA ALTER COLUMN CODLOTE POSITION 14;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPAX POSITION 15;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALAX POSITION 16;

ALTER TABLE VDITVENDA ALTER COLUMN CODALMOX POSITION 17;

ALTER TABLE VDITVENDA ALTER COLUMN QTDITVENDA POSITION 18;

ALTER TABLE VDITVENDA ALTER COLUMN QTDITVENDACANC POSITION 19;

ALTER TABLE VDITVENDA ALTER COLUMN PRECOITVENDA POSITION 20;

ALTER TABLE VDITVENDA ALTER COLUMN PERCDESCITVENDA POSITION 21;

ALTER TABLE VDITVENDA ALTER COLUMN VLRDESCITVENDA POSITION 22;

ALTER TABLE VDITVENDA ALTER COLUMN PERCICMSITVENDA POSITION 23;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEICMSITVENDA POSITION 24;

ALTER TABLE VDITVENDA ALTER COLUMN VLRICMSITVENDA POSITION 25;

ALTER TABLE VDITVENDA ALTER COLUMN PERCIPIITVENDA POSITION 26;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEIPIITVENDA POSITION 27;

ALTER TABLE VDITVENDA ALTER COLUMN VLRIPIITVENDA POSITION 28;

ALTER TABLE VDITVENDA ALTER COLUMN VLRLIQITVENDA POSITION 29;

ALTER TABLE VDITVENDA ALTER COLUMN PERCCOMISITVENDA POSITION 30;

ALTER TABLE VDITVENDA ALTER COLUMN VLRCOMISITVENDA POSITION 31;

ALTER TABLE VDITVENDA ALTER COLUMN VLRADICITVENDA POSITION 32;

ALTER TABLE VDITVENDA ALTER COLUMN PERCISSITVENDA POSITION 33;

ALTER TABLE VDITVENDA ALTER COLUMN VLRISSITVENDA POSITION 34;

ALTER TABLE VDITVENDA ALTER COLUMN VLRFRETEITVENDA POSITION 35;

ALTER TABLE VDITVENDA ALTER COLUMN VLRPRODITVENDA POSITION 36;

ALTER TABLE VDITVENDA ALTER COLUMN VLRISENTASITVENDA POSITION 37;

ALTER TABLE VDITVENDA ALTER COLUMN VLROUTRASITVENDA POSITION 38;

ALTER TABLE VDITVENDA ALTER COLUMN REFPROD POSITION 39;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEISSITVENDA POSITION 40;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEICMSBRUTITVENDA POSITION 41;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEICMSSTITVENDA POSITION 42;

ALTER TABLE VDITVENDA ALTER COLUMN VLRICMSSTITVENDA POSITION 43;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASECOMISITVENDA POSITION 44;

ALTER TABLE VDITVENDA ALTER COLUMN MARGEMVLAGRITVENDA POSITION 45;

ALTER TABLE VDITVENDA ALTER COLUMN OBSITVENDA POSITION 46;

ALTER TABLE VDITVENDA ALTER COLUMN ORIGFISC POSITION 47;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPTT POSITION 48;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALTT POSITION 49;

ALTER TABLE VDITVENDA ALTER COLUMN CODTRATTRIB POSITION 50;

ALTER TABLE VDITVENDA ALTER COLUMN TIPOFISC POSITION 51;

ALTER TABLE VDITVENDA ALTER COLUMN TIPOST POSITION 52;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPME POSITION 53;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALME POSITION 54;

ALTER TABLE VDITVENDA ALTER COLUMN CODMENS POSITION 55;

ALTER TABLE VDITVENDA ALTER COLUMN STRDESCITVENDA POSITION 56;

ALTER TABLE VDITVENDA ALTER COLUMN QTDDEVITVENDA POSITION 57;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPLG POSITION 58;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALLG POSITION 59;

ALTER TABLE VDITVENDA ALTER COLUMN CODLOG POSITION 60;

ALTER TABLE VDITVENDA ALTER COLUMN CANCITVENDA POSITION 61;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPPE POSITION 62;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALPE POSITION 63;

ALTER TABLE VDITVENDA ALTER COLUMN CODPE POSITION 64;

ALTER TABLE VDITVENDA ALTER COLUMN DIASPE POSITION 65;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPCV POSITION 66;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALCV POSITION 67;

ALTER TABLE VDITVENDA ALTER COLUMN CODCONV POSITION 68;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPIF POSITION 69;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALIF POSITION 70;

ALTER TABLE VDITVENDA ALTER COLUMN CODFISC POSITION 71;

ALTER TABLE VDITVENDA ALTER COLUMN CODITFISC POSITION 72;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPCP POSITION 73;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALCP POSITION 74;

ALTER TABLE VDITVENDA ALTER COLUMN CODCOMPRA POSITION 75;

ALTER TABLE VDITVENDA ALTER COLUMN CODITCOMPRA POSITION 76;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPVR POSITION 77;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALVR POSITION 78;

ALTER TABLE VDITVENDA ALTER COLUMN TIPOVENDAVR POSITION 79;

ALTER TABLE VDITVENDA ALTER COLUMN CODVENDAVR POSITION 80;

ALTER TABLE VDITVENDA ALTER COLUMN CODITVENDAVR POSITION 81;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPNS POSITION 82;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALNS POSITION 83;

ALTER TABLE VDITVENDA ALTER COLUMN NUMSERIETMP POSITION 84;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEICMSSTRETITVENDA POSITION 85;

ALTER TABLE VDITVENDA ALTER COLUMN VLRICMSSTRETITVENDA POSITION 86;

ALTER TABLE VDITVENDA ALTER COLUMN CALCSTCM POSITION 87;

ALTER TABLE VDITVENDA ALTER COLUMN PEDCLIITVENDA POSITION 88;

ALTER TABLE VDITVENDA ALTER COLUMN NITEMCLI POSITION 89;

ALTER TABLE VDITVENDA ALTER COLUMN VLRICMSDEVIDO POSITION 90;

ALTER TABLE VDITVENDA ALTER COLUMN VLRICMSDIFERIDO POSITION 91;

ALTER TABLE VDITVENDA ALTER COLUMN PBCOP POSITION 92;

ALTER TABLE VDITVENDA ALTER COLUMN ICMSPART POSITION 93;

ALTER TABLE VDITVENDA ALTER COLUMN PFCP POSITION 94;

ALTER TABLE VDITVENDA ALTER COLUMN VBCUFDEST POSITION 95;

ALTER TABLE VDITVENDA ALTER COLUMN VFCPUFDEST POSITION 96;

ALTER TABLE VDITVENDA ALTER COLUMN VICMSUFDEST POSITION 97;

ALTER TABLE VDITVENDA ALTER COLUMN VICMSUFREMET POSITION 98;

ALTER TABLE VDITVENDA ALTER COLUMN PICMSINTER POSITION 99;

ALTER TABLE VDITVENDA ALTER COLUMN PICMSUFDEST POSITION 100;

ALTER TABLE VDITVENDA ALTER COLUMN EMMANUT POSITION 101;

ALTER TABLE VDITVENDA ALTER COLUMN DTINS POSITION 102;

ALTER TABLE VDITVENDA ALTER COLUMN HINS POSITION 103;

ALTER TABLE VDITVENDA ALTER COLUMN IDUSUINS POSITION 104;

ALTER TABLE VDITVENDA ALTER COLUMN DTALT POSITION 105;

ALTER TABLE VDITVENDA ALTER COLUMN HALT POSITION 106;

ALTER TABLE VDITVENDA ALTER COLUMN IDUSUALT POSITION 107;

ALTER TABLE VDMODCONTR ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDMODCONTR ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDMODCONTR ALTER COLUMN CODMODCONTR POSITION 3;

ALTER TABLE VDMODCONTR ALTER COLUMN DESCMODCONTR POSITION 4;

ALTER TABLE VDMODCONTR ALTER COLUMN LAYOUTMODCONTR POSITION 5;

ALTER TABLE VDMODCONTR ALTER COLUMN TPMODCONTR POSITION 6;

ALTER TABLE VDMODCONTR ALTER COLUMN FONTESQL POSITION 7;

ALTER TABLE VDMODCONTR ALTER COLUMN CODEMPBO POSITION 8;

ALTER TABLE VDMODCONTR ALTER COLUMN CODFILIALBO POSITION 9;

ALTER TABLE VDMODCONTR ALTER COLUMN CODBANCO POSITION 10;

ALTER TABLE VDMODCONTR ALTER COLUMN CODEMPCB POSITION 11;

ALTER TABLE VDMODCONTR ALTER COLUMN CODFILIALCB POSITION 12;

ALTER TABLE VDMODCONTR ALTER COLUMN CODCARTCOB POSITION 13;

ALTER TABLE VDMODCONTR ALTER COLUMN TEXTO1 POSITION 14;

ALTER TABLE VDMODCONTR ALTER COLUMN TEXTO2 POSITION 15;

ALTER TABLE VDMODCONTR ALTER COLUMN CODEMPIL POSITION 16;

ALTER TABLE VDMODCONTR ALTER COLUMN CODFILIALIL POSITION 17;

ALTER TABLE VDMODCONTR ALTER COLUMN CODIMGLG POSITION 18;

ALTER TABLE VDMODCONTR ALTER COLUMN DTINS POSITION 19;

ALTER TABLE VDMODCONTR ALTER COLUMN HINS POSITION 20;

ALTER TABLE VDMODCONTR ALTER COLUMN IDUSUINS POSITION 21;

ALTER TABLE VDMODCONTR ALTER COLUMN DTALT POSITION 22;

ALTER TABLE VDMODCONTR ALTER COLUMN HALT POSITION 23;

ALTER TABLE VDMODCONTR ALTER COLUMN IDUSUALT POSITION 24;

ALTER TABLE VDMOTORISTA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDMOTORISTA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDMOTORISTA ALTER COLUMN CODMOT POSITION 3;

ALTER TABLE VDMOTORISTA ALTER COLUMN CNH POSITION 4;

ALTER TABLE VDMOTORISTA ALTER COLUMN DTVENCCNH POSITION 5;

ALTER TABLE VDMOTORISTA ALTER COLUMN CODPAIS POSITION 6;

ALTER TABLE VDMOTORISTA ALTER COLUMN CODMUNIC POSITION 7;

ALTER TABLE VDMOTORISTA ALTER COLUMN SIGLAUF POSITION 8;

ALTER TABLE VDMOTORISTA ALTER COLUMN NOMEMOT POSITION 9;

ALTER TABLE VDMOTORISTA ALTER COLUMN CPFMOT POSITION 10;

ALTER TABLE VDMOTORISTA ALTER COLUMN ENDMOT POSITION 11;

ALTER TABLE VDMOTORISTA ALTER COLUMN NUMMOT POSITION 12;

ALTER TABLE VDMOTORISTA ALTER COLUMN COMPLMOT POSITION 13;

ALTER TABLE VDMOTORISTA ALTER COLUMN BAIRMOT POSITION 14;

ALTER TABLE VDMOTORISTA ALTER COLUMN CEPMOT POSITION 15;

ALTER TABLE VDMOTORISTA ALTER COLUMN FONEMOT POSITION 16;

ALTER TABLE VDMOTORISTA ALTER COLUMN CELMOT POSITION 17;

ALTER TABLE VDMOTORISTA ALTER COLUMN DDDMOT POSITION 18;

ALTER TABLE VDMOTORISTA ALTER COLUMN CONJUGEMOT POSITION 19;

ALTER TABLE VDMOTORISTA ALTER COLUMN NRODEPENDMOT POSITION 20;

ALTER TABLE VDMOTORISTA ALTER COLUMN RGMOT POSITION 21;

ALTER TABLE VDMOTORISTA ALTER COLUMN SSPMOT POSITION 22;

ALTER TABLE VDMOTORISTA ALTER COLUMN NROPISMOT POSITION 23;

ALTER TABLE VDMOTORISTA ALTER COLUMN OBSMOT POSITION 24;

ALTER TABLE VDMOTORISTA ALTER COLUMN EMAILMOT POSITION 25;

ALTER TABLE VDMOTORISTA ALTER COLUMN CODEMPTN POSITION 26;

ALTER TABLE VDMOTORISTA ALTER COLUMN CODFILIALTN POSITION 27;

ALTER TABLE VDMOTORISTA ALTER COLUMN CODTRAN POSITION 28;

ALTER TABLE VDMOTORISTA ALTER COLUMN DTINS POSITION 29;

ALTER TABLE VDMOTORISTA ALTER COLUMN HINS POSITION 30;

ALTER TABLE VDMOTORISTA ALTER COLUMN IDUSUINS POSITION 31;

ALTER TABLE VDMOTORISTA ALTER COLUMN DTALT POSITION 32;

ALTER TABLE VDMOTORISTA ALTER COLUMN HALT POSITION 33;

ALTER TABLE VDMOTORISTA ALTER COLUMN IDUSUALT POSITION 34;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDORCAMENTO ALTER COLUMN TIPOORC POSITION 3;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODORC POSITION 4;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODEMPAE POSITION 5;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODFILIALAE POSITION 6;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODATEND POSITION 7;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODEMPCV POSITION 8;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODFILIALCV POSITION 9;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODCONV POSITION 10;

ALTER TABLE VDORCAMENTO ALTER COLUMN DTORC POSITION 11;

ALTER TABLE VDORCAMENTO ALTER COLUMN DTVENCORC POSITION 12;

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRPRODORC POSITION 13;

ALTER TABLE VDORCAMENTO ALTER COLUMN PERCDESCORC POSITION 14;

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRDESCORC POSITION 15;

ALTER TABLE VDORCAMENTO ALTER COLUMN PERCADICORC POSITION 16;

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRADICORC POSITION 17;

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRDESCITORC POSITION 18;

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRLIQORC POSITION 19;

ALTER TABLE VDORCAMENTO ALTER COLUMN STATUSORC POSITION 20;

ALTER TABLE VDORCAMENTO ALTER COLUMN OBSORC POSITION 21;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODPLANOPAG POSITION 22;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODFILIALPG POSITION 23;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODEMPPG POSITION 24;

ALTER TABLE VDORCAMENTO ALTER COLUMN TXT01 POSITION 25;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODEMPVD POSITION 26;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODFILIALVD POSITION 27;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODVEND POSITION 28;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODEMPCL POSITION 29;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODFILIALCL POSITION 30;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODCLI POSITION 31;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODTPCONV POSITION 32;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODFILIALTC POSITION 33;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODEMPTC POSITION 34;

ALTER TABLE VDORCAMENTO ALTER COLUMN PRAZOENTORC POSITION 35;

ALTER TABLE VDORCAMENTO ALTER COLUMN EMMANUT POSITION 36;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODCLCOMIS POSITION 37;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODEMPCM POSITION 38;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODFILIALCM POSITION 39;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODEMPTN POSITION 40;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODFILIALTN POSITION 41;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODTRAN POSITION 42;

ALTER TABLE VDORCAMENTO ALTER COLUMN TIPOFRETE POSITION 43;

ALTER TABLE VDORCAMENTO ALTER COLUMN ADICFRETE POSITION 44;

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRFRETEORC POSITION 45;

ALTER TABLE VDORCAMENTO ALTER COLUMN VLRCOMISORC POSITION 46;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODEMPTM POSITION 47;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODFILIALTM POSITION 48;

ALTER TABLE VDORCAMENTO ALTER COLUMN CODTIPOMOV POSITION 49;

ALTER TABLE VDORCAMENTO ALTER COLUMN DTAPROVORC POSITION 50;

ALTER TABLE VDORCAMENTO ALTER COLUMN DTPREVENTORC POSITION 51;

ALTER TABLE VDORCAMENTO ALTER COLUMN HPREVENTORC POSITION 52;

ALTER TABLE VDORCAMENTO ALTER COLUMN JUSTIFICCANCORC POSITION 53;

ALTER TABLE VDORCAMENTO ALTER COLUMN ACORC POSITION 54;

ALTER TABLE VDORCAMENTO ALTER COLUMN PEDCLIORC POSITION 55;

ALTER TABLE VDORCAMENTO ALTER COLUMN DTINS POSITION 56;

ALTER TABLE VDORCAMENTO ALTER COLUMN HINS POSITION 57;

ALTER TABLE VDORCAMENTO ALTER COLUMN IDUSUINS POSITION 58;

ALTER TABLE VDORCAMENTO ALTER COLUMN DTALT POSITION 59;

ALTER TABLE VDORCAMENTO ALTER COLUMN HALT POSITION 60;

ALTER TABLE VDORCAMENTO ALTER COLUMN IDUSUALT POSITION 61;

ALTER TABLE VDROMANEIO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDROMANEIO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDROMANEIO ALTER COLUMN CODROMA POSITION 3;

ALTER TABLE VDROMANEIO ALTER COLUMN DATAROMA POSITION 4;

ALTER TABLE VDROMANEIO ALTER COLUMN DTSAIDAROMA POSITION 5;

ALTER TABLE VDROMANEIO ALTER COLUMN DTPREVROMA POSITION 6;

ALTER TABLE VDROMANEIO ALTER COLUMN DTENTREGAROMA POSITION 7;

ALTER TABLE VDROMANEIO ALTER COLUMN STATUSROMA POSITION 8;

ALTER TABLE VDROMANEIO ALTER COLUMN VOLUMES POSITION 9;

ALTER TABLE VDROMANEIO ALTER COLUMN CODEMPTN POSITION 10;

ALTER TABLE VDROMANEIO ALTER COLUMN CODFILIALTN POSITION 11;

ALTER TABLE VDROMANEIO ALTER COLUMN CODTRAN POSITION 12;

ALTER TABLE VDROMANEIO ALTER COLUMN CODEMPEX POSITION 13;

ALTER TABLE VDROMANEIO ALTER COLUMN CODFILIALEX POSITION 14;

ALTER TABLE VDROMANEIO ALTER COLUMN TICKET POSITION 15;

ALTER TABLE VDROMANEIO ALTER COLUMN DTINS POSITION 16;

ALTER TABLE VDROMANEIO ALTER COLUMN HINS POSITION 17;

ALTER TABLE VDROMANEIO ALTER COLUMN IDUSUINS POSITION 18;

ALTER TABLE VDROMANEIO ALTER COLUMN DTALT POSITION 19;

ALTER TABLE VDROMANEIO ALTER COLUMN HALT POSITION 20;

ALTER TABLE VDROMANEIO ALTER COLUMN IDUSUALT POSITION 21;

ALTER TABLE VDTRANSP ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDTRANSP ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDTRANSP ALTER COLUMN CODTRAN POSITION 3;

ALTER TABLE VDTRANSP ALTER COLUMN RAZTRAN POSITION 4;

ALTER TABLE VDTRANSP ALTER COLUMN NOMETRAN POSITION 5;

ALTER TABLE VDTRANSP ALTER COLUMN CNPJTRAN POSITION 6;

ALTER TABLE VDTRANSP ALTER COLUMN CPFTRAN POSITION 7;

ALTER TABLE VDTRANSP ALTER COLUMN INSCTRAN POSITION 8;

ALTER TABLE VDTRANSP ALTER COLUMN ENDTRAN POSITION 9;

ALTER TABLE VDTRANSP ALTER COLUMN NUMTRAN POSITION 10;

ALTER TABLE VDTRANSP ALTER COLUMN COMPLTRAN POSITION 11;

ALTER TABLE VDTRANSP ALTER COLUMN BAIRTRAN POSITION 12;

ALTER TABLE VDTRANSP ALTER COLUMN CIDTRAN POSITION 13;

ALTER TABLE VDTRANSP ALTER COLUMN CEPTRAN POSITION 14;

ALTER TABLE VDTRANSP ALTER COLUMN FONETRAN POSITION 15;

ALTER TABLE VDTRANSP ALTER COLUMN FAXTRAN POSITION 16;

ALTER TABLE VDTRANSP ALTER COLUMN UFTRAN POSITION 17;

ALTER TABLE VDTRANSP ALTER COLUMN TIPOTRAN POSITION 18;

ALTER TABLE VDTRANSP ALTER COLUMN CELTRAN POSITION 19;

ALTER TABLE VDTRANSP ALTER COLUMN CONTTRAN POSITION 20;

ALTER TABLE VDTRANSP ALTER COLUMN DDDFONETRAN POSITION 21;

ALTER TABLE VDTRANSP ALTER COLUMN DDDFAXTRAN POSITION 22;

ALTER TABLE VDTRANSP ALTER COLUMN DDDCELTRAN POSITION 23;

ALTER TABLE VDTRANSP ALTER COLUMN CODMUNIC POSITION 24;

ALTER TABLE VDTRANSP ALTER COLUMN SIGLAUF POSITION 25;

ALTER TABLE VDTRANSP ALTER COLUMN CODPAIS POSITION 26;

ALTER TABLE VDTRANSP ALTER COLUMN CODEMPUC POSITION 27;

ALTER TABLE VDTRANSP ALTER COLUMN CODFILIALUC POSITION 28;

ALTER TABLE VDTRANSP ALTER COLUMN CODUNIFCOD POSITION 29;

ALTER TABLE VDTRANSP ALTER COLUMN CODEMPFR POSITION 30;

ALTER TABLE VDTRANSP ALTER COLUMN CODFILIALFR POSITION 31;

ALTER TABLE VDTRANSP ALTER COLUMN CODFOR POSITION 32;

ALTER TABLE VDTRANSP ALTER COLUMN CONJUGETRAN POSITION 33;

ALTER TABLE VDTRANSP ALTER COLUMN CODEMPBO POSITION 34;

ALTER TABLE VDTRANSP ALTER COLUMN CODFILIALBO POSITION 35;

ALTER TABLE VDTRANSP ALTER COLUMN CODBANCO POSITION 36;

ALTER TABLE VDTRANSP ALTER COLUMN AGENCIATRAN POSITION 37;

ALTER TABLE VDTRANSP ALTER COLUMN NUMCONTATRAN POSITION 38;

ALTER TABLE VDTRANSP ALTER COLUMN PLACATRAN POSITION 39;

ALTER TABLE VDTRANSP ALTER COLUMN NRODEPENDTRAN POSITION 40;

ALTER TABLE VDTRANSP ALTER COLUMN RGTRAN POSITION 41;

ALTER TABLE VDTRANSP ALTER COLUMN SSPTRAN POSITION 42;

ALTER TABLE VDTRANSP ALTER COLUMN CODGPS POSITION 43;

ALTER TABLE VDTRANSP ALTER COLUMN NROPISTRAN POSITION 44;

ALTER TABLE VDTRANSP ALTER COLUMN OBSTRAN POSITION 45;

ALTER TABLE VDTRANSP ALTER COLUMN EMAILTRAN POSITION 46;

ALTER TABLE VDTRANSP ALTER COLUMN EMAILNFETRAN POSITION 47;

ALTER TABLE VDTRANSP ALTER COLUMN RNTCTRAN POSITION 48;

ALTER TABLE VDTRANSP ALTER COLUMN VALIDRNTC POSITION 49;

ALTER TABLE VDTRANSP ALTER COLUMN DTINS POSITION 50;

ALTER TABLE VDTRANSP ALTER COLUMN HINS POSITION 51;

ALTER TABLE VDTRANSP ALTER COLUMN IDUSUINS POSITION 52;

ALTER TABLE VDTRANSP ALTER COLUMN DTALT POSITION 53;

ALTER TABLE VDTRANSP ALTER COLUMN HALT POSITION 54;

ALTER TABLE VDTRANSP ALTER COLUMN IDUSUALT POSITION 55;

ALTER TABLE VDVEICULO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDVEICULO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDVEICULO ALTER COLUMN CODVEIC POSITION 3;

ALTER TABLE VDVEICULO ALTER COLUMN PLACA POSITION 4;

ALTER TABLE VDVEICULO ALTER COLUMN RENAVAM POSITION 5;

ALTER TABLE VDVEICULO ALTER COLUMN CODPAIS POSITION 6;

ALTER TABLE VDVEICULO ALTER COLUMN CODMUNIC POSITION 7;

ALTER TABLE VDVEICULO ALTER COLUMN SIGLAUF POSITION 8;

ALTER TABLE VDVEICULO ALTER COLUMN FABRICANTE POSITION 9;

ALTER TABLE VDVEICULO ALTER COLUMN MODELO POSITION 10;

ALTER TABLE VDVEICULO ALTER COLUMN DESCCOR POSITION 11;

ALTER TABLE VDVEICULO ALTER COLUMN CODCOR POSITION 12;

ALTER TABLE VDVEICULO ALTER COLUMN OBS POSITION 13;

ALTER TABLE VDVEICULO ALTER COLUMN ANOFABRIC POSITION 14;

ALTER TABLE VDVEICULO ALTER COLUMN ANOMODELO POSITION 15;

ALTER TABLE VDVEICULO ALTER COLUMN CODEMPTN POSITION 16;

ALTER TABLE VDVEICULO ALTER COLUMN CODFILIALTN POSITION 17;

ALTER TABLE VDVEICULO ALTER COLUMN CODTRAN POSITION 18;

ALTER TABLE VDVEICULO ALTER COLUMN RNTC POSITION 19;

ALTER TABLE VDVEICULO ALTER COLUMN PLACA1 POSITION 20;

ALTER TABLE VDVEICULO ALTER COLUMN PLACA2 POSITION 21;

ALTER TABLE VDVEICULO ALTER COLUMN PLACA3 POSITION 22;

ALTER TABLE VDVEICULO ALTER COLUMN EIXOS POSITION 23;

ALTER TABLE VDVEICULO ALTER COLUMN DTINS POSITION 24;

ALTER TABLE VDVEICULO ALTER COLUMN HINS POSITION 25;

ALTER TABLE VDVEICULO ALTER COLUMN IDUSUINS POSITION 26;

ALTER TABLE VDVEICULO ALTER COLUMN DTALT POSITION 27;

ALTER TABLE VDVEICULO ALTER COLUMN HALT POSITION 28;

ALTER TABLE VDVEICULO ALTER COLUMN IDUSUALT POSITION 29;

ALTER TABLE VDVENDA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDVENDA ALTER COLUMN TIPOVENDA POSITION 3;

ALTER TABLE VDVENDA ALTER COLUMN CODVENDA POSITION 4;

ALTER TABLE VDVENDA ALTER COLUMN SUBTIPOVENDA POSITION 5;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPVD POSITION 6;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALVD POSITION 7;

ALTER TABLE VDVENDA ALTER COLUMN CODVEND POSITION 8;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPCL POSITION 9;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALCL POSITION 10;

ALTER TABLE VDVENDA ALTER COLUMN CODCLI POSITION 11;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPPG POSITION 12;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALPG POSITION 13;

ALTER TABLE VDVENDA ALTER COLUMN CODPLANOPAG POSITION 14;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPSE POSITION 15;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALSE POSITION 16;

ALTER TABLE VDVENDA ALTER COLUMN SERIE POSITION 17;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPTM POSITION 18;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALTM POSITION 19;

ALTER TABLE VDVENDA ALTER COLUMN CODTIPOMOV POSITION 20;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPCX POSITION 21;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALCX POSITION 22;

ALTER TABLE VDVENDA ALTER COLUMN CODCAIXA POSITION 23;

ALTER TABLE VDVENDA ALTER COLUMN DOCVENDA POSITION 24;

ALTER TABLE VDVENDA ALTER COLUMN DTSAIDAVENDA POSITION 25;

ALTER TABLE VDVENDA ALTER COLUMN DTEMITVENDA POSITION 26;

ALTER TABLE VDVENDA ALTER COLUMN DTCOMPVENDA POSITION 27;

ALTER TABLE VDVENDA ALTER COLUMN HEMITVENDA POSITION 28;

ALTER TABLE VDVENDA ALTER COLUMN HSAIDAVENDA POSITION 29;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPRM POSITION 30;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALRM POSITION 31;

ALTER TABLE VDVENDA ALTER COLUMN TICKET POSITION 32;

ALTER TABLE VDVENDA ALTER COLUMN VLRPRODVENDA POSITION 33;

ALTER TABLE VDVENDA ALTER COLUMN PERCDESCVENDA POSITION 34;

ALTER TABLE VDVENDA ALTER COLUMN VLRDESCVENDA POSITION 35;

ALTER TABLE VDVENDA ALTER COLUMN VLRDESCITVENDA POSITION 36;

ALTER TABLE VDVENDA ALTER COLUMN VLRVENDA POSITION 37;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEICMSVENDA POSITION 38;

ALTER TABLE VDVENDA ALTER COLUMN VLRICMSVENDA POSITION 39;

ALTER TABLE VDVENDA ALTER COLUMN CALCICMSVENDA POSITION 40;

ALTER TABLE VDVENDA ALTER COLUMN IMPICMSVENDA POSITION 41;

ALTER TABLE VDVENDA ALTER COLUMN VLRISENTASVENDA POSITION 42;

ALTER TABLE VDVENDA ALTER COLUMN VLROUTRASVENDA POSITION 43;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEIPIVENDA POSITION 44;

ALTER TABLE VDVENDA ALTER COLUMN VLRLIQVENDA POSITION 45;

ALTER TABLE VDVENDA ALTER COLUMN PERCCOMISVENDA POSITION 46;

ALTER TABLE VDVENDA ALTER COLUMN VLRCOMISVENDA POSITION 47;

ALTER TABLE VDVENDA ALTER COLUMN STATUSVENDA POSITION 48;

ALTER TABLE VDVENDA ALTER COLUMN VLRFRETEVENDA POSITION 49;

ALTER TABLE VDVENDA ALTER COLUMN VLRADICVENDA POSITION 50;

ALTER TABLE VDVENDA ALTER COLUMN VLRIPIVENDA POSITION 51;

ALTER TABLE VDVENDA ALTER COLUMN CALCIPIVENDA POSITION 52;

ALTER TABLE VDVENDA ALTER COLUMN IMPIPIVENDA POSITION 53;

ALTER TABLE VDVENDA ALTER COLUMN OBSVENDA POSITION 54;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPBO POSITION 55;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALBO POSITION 56;

ALTER TABLE VDVENDA ALTER COLUMN CODBANCO POSITION 57;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPTC POSITION 58;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALTC POSITION 59;

ALTER TABLE VDVENDA ALTER COLUMN CODTIPOCOB POSITION 60;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEISSVENDA POSITION 61;

ALTER TABLE VDVENDA ALTER COLUMN VLRISSVENDA POSITION 62;

ALTER TABLE VDVENDA ALTER COLUMN CALCISSVENDA POSITION 63;

ALTER TABLE VDVENDA ALTER COLUMN IMPIISSVENDA POSITION 64;

ALTER TABLE VDVENDA ALTER COLUMN IMPNOTAVENDA POSITION 65;

ALTER TABLE VDVENDA ALTER COLUMN FLAG POSITION 66;

ALTER TABLE VDVENDA ALTER COLUMN CODCLASCOMIS POSITION 67;

ALTER TABLE VDVENDA ALTER COLUMN VLRPISVENDA POSITION 68;

ALTER TABLE VDVENDA ALTER COLUMN CALCPISVENDA POSITION 69;

ALTER TABLE VDVENDA ALTER COLUMN IMPPISVENDA POSITION 70;

ALTER TABLE VDVENDA ALTER COLUMN VLRCOFINSVENDA POSITION 71;

ALTER TABLE VDVENDA ALTER COLUMN CALCCOFINSVENDA POSITION 72;

ALTER TABLE VDVENDA ALTER COLUMN IMPCOFINSVENDA POSITION 73;

ALTER TABLE VDVENDA ALTER COLUMN VLRIRVENDA POSITION 74;

ALTER TABLE VDVENDA ALTER COLUMN CALCIRVENDA POSITION 75;

ALTER TABLE VDVENDA ALTER COLUMN IMPIRVENDA POSITION 76;

ALTER TABLE VDVENDA ALTER COLUMN VLRCSOCIALVENDA POSITION 77;

ALTER TABLE VDVENDA ALTER COLUMN CALCCSOCIALVENDA POSITION 78;

ALTER TABLE VDVENDA ALTER COLUMN IMPCSOCIALVENDA POSITION 79;

ALTER TABLE VDVENDA ALTER COLUMN PERCMCOMISVENDA POSITION 80;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPCM POSITION 81;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALCM POSITION 82;

ALTER TABLE VDVENDA ALTER COLUMN CODCLCOMIS POSITION 83;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPCB POSITION 84;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALCB POSITION 85;

ALTER TABLE VDVENDA ALTER COLUMN CODCARTCOB POSITION 86;

ALTER TABLE VDVENDA ALTER COLUMN PEDCLIVENDA POSITION 87;

ALTER TABLE VDVENDA ALTER COLUMN VLRICMSSTVENDA POSITION 88;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEICMSSTVENDA POSITION 89;

ALTER TABLE VDVENDA ALTER COLUMN EMMANUT POSITION 90;

ALTER TABLE VDVENDA ALTER COLUMN BLOQVENDA POSITION 91;

ALTER TABLE VDVENDA ALTER COLUMN VLRICMSSIMPLES POSITION 92;

ALTER TABLE VDVENDA ALTER COLUMN PERCICMSSIMPLES POSITION 93;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEPISVENDA POSITION 94;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASECOFINSVENDA POSITION 95;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASECOMIS POSITION 96;

ALTER TABLE VDVENDA ALTER COLUMN CHAVENFEVENDA POSITION 97;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPCA POSITION 98;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALCA POSITION 99;

ALTER TABLE VDVENDA ALTER COLUMN NUMCONTA POSITION 100;

ALTER TABLE VDVENDA ALTER COLUMN OBSREC POSITION 101;

ALTER TABLE VDVENDA ALTER COLUMN INFCOMPL POSITION 102;

ALTER TABLE VDVENDA ALTER COLUMN SITDOC POSITION 103;

ALTER TABLE VDVENDA ALTER COLUMN OBSNFE POSITION 104;

ALTER TABLE VDVENDA ALTER COLUMN DESCIPIVENDA POSITION 105;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPOP POSITION 106;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALOP POSITION 107;

ALTER TABLE VDVENDA ALTER COLUMN SEQOP POSITION 108;

ALTER TABLE VDVENDA ALTER COLUMN CODOP POSITION 109;

ALTER TABLE VDVENDA ALTER COLUMN LOCALSERV POSITION 110;

ALTER TABLE VDVENDA ALTER COLUMN NROATUALIZADO POSITION 111;

ALTER TABLE VDVENDA ALTER COLUMN CNF POSITION 112;

ALTER TABLE VDVENDA ALTER COLUMN SITCOMPLVENDA POSITION 113;

ALTER TABLE VDVENDA ALTER COLUMN MOTIVOCANCVENDA POSITION 114;

ALTER TABLE VDVENDA ALTER COLUMN CULTURA POSITION 115;

ALTER TABLE VDVENDA ALTER COLUMN VLRICMSDEVIDO POSITION 116;

ALTER TABLE VDVENDA ALTER COLUMN VLRICMSDIFERIDO POSITION 117;

ALTER TABLE VDVENDA ALTER COLUMN VLRTOTALPAGO POSITION 118;

ALTER TABLE VDVENDA ALTER COLUMN VLRTROCO POSITION 119;

ALTER TABLE VDVENDA ALTER COLUMN DTINS POSITION 120;

ALTER TABLE VDVENDA ALTER COLUMN HINS POSITION 121;

ALTER TABLE VDVENDA ALTER COLUMN IDUSUINS POSITION 122;

ALTER TABLE VDVENDA ALTER COLUMN DTALT POSITION 123;

ALTER TABLE VDVENDA ALTER COLUMN HALT POSITION 124;

ALTER TABLE VDVENDA ALTER COLUMN IDUSUALT POSITION 125;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODVEND POSITION 3;

ALTER TABLE VDVENDEDOR ALTER COLUMN NOMEVEND POSITION 4;

ALTER TABLE VDVENDEDOR ALTER COLUMN ENDVEND POSITION 5;

ALTER TABLE VDVENDEDOR ALTER COLUMN NUMVEND POSITION 6;

ALTER TABLE VDVENDEDOR ALTER COLUMN COMPLVEND POSITION 7;

ALTER TABLE VDVENDEDOR ALTER COLUMN BAIRVEND POSITION 8;

ALTER TABLE VDVENDEDOR ALTER COLUMN CIDVEND POSITION 9;

ALTER TABLE VDVENDEDOR ALTER COLUMN CEPVEND POSITION 10;

ALTER TABLE VDVENDEDOR ALTER COLUMN UFVEND POSITION 11;

ALTER TABLE VDVENDEDOR ALTER COLUMN FONEVEND POSITION 12;

ALTER TABLE VDVENDEDOR ALTER COLUMN FAXVEND POSITION 13;

ALTER TABLE VDVENDEDOR ALTER COLUMN EMAILVEND POSITION 14;

ALTER TABLE VDVENDEDOR ALTER COLUMN PERCCOMVEND POSITION 15;

ALTER TABLE VDVENDEDOR ALTER COLUMN COMIPIVEND POSITION 16;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODEMPPN POSITION 17;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODFILIALPN POSITION 18;

ALTER TABLE VDVENDEDOR ALTER COLUMN ANOPLAN POSITION 19;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODPLAN POSITION 20;

ALTER TABLE VDVENDEDOR ALTER COLUMN CPFVEND POSITION 21;

ALTER TABLE VDVENDEDOR ALTER COLUMN RGVEND POSITION 22;

ALTER TABLE VDVENDEDOR ALTER COLUMN CNPJVEND POSITION 23;

ALTER TABLE VDVENDEDOR ALTER COLUMN INSCVEND POSITION 24;

ALTER TABLE VDVENDEDOR ALTER COLUMN CELVEND POSITION 25;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODEMPSE POSITION 26;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODFILIALSE POSITION 27;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODSETOR POSITION 28;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODEMPCM POSITION 29;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODFILIALCM POSITION 30;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODCLCOMIS POSITION 31;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODFORNVEND POSITION 32;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODFUNC POSITION 33;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODEMPFU POSITION 34;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODFILIALFU POSITION 35;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODEMPTV POSITION 36;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODFILIALTV POSITION 37;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODTIPOVEND POSITION 38;

ALTER TABLE VDVENDEDOR ALTER COLUMN DDDFONEVEND POSITION 39;

ALTER TABLE VDVENDEDOR ALTER COLUMN DDDFAXVEND POSITION 40;

ALTER TABLE VDVENDEDOR ALTER COLUMN DDDCELVEND POSITION 41;

ALTER TABLE VDVENDEDOR ALTER COLUMN SSPVEND POSITION 42;

ALTER TABLE VDVENDEDOR ALTER COLUMN OBSVEND POSITION 43;

ALTER TABLE VDVENDEDOR ALTER COLUMN ATIVOCOMIS POSITION 44;

ALTER TABLE VDVENDEDOR ALTER COLUMN IMGASSVEND POSITION 45;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODEMPCA POSITION 46;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODFILIALCA POSITION 47;

ALTER TABLE VDVENDEDOR ALTER COLUMN NUMCONTA POSITION 48;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODEMPSC POSITION 49;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODFILIALSC POSITION 50;

ALTER TABLE VDVENDEDOR ALTER COLUMN CODSECAO POSITION 51;

ALTER TABLE VDVENDEDOR ALTER COLUMN DTINS POSITION 52;

ALTER TABLE VDVENDEDOR ALTER COLUMN HINS POSITION 53;

ALTER TABLE VDVENDEDOR ALTER COLUMN IDUSUINS POSITION 54;

ALTER TABLE VDVENDEDOR ALTER COLUMN DTALT POSITION 55;

ALTER TABLE VDVENDEDOR ALTER COLUMN HALT POSITION 56;

ALTER TABLE VDVENDEDOR ALTER COLUMN IDUSUALT POSITION 57;

ALTER TABLE VDVENDEDOR ALTER COLUMN VLRABONO POSITION 58;

ALTER TABLE VDVENDEDOR ALTER COLUMN VLRDESCONTO POSITION 59;

/* DROP: -- GRANT ADM TO "1" */
REVOKE ADM FROM "1";

/* DROP: -- GRANT ADM TO ALP */
REVOKE ADM FROM ALP;

/* DROP: -- GRANT ADM TO AMC */
REVOKE ADM FROM AMC;

/* DROP: -- GRANT ADM TO AMCAMC */
REVOKE ADM FROM AMCAMC;

/* DROP: -- GRANT ADM TO APP */
REVOKE ADM FROM APP;

/* DROP: -- GRANT ADM TO ECLS */
REVOKE ADM FROM ECLS;

/* DROP: -- GRANT ADM TO FDP */
REVOKE ADM FROM FDP;

/* DROP: -- GRANT ADM TO JAV */
REVOKE ADM FROM JAV;

/* DROP: -- GRANT ADM TO MES */
REVOKE ADM FROM MES;

/* DROP: -- GRANT ADM TO MMB */
REVOKE ADM FROM MMB;

/* DROP: -- GRANT ADM TO MMV */
REVOKE ADM FROM MMV;

/* DROP: -- GRANT ADM TO MVC */
REVOKE ADM FROM MVC;

/* DROP: -- GRANT ADM TO RFC */
REVOKE ADM FROM RFC;

/* DROP: -- GRANT ADM TO SAA */
REVOKE ADM FROM SAA;

/* DROP: -- GRANT ADM TO SBG */
REVOKE ADM FROM SBG;

/* DROP: -- GRANT ADM TO TAF */
REVOKE ADM FROM TAF;

/* DROP: -- GRANT ADM TO US01 */
REVOKE ADM FROM US01;

/* DROP: -- GRANT EXECUTE ON PROCEDURE VDGERACOMISSAOSP TO TRIGGER FNITRECEBERTGAU */
REVOKE EXECUTE ON PROCEDURE VDGERACOMISSAOSP FROM TRIGGER FNITRECEBERTGAU;

/* DROP: -- GRANT RDB$ADMIN TO AMC */
REVOKE RDB$ADMIN FROM AMC;

/* DROP: -- GRANT RDB$ADMIN TO MES */
REVOKE RDB$ADMIN FROM MES;

/* DROP: -- GRANT RDB$ADMIN TO MMB */
REVOKE RDB$ADMIN FROM MMB;

/* Create(Add) Crant */
GRANT DELETE, INSERT, SELECT, UPDATE ON EQGRUPOIMG TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON EQITRMLOGALERTA TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON EQSEQLOTE TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON EQTIPOCTRLPROD TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON FNTIPOCOBVD TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON LFCEST TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON LFCESTNCM TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON LFENQIPI TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON SGIEST TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON VDCONTREMPREGADO TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON VDFUNCAOPROJ TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON VDTIPOCONTR TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON VWPROD_PRECO_CUSTO TO ADM;

GRANT EXECUTE ON PROCEDURE CPRETULTCPFORPROD TO ADM;

GRANT EXECUTE ON PROCEDURE EQESTOQUELOTESP TO ADM;

GRANT EXECUTE ON PROCEDURE SGRETFILIAL TO PROCEDURE CPRETULTCPFORPROD;

GRANT EXECUTE ON PROCEDURE VDBUSCAPRECOSP01 TO ADM;

GRANT EXECUTE ON PROCEDURE VDBUSCAPRECOSP01 TO PROCEDURE ATBUSCAPRECOSP;

GRANT EXECUTE ON PROCEDURE VDBUSCAPRECOSP01 TO PROCEDURE CPADICITORCRECMERCSP;

GRANT EXECUTE ON PROCEDURE VDBUSCAPRECOSP01 TO PROCEDURE VDADICITORCRECMERCSP;

GRANT EXECUTE ON PROCEDURE VDBUSCAPRECOSP01 TO PROCEDURE VDBUSCAPRECOSP;

GRANT SELECT ON ATATENDIMENTOVW01 TO ADM;

GRANT SELECT ON ATATENDIMENTOVW02 TO ADM;

GRANT SELECT ON ATATENDIMENTOVW02 TO PROCEDURE ATRESUMOATENDOSP01;

GRANT SELECT ON ATATENDIMENTOVW02 TO PROCEDURE VDCONTRATOTOTSP;

GRANT SELECT ON ATATENDIMENTOVW03 TO ADM;

GRANT SELECT ON ATATENDIMENTOVW04 TO ADM;

GRANT SELECT ON ATATENDIMENTOVW05 TO ADM;

GRANT SELECT ON ATATENDIMENTOVW06 TO ADM;

GRANT SELECT ON ATATENDIMENTOVW07 TO ADM;

GRANT SELECT ON ATATENDIMENTOVW08 TO ADM;

GRANT SELECT ON CPCOMPRA TO PROCEDURE CPRETULTCPFORPROD;

GRANT SELECT ON CPCOMPRA TO PROCEDURE EQESTOQUELOTESP;

GRANT SELECT ON CPFORNECED TO PROCEDURE CPRETULTCPFORPROD;

GRANT SELECT ON CPITCOMPRA TO PROCEDURE CPRETULTCPFORPROD;

GRANT SELECT ON CPITCOMPRA TO PROCEDURE EQESTOQUELOTESP;

GRANT SELECT ON EQCONFESTOQVW01 TO ADM;

GRANT SELECT ON EQLOTE TO PROCEDURE EQESTOQUELOTESP;

GRANT SELECT ON EQMOVPROD TO PROCEDURE EQESTOQUELOTESP;

GRANT SELECT ON EQPRODUTO TO PROCEDURE CPRETULTCPFORPROD;

GRANT SELECT ON EQPRODUTO TO PROCEDURE EQESTOQUELOTESP;

GRANT SELECT ON EQPRODUTO TO PROCEDURE VDBUSCAPRECOSP01;

GRANT SELECT ON EQTIPOMOV TO PROCEDURE VDBUSCAPRECOSP01;

GRANT SELECT ON FNFLUXOCAIXAVW01 TO ADM;

GRANT SELECT ON FNRAZCLIVW01 TO ADM;

GRANT SELECT ON FNRAZFORVW01 TO ADM;

GRANT SELECT ON PPLISTAOPVW01 TO ADM;

GRANT SELECT ON SGUNIFCODVW01 TO ADM;

GRANT SELECT ON TKCONTCLIVW01 TO ADM;

GRANT SELECT ON TKCONTCLIVW02 TO ADM;

GRANT SELECT ON TKCONTCLIVW03 TO ADM;

GRANT SELECT ON VDCLIENTE TO PROCEDURE VDBUSCAPRECOSP01;

GRANT SELECT ON VDCONTRATOVW01 TO ADM;

GRANT SELECT ON VDPRECOPROD TO PROCEDURE VDBUSCAPRECOSP01;

GRANT SELECT ON VWCUSTOPROJ01 TO ADM;


/* Dropping roles */
DROP ROLE OPE;


